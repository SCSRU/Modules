<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Introduction to Longitudinal Data | Topics in Statistical Consulting</title>
  <meta name="description" content="6 Introduction to Longitudinal Data | Topics in Statistical Consulting" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Introduction to Longitudinal Data | Topics in Statistical Consulting" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Introduction to Longitudinal Data | Topics in Statistical Consulting" />
  
  
  



<meta name="date" content="2023-04-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-to-nonparametric-statistics.html"/>
<link rel="next" href="introduction-to-questionnaire-design.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Latex macros for html output

A few very common things you should use:

- $\bm{}$: Bold math.  Use bold for everything except scalars.
- $\tx{}$: Text within math.  Use for abbreviating words, e.g., $A_{\tx{miss}}$.
- $\xx, \YY$: Default macro convention for bold letters (small and capital case).
- $\aal, \TTh$: Default macro convention for bold symbols (first two letters of symbol name, i.e., $\bm{\alpha}$ and $\bm{\Theta}$).
- common stats symbols e.g., $\var$, $\cov$, $\iid$, $\N, defined below.
-->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      TeX: {
	  Macros: {
	      bm: ["\\boldsymbol{#1}",1], <!--bold math-->
	      tx: ["\\textrm{#1}",1], <!--text within math-->
	      rv: ["#2_{#1},\\ldots,#2_{#3}",3,"1"], <!--random variable \rv{X}{n}: X_1, ..., X_n-->
	      iid: ["\\overset{\\;\\tx{iid}\\;}{\\sim}"], <!--iid follows-->
	      ind: ["\\overset{\\:\\tx{ind}\\:}{\\sim}"], <!--ind follows-->
	      var: ["\\operatorname{var}"], <!--variance-->
	      cov: ["\\operatorname{cov}"], <!--coveraince-->
	      cor: ["\\operatorname{cor}"], <!--correlation-->
	      std: ["\\operatorname{se}"], <!--standard error-->
	      diag: ["\\operatorname{diag}"], <!--diagonal matrix-->
	      logit: ["\\operatorname{logit}"], <!--logit function-->
	      N: ["\\mathcal{N}"], <!--normal distribution-->
	      unif: ["\\operatorname{Unif}"], <!--Uniform distribution-->
	      ud: ["\\mathop{}\\!\\mathrm{d}"], <!--d in tegeral-->
	      der: ["\\frac{\\ud^{#1}}{\\ud{#2}^{#1}}", 2, ""], <!--\der{x}{f} d/dx f--> 
	      del: ["\\frac{\\partial^{#1}}{\\partial{#2}^{#1}}", 2, ""], <!--\del{x}{f} d/dx f-->
	      fder: ["\\frac{\\ud^{#1}#3}{\\ud{#2}^{#1}}", 3, ""], <!--\fder{x}{f} df/dx -->
	      fdel: ["\\frac{\\partial^{#1}#3}{\\partial{#2}^{#1}}", 3, ""], <!--\fdel{x}{f} df/dx -->
	      hess: ["\\frac{\\partial^2}{\\partial{#1}\\partial{#1}'}", 1], <!--\hess{x} d/dxdx -->
	      fhess: ["\\frac{\\partial^2#2}{\\partial{#1}\\partial{#1}'}", 2], <!--\fhess{x}{f} df/dxdx -->
              kbt: ["k_{\\tx{B}}T"],
	      IH: ["{\\mathfrak P}"], <!--p curl-->
	      eps: ["\\varepsilon"], <!--epsilon-->
	      paug: ["p_{\\tx{A}}"], <!--p_A-->
	      Ka: ["{\\mathcal K}"], <!--K curl-->
	      Ua: ["{\\mathcal U}"], <!--U curl-->
	      Ha: ["{\\mathcal H}"], <!--H curl-->
	      curr: ["{\\tx{curr}}"], <!--curr-->
	      prop: ["{\\tx{prop}}"], <!--prop-->
	      obs: ["{\\tx{obs}}"], <!--obs-->
	      bz: ["{\\bm{0}}"], <!--boldface 0-->
	      mm: ["{\\bm{m}}"], <!--boldface m-->
	      ww: ["{\\bm{w}}"], <!--boldface w-->
	      vv: ["{\\bm{v}}"], <!--boldface v-->
	      xx: ["{\\bm{x}}"], <!--boldface x-->
	      yy: ["{\\bm{y}}"], <!--boldface y-->
	      zz: ["{\\bm{z}}"], <!--boldface z-->
	      UU: ["{\\bm{U}}"], <!--boldface U-->
	      II: ["{\\bm{I}}"], <!--boldface I-->
	      HH: ["{\\bm{H}}"], <!--boldface H-->
	      XX: ["{\\bm{X}}"], <!--boldface X-->
	      YY: ["{\\bm{Y}}"], <!--boldface Y-->
	      ZZ: ["{\\bm{Z}}"], <!--boldface Z-->
	      aal: ["{\\bm{\\alpha}}"], <!--boldface alpha-->
	      bbe: ["{\\bm{\\beta}}"], <!--boldface beta-->
	      gga: ["{\\bm{\\gamma}}"], <!--boldface gamma-->
	      eet: ["{\\bm{\\eta}}"], <!--boldface eta-->
	      lla: ["{\\bm{\\lambda}}"], <!--boldface lambda-->
	      mmu: ["{\\bm{\\mu}}"], <!--boldface mu-->
	      pph: ["{\\bm{\\phi}}"], <!--boldface phi-->
	      pps: ["{\\bm{\\psi}}"], <!--boldface psi-->
	      rrh: ["{\\bm{\\rho}}"], <!--boldface rho-->
	      ssi: ["{\\bm{\\sigma}}"], <!--boldface sigma-->
	      tta: ["{\\bm{\\tau}}"], <!--boldface tau-->
	      tth: ["{\\bm{\\theta}}"], <!--boldface theta-->
	      eeps: ["{\\bm{\\varepsilon}}"], <!--boldface varepsilon-->
	      GGa: ["{\\bm{\\Gamma}}"], <!--boldface Gamma-->
	      SSi: ["{\\bm{\\Sigma}}"], <!--boldface Sigma-->
	      TTh: ["{\\bm{\\Theta}}"], <!--boldface Theta-->
	      cU: ["\\bm{\\mathcal{U}}"], <!--boldface U curl-->
	      rx: ["{\\tx{x}}"], <!--text x-->
	      ry: ["{\\tx{y}}"], <!--text y-->
	      rz: ["{\\tx{z}}"], <!--text z-->
	      rvx: ["{\\mathbf{x}}"], <!--boldface text x-->
	      rvz: ["{\\mathbf{z}}"], <!--boldface text z-->
	      rvc: ["{\\mathbf{c}}"], <!--boldface text c-->
	      rvzl: ["{\\mathbf{z}^{\\tx{l}}}"], <!--bold face z^l-->
	      rvzg: ["{\\mathbf{z}^{\\tx{g}}}"], <!--bold face z^g-->
	      rvt: ["{\\mathbf{t}}"], <!--boldface t-->
	      Q: ["{\\mathcal{Q}}"], <!--Q curl-->
	      O: ["{\\mathcal{O}}"], <!--O curl-->
	      U: ["{\\mathcal{U}}"], <!--U curl-->
	      R: ["{\\mathbb{R}}"], <!--real set-->
	      kl: ["{\\operatorname{KL}}"], <!--KL-->
	      sfT: ["{\\mathsf{T}}"], <!--sf T-->
	      sfk: ["{\\mathsf{k}}"], <!--sf k-->
	      sfa: ["{\\mathsf{a}}"], <!--sf a-->
	      sfh: ["{\\mathsf{h}}"], <!--sf h-->
  	      sfkl: ["{\\mathsf{k}^{\\tx{l}}}"], <!--sf k^l-->
	      sfal: ["{\\mathsf{a}^{\\tx{l}}}"], <!--sf a^l-->
	      sfhl: ["{\\mathsf{h}^{\\tx{l}}}"], <!--sf h^l-->
  	      sfkg: ["{\\mathsf{k}^{\\tx{g}}}"], <!--sf k^g-->
	      sfag: ["{\\mathsf{a}^{\\tx{g}}}"], <!--sf a^g-->
	      sfhg: ["{\\mathsf{h}^{\\tx{g}}}"], <!--sf h^g-->
	      sft: ["{\\mathsf{t}}"], <!--sf t-->
	      sfr: ["{\\mathsf{r}}"], <!--sf r-->
	      argmin: ["\\operatorname{arg\\,min}"], <!--argmin-->
	      argmax: ["\\operatorname{arg\\,max}"], <!--argmax-->
	      E: ["{\\mathbb{E}}"], <!--expectation-->
	      L: ["{\\mathcal{L}}"], <!--curl L likelihood-->
	      ellap: ["\\ell_{\\tx{Lap}}"] <!--curl l_Lap-->
	  }
      }
  });
</script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://uwaterloo.ca/statistical-consulting-and-collaborative-research-unit/" target="blank">Statistical Consulting and Collaborative Research Unit</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#editors"><i class="fa fa-check"></i>Editors</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>1</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-and-rstudio"><i class="fa fa-check"></i><b>1.1</b> R and RStudio</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-r"><i class="fa fa-check"></i><b>1.2</b> Basic R</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#rintro-calculate"><i class="fa fa-check"></i><b>1.2.1</b> Calculating with R</a></li>
<li class="chapter" data-level="1.2.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#variables"><i class="fa fa-check"></i><b>1.2.2</b> Variables</a></li>
<li class="chapter" data-level="1.2.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#vectors"><i class="fa fa-check"></i><b>1.2.3</b> Vectors</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-data-analysis-workflow"><i class="fa fa-check"></i><b>1.3</b> Basic Data Analysis Workflow</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-data-into-r"><i class="fa fa-check"></i><b>1.3.1</b> Reading Data into R</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#descriptive-statistics"><i class="fa fa-check"></i><b>1.3.2</b> Descriptive Statistics</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-visualization"><i class="fa fa-check"></i><b>1.3.3</b> Data Visualization</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#some-coding-tips"><i class="fa fa-check"></i><b>1.4</b> Some Coding Tips</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#source-editor"><i class="fa fa-check"></i><b>1.4.1</b> Source Editor</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#commenting"><i class="fa fa-check"></i><b>1.4.2</b> Commenting</a></li>
<li class="chapter" data-level="1.4.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#saving-the-environment"><i class="fa fa-check"></i><b>1.4.3</b> Saving the Environment</a></li>
<li class="chapter" data-level="1.4.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#installing-and-loading-libraries"><i class="fa fa-check"></i><b>1.4.4</b> Installing and Loading Libraries</a></li>
<li class="chapter" data-level="1.4.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#good-coding-practices"><i class="fa fa-check"></i><b>1.4.5</b> Good Coding Practices</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-help"><i class="fa fa-check"></i><b>1.5</b> Getting Help</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-documentation"><i class="fa fa-check"></i><b>1.5.1</b> R Documentation</a></li>
<li class="chapter" data-level="1.5.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#online-resources"><i class="fa fa-check"></i><b>1.5.2</b> Online Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html"><i class="fa fa-check"></i><b>2</b> Introduction to ggplot2</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#example-data-set"><i class="fa fa-check"></i><b>2.1.1</b> Example Data Set</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#data"><i class="fa fa-check"></i><b>2.2</b> Data</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#aesthetics"><i class="fa fa-check"></i><b>2.3</b> Aesthetics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#the-colour-component"><i class="fa fa-check"></i><b>2.3.1</b> The Colour Component</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#the-size-component"><i class="fa fa-check"></i><b>2.3.2</b> The Size Component</a></li>
<li class="chapter" data-level="2.3.3" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#the-shape-component"><i class="fa fa-check"></i><b>2.3.3</b> The Shape Component</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#geometrics"><i class="fa fa-check"></i><b>2.4</b> Geometrics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#line-graphs"><i class="fa fa-check"></i><b>2.4.1</b> Line Graphs</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#bar-plots"><i class="fa fa-check"></i><b>2.4.2</b> Bar Plots</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#others"><i class="fa fa-check"></i><b>2.5</b> Others</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#axes-labels"><i class="fa fa-check"></i><b>2.5.1</b> Axes Labels</a></li>
<li class="chapter" data-level="2.5.2" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#title-of-the-graph"><i class="fa fa-check"></i><b>2.5.2</b> Title of the Graph</a></li>
<li class="chapter" data-level="2.5.3" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#legends"><i class="fa fa-check"></i><b>2.5.3</b> Legends</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html"><i class="fa fa-check"></i><b>3</b> Introduction to Linear Regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#list-of-r-packages-used"><i class="fa fa-check"></i><b>3.1.1</b> List of R packages Used</a></li>
<li class="chapter" data-level="3.1.2" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#motivating-example"><i class="fa fa-check"></i><b>3.1.2</b> Motivating Example</a></li>
<li class="chapter" data-level="3.1.3" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#variables-1"><i class="fa fa-check"></i><b>3.1.3</b> Variables</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#linreg-slm"><i class="fa fa-check"></i><b>3.2</b> Simple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#linreg-slm-assumption"><i class="fa fa-check"></i><b>3.2.1</b> Assumptions</a></li>
<li class="chapter" data-level="3.2.2" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#linreg-slm-est"><i class="fa fa-check"></i><b>3.2.2</b> Estimation</a></li>
<li class="chapter" data-level="3.2.3" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#inference"><i class="fa fa-check"></i><b>3.2.3</b> Inference</a></li>
<li class="chapter" data-level="3.2.4" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#linreg-slm-modelcheck"><i class="fa fa-check"></i><b>3.2.4</b> Model Checking</a></li>
<li class="chapter" data-level="3.2.5" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#simple-linear-regression-on-a-binary-covariate"><i class="fa fa-check"></i><b>3.2.5</b> Simple Linear Regression on a Binary Covariate</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#linreg-mlm"><i class="fa fa-check"></i><b>3.3</b> Multiple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#linreg-mlm-est"><i class="fa fa-check"></i><b>3.3.1</b> Estimation</a></li>
<li class="chapter" data-level="3.3.2" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#interaction-effects"><i class="fa fa-check"></i><b>3.3.2</b> Interaction Effects</a></li>
<li class="chapter" data-level="3.3.3" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#model-selection"><i class="fa fa-check"></i><b>3.3.3</b> Model Selection</a></li>
<li class="chapter" data-level="3.3.4" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#model-diagnostics"><i class="fa fa-check"></i><b>3.3.4</b> Model Diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#further-extensions"><i class="fa fa-check"></i><b>3.4</b> Further Extensions</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#recommendations"><i class="fa fa-check"></i><b>3.4.1</b> Recommendations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>4</b> Introduction to Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="glm.html"><a href="glm.html#glm-intro"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="glm.html"><a href="glm.html#glm-rpackages"><i class="fa fa-check"></i><b>4.2</b> List of R Packages</a></li>
<li class="chapter" data-level="4.3" data-path="glm.html"><a href="glm.html#glm-framework"><i class="fa fa-check"></i><b>4.3</b> Generalized Linear Model Framework</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="glm.html"><a href="glm.html#glm-assumptions"><i class="fa fa-check"></i><b>4.3.1</b> Assumptions</a></li>
<li class="chapter" data-level="4.3.2" data-path="glm.html"><a href="glm.html#glm-links"><i class="fa fa-check"></i><b>4.3.2</b> Link Functions</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="glm.html"><a href="glm.html#glm-modelselection"><i class="fa fa-check"></i><b>4.4</b> Notes on Model Selection</a></li>
<li class="chapter" data-level="4.5" data-path="glm.html"><a href="glm.html#glm-normal"><i class="fa fa-check"></i><b>4.5</b> Normally Distributed Outcomes</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="glm.html"><a href="glm.html#glm-normal-ex"><i class="fa fa-check"></i><b>4.5.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="glm.html"><a href="glm.html#glm-logreg"><i class="fa fa-check"></i><b>4.6</b> Bernoulli Distributed Outcomes (Logistic Regression)</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="glm.html"><a href="glm.html#glm-logreg-example"><i class="fa fa-check"></i><b>4.6.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="glm.html"><a href="glm.html#glm-binprop"><i class="fa fa-check"></i><b>4.7</b> Binominal Distributed/Proportional Outcomes (Logistic Regression on Proportions)</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="glm.html"><a href="glm.html#glm-binprop-example"><i class="fa fa-check"></i><b>4.7.1</b> Example</a></li>
<li class="chapter" data-level="4.7.2" data-path="glm.html"><a href="glm.html#glm-binprop-DR"><i class="fa fa-check"></i><b>4.7.2</b> Dose-response Models</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="glm.html"><a href="glm.html#glm-poisson"><i class="fa fa-check"></i><b>4.8</b> Poisson Distributed Outcomes (Log-linear Regression)</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="glm.html"><a href="glm.html#glm-poisson-example"><i class="fa fa-check"></i><b>4.8.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="glm.html"><a href="glm.html#glm-gamma"><i class="fa fa-check"></i><b>4.9</b> Gamma Distributed (Skewed) Outcomes</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="glm.html"><a href="glm.html#glm-gamma-example"><i class="fa fa-check"></i><b>4.9.1</b> Example</a></li>
<li class="chapter" data-level="4.9.2" data-path="glm.html"><a href="glm.html#glm-gamma-example-md"><i class="fa fa-check"></i><b>4.9.2</b> Model Diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="glm.html"><a href="glm.html#further-reading"><i class="fa fa-check"></i><b>4.10</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html"><i class="fa fa-check"></i><b>5</b> Introduction to Nonparametric Statistics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#r-packages-and-data"><i class="fa fa-check"></i><b>5.1.1</b> R Packages and Data</a></li>
<li class="chapter" data-level="5.1.2" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-rank"><i class="fa fa-check"></i><b>5.1.2</b> Sample Ranks</a></li>
<li class="chapter" data-level="5.1.3" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-sd"><i class="fa fa-check"></i><b>5.1.3</b> Sampling Distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#two-sample-hypothesis-testing"><i class="fa fa-check"></i><b>5.2</b> Two-sample Hypothesis Testing</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#quick-reference-table"><i class="fa fa-check"></i><b>5.2.1</b> Quick Reference Table</a></li>
<li class="chapter" data-level="5.2.2" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-mwu"><i class="fa fa-check"></i><b>5.2.2</b> Wilcoxon Rank-Sum Test</a></li>
<li class="chapter" data-level="5.2.3" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#other-softwares"><i class="fa fa-check"></i><b>5.2.3</b> Other Softwares</a></li>
<li class="chapter" data-level="5.2.4" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-wst"><i class="fa fa-check"></i><b>5.2.4</b> Wilcoxon Signed Rank Test</a></li>
<li class="chapter" data-level="5.2.5" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-tst"><i class="fa fa-check"></i><b>5.2.5</b> Siegel-Tukey Test</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-anova"><i class="fa fa-check"></i><b>5.3</b> ANOVA-type Methods</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#one-way-anova"><i class="fa fa-check"></i><b>5.3.1</b> One-way ANOVA</a></li>
<li class="chapter" data-level="5.3.2" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#post-hoc-comparisons-for-kw-anova"><i class="fa fa-check"></i><b>5.3.2</b> Post Hoc Comparisons for KW ANOVA</a></li>
<li class="chapter" data-level="5.3.3" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#repeated-measures-anova-friedman-test"><i class="fa fa-check"></i><b>5.3.3</b> Repeated Measures ANOVA (Friedman Test)</a></li>
<li class="chapter" data-level="5.3.4" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#post-hoc-tests"><i class="fa fa-check"></i><b>5.3.4</b> Post Hoc tests</a></li>
<li class="chapter" data-level="5.3.5" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#an-example-using-r-6"><i class="fa fa-check"></i><b>5.3.5</b> An example using R</a></li>
<li class="chapter" data-level="5.3.6" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#additional-resources-for-nonparametric-anova-procedures"><i class="fa fa-check"></i><b>5.3.6</b> Additional Resources for Nonparametric ANOVA Procedures</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#boostrap-methods"><i class="fa fa-check"></i><b>5.4</b> Boostrap Methods</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#bootstrap-confidence-intervals"><i class="fa fa-check"></i><b>5.4.1</b> Bootstrap Confidence Intervals</a></li>
<li class="chapter" data-level="5.4.2" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#assumptions"><i class="fa fa-check"></i><b>5.4.2</b> Assumptions</a></li>
<li class="chapter" data-level="5.4.3" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#examples-using-r"><i class="fa fa-check"></i><b>5.4.3</b> Examples using R</a></li>
<li class="chapter" data-level="5.4.4" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#additional-resources"><i class="fa fa-check"></i><b>5.4.4</b> Additional Resources</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#random-forests"><i class="fa fa-check"></i><b>5.5</b> Random Forests</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#examples-using-r-1"><i class="fa fa-check"></i><b>5.5.1</b> Examples Using R</a></li>
<li class="chapter" data-level="5.5.2" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-arrf"><i class="fa fa-check"></i><b>5.5.2</b> Additional Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html"><i class="fa fa-check"></i><b>6</b> Introduction to Longitudinal Data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-intro"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-rpackages"><i class="fa fa-check"></i><b>6.1.1</b> List of R packages Used</a></li>
<li class="chapter" data-level="6.1.2" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-motivating"><i class="fa fa-check"></i><b>6.1.2</b> Motivating Example</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-datastruc"><i class="fa fa-check"></i><b>6.2</b> Data Structure for Longitudinal Responses</a></li>
<li class="chapter" data-level="6.3" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear"><i class="fa fa-check"></i><b>6.3</b> Linear Models for Continuous Outcome</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-assumptions"><i class="fa fa-check"></i><b>6.3.1</b> Assumptions</a></li>
<li class="chapter" data-level="6.3.2" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-modelspec"><i class="fa fa-check"></i><b>6.3.2</b> Notation and Model Specification</a></li>
<li class="chapter" data-level="6.3.3" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-corr"><i class="fa fa-check"></i><b>6.3.3</b> Correlation Structures</a></li>
<li class="chapter" data-level="6.3.4" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-estimation"><i class="fa fa-check"></i><b>6.3.4</b> Estimation</a></li>
<li class="chapter" data-level="6.3.5" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-R"><i class="fa fa-check"></i><b>6.3.5</b> Modelling in R</a></li>
<li class="chapter" data-level="6.3.6" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-HT"><i class="fa fa-check"></i><b>6.3.6</b> Hypothesis Testing</a></li>
<li class="chapter" data-level="6.3.7" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-population"><i class="fa fa-check"></i><b>6.3.7</b> Population Means</a></li>
<li class="chapter" data-level="6.3.8" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-cov"><i class="fa fa-check"></i><b>6.3.8</b> Selecting a Correlation Structure</a></li>
<li class="chapter" data-level="6.3.9" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-procedure"><i class="fa fa-check"></i><b>6.3.9</b> Model Fitting Procedure</a></li>
<li class="chapter" data-level="6.3.10" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-example2"><i class="fa fa-check"></i><b>6.3.10</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed"><i class="fa fa-check"></i><b>6.4</b> Linear Mixed Effect Models for Longitudinal Data</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-notation"><i class="fa fa-check"></i><b>6.4.1</b> Notation and Model Specification</a></li>
<li class="chapter" data-level="6.4.2" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-randomintercept"><i class="fa fa-check"></i><b>6.4.2</b> Random Intercept Models</a></li>
<li class="chapter" data-level="6.4.3" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-randominterceptslope"><i class="fa fa-check"></i><b>6.4.3</b> Random Intercept and Slope Models</a></li>
<li class="chapter" data-level="6.4.4" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-estimation"><i class="fa fa-check"></i><b>6.4.4</b> Estimation</a></li>
<li class="chapter" data-level="6.4.5" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-R"><i class="fa fa-check"></i><b>6.4.5</b> Modelling in R</a></li>
<li class="chapter" data-level="6.4.6" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-diagnostics"><i class="fa fa-check"></i><b>6.4.6</b> Model Diagnostics for Linear Mixed-Effects Models</a></li>
<li class="chapter" data-level="6.4.7" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-popmeans"><i class="fa fa-check"></i><b>6.4.7</b> Population Means</a></li>
<li class="chapter" data-level="6.4.8" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-ht"><i class="fa fa-check"></i><b>6.4.8</b> Hypothesis Testing for Fixed Effects</a></li>
<li class="chapter" data-level="6.4.9" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-lme-modelfitting"><i class="fa fa-check"></i><b>6.4.9</b> Model Fitting Procedure</a></li>
<li class="chapter" data-level="6.4.10" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-lme-ex2"><i class="fa fa-check"></i><b>6.4.10</b> Example - Milk Protein and Diet</a></li>
<li class="chapter" data-level="6.4.11" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#example---aids-clinical-trial-group"><i class="fa fa-check"></i><b>6.4.11</b> Example - AIDS Clinical Trial Group</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-glmm"><i class="fa fa-check"></i><b>6.5</b> Generalized Linear Mixed-Effects Models</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-glmm-notation"><i class="fa fa-check"></i><b>6.5.1</b> Notation and Model Specification</a></li>
<li class="chapter" data-level="6.5.2" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-glmm-R"><i class="fa fa-check"></i><b>6.5.2</b> Modelling in R</a></li>
<li class="chapter" data-level="6.5.3" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#model-diagnostics-long-glmm-md"><i class="fa fa-check"></i><b>6.5.3</b> Model Diagnostics {long-glmm-md}</a></li>
<li class="chapter" data-level="6.5.4" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-glmm-interpret"><i class="fa fa-check"></i><b>6.5.4</b> Model Interpretations</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#a-note-on-irregular-longitudinal-data"><i class="fa fa-check"></i><b>6.6</b> A Note on Irregular Longitudinal Data</a></li>
<li class="chapter" data-level="6.7" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#further-reading-1"><i class="fa fa-check"></i><b>6.7</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduction-to-questionnaire-design.html"><a href="introduction-to-questionnaire-design.html"><i class="fa fa-check"></i><b>7</b> Introduction to Questionnaire Design</a>
<ul>
<li class="chapter" data-level="7.1" data-path="introduction-to-questionnaire-design.html"><a href="introduction-to-questionnaire-design.html#questdes-plan"><i class="fa fa-check"></i><b>7.1</b> Plan the Study</a></li>
<li class="chapter" data-level="7.2" data-path="introduction-to-questionnaire-design.html"><a href="introduction-to-questionnaire-design.html#questdes-prepare"><i class="fa fa-check"></i><b>7.2</b> Prepare the Questions</a></li>
<li class="chapter" data-level="7.3" data-path="introduction-to-questionnaire-design.html"><a href="introduction-to-questionnaire-design.html#questdes-put"><i class="fa fa-check"></i><b>7.3</b> Put Together the Questionnaire</a></li>
<li class="chapter" data-level="7.4" data-path="introduction-to-questionnaire-design.html"><a href="introduction-to-questionnaire-design.html#questdes-pretest"><i class="fa fa-check"></i><b>7.4</b> Pretest the Questionnaire</a></li>
<li class="chapter" data-level="7.5" data-path="introduction-to-questionnaire-design.html"><a href="introduction-to-questionnaire-design.html#a-checklist-for-questionnaire-designs"><i class="fa fa-check"></i><b>7.5</b> A Checklist for Questionnaire Designs</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html"><i class="fa fa-check"></i><b>8</b> Introduction to Sample Size Determination</a>
<ul>
<li class="chapter" data-level="8.1" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#introduction-3"><i class="fa fa-check"></i><b>8.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-rpackages"><i class="fa fa-check"></i><b>8.1.1</b> List of R Packages Used</a></li>
<li class="chapter" data-level="8.1.2" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-errors"><i class="fa fa-check"></i><b>8.1.2</b> Type I and Type II Errors</a></li>
<li class="chapter" data-level="8.1.3" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-effect-size"><i class="fa fa-check"></i><b>8.1.3</b> Effect Size</a></li>
<li class="chapter" data-level="8.1.4" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-equivalence"><i class="fa fa-check"></i><b>8.1.4</b> Equivalence Testing</a></li>
<li class="chapter" data-level="8.1.5" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-precision"><i class="fa fa-check"></i><b>8.1.5</b> Precision-Based Sample Size Determination</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-common-models"><i class="fa fa-check"></i><b>8.2</b> Sample Size Determination for Common Models</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#pwr-pckg"><i class="fa fa-check"></i><b>8.2.1</b> The pwr Package</a></li>
<li class="chapter" data-level="8.2.2" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#gpower-software"><i class="fa fa-check"></i><b>8.2.2</b> G*Power Software</a></li>
<li class="chapter" data-level="8.2.3" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-ex-ANOVA"><i class="fa fa-check"></i><b>8.2.3</b> Sample Size Determination for Balanced One-Way ANOVA</a></li>
<li class="chapter" data-level="8.2.4" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-ex-mlr"><i class="fa fa-check"></i><b>8.2.4</b> Sample Size Determination for Multiple Regression Model</a></li>
<li class="chapter" data-level="8.2.5" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-ex-t"><i class="fa fa-check"></i><b>8.2.5</b> Sample Size Determination to Compare Two Means (Unknown, Common Variance)</a></li>
<li class="chapter" data-level="8.2.6" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-TOSTER"><i class="fa fa-check"></i><b>8.2.6</b> The TOSTER Package</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-sec-sim"><i class="fa fa-check"></i><b>8.3</b> Simulation-Based Sample Size Determination</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-sim-sing"><i class="fa fa-check"></i><b>8.3.1</b> Computing a Single Power Estimation via Simulation</a></li>
<li class="chapter" data-level="8.3.2" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-est-curve"><i class="fa fa-check"></i><b>8.3.2</b> Estimating a Power Curve via Simulation</a></li>
<li class="chapter" data-level="8.3.3" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-parallel"><i class="fa fa-check"></i><b>8.3.3</b> Parallelization for Simulation-Based Sample Size Determination</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-beyond"><i class="fa fa-check"></i><b>8.4</b> Beyond Sample Size Determination</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="general-guidelines.html"><a href="general-guidelines.html"><i class="fa fa-check"></i><b>A</b> General Guidelines</a>
<ul>
<li class="chapter" data-level="A.1" data-path="general-guidelines.html"><a href="general-guidelines.html#resources"><i class="fa fa-check"></i><b>A.1</b> Resources</a></li>
<li class="chapter" data-level="A.2" data-path="general-guidelines.html"><a href="general-guidelines.html#format"><i class="fa fa-check"></i><b>A.2</b> Format</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="general-guidelines.html"><a href="general-guidelines.html#typesetting-math"><i class="fa fa-check"></i><b>A.2.1</b> Typesetting Math</a></li>
<li class="chapter" data-level="A.2.2" data-path="general-guidelines.html"><a href="general-guidelines.html#genguide-citations"><i class="fa fa-check"></i><b>A.2.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="general-guidelines.html"><a href="general-guidelines.html#rendering-the-book"><i class="fa fa-check"></i><b>A.3</b> Rendering the Book</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="formatting-guidelines.html"><a href="formatting-guidelines.html"><i class="fa fa-check"></i><b>B</b> Formatting Guidelines</a>
<ul>
<li class="chapter" data-level="B.1" data-path="formatting-guidelines.html"><a href="formatting-guidelines.html#formatguide-general"><i class="fa fa-check"></i><b>B.1</b> General</a></li>
<li class="chapter" data-level="B.2" data-path="formatting-guidelines.html"><a href="formatting-guidelines.html#embedding-files"><i class="fa fa-check"></i><b>B.2</b> Embedding Files</a></li>
<li class="chapter" data-level="B.3" data-path="formatting-guidelines.html"><a href="formatting-guidelines.html#math"><i class="fa fa-check"></i><b>B.3</b> Math</a>
<ul>
<li class="chapter" data-level="B.3.1" data-path="formatting-guidelines.html"><a href="formatting-guidelines.html#commonly-used-math-and-stats-expressions"><i class="fa fa-check"></i><b>B.3.1</b> Commonly-Used Math and Stats Expressions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="C" data-path="git-and-github-a-quick-tutorial.html"><a href="git-and-github-a-quick-tutorial.html"><i class="fa fa-check"></i><b>C</b> Git and GitHub: A Quick Tutorial</a>
<ul>
<li class="chapter" data-level="C.1" data-path="git-and-github-a-quick-tutorial.html"><a href="git-and-github-a-quick-tutorial.html#setup"><i class="fa fa-check"></i><b>C.1</b> Setup</a></li>
<li class="chapter" data-level="C.2" data-path="git-and-github-a-quick-tutorial.html"><a href="git-and-github-a-quick-tutorial.html#contributing-to-the-project"><i class="fa fa-check"></i><b>C.2</b> Contributing to the Project</a></li>
<li class="chapter" data-level="C.3" data-path="git-and-github-a-quick-tutorial.html"><a href="git-and-github-a-quick-tutorial.html#git-mistakes"><i class="fa fa-check"></i><b>C.3</b> Git Mistakes</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="bookdown-tests.html"><a href="bookdown-tests.html"><i class="fa fa-check"></i><b>D</b> Bookdown Tests</a>
<ul>
<li class="chapter" data-level="D.1" data-path="bookdown-tests.html"><a href="bookdown-tests.html#test-math-macros"><i class="fa fa-check"></i><b>D.1</b> Test Math Macros</a></li>
<li class="chapter" data-level="D.2" data-path="bookdown-tests.html"><a href="bookdown-tests.html#test-figure"><i class="fa fa-check"></i><b>D.2</b> Test Figure</a></li>
<li class="chapter" data-level="D.3" data-path="bookdown-tests.html"><a href="bookdown-tests.html#test-cran-link"><i class="fa fa-check"></i><b>D.3</b> Test CRAN Link</a></li>
<li class="chapter" data-level="D.4" data-path="bookdown-tests.html"><a href="bookdown-tests.html#test-checklist"><i class="fa fa-check"></i><b>D.4</b> Test Checklist</a></li>
<li class="chapter" data-level="D.5" data-path="bookdown-tests.html"><a href="bookdown-tests.html#test-references"><i class="fa fa-check"></i><b>D.5</b> Test References</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Topics in Statistical Consulting</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="introduction-to-longitudinal-data" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Introduction to Longitudinal Data<a href="introduction-to-longitudinal-data.html#introduction-to-longitudinal-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><em>Author: Grace Tompkins</em></p>
<p><em>Last Updated: April 12, 2023</em></p>
<hr />
<div id="long-intro" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Introduction<a href="introduction-to-longitudinal-data.html#long-intro" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Longitudinal studies are studies in which we follow and take repeated measurements from a sample of individuals over a certain period of time. The major advantage of a longitudinal study is that one can distinguish between the outcome changes within a subject over time (longitudinal effect) and the differences among subjects at a given point in time (cohort effect). Longitudinal studies can also separate time effects and quantify different sources of variation in the data by separating the between-subject and within-subject variation. Cross-sectional studies, in which we see data only at one “snapshot” or point in time, do not have these benefits.</p>
<p>While longitudinal studies can either be prospective (subjects are followed forward in time) or retrospective (measurements on subjects are extracted historically), prospective studies tend to be preferred. This is because in retrospective studies there exists <a href="https://en.wikipedia.org/wiki/Recall_bias">recall bias</a>, where subjects inaccurately remember past events, which can impact the data collected and consequently the resultant analysis and findings <span class="citation">(<a href="#ref-diggle02" role="doc-biblioref">Diggle et al. 2002</a>)</span>.</p>
<p>A challenge of longitudinal data is that observations taken within each subject are correlated. For example, weather patterns tend to be correlated at a given location, in the sense that if today is rainy then we are more likely to have a rainy day tomorrow than a sunny day. In general, even when we have a great amount of time separation between observations, the correlation between a pair of responses on the same subject rarely approaches zero <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span>. We refer to the correlation of responses within the same individual as the <strong>intra-subject correlation</strong>. This implies that our typical statistical modeling tools which assume independence among observations are inappropriate for this type of data. Methods that account for intra-subject correlation will be discussed further in the following sections, and include linear models (Section <a href="introduction-to-longitudinal-data.html#long-linear">6.3</a>), linear mixed effect (LME) models (Section <a href="introduction-to-longitudinal-data.html#long-linearmixed">6.4</a>), and generalized linear mixed-effects models (GLMMs) (Section <a href="introduction-to-longitudinal-data.html#long-glmm">6.5</a>).</p>
<p>While longitudinal analysis is often used in the context of health data involving repeated measurements from patients, it can also be found in a variety of disciplines, including (but not limited to) <a href="https://www150.statcan.gc.ca/n1/en/pub/11f0019m/11f0019m2004227-eng.pdf?st=aVJbOo9q">economics</a>, <a href="https://www.sciencedirect.com/science/article/pii/S0167487018301648?casa_token=Zu4t8ubyZPAAAAAA:geM4RGeihOj0gGWgPeZ_xnNBB2ZA3nnOeYzlvSHHuCnEbbd9mmi-5iuR7ysEh_6Zm5_uaatnhKB_">finance</a>, <a href="https://www.mdpi.com/2071-1050/9/6/913">environmental studies</a>, and <a href="https://www.tandfonline.com/doi/abs/10.1080/00220973.1997.9943456?casa_token=KBEjZbk9xRAAAAAA:INEZk1fuIr0H59P9fl0ykz5qWKxzXnR1PZ_6H0MHwvgCnjXWC8D0A5xbLadXutbsUJx3lvKF1yXj5QE">education</a>.</p>
<p>A working example of a dentistry data set with a continuous outcome will be carried through this module, with R code accompanying the theory presented. If the statistical theory presented in each section is not of interest to the reader, the working example should be able to be followed on its own. At the end of each section that presents new methodology, a second example will be fully worked through using the methods presented.</p>
<div id="long-rpackages" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> List of R packages Used<a href="introduction-to-longitudinal-data.html#long-rpackages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this chapter, we will be using the packages <a href="https://CRAN.R-project.org/package=geesmv"><strong>geesmv</strong></a>, <a href="https://CRAN.R-project.org/package=nmle"><strong>nmle</strong></a>, <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a>, <a href="https://CRAN.R-project.org/package=emdbook"><strong>emdbook</strong></a>, <a href="https://CRAN.R-project.org/package=lattice"><strong>lattice</strong></a>, <a href="https://CRAN.R-project.org/package=lme4"><strong>lme4</strong></a>,<a href="https://CRAN.R-project.org/package=dplyr"><strong>dplyr</strong></a>, <a href="https://CRAN.R-project.org/package=HSAUR2"><strong>HSAUR2</strong></a>, <a href="https://CRAN.R-project.org/package=performance"><strong>performance</strong></a>.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="introduction-to-longitudinal-data.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geesmv) <span class="co"># load the required packages</span></span>
<span id="cb456-2"><a href="introduction-to-longitudinal-data.html#cb456-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb456-3"><a href="introduction-to-longitudinal-data.html#cb456-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb456-4"><a href="introduction-to-longitudinal-data.html#cb456-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emdbook)</span>
<span id="cb456-5"><a href="introduction-to-longitudinal-data.html#cb456-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb456-6"><a href="introduction-to-longitudinal-data.html#cb456-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb456-7"><a href="introduction-to-longitudinal-data.html#cb456-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb456-8"><a href="introduction-to-longitudinal-data.html#cb456-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HSAUR2)</span>
<span id="cb456-9"><a href="introduction-to-longitudinal-data.html#cb456-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span></code></pre></div>
</div>
<div id="long-motivating" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Motivating Example<a href="introduction-to-longitudinal-data.html#long-motivating" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the first working example, we consider the data set <code>dental</code> from the R package <a href="https://CRAN.R-project.org/package=geesmv"><strong>geesmv</strong></a>.</p>
<p>We can first load the data set <code>dental</code> to the working environment.</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="introduction-to-longitudinal-data.html#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;dental&quot;</span>) <span class="co"># load the data dental from the geesmv package</span></span>
<span id="cb457-2"><a href="introduction-to-longitudinal-data.html#cb457-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-3"><a href="introduction-to-longitudinal-data.html#cb457-3" aria-hidden="true" tabindex="-1"></a><span class="co"># update name of gender variable to be sex, as described in documentation of data set</span></span>
<span id="cb457-4"><a href="introduction-to-longitudinal-data.html#cb457-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dental) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;subject&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age_8&quot;</span>, <span class="st">&quot;age_10&quot;</span>, <span class="st">&quot;age_12&quot;</span>, <span class="st">&quot;age_14&quot;</span>)</span></code></pre></div>
<p>This data set was obtained to study the growth of 27 children (16 boys and 11 girls), which contains an orthodontic measurement (the distance from the center of the pituitary to the pterygomaxillary fissure) in millimeters, and the sex assigned at birth for each child. Orthodontic measurements were at ages 8 (baseline), 10, 12, and 14 years for each child. To learn more about the data set and its covariates, one can type <code>?dental</code> in the R Console after loading the <a href="https://CRAN.R-project.org/package=geesmv"><strong>geesmv</strong></a> package.</p>
<p>To assess the form of the data, we can look at the first six observations using the <code>head()</code> function:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="introduction-to-longitudinal-data.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dental) <span class="co"># look at the first 6 observations in the data set</span></span></code></pre></div>
<pre><code>##   subject sex age_8 age_10 age_12 age_14
## 1       1   F  21.0   20.0   21.5   23.0
## 2       2   F  21.0   21.5   24.0   25.5
## 3       3   F  20.5   24.0   24.5   26.0
## 4       4   F  23.5   24.5   25.0   26.5
## 5       5   F  21.5   23.0   22.5   23.5
## 6       6   F  20.0   21.0   21.0   22.5</code></pre>
<p>In this data set, the <code>subject</code> variable identifies the specific child and the <code>sex</code> variable is a binary variable such that <code>sex = F</code> when the subject is female and <code>sex = M</code> if male. The last four columns show the orthodontic measurements for each child at the given age, which are continuous.</p>
<p>Using this data, we want to ask the following questions:</p>
<ul>
<li>Do the orthodontic measurements increase as the age of the subjects increases?</li>
<li>Is there a difference in growth by sex assigned at birth?</li>
</ul>
<p>In order to answer these, we need to employ longitudinal methods, which will be described in the following sections.</p>
</div>
</div>
<div id="long-datastruc" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Data Structure for Longitudinal Responses<a href="introduction-to-longitudinal-data.html#long-datastruc" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Longitudinal data can be presented or stored in two different ways. <em>Wide form</em> data has a single row for each subject and a unique column for the response of the subject at different time points. In its unaltered form, the <code>dental</code> data set is in wide form. However, we often need to convert our data into <em>long form</em> in order to use many popular software packages for longitudinal data analysis. In long form, we have multiple rows per subject representing the outcome measured at different time points. We also include an additional variable denoting the time or occasion in which we obtained the measurement.</p>
<p>As an example, let’s change the <code>dental</code> data set into the long form. We can do this by employing the <code>reshape()</code> function in <code>R</code>. The <code>reshape()</code> function has many arguments available, which can be explored by typing <code>?reshape</code> in the console. Some of the important arguments, which we will be using for this example, include:</p>
<ul>
<li><code>data</code>: the data set we are converting, as a <code>dataframe</code> object in R;</li>
<li><code>direction</code>: the direction in which we are converting to;</li>
<li><code>idvar</code>: the column name of the variable identifying subjects (typically some type of id, or name);</li>
<li><code>varying</code>: the name of the sets of variables in the wide format that we want to transform into a single variable in long format (“time-varying”). Typically these are the column names of wide form data set in which the repeated outcome is measured;</li>
<li><code>times</code>: the values we are going to use in the long form that indicates when the observations were taken;</li>
<li><code>timevar</code>: the name of the variable in long form indicating the time; and</li>
<li><code>drop</code>: a vector of column names that we do not want to include in the newly reshaped data set.</li>
</ul>
<p>To reshape the wide form dental data set into long form, we can execute the following code:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="introduction-to-longitudinal-data.html#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reshape the data into long form</span></span>
<span id="cb460-2"><a href="introduction-to-longitudinal-data.html#cb460-2" aria-hidden="true" tabindex="-1"></a>dental_long <span class="ot">&lt;-</span> <span class="fu">reshape</span>(</span>
<span id="cb460-3"><a href="introduction-to-longitudinal-data.html#cb460-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dental, <span class="co"># original data in wide form</span></span>
<span id="cb460-4"><a href="introduction-to-longitudinal-data.html#cb460-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>, <span class="co"># changing from wide TO long</span></span>
<span id="cb460-5"><a href="introduction-to-longitudinal-data.html#cb460-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">idvar =</span> <span class="st">&quot;subject&quot;</span>, <span class="co"># name of variable indicating unique</span></span>
<span id="cb460-6"><a href="introduction-to-longitudinal-data.html#cb460-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subjects in wide form data set</span></span>
<span id="cb460-7"><a href="introduction-to-longitudinal-data.html#cb460-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying =</span> <span class="fu">c</span>(<span class="st">&quot;age_8&quot;</span>, <span class="st">&quot;age_10&quot;</span>, <span class="st">&quot;age_12&quot;</span>, <span class="st">&quot;age_14&quot;</span>), <span class="co"># name</span></span>
<span id="cb460-8"><a href="introduction-to-longitudinal-data.html#cb460-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of variables in which outcomes recorded</span></span>
<span id="cb460-9"><a href="introduction-to-longitudinal-data.html#cb460-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names =</span> <span class="st">&quot;distance&quot;</span>, <span class="co"># assigning a new name to the outcome</span></span>
<span id="cb460-10"><a href="introduction-to-longitudinal-data.html#cb460-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">14</span>), <span class="co"># time points in which the above</span></span>
<span id="cb460-11"><a href="introduction-to-longitudinal-data.html#cb460-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># outcomes were recorded</span></span>
<span id="cb460-12"><a href="introduction-to-longitudinal-data.html#cb460-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar =</span> <span class="st">&quot;age&quot;</span></span>
<span id="cb460-13"><a href="introduction-to-longitudinal-data.html#cb460-13" aria-hidden="true" tabindex="-1"></a>) <span class="co"># name of the time variable we&#39;re using</span></span>
<span id="cb460-14"><a href="introduction-to-longitudinal-data.html#cb460-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-15"><a href="introduction-to-longitudinal-data.html#cb460-15" aria-hidden="true" tabindex="-1"></a><span class="co"># order the data by subject ID and then by age</span></span>
<span id="cb460-16"><a href="introduction-to-longitudinal-data.html#cb460-16" aria-hidden="true" tabindex="-1"></a>dental_long <span class="ot">&lt;-</span> dental_long[<span class="fu">order</span>(dental_long<span class="sc">$</span>subject, dental_long<span class="sc">$</span>age), ]</span>
<span id="cb460-17"><a href="introduction-to-longitudinal-data.html#cb460-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-18"><a href="introduction-to-longitudinal-data.html#cb460-18" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the first 10 observations</span></span>
<span id="cb460-19"><a href="introduction-to-longitudinal-data.html#cb460-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dental_long, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##      subject sex age distance
## 1.8        1   F   8     21.0
## 1.10       1   F  10     20.0
## 1.12       1   F  12     21.5
## 1.14       1   F  14     23.0
## 2.8        2   F   8     21.0
## 2.10       2   F  10     21.5
## 2.12       2   F  12     24.0
## 2.14       2   F  14     25.5
## 3.8        3   F   8     20.5
## 3.10       3   F  10     24.0</code></pre>
<p>We see that the <code>distance</code> variable corresponds to the values in one of the last four columns of the <code>dental</code> data set in wide form for each subject. For the rest of the example, we will be using the data stored in <code>dental_long</code>.</p>
</div>
<div id="long-linear" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Linear Models for Continuous Outcome<a href="introduction-to-longitudinal-data.html#long-linear" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="long-linear-assumptions" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Assumptions<a href="introduction-to-longitudinal-data.html#long-linear-assumptions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When we are analyzing data that has a continuous outcome, we can often use a linear model to answer our research questions. In this setting, we require that</p>
<ul>
<li>the data set has a <em>balanced design</em>, meaning that the observation times are the same for all subjects,</li>
<li>we have no missing observations in our data set, and</li>
<li>the outcome is normally distributed.</li>
</ul>
<p>We note that our methodology will be particularly sensitive to these assumptions when small sample sizes are present. When collecting data, we also want to ensure that the sample is representative of the population of interest to answer the research question(s).</p>
<p>To assess the normality assumption of the outcome, we can view the outcome for all subjects using a <a href="https://en.wikipedia.org/wiki/Histogram">histogram</a> or a <a href="https://en.wikipedia.org/wiki/Q%E2%80%93Q_plot">quantile-quantile (Q-Q)</a> plot to assess normality. To do this on our dental data set, we can perform the following:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="introduction-to-longitudinal-data.html#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="co"># set graphs to be arranged in one row and two columns</span></span>
<span id="cb462-2"><a href="introduction-to-longitudinal-data.html#cb462-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-3"><a href="introduction-to-longitudinal-data.html#cb462-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dental_long<span class="sc">$</span>distance, <span class="at">xlab =</span> <span class="st">&quot;Distance&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Histogram of Outcome&quot;</span>)</span>
<span id="cb462-4"><a href="introduction-to-longitudinal-data.html#cb462-4" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of outcome</span></span>
<span id="cb462-5"><a href="introduction-to-longitudinal-data.html#cb462-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-6"><a href="introduction-to-longitudinal-data.html#cb462-6" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(dental_long<span class="sc">$</span>distance) <span class="co"># plot quantiles against normal distribution</span></span>
<span id="cb462-7"><a href="introduction-to-longitudinal-data.html#cb462-7" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(dental_long<span class="sc">$</span>distance) <span class="co"># add line</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-normality"></span>
<img src="topics_in_consulting_files/figure-html/long-normality-1.png" alt="Plots for assessing normality of the outcome." width="672" />
<p class="caption">
Figure 6.1: Plots for assessing normality of the outcome.
</p>
</div>
<p>From the plots in Figure <a href="introduction-to-longitudinal-data.html#fig:long-normality">6.1</a>, we see that our outcomes appear to be normally distributed by the histogram. Additionally, we do not see any indication of non-normality in the data by the Q-Q plot as the sample quantiles do not deviate greatly from the theoretical quantiles of a normal distribution.</p>
</div>
<div id="long-linear-modelspec" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Notation and Model Specification<a href="introduction-to-longitudinal-data.html#long-linear-modelspec" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Assume we have <span class="math inline">\(n\)</span> individuals observed at <span class="math inline">\(k\)</span> common observation times.</p>
<p>Let:</p>
<ul>
<li><span class="math inline">\(t_j\)</span> be the <span class="math inline">\(j^{th}\)</span> common assessment times, for <span class="math inline">\(j = 1, .., k\)</span>,</li>
<li><span class="math inline">\(Y_{ij}\)</span> be the response of subject <span class="math inline">\(i\)</span> at assessment time <span class="math inline">\(j\)</span>, for <span class="math inline">\(i = 1, ... ,n\)</span> and <span class="math inline">\(j = 1, ... , k\)</span>, and</li>
<li><span class="math inline">\(\xx_{ij}\)</span> be a <span class="math inline">\(p \times 1\)</span> vector recording other covariates for subject <span class="math inline">\(i\)</span> at time <span class="math inline">\(j\)</span>, for <span class="math inline">\(i = 1, ... ,n\)</span> and <span class="math inline">\(j = 1, ... , k\)</span>.</li>
</ul>
<p>We can write the observed data at each time point in matrix form. For each subject <span class="math inline">\(i = 1, ..., n\)</span>, we let
<span class="math display">\[
\bm{Y}_i = \begin{bmatrix}
Y_{i1} \\
Y_{i2} \\
\vdots \\
Y_{ik} \\
\end{bmatrix} , \text{     and } \bm{X}_i = \begin{bmatrix}
\bm{x}_{i1}^T \\
\bm{x}_{i2}^T  \\
\vdots \\
\bm{x}_{ik}^T \\
\end{bmatrix} = \begin{bmatrix}
x_{i11} &amp; x_{i12}&amp;\dots &amp; x_{i1p} \\
x_{i21} &amp; x_{i22}&amp;\dots &amp; x_{i2p} \\
\vdots &amp; \vdots &amp;\vdots &amp; \vdots \\
x_{ik1} &amp; x_{ik2}&amp;\dots &amp; x_{ikp}
\end{bmatrix}.
\]</span></p>
<p>To model the relationship between the outcome and other covariates, we can consider a linear regression model of the outcome of interest, <span class="math inline">\(Y_{ij}\)</span> based on covariates <span class="math inline">\(x_{ij}\)</span>.
<span class="math display">\[
Y_{ij} = \beta_1x_{ij1} + \beta_2x_{ij2} + ... + \beta_px_{ijp} + e_{ij}, \tx{           for } j = 1, ..., k,
\]</span>
where <span class="math inline">\(e_{ij}\)</span> represents the random errors with mean zero. To include an intercept in this model, we can let <span class="math inline">\(x_{ij1} = 1\)</span> for all subjects <span class="math inline">\(i\)</span>.</p>
<p>In practice, for longitudinal data, we model the mean of our outcome <span class="math inline">\(Y\)</span>. We assume that <span class="math inline">\(\bm{Y}_i\)</span> conditional on <span class="math inline">\(\bm{X}_i\)</span> follows a multivariate distribution:
<span class="math display">\[
\bm{Y}_i | \bm{X}_i \sim \N(\mu_i, \bm{\Sigma_i}),
\]</span>
where <span class="math inline">\(\bm{\Sigma}_i = \cov(\YY_i | \XX_i)\)</span> is a <a href="https://en.wikipedia.org/wiki/Covariance_matrix">covariance matrix</a>, whose form must be specified. The covariance matrix describes the relationship between pairs of observations within an individual. Specification of the correlation structure is discussed in the following section, Section <a href="introduction-to-longitudinal-data.html#long-linear-corr">6.3.3</a>.</p>
<p>With this notation, we can specify the corresponding linear model for <span class="math inline">\(\mu_i\)</span>, the mean of the outcome <span class="math inline">\(Y_i\)</span> conditional on <span class="math inline">\(X_i\)</span>:
<span class="math display">\[
\mu_i = E(\bm{Y}_i | \bm{X}_i) = \bm{X}_i\bm{\beta} = \begin{bmatrix}
\bm{x}_{i1}^T\bm{\beta} \\
\bm{x}_{i2}^T\bm{\beta} \\
\vdots \\
\bm{x}_{ik}^T\bm{\beta}  \\
\end{bmatrix}.
\]</span></p>
<p>We can then rewrite the multivariate normal assumption using the specified linear model as
<span class="math display">\[
\bm{Y}_i \sim \N(\bm{X}_i\bm{\beta}, \bm{\Sigma}_i).
\]</span>
Again, to include an intercept in this model, we can let the first row of the matrix <span class="math inline">\(\XX\)</span> be a row of ones. That is, <span class="math inline">\(x_{ij1} = 1\)</span> for all subjects <span class="math inline">\(i\)</span>.</p>
</div>
<div id="long-linear-corr" class="section level3 hasAnchor" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Correlation Structures<a href="introduction-to-longitudinal-data.html#long-linear-corr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Unlike in most cross-sectional studies where we are working with data at a given “snapshot” in time, data in longitudinal studies are correlated due to the repeated samples taken on the same subjects. Thus, we need to model both the relationship between the outcome and the covariates and the correlation of the responses within an individual subject.</p>
<p>If we do not account for the correlation of responses within an individual, we may end up with</p>
<ul>
<li>incorrect conclusions and incorrect inferences on the parameters <span class="math inline">\(\bm{\beta}\)</span>,</li>
<li>inefficient estimated of <span class="math inline">\(\bm{\beta}\)</span>, and/or</li>
<li>more biases caused by missing data <span class="citation">(<a href="#ref-diggle02" role="doc-biblioref">Diggle et al. 2002</a>)</span>.</li>
</ul>
<p>Under a balanced longitudinal design with common observation times, we assume a common covariance matrix for all individuals, which can be written as
<span class="math display">\[
\bm{\Sigma}_i = \begin{bmatrix}
\sigma_1^2 &amp; \sigma_{12}&amp; \dots &amp; \sigma_{1k} \\
&amp; \sigma_2^2 &amp; \dots &amp; \sigma_{2k} \\
&amp;  &amp; \ddots &amp; \vdots\\
&amp; &amp;  &amp; \sigma_k^2
\end{bmatrix}.
\]</span></p>
<p>The diagonal elements in the above matrix represent the variances of the outcome <span class="math inline">\(Y\)</span> at each time point while the off-diagonal elements represent the covariance between outcomes within a given individual at two different times. Estimating this covariance matrix can be problematic due to the large number of parameters we need to estimate. Hence, we consider different structures of covariance matrices to simplify it. We will refer to the collection of parameters in this variance-covariance matrix as <span class="math inline">\(\bm{\theta} = (\sigma_1^2, \sigma_2^2, ..., \sigma_k^2, \sigma_{12}, \sigma_{13}, ..., \sigma_{k-1,k})^T\)</span> and can write the covariance matrix as a function of these parameters, <span class="math inline">\(\bm{\Sigma}(\bm{\theta})\)</span>.</p>
<p>We typically assume that the variance of the response does not change overtime, and thus we can write
<span class="math display">\[
\bm{\Sigma}_i = \sigma^2\bm{R}_i,
\]</span>
where <span class="math inline">\(\bm{R}_i\)</span> is referred to as a correlation matrix such that
<span class="math display">\[
\bm{R}_i = \begin{bmatrix}
1 &amp; \rho_{12}&amp; \dots &amp; \rho_{1k} \\
&amp; 1 &amp; \dots &amp; \rho_{2k} \\
&amp;  &amp; \ddots &amp; \vdots\\
&amp; &amp;  &amp; 1
\end{bmatrix}.
\]</span>
This comes from the equation relating correlation and covariance, for example, <span class="math inline">\(\sigma_{12} = \sigma^2\rho_{12}\)</span> when common variances are assumed.</p>
<p>We consider different structures of <span class="math inline">\(\bm{R}_i\)</span> in our analyses and choose the most appropriate one based on the data. Commonly used correlation structures are:</p>
<ul>
<li><p><em>Unstructured Correlation</em>, the least constrained structure:
<span class="math display">\[
\bm{R}_i = \begin{bmatrix}
1 &amp; \rho_{12}&amp; \dots &amp; \rho_{1k} \\
&amp; 1 &amp; \dots &amp; \rho_{2k} \\
&amp;  &amp; \ddots &amp; \vdots\\
&amp; &amp;  &amp; 1
\end{bmatrix},
\]</span></p></li>
<li><p><em>Exchangeable Correlation</em>, which is the simplest with only one parameter (excluding the variance <span class="math inline">\(\sigma^2\)</span>) to estimate:
<span class="math display">\[
\bm{R}_i = \begin{bmatrix}
1 &amp; \rho&amp; \dots &amp; \rho \\
&amp; 1 &amp; \dots &amp; \rho \\
&amp;  &amp; \ddots &amp; \vdots\\
&amp; &amp;  &amp; 1
\end{bmatrix},
\]</span></p></li>
<li><p><em>First-order Auto Regressive Correlation</em>, which is sometimes referred to as “AR(1)” and is most suitable for evenly spaced observations where we see the correlation weakens as the time between observations gets larger:
<span class="math display">\[
\bm{R}_i = \begin{bmatrix}
1 &amp; \rho &amp; \rho^2 &amp;\dots &amp; \rho^{k-1} \\
&amp; 1 &amp; \rho &amp;\dots  &amp; \rho^{k-2} \\
&amp;  &amp;  &amp;\ddots &amp; \vdots\\
&amp; &amp; &amp; &amp; 1
\end{bmatrix},
\]</span></p></li>
<li><p><em>Exponential Correlation</em>, where <span class="math inline">\(\rho_{jl} = \exp(-\phi|t_{ij} - t_{il}|)\)</span> for some <span class="math inline">\(\phi &gt; 0\)</span>, which collapses to AR(1) if observations are equally spaced.</p></li>
</ul>
<p>We note that in practice, it is possible that the variance-covariance matrices differ among subjects, and the matrix may also depend on the covariates present in the data. More details about how to choose the appropriate structure will be discussed in Section <a href="introduction-to-longitudinal-data.html#long-linear-cov">6.3.8</a>.</p>
</div>
<div id="long-linear-estimation" class="section level3 hasAnchor" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> Estimation<a href="introduction-to-longitudinal-data.html#long-linear-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For convenience, let’s condense our notation to stack the response vectors and rewrite the linear model as <span class="math inline">\(\bm{Y}\sim N(\bm{X} \bm{\beta}, \Sigma)\)</span> where
<span class="math display">\[
\bm{Y} = \begin{bmatrix}
\bm{Y}_1 \\
\bm{Y}_2 \\
\vdots \\
\bm{Y}_n\\
\end{bmatrix} ,    \bm{X} = \begin{bmatrix}
\bm{X}_1 \\
\bm{X}_2  \\
\vdots \\
\bm{X}_n\\
\end{bmatrix}, \text{     and } \bm{\Sigma} = \begin{bmatrix}
\bm{\Sigma}_1 &amp; 0 &amp;\dots &amp; 0 \\
&amp;  \bm{\Sigma}_2 &amp;\dots  &amp; 0 \\
&amp;    &amp;\ddots &amp; \vdots\\
&amp; &amp; &amp; \bm{\Sigma}_n
\end{bmatrix}.
\]</span></p>
<p>Under the multivariate normality assumptions, and with a fully specified distribution, one approach to estimate our regression parameters <span class="math inline">\(\beta\)</span> and variance-covariance parameters <span class="math inline">\(\theta = (\sigma_1^2, \sigma_2^2, ..., \sigma_k^2, \sigma_{12}, \sigma_{13}, ..., \sigma_{k-1,k})^T\)</span> is through maximum likelihood estimation.</p>
<p>The maximum likelihood estimate (MLE) of <span class="math inline">\(\beta\)</span> is
<span class="math display">\[
\widehat{\bm{\beta}} = (\bm{X}^T\bm{\Sigma}^{-1}\bm{X})^{-1}\bm{X}^T\bm{\Sigma}^{-1}\bm{Y}.
\]</span></p>
<p>This is a function of our variance-covariance matrix <span class="math inline">\(\bm{\Sigma}\)</span> and thus a function of the parameters <span class="math inline">\(\theta\)</span>. As such, we can either estimate the parameters using <a href="https://en.wikipedia.org/wiki/Likelihood_function">profile likelihood</a> or <a href="https://en.wikipedia.org/wiki/Restricted_maximum_likelihood">restricted maximum likelihood estimation (REML)</a>. The profile likelihood estimation is desirable because of the MLE’s large-sample properties. However, the MLEs of our variance and covariance parameters <span class="math inline">\(\bm{\theta}\)</span> will be biased. The REML method was developed to overcome this issue. In general, the MLE (by the profile-likelihood approach) and REML estimates are not equal to each other for the regression parameters <span class="math inline">\(\bm{\beta}\)</span>, and thus we typically only use REML when estimating the variance and covariance parameters.</p>
<p>The MLE <span class="math inline">\(\widehat\beta\)</span> has the asymptotic normality property. That is,
<span class="math display">\[
\hat{\bm{\beta}} \sim \N(\bm{\beta}, [\bm{X}^T\bm{\Sigma}^{-1}\bm{X}]^{-1}).
\]</span></p>
<p>As <span class="math inline">\(\Sigma\)</span> must be estimated, we typically estimate the asymptotic variance-covariance matrix as
<span class="math display">\[
\widehat{\text{asvar}}(\widehat{\bm{\beta}}) = (\bm{X}^T\widehat{\bm{\Sigma}}^{-1}\bm{X})^{-1}.
\]</span>
We can use this to make inferences about regression parameters and perform hypothesis testing. For example,
<span class="math display">\[
\frac{\widehat{\beta}_j - \beta_j}{\sqrt{\widehat{\text{asvar}}}(\widehat{\beta}_j)} \dot{\sim} N(0,1),
\]</span>
where <span class="math inline">\(\sqrt{\widehat{\text{asvar}}(\widehat{\beta}_j)} = (\bm{X}^T\widehat{\bm{\Sigma}}^{-1}\bm{X})^{-1}_{(jj)}\)</span>, i.e. the <span class="math inline">\((j,j)^{th}\)</span> element of the asymptotic variance-covariance matrix.</p>
</div>
<div id="long-linear-R" class="section level3 hasAnchor" number="6.3.5">
<h3><span class="header-section-number">6.3.5</span> Modelling in R<a href="introduction-to-longitudinal-data.html#long-linear-R" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To fit a linear longitudinal model in <code>R</code>, we can use the <code>gls()</code> function from the <a href="https://CRAN.R-project.org/package=nlme"><strong>nlme</strong></a> package. This function has a number of parameters, including</p>
<ul>
<li><code>model</code>: a linear formula description of the form <code>model = response ~ covariate1 + covariate2</code>. Interaction effects can be specified using the form <code>covariate1*covariate2</code> (NOTE: to add higher order terms, one must create a new variable in the original data set as operations like <code>model = response ~ covariate1^2</code> will not be accepted in the model argument);</li>
<li><code>correlation</code>: the name of the within-group correlation structure, which may include <code>corAR1</code> for the AR(1) structure, <code>corCompSymm</code> for the exchangeable structure, <code>corExp</code> for exponential structure, <code>corSymm</code> for unstructured, and others (see <code>?corClasses</code> for other options). The default structure is an independent covariance structure;</li>
<li><code>weights</code>: an optional argument to allow for different marginal variances. For example, to allow for the variance of the responses to change for different discrete time/observation points, we can use <code>weights = varIndent(form ~1 | factor(time))</code>; and</li>
<li><code>method</code>: the name of the estimation method, where options include “ML” and “REML” (default).</li>
</ul>
<p>To demonstrate the use of this package, we will apply the <code>gls()</code> function to the transformed (long form) dental data set.</p>
<p>Now, we can start to build our model, treating <code>age</code> as a categorical time variable. Define</p>
<ul>
<li><span class="math inline">\(z_i\)</span> to be the indicator for if subject <span class="math inline">\(i\)</span> is male,</li>
<li><span class="math inline">\(t_{ij1}\)</span> to be the indicator for if the age of individual <span class="math inline">\(i\)</span> at observation <span class="math inline">\(j\)</span> is 10,</li>
<li><span class="math inline">\(t_{ij2}\)</span> to be the indicator for if the age of individual <span class="math inline">\(i\)</span> at observation <span class="math inline">\(j\)</span> is 12, and</li>
<li><span class="math inline">\(t_{ij3}\)</span> to be the indicator for if the age of individual <span class="math inline">\(i\)</span> at observation <span class="math inline">\(j\)</span> is 14.</li>
</ul>
<p>The main-effects model can be written as
<span class="math display">\[
\mu_{ij} = \beta_0 + \beta_1z_i + \beta_2t_{ij1} + \beta_3t_{ij2} + \beta_4t_{ij3}.
\]</span></p>
<p>We will assume an unstructured working correlation structure for this model for illustrative purposes. In Section <a href="introduction-to-longitudinal-data.html#long-linear-cov">6.3.8</a>, we will describe how to choose the appropriate working correlation structure.</p>
<p>To fit a model and see the output, we can write:</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="introduction-to-longitudinal-data.html#cb463-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">gls</span>(distance <span class="sc">~</span> <span class="fu">factor</span>(sex) <span class="sc">+</span> <span class="fu">factor</span>(age),</span>
<span id="cb463-2"><a href="introduction-to-longitudinal-data.html#cb463-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dental_long,</span>
<span id="cb463-3"><a href="introduction-to-longitudinal-data.html#cb463-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>,</span>
<span id="cb463-4"><a href="introduction-to-longitudinal-data.html#cb463-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">corr =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> subject) <span class="co"># unstructured</span></span>
<span id="cb463-5"><a href="introduction-to-longitudinal-data.html#cb463-5" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb463-6"><a href="introduction-to-longitudinal-data.html#cb463-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Note we are fitting the model using Maximum</span></span>
<span id="cb463-7"><a href="introduction-to-longitudinal-data.html#cb463-7" aria-hidden="true" tabindex="-1"></a><span class="co"># likelihood estimation and with no interactions (main effects only).</span></span>
<span id="cb463-8"><a href="introduction-to-longitudinal-data.html#cb463-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-9"><a href="introduction-to-longitudinal-data.html#cb463-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1) <span class="co"># see the output of the fit</span></span></code></pre></div>
<pre><code>## Generalized least squares fit by maximum likelihood
##   Model: distance ~ factor(sex) + factor(age) 
##   Data: dental_long 
##        AIC      BIC    logLik
##   450.3138 482.4993 -213.1569
## 
## Correlation Structure: General
##  Formula: ~1 | subject 
##  Parameter estimate(s):
##  Correlation: 
##   1     2     3    
## 2 0.591            
## 3 0.623 0.532      
## 4 0.464 0.674 0.700
## 
## Coefficients:
##                   Value Std.Error  t-value p-value
## (Intercept)   20.833863 0.6235854 33.40980  0.0000
## factor(sex)M   2.280355 0.7461323  3.05623  0.0029
## factor(age)10  0.981481 0.3976474  2.46822  0.0152
## factor(age)12  2.462963 0.3820559  6.44660  0.0000
## factor(age)14  3.907407 0.4554203  8.57978  0.0000
## 
##  Correlation: 
##               (Intr) fct()M fc()10 fc()12
## factor(sex)M  -0.709                     
## factor(age)10 -0.319  0.000              
## factor(age)12 -0.306  0.000  0.405       
## factor(age)14 -0.365  0.000  0.661  0.682
## 
## Standardized residuals:
##         Min          Q1         Med          Q3         Max 
## -2.74011685 -0.70682170 -0.05118776  0.57834032  2.43026224 
## 
## Residual standard error: 2.231372 
## Degrees of freedom: 108 total; 103 residual</code></pre>
<p>Under the assumption that the working correlation structure is unstructured, we can assess which variables impact the outcome (our distance measurement). In the summary of the coefficients for our model, we have very small <span class="math inline">\(p\)</span>-values for our sex variable (<span class="math inline">\(p\)</span> = 0.0029), indicating that there is a difference in distance measurements between boys and girls enrolled in the study, when controlling for the time effect. Additionally, the <span class="math inline">\(p\)</span>-values indicating the timings of the observations are small, with increasingly large coefficients, providing evidence of a possible time trend in our data. These <span class="math inline">\(p\)</span>-values come from <span class="math inline">\(t\)</span>-tests for the null hypothesis that the coefficient of interest is zero.</p>
<p>Note: similar to linear regression models, if you would like to remove the intercept in the model, we would use the formula <code>distance ~ factor(sex) + factor(age) - 1</code> when fitting the model.</p>
</div>
<div id="long-linear-HT" class="section level3 hasAnchor" number="6.3.6">
<h3><span class="header-section-number">6.3.6</span> Hypothesis Testing<a href="introduction-to-longitudinal-data.html#long-linear-HT" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose we want to see if the time trend differs between the sexes of children enrolled in the study. To formally test if there is a common time-trend between groups (sex), we can fit a model including an interaction term and perform a hypothesis test. The interaction model can be written as
<span class="math display">\[
\mu_{ij} = \beta_0 + \beta_1z_i + \beta_2t_{ij1} + \beta_3t_{ij2} + \beta_4t_{ij3} + \beta_5z_it_{ij1} + \beta_6z_it_{ij2} + \beta_7z_it_{ij3}.
\]</span></p>
<p>We fit the required model using the following code, and for now assume an unstructured correlation structure:</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="introduction-to-longitudinal-data.html#cb465-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">gls</span>(distance <span class="sc">~</span> <span class="fu">factor</span>(sex) <span class="sc">*</span> <span class="fu">factor</span>(age),</span>
<span id="cb465-2"><a href="introduction-to-longitudinal-data.html#cb465-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dental_long,</span>
<span id="cb465-3"><a href="introduction-to-longitudinal-data.html#cb465-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>,</span>
<span id="cb465-4"><a href="introduction-to-longitudinal-data.html#cb465-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">corr =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> subject) <span class="co"># unstructured </span></span>
<span id="cb465-5"><a href="introduction-to-longitudinal-data.html#cb465-5" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb465-6"><a href="introduction-to-longitudinal-data.html#cb465-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Note we are fitting the model using Maximum</span></span>
<span id="cb465-7"><a href="introduction-to-longitudinal-data.html#cb465-7" aria-hidden="true" tabindex="-1"></a><span class="co"># likelihood estimation and with main effects and interactions (by using *).</span></span>
<span id="cb465-8"><a href="introduction-to-longitudinal-data.html#cb465-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-9"><a href="introduction-to-longitudinal-data.html#cb465-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2) <span class="co"># see the output of the fit</span></span></code></pre></div>
<pre><code>## Generalized least squares fit by maximum likelihood
##   Model: distance ~ factor(sex) * factor(age) 
##   Data: dental_long 
##       AIC     BIC    logLik
##   448.377 488.609 -209.1885
## 
## Correlation Structure: General
##  Formula: ~1 | subject 
##  Parameter estimate(s):
##  Correlation: 
##   1     2     3    
## 2 0.580            
## 3 0.637 0.553      
## 4 0.516 0.753 0.705
## 
## Coefficients:
##                                Value Std.Error   t-value p-value
## (Intercept)                21.181818 0.6922613 30.598009  0.0000
## factor(sex)M                1.693182 0.8992738  1.882832  0.0626
## factor(age)10               1.045455 0.6344963  1.647692  0.1026
## factor(age)12               1.909091 0.5899117  3.236231  0.0016
## factor(age)14               2.909091 0.6812865  4.269996  0.0000
## factor(sex)M:factor(age)10 -0.107955 0.8242348 -0.130975  0.8961
## factor(sex)M:factor(age)12  0.934659 0.7663178  1.219676  0.2255
## factor(sex)M:factor(age)14  1.684659 0.8850171  1.903533  0.0598
## 
##  Correlation: 
##                            (Intr) fct()M fc()10 fc()12 fc()14 f()M:()10
## factor(sex)M               -0.770                                      
## factor(age)10              -0.458  0.353                               
## factor(age)12              -0.426  0.328  0.431                        
## factor(age)14              -0.492  0.379  0.729  0.658                 
## factor(sex)M:factor(age)10  0.353 -0.458 -0.770 -0.332 -0.561          
## factor(sex)M:factor(age)12  0.328 -0.426 -0.332 -0.770 -0.507  0.431   
## factor(sex)M:factor(age)14  0.379 -0.492 -0.561 -0.507 -0.770  0.729   
##                            f()M:()12
## factor(sex)M                        
## factor(age)10                       
## factor(age)12                       
## factor(age)14                       
## factor(sex)M:factor(age)10          
## factor(sex)M:factor(age)12          
## factor(sex)M:factor(age)14  0.658   
## 
## Standardized residuals:
##         Min          Q1         Med          Q3         Max 
## -2.65921430 -0.63297787 -0.08229677  0.63779995  2.39046392 
## 
## Residual standard error: 2.209299 
## Degrees of freedom: 108 total; 100 residual</code></pre>
<p>To test the difference in time-trends between groups (sex), we test if the last three coefficients (<span class="math inline">\(\beta_5\)</span>, <span class="math inline">\(\beta_6\)</span>, and <span class="math inline">\(\beta_7\)</span>, that are associated with the interaction terms in our model) are all equal to zero. We are testing <span class="math inline">\(H_0: \beta_5 = \beta_6 = \beta_7 = 0\)</span> vs <span class="math inline">\(H_a\)</span>: at least one of these coefficients is non-zero. To do so, we need to define a matrix. This matrix has one column for each estimated coefficient (including the intercept) and one row for each coefficient in the hypothesis test. As such, for this particular hypothesis test, let’s define the matrix
<span class="math display">\[
\bm{L} = \begin{bmatrix}
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\
\end{bmatrix},
\]</span>
which will be used to calculate our Wald test statistic <span class="math inline">\((\bm{L}\widehat{\bm{\beta}})^T[\bm{L}\widehat{\text{asvar}}(\widehat{\bm{\beta}})\bm{L}^T]^{-1}(\bm{L}\widehat{\bm{\beta}})\)</span>. This test statistic follows a chi-squared distribution with the degree of freedom equal to the <a href="https://en.wikipedia.org/wiki/Rank_(linear_algebra)">rank</a> of the matrix <span class="math inline">\(\bm{L}\)</span> (which is 3 in this case).</p>
<p>To perform this hypothesis test in <code>R</code>, we do the following:</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="introduction-to-longitudinal-data.html#cb467-1" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb467-2"><a href="introduction-to-longitudinal-data.html#cb467-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb467-3"><a href="introduction-to-longitudinal-data.html#cb467-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb467-4"><a href="introduction-to-longitudinal-data.html#cb467-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb467-5"><a href="introduction-to-longitudinal-data.html#cb467-5" aria-hidden="true" tabindex="-1"></a>) <span class="co"># create L matrix as above</span></span>
<span id="cb467-6"><a href="introduction-to-longitudinal-data.html#cb467-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-7"><a href="introduction-to-longitudinal-data.html#cb467-7" aria-hidden="true" tabindex="-1"></a>betahat <span class="ot">&lt;-</span> fit2<span class="sc">$</span>coef <span class="co"># get estimated beta hats from the model</span></span>
<span id="cb467-8"><a href="introduction-to-longitudinal-data.html#cb467-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-9"><a href="introduction-to-longitudinal-data.html#cb467-9" aria-hidden="true" tabindex="-1"></a>asvar <span class="ot">&lt;-</span> fit2<span class="sc">$</span>varBeta <span class="co"># get the estimated covariances from the model</span></span>
<span id="cb467-10"><a href="introduction-to-longitudinal-data.html#cb467-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-11"><a href="introduction-to-longitudinal-data.html#cb467-11" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate test statistic using given formula</span></span>
<span id="cb467-12"><a href="introduction-to-longitudinal-data.html#cb467-12" aria-hidden="true" tabindex="-1"></a>waldtest_stat <span class="ot">&lt;-</span> <span class="fu">t</span>(L <span class="sc">%*%</span> betahat) <span class="sc">%*%</span> <span class="fu">solve</span>(L <span class="sc">%*%</span> asvar <span class="sc">%*%</span> <span class="fu">t</span>(L)) <span class="sc">%*%</span> (L <span class="sc">%*%</span> betahat)</span>
<span id="cb467-13"><a href="introduction-to-longitudinal-data.html#cb467-13" aria-hidden="true" tabindex="-1"></a>waldtest_stat</span></code></pre></div>
<pre><code>##         [,1]
## [1,] 8.60252</code></pre>
<p>To get a <span class="math inline">\(p\)</span>-value for this test, we perform the following:</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="introduction-to-longitudinal-data.html#cb469-1" aria-hidden="true" tabindex="-1"></a>pval <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(waldtest_stat, <span class="dv">3</span>) <span class="co"># test stat follows chi-squared 3 in this case</span></span>
<span id="cb469-2"><a href="introduction-to-longitudinal-data.html#cb469-2" aria-hidden="true" tabindex="-1"></a>pval</span></code></pre></div>
<pre><code>##            [,1]
## [1,] 0.03507014</code></pre>
<p>We have a small <span class="math inline">\(p\)</span>-value, which tells us that we have sufficient evidence against <span class="math inline">\(H_0\)</span>. That is, we have evidence to suggest that the time trends vary by sex, and the model (<code>fit2</code>) with the interactions is more appropriate.</p>
<p>We can also do a <a href="https://en.wikipedia.org/wiki/Likelihood-ratio_test">likelihood ratio test (LRT)</a> as these models are nested within each other (i.e., all parameters in <code>fit1</code> are also present in <code>fit2</code>, so <code>fit1</code> is nested in <code>fit2</code>). The test statistic is <span class="math inline">\(\Lambda = -2(l_2-l_1)\)</span> where <span class="math inline">\(l_2\)</span> is the log-likelihood of <code>fit2</code> (the bigger model), and <span class="math inline">\(l_1\)</span> is the log-likelihood of <code>fit1</code> (nested model). The degree of freedom is the same as in the chi-squared test. Note that models both must be fit using maximum likelihood (<code>ML</code> argument) to perform the LRT for model parameters, and be fit with the same correlation structure.</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="introduction-to-longitudinal-data.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit1, fit2)</span></code></pre></div>
<pre><code>##      Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fit1     1 12 450.3138 482.4993 -213.1569                        
## fit2     2 15 448.3770 488.6090 -209.1885 1 vs 2 7.936725  0.0473</code></pre>
<p>Again, we have a small <span class="math inline">\(p\)</span>-value and come to the same conclusion as in the Wald test, which is to reject the null and use the model with the interaction terms.</p>
<p>We could additionally test if there was a difference in distance at baseline between sexes (<span class="math inline">\(H_0: \beta_1 = 0\)</span>) in a similar manner, or by looking at the <span class="math inline">\(p\)</span>-value in the model summary for the sex coefficient.</p>
<p>Note: If we had come to the conclusion that the time trends were the same among groups, the same methods could be used to test the hypothesis that there is no time effect (<span class="math inline">\(H_0: \beta_2 = \beta_3 = \beta_4 = 0\)</span>) or the hypothesis that there is no difference in mean outcome by sex (<span class="math inline">\(H_0: \beta_1 = 0\)</span>).</p>
<p>We again emphasize that the results can differ based on the chosen correlation structure.</p>
</div>
<div id="long-linear-population" class="section level3 hasAnchor" number="6.3.7">
<h3><span class="header-section-number">6.3.7</span> Population Means<a href="introduction-to-longitudinal-data.html#long-linear-population" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using the asymptotic results of our MLE for <span class="math inline">\(\bm{\beta}\)</span>, we can estimate the population means for different subgroups in the data, and/or at different time points.
For example, suppose we would like to know the mean distance at age 14 for males in the study, i.e. we want to estimate <span class="math inline">\(\mu = \beta_0 + \beta_1 + \beta_4\)</span>. We can define a vector
<span class="math display">\[
\bm{L} = [1,1,0,0,1]
\]</span>
to obtain the estimate
<span class="math display">\[
\widehat{\mu}  = \bm{L}\widehat{\bm{\beta}} = \widehat{\beta_0} + \widehat{\beta_1} + \widehat{\beta_4},
\]</span>
along with its standard error
<span class="math display">\[
se(\widehat{\mu}) = \sqrt{\bm{L}\widehat{\text{asvar}}(\widehat{\bm{\beta}})\bm{L}^T}.
\]</span></p>
<p>The code to obtain these estimates is as follows:</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="introduction-to-longitudinal-data.html#cb473-1" aria-hidden="true" tabindex="-1"></a>betahat <span class="ot">&lt;-</span> fit1<span class="sc">$</span>coef <span class="co"># get estimated betas from model 1</span></span>
<span id="cb473-2"><a href="introduction-to-longitudinal-data.html#cb473-2" aria-hidden="true" tabindex="-1"></a>varbeta <span class="ot">&lt;-</span> fit1<span class="sc">$</span>varBeta <span class="co"># get estimated variance covariance matrix from model 1</span></span>
<span id="cb473-3"><a href="introduction-to-longitudinal-data.html#cb473-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-4"><a href="introduction-to-longitudinal-data.html#cb473-4" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">1</span>) <span class="co"># set up row vector L</span></span>
<span id="cb473-5"><a href="introduction-to-longitudinal-data.html#cb473-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-6"><a href="introduction-to-longitudinal-data.html#cb473-6" aria-hidden="true" tabindex="-1"></a>muhat <span class="ot">&lt;-</span> L <span class="sc">%*%</span> betahat <span class="co"># calculate estimated mean</span></span>
<span id="cb473-7"><a href="introduction-to-longitudinal-data.html#cb473-7" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(L <span class="sc">%*%</span> varbeta <span class="sc">%*%</span> <span class="fu">t</span>(L)) <span class="co"># calculated estimated variance</span></span>
<span id="cb473-8"><a href="introduction-to-longitudinal-data.html#cb473-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb473-9"><a href="introduction-to-longitudinal-data.html#cb473-9" aria-hidden="true" tabindex="-1"></a>muhat</span></code></pre></div>
<pre><code>##          [,1]
## [1,] 27.02163</code></pre>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="introduction-to-longitudinal-data.html#cb475-1" aria-hidden="true" tabindex="-1"></a>se</span></code></pre></div>
<pre><code>##           [,1]
## [1,] 0.5345687</code></pre>
<p>With these quantities, we can also construct a 95% confidence interval for the mean as <span class="math inline">\(\widehat{\mu} \pm 1.960*se(\widehat{\mu})\)</span>.</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="introduction-to-longitudinal-data.html#cb477-1" aria-hidden="true" tabindex="-1"></a>CI_l <span class="ot">&lt;-</span> muhat <span class="sc">-</span> <span class="fl">1.960</span> <span class="sc">*</span> se <span class="co"># calculate lower CI bound</span></span>
<span id="cb477-2"><a href="introduction-to-longitudinal-data.html#cb477-2" aria-hidden="true" tabindex="-1"></a>CI_u <span class="ot">&lt;-</span> muhat <span class="sc">+</span> <span class="fl">1.960</span> <span class="sc">*</span> se <span class="co"># calculate upper CI bound</span></span>
<span id="cb477-3"><a href="introduction-to-longitudinal-data.html#cb477-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-4"><a href="introduction-to-longitudinal-data.html#cb477-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">round</span>(CI_l, <span class="dv">3</span>), <span class="st">&quot;, &quot;</span>, <span class="fu">round</span>(CI_u, <span class="dv">3</span>), <span class="st">&quot;)&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)) <span class="co"># output the CI</span></span></code></pre></div>
<pre><code>## [1] &quot;(25.974, 28.069)&quot;</code></pre>
<p>That is, we are 95% confident that the mean outcome for 14 year old male subjects falls between (25.974, 28.069).</p>
<p>Similar calculations can be performed for other population means of interest.</p>
</div>
<div id="long-linear-cov" class="section level3 hasAnchor" number="6.3.8">
<h3><span class="header-section-number">6.3.8</span> Selecting a Correlation Structure<a href="introduction-to-longitudinal-data.html#long-linear-cov" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the previous examples, for illustrative purposes we assumed an unstructured correlation structure. It is likely that in practice we can use a simpler structure, and thus we need to perform hypothesis tests to select the appropriate structure.</p>
<p>To select a correlation structure, we use the <code>REML</code> method instead of the <code>ML</code> method when fitting our models, since maximum likelihood estimation is biased for our covariance parameters. Our goal is to choose the simplest correlation structure while maintaining an adequate model fit.</p>
<p>Some correlation structures are nested within each other (meaning you can chose parameters such that one simplifies into the other), and we can perform likelihood ratio tests to assess the adequacy of the correlation structures. For example, the exchangeable correlation structure is nested within the unstructured covariance structure. As such, we can perform a hypothesis test of <span class="math inline">\(H_0\)</span>: The simpler correlation structure (exchangeable) fits as well as the more complex structure (unstructured).</p>
<p>To do this test, we fit our model (we will continue using the model including interactions here) using restricted maximum likelihood estimation and perform the LRT.</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="introduction-to-longitudinal-data.html#cb479-1" aria-hidden="true" tabindex="-1"></a>fit1_unstructured <span class="ot">&lt;-</span> <span class="fu">gls</span>(distance <span class="sc">~</span> <span class="fu">factor</span>(sex)<span class="sc">*</span><span class="fu">factor</span>(age),</span>
<span id="cb479-2"><a href="introduction-to-longitudinal-data.html#cb479-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dental_long,</span>
<span id="cb479-3"><a href="introduction-to-longitudinal-data.html#cb479-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;REML&quot;</span>,</span>
<span id="cb479-4"><a href="introduction-to-longitudinal-data.html#cb479-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">corr =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> subject)</span>
<span id="cb479-5"><a href="introduction-to-longitudinal-data.html#cb479-5" aria-hidden="true" tabindex="-1"></a>) <span class="co"># subject is the variable indicating</span></span>
<span id="cb479-6"><a href="introduction-to-longitudinal-data.html#cb479-6" aria-hidden="true" tabindex="-1"></a><span class="co"># repeated measures. Unstructured corr</span></span>
<span id="cb479-7"><a href="introduction-to-longitudinal-data.html#cb479-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-8"><a href="introduction-to-longitudinal-data.html#cb479-8" aria-hidden="true" tabindex="-1"></a>fit1_exchangeable <span class="ot">&lt;-</span> <span class="fu">gls</span>(distance <span class="sc">~</span> <span class="fu">factor</span>(sex)<span class="sc">*</span><span class="fu">factor</span>(age),</span>
<span id="cb479-9"><a href="introduction-to-longitudinal-data.html#cb479-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dental_long,</span>
<span id="cb479-10"><a href="introduction-to-longitudinal-data.html#cb479-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;REML&quot;</span>,</span>
<span id="cb479-11"><a href="introduction-to-longitudinal-data.html#cb479-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">corr =</span> <span class="fu">corCompSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> subject)</span>
<span id="cb479-12"><a href="introduction-to-longitudinal-data.html#cb479-12" aria-hidden="true" tabindex="-1"></a>) <span class="co"># subject is the variable indicating</span></span>
<span id="cb479-13"><a href="introduction-to-longitudinal-data.html#cb479-13" aria-hidden="true" tabindex="-1"></a><span class="co"># repeated measures. Exchangeable corr</span></span>
<span id="cb479-14"><a href="introduction-to-longitudinal-data.html#cb479-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-15"><a href="introduction-to-longitudinal-data.html#cb479-15" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit1_unstructured, fit1_exchangeable)</span></code></pre></div>
<pre><code>##                   Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fit1_unstructured     1 15 445.7642 484.8417 -207.8821                        
## fit1_exchangeable     2 10 443.4085 469.4602 -211.7043 1 vs 2 7.644354   0.177</code></pre>
<p>We have a large <span class="math inline">\(p\)</span>-value and thus fail to reject the null hypothesis. That is, we will use the exchangeable correlation structure as it is simpler and fits as well.</p>
<p>For non-nested correlation structures like AR(1) and exchangeable, we can use <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion">AIC</a> or <a href="https://en.wikipedia.org/wiki/Bayesian_information_criterion">BIC</a> to assess the fit, where a smaller AIC/BIC indicates a better fit. AIC and BIC are similar, but achieve different goals in model selection and one is not strictly preferred over the other. In fact, they are often used for model selection together. For the purposes of this analysis, we choose to only show the results for AIC, as using BIC will yield similar results. More information on AIC and BIC can be found <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion#Comparison_with_BIC">here</a>.</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="introduction-to-longitudinal-data.html#cb481-1" aria-hidden="true" tabindex="-1"></a>fit1_ar1 <span class="ot">&lt;-</span> <span class="fu">gls</span>(distance <span class="sc">~</span> <span class="fu">factor</span>(sex)<span class="sc">*</span><span class="fu">factor</span>(age),</span>
<span id="cb481-2"><a href="introduction-to-longitudinal-data.html#cb481-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dental_long,</span>
<span id="cb481-3"><a href="introduction-to-longitudinal-data.html#cb481-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;REML&quot;</span>,</span>
<span id="cb481-4"><a href="introduction-to-longitudinal-data.html#cb481-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">corr =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> subject)</span>
<span id="cb481-5"><a href="introduction-to-longitudinal-data.html#cb481-5" aria-hidden="true" tabindex="-1"></a>) <span class="co"># subject is the variable indicating</span></span>
<span id="cb481-6"><a href="introduction-to-longitudinal-data.html#cb481-6" aria-hidden="true" tabindex="-1"></a><span class="co"># repeated measures. Exchangeable corr</span></span>
<span id="cb481-7"><a href="introduction-to-longitudinal-data.html#cb481-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb481-8"><a href="introduction-to-longitudinal-data.html#cb481-8" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit1_exchangeable)</span></code></pre></div>
<pre><code>## [1] 443.4085</code></pre>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="introduction-to-longitudinal-data.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit1_ar1)</span></code></pre></div>
<pre><code>## [1] 454.5472</code></pre>
<p>We see that the model using an exchangeable correlation structure has a smaller AIC, which indicates a better fit. In this case, we would choose the exchangeable correlation structure over the auto-regressive structure. We note that similar tests can be performed for other correlation structures, but are omitted for the purposes of this example.</p>
</div>
<div id="long-linear-procedure" class="section level3 hasAnchor" number="6.3.9">
<h3><span class="header-section-number">6.3.9</span> Model Fitting Procedure<a href="introduction-to-longitudinal-data.html#long-linear-procedure" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We start the model fitting procedure by</p>
<ol style="list-style-type: decimal">
<li><p>reading in and cleaning the data, then</p></li>
<li><p>checking model assumptions assumptions, including checking if</p>
<ul>
<li><p>the outcome is normally distributed (see Section <a href="introduction-to-longitudinal-data.html#long-linear-assumptions">6.3.1</a>),</p></li>
<li><p>observations are taken at the same times for all subjects, and</p></li>
<li><p>there are no missing observations in the data set.</p></li>
</ul></li>
</ol>
<p>If the above conditions are satisfied, we can start fitting/building a model. It is usually recommended to</p>
<ol start="3" style="list-style-type: decimal">
<li><p>focus on the time trend of the response (assess if we should have a continuous or discrete time variable, need higher-order terms, and/or interactions), then</p></li>
<li><p>find the appropriate covariance structure, then</p></li>
<li><p>consider variable selection.</p></li>
</ol>
<p>This process can be done iteratively on steps 3 - 5 until a final model is chosen based on the appropriate statistical tests and the scientific question of interest.</p>
<p>We note that the model building process can be done with the consultation of expert opinions, if available, to include “a priori” variables in the model that should be included regardless of statistical significance.</p>
</div>
<div id="long-linear-example2" class="section level3 hasAnchor" number="6.3.10">
<h3><span class="header-section-number">6.3.10</span> Example<a href="introduction-to-longitudinal-data.html#long-linear-example2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We follow the model fitting procedure presented in <a href="introduction-to-longitudinal-data.html#long-linear-procedure">6.3.9</a> to answer a different research question on a new data set. The data set <a href="data/tlc.txt"><code>tlc</code></a>, which is stored in a text file in the “data” folder, consists of 100 children who were randomly assigned to chelation treatment with the addition of either succimer or placebo. Four repeated measurements of blood lead levels were obtained at baseline (week 0), week 1, week 4, and week 6. We note this data set has the same observation pattern for all individuals in the study, and no missing observations, which is a requirement for the linear model.</p>
<p>The research question of interest is whether there is a difference in the mean blood lead level over time between the succimer (which we we will refer to as the treatment group) or placebo group.</p>
<p><strong>Step 1: Data Read in and Cleaning</strong></p>
<p>We first read in the data and rename the columns. We also rename the <code>Group</code> variable values to be more clear, where group “A” corresponds to succimer treatment group and group “P” corresponds to the placebo.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="introduction-to-longitudinal-data.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the data set</span></span>
<span id="cb485-2"><a href="introduction-to-longitudinal-data.html#cb485-2" aria-hidden="true" tabindex="-1"></a>tlc <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/tlc.txt&quot;</span>)</span>
<span id="cb485-3"><a href="introduction-to-longitudinal-data.html#cb485-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-4"><a href="introduction-to-longitudinal-data.html#cb485-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb485-5"><a href="introduction-to-longitudinal-data.html#cb485-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tlc) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;Group&quot;</span>, <span class="st">&quot;week0&quot;</span>, <span class="st">&quot;week1&quot;</span>, <span class="st">&quot;week4&quot;</span>, <span class="st">&quot;week6&quot;</span>)</span>
<span id="cb485-6"><a href="introduction-to-longitudinal-data.html#cb485-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-7"><a href="introduction-to-longitudinal-data.html#cb485-7" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the P and A groups to Placebo and Succimer</span></span>
<span id="cb485-8"><a href="introduction-to-longitudinal-data.html#cb485-8" aria-hidden="true" tabindex="-1"></a>tlc[tlc<span class="sc">$</span>Group <span class="sc">==</span> <span class="st">&quot;P&quot;</span>, <span class="st">&quot;Group&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Placebo&quot;</span></span>
<span id="cb485-9"><a href="introduction-to-longitudinal-data.html#cb485-9" aria-hidden="true" tabindex="-1"></a>tlc[tlc<span class="sc">$</span>Group <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="st">&quot;Group&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Succimer&quot;</span></span></code></pre></div>
<p>and convert our data to long-form</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="introduction-to-longitudinal-data.html#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reshape the data into long form</span></span>
<span id="cb486-2"><a href="introduction-to-longitudinal-data.html#cb486-2" aria-hidden="true" tabindex="-1"></a>tlc_long <span class="ot">&lt;-</span> <span class="fu">reshape</span>(</span>
<span id="cb486-3"><a href="introduction-to-longitudinal-data.html#cb486-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> tlc, <span class="co"># original data in wide form</span></span>
<span id="cb486-4"><a href="introduction-to-longitudinal-data.html#cb486-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>, <span class="co"># changing from wide TO long</span></span>
<span id="cb486-5"><a href="introduction-to-longitudinal-data.html#cb486-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">idvar =</span> <span class="st">&quot;ID&quot;</span>, <span class="co"># name of variable indicating unique</span></span>
<span id="cb486-6"><a href="introduction-to-longitudinal-data.html#cb486-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subjects in wide form data set</span></span>
<span id="cb486-7"><a href="introduction-to-longitudinal-data.html#cb486-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">varying =</span> <span class="fu">c</span>(<span class="st">&quot;week0&quot;</span>, <span class="st">&quot;week1&quot;</span>, <span class="st">&quot;week4&quot;</span>, <span class="st">&quot;week6&quot;</span>), <span class="co"># name</span></span>
<span id="cb486-8"><a href="introduction-to-longitudinal-data.html#cb486-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of variables in which outcomes recorded</span></span>
<span id="cb486-9"><a href="introduction-to-longitudinal-data.html#cb486-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">v.names =</span> <span class="st">&quot;bloodlev&quot;</span>, <span class="co"># assigning a new name to the outcome</span></span>
<span id="cb486-10"><a href="introduction-to-longitudinal-data.html#cb486-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">6</span>), <span class="co"># time points in which the above</span></span>
<span id="cb486-11"><a href="introduction-to-longitudinal-data.html#cb486-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># outcomes were recorded</span></span>
<span id="cb486-12"><a href="introduction-to-longitudinal-data.html#cb486-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">timevar =</span> <span class="st">&quot;week&quot;</span></span>
<span id="cb486-13"><a href="introduction-to-longitudinal-data.html#cb486-13" aria-hidden="true" tabindex="-1"></a>) <span class="co"># name of the time variable we&#39;re using</span></span>
<span id="cb486-14"><a href="introduction-to-longitudinal-data.html#cb486-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-15"><a href="introduction-to-longitudinal-data.html#cb486-15" aria-hidden="true" tabindex="-1"></a><span class="co"># order the data by subject ID and then by week</span></span>
<span id="cb486-16"><a href="introduction-to-longitudinal-data.html#cb486-16" aria-hidden="true" tabindex="-1"></a>tlc_long <span class="ot">&lt;-</span> tlc_long[<span class="fu">order</span>(tlc_long<span class="sc">$</span>ID, tlc_long<span class="sc">$</span>week), ]</span>
<span id="cb486-17"><a href="introduction-to-longitudinal-data.html#cb486-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-18"><a href="introduction-to-longitudinal-data.html#cb486-18" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the first 10 observations</span></span>
<span id="cb486-19"><a href="introduction-to-longitudinal-data.html#cb486-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tlc_long, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##     ID    Group week bloodlev
## 1.0  1  Placebo    0     30.8
## 1.1  1  Placebo    1     26.9
## 1.4  1  Placebo    4     25.8
## 1.6  1  Placebo    6     23.8
## 2.0  2 Succimer    0     26.5
## 2.1  2 Succimer    1     14.8
## 2.4  2 Succimer    4     19.5
## 2.6  2 Succimer    6     21.0
## 3.0  3 Succimer    0     25.8
## 3.1  3 Succimer    1     23.0</code></pre>
<p><strong>Step 2: Checking Model Assumptions</strong></p>
<p>Now that the data is in long form, we can begin to explore the data. We first assess the normality assumption of the outcome of interest, <code>bloodlev</code>. We do this by looking at the distribution of the outcome and by creating a Q-Q plot.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="introduction-to-longitudinal-data.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="co"># set graphs to be arranged in one row and two columns</span></span>
<span id="cb488-2"><a href="introduction-to-longitudinal-data.html#cb488-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-3"><a href="introduction-to-longitudinal-data.html#cb488-3" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of outcome</span></span>
<span id="cb488-4"><a href="introduction-to-longitudinal-data.html#cb488-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(tlc_long<span class="sc">$</span>bloodlev, <span class="at">xlab =</span> <span class="st">&quot;Blood lead level&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Histogram of Outcome&quot;</span>)</span>
<span id="cb488-5"><a href="introduction-to-longitudinal-data.html#cb488-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-6"><a href="introduction-to-longitudinal-data.html#cb488-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Q-Q plot and line</span></span>
<span id="cb488-7"><a href="introduction-to-longitudinal-data.html#cb488-7" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(tlc_long<span class="sc">$</span>bloodlev) <span class="co"># plot quantiles against normal distribution</span></span>
<span id="cb488-8"><a href="introduction-to-longitudinal-data.html#cb488-8" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(tlc_long<span class="sc">$</span>bloodlev) <span class="co"># add line</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-linear-ex3normality"></span>
<img src="topics_in_consulting_files/figure-html/long-linear-ex3normality-1.png" alt="Plots for assessing normality of the outcome (blood lead level)." width="672" />
<p class="caption">
Figure 6.2: Plots for assessing normality of the outcome (blood lead level).
</p>
</div>
<p>From the plots in Figure <a href="introduction-to-longitudinal-data.html#fig:long-linear-ex3normality">6.2</a>, we do not see evidence of non-normality and can continue with the linear model. See Section <a href="introduction-to-longitudinal-data.html#long-linear-assumptions">6.3.1</a> for more details on assessing normality.</p>
<p><strong>Step 3: Assessing Time Trend</strong></p>
<p>The next step is to assess the time trend. We can first explore the data by looking at the average profile across the two groups and see if there is a linear trend, or if we need to consider higher-order terms. We can do this using the <code>xyplot()</code> function from the <strong>lattice</strong> package</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="introduction-to-longitudinal-data.html#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(bloodlev <span class="sc">~</span> week <span class="sc">|</span> <span class="fu">factor</span>(Group), <span class="co"># plotting bloodlev over time, by group</span></span>
<span id="cb489-2"><a href="introduction-to-longitudinal-data.html#cb489-2" aria-hidden="true" tabindex="-1"></a><span class="at">data =</span> tlc_long,</span>
<span id="cb489-3"><a href="introduction-to-longitudinal-data.html#cb489-3" aria-hidden="true" tabindex="-1"></a><span class="at">xlab =</span> <span class="st">&quot;time (weeks)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Blood lead levels&quot;</span>, <span class="co"># axis labels</span></span>
<span id="cb489-4"><a href="introduction-to-longitudinal-data.html#cb489-4" aria-hidden="true" tabindex="-1"></a><span class="at">main =</span> <span class="st">&quot;Plot of individual blood lead levels by treatment group&quot;</span>, <span class="co"># title</span></span>
<span id="cb489-5"><a href="introduction-to-longitudinal-data.html#cb489-5" aria-hidden="true" tabindex="-1"></a><span class="at">panel =</span> <span class="cf">function</span>(x,y){</span>
<span id="cb489-6"><a href="introduction-to-longitudinal-data.html#cb489-6" aria-hidden="true" tabindex="-1"></a><span class="fu">panel.xyplot</span>(x, y, <span class="at">type =</span> <span class="st">&quot;p&quot;</span>) <span class="co"># plots individual values </span></span>
<span id="cb489-7"><a href="introduction-to-longitudinal-data.html#cb489-7" aria-hidden="true" tabindex="-1"></a><span class="fu">panel.linejoin</span>(x,y, <span class="at">fun =</span> mean, <span class="at">horizontal =</span> F, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="dv">1</span>)}) <span class="co"># plots mean</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-linear-ex3plot"></span>
<img src="topics_in_consulting_files/figure-html/long-linear-ex3plot-1.png" alt="Plot of individual blood lead levels stratified by treatment group. Dark line represents mean blood level at each observation times." width="672" />
<p class="caption">
Figure 6.3: Plot of individual blood lead levels stratified by treatment group. Dark line represents mean blood level at each observation times.
</p>
</div>
<p>From the plot in Figure <a href="introduction-to-longitudinal-data.html#fig:long-linear-ex3plot">6.3</a>, there does not appear to be a linear time trend, particularly for the succimer group. There also appears to be a difference in trend between the succimer and placebo groups. As such, we should consider transformations or higher-order terms for time (such as quadratic (squared) time effects for the non-linear trend) and also interaction terms between the group and time variables (to account for differences in trend by group).</p>
<p>In this example, we will not categorize the time trend and treat it as a continuous covariate. This allows us to quantify the effect of a one unit change of time on the outcome. This is a different way of looking at time, as opposed to the working example in the module that categorized time. Whether or not to treat time as continuous or categorical will depend on the research goal and the data.</p>
<p>The model we start with is a linear trend model for the marginal mean, written as
<span class="math display">\[
\mu_{ij} = \beta_0 + \beta_1\text{Group}_{ij} + \beta_2 \text{week}_{ij}  + \beta_3\text{Group}_i\text{week}_{ij} .
\]</span>
Here we have an individual group effect (<span class="math inline">\(\beta_1\)</span>) that allows the groups to differ at baseline, a linear time effect (<span class="math inline">\(\beta_2\)</span> ) for our week variable, and an interaction term that allows the trends to differ by group (<span class="math inline">\(\beta_3\)</span>).</p>
<p>We can fit our model using the <code>gls()</code> function using the <code>ML</code> method, and assume an unstructured correlation structure.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="introduction-to-longitudinal-data.html#cb490-1" aria-hidden="true" tabindex="-1"></a>fit1_tlc <span class="ot">&lt;-</span> <span class="fu">gls</span>(bloodlev <span class="sc">~</span> Group<span class="sc">*</span>week,  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>, <span class="co"># maximum likelihood method</span></span>
<span id="cb490-2"><a href="introduction-to-longitudinal-data.html#cb490-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> tlc_long, <span class="at">corr =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> ID)) <span class="co"># unstructured cor</span></span></code></pre></div>
<p>We compare this model to one that includes a quadratic time effect (and higher-order interactions), written as
<span class="math display">\[
\mu_{ij} = \beta_0 + \beta_1\text{Group}_{ij} + \beta_2 \text{week}_{ij} + \beta_3\text{week}^2_{ij} + \beta_4\text{Group}_i\text{week}_{ij} + \beta_5\text{Group}_i\text{week}^2_{ij}.
\]</span>
Here we have an individual group effect (<span class="math inline">\(\beta_1\)</span>) that allows the groups to differ at baseline, a linear and quadratic effect (<span class="math inline">\(\beta_2\)</span> and <span class="math inline">\(\beta_3\)</span>) for our time variable (week) that allows for non-linear trends, and two interaction terms that allow the trends to differ by group (<span class="math inline">\(\beta_4\)</span> and <span class="math inline">\(\beta_5\)</span>).</p>
<p>To fit the above model, we need to create an additional variable in our data set for the squared time variable. To do so, we perform the following:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="introduction-to-longitudinal-data.html#cb491-1" aria-hidden="true" tabindex="-1"></a>tlc_long<span class="sc">$</span>weeksq <span class="ot">&lt;-</span> (tlc_long<span class="sc">$</span>week)<span class="sc">^</span><span class="dv">2</span> <span class="co"># create squared week variable</span></span></code></pre></div>
<p>Then, we fit a model with the squared time variable, to see if the squared time variable is necessary in the model and perform a LRT:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="introduction-to-longitudinal-data.html#cb492-1" aria-hidden="true" tabindex="-1"></a>fit2_tlc <span class="ot">&lt;-</span> <span class="fu">gls</span>(bloodlev <span class="sc">~</span> Group<span class="sc">*</span>week <span class="sc">+</span> Group<span class="sc">*</span>weeksq , <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>, <span class="co">#no squared week term</span></span>
<span id="cb492-2"><a href="introduction-to-longitudinal-data.html#cb492-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> tlc_long, <span class="at">corr =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> ID))</span>
<span id="cb492-3"><a href="introduction-to-longitudinal-data.html#cb492-3" aria-hidden="true" tabindex="-1"></a>                <span class="co">#unstructured correlation again</span></span>
<span id="cb492-4"><a href="introduction-to-longitudinal-data.html#cb492-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-5"><a href="introduction-to-longitudinal-data.html#cb492-5" aria-hidden="true" tabindex="-1"></a><span class="co"># perform hypothesis test to see if linear model (fit1) fits </span></span>
<span id="cb492-6"><a href="introduction-to-longitudinal-data.html#cb492-6" aria-hidden="true" tabindex="-1"></a><span class="co"># as well as new model with squared time terms (fit2)</span></span>
<span id="cb492-7"><a href="introduction-to-longitudinal-data.html#cb492-7" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit1_tlc, fit2_tlc)</span></code></pre></div>
<pre><code>##          Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fit1_tlc     1 11 2593.256 2637.162 -1285.628                        
## fit2_tlc     2 13 2554.344 2606.233 -1264.172 1 vs 2 42.91194  &lt;.0001</code></pre>
<p>As the <span class="math inline">\(p\)</span>-value here is very small (<span class="math inline">\(p&lt;0.0001\)</span>), we reject the null hypothesis that the model without the squared week term fits as well as the model that includes it.</p>
<p>We can also investigate higher-order terms in a similar manner, including cubic transformations of the week variable. The model can be written as</p>
<p><span class="math display">\[
\begin{aligned}
\mu_{ij} = \beta_0 + \beta_1\text{Group}_{ij} + &amp;\beta_2 \text{week}_{ij} + \beta_3\text{week}^2_{ij} + \beta_4\text{week}^3 + \beta_5\text{Group}_i\text{week}_{ij} +\\
&amp;\beta_6\text{Group}_i\text{week}^2_{ij} + \beta_7\text{Group}_i\text{week}_{ij}^3.
\end{aligned}
\]</span>
We first create a cubic term:</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="introduction-to-longitudinal-data.html#cb494-1" aria-hidden="true" tabindex="-1"></a>tlc_long<span class="sc">$</span>weekcb <span class="ot">&lt;-</span> (tlc_long<span class="sc">$</span>week)<span class="sc">^</span><span class="dv">3</span> <span class="co"># create cubed week variable</span></span></code></pre></div>
<p>We can again fit this model using the <code>gls()</code> function, specifying the <code>ML</code> method and again assuming an unstructured correlation structure:</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="introduction-to-longitudinal-data.html#cb495-1" aria-hidden="true" tabindex="-1"></a>fit3_tlc <span class="ot">&lt;-</span> <span class="fu">gls</span>(bloodlev <span class="sc">~</span> Group<span class="sc">*</span>week <span class="sc">+</span> Group<span class="sc">*</span>weeksq <span class="sc">+</span> Group<span class="sc">*</span>weekcb,  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>,</span>
<span id="cb495-2"><a href="introduction-to-longitudinal-data.html#cb495-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> tlc_long, <span class="at">corr =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> ID))</span>
<span id="cb495-3"><a href="introduction-to-longitudinal-data.html#cb495-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb495-4"><a href="introduction-to-longitudinal-data.html#cb495-4" aria-hidden="true" tabindex="-1"></a><span class="co"># perform hypothesis test to see if model with squared time term (fit2) fits </span></span>
<span id="cb495-5"><a href="introduction-to-longitudinal-data.html#cb495-5" aria-hidden="true" tabindex="-1"></a><span class="co"># as well as new model with cubic time terms (fit3)</span></span>
<span id="cb495-6"><a href="introduction-to-longitudinal-data.html#cb495-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit3_tlc, fit2_tlc)</span></code></pre></div>
<pre><code>##          Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fit3_tlc     1 15 2481.445 2541.317 -1225.722                        
## fit2_tlc     2 13 2554.344 2606.233 -1264.172 1 vs 2 76.89944  &lt;.0001</code></pre>
<p>We again reject the null hypothesis and conclude that we should have cubic terms of our week variable in the model. As such, we continue model building with the third model that contains both squared and cubic transformations of our time variable (week). More details on such tests can be found in Section <a href="introduction-to-longitudinal-data.html#long-linear-HT">6.3.6</a>, and we note that analysts can consider other transformations of time, and refer them to <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span> for further discussion and examples.</p>
<p><strong>Step 4: Selecting a Covariance Structure</strong></p>
<p>The next step is to select a covariance structure, as detailed in Section <a href="introduction-to-longitudinal-data.html#long-linear-cov">6.3.8</a>. Note that we must re-fit the model using the <code>REML</code> method as we are conducting inference about the covariance structure.</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="introduction-to-longitudinal-data.html#cb497-1" aria-hidden="true" tabindex="-1"></a>fit3_tlc_REML <span class="ot">&lt;-</span> <span class="fu">gls</span>(bloodlev <span class="sc">~</span> Group<span class="sc">*</span>week <span class="sc">+</span> Group<span class="sc">*</span>weeksq <span class="sc">+</span> Group<span class="sc">*</span>weekcb,  </span>
<span id="cb497-2"><a href="introduction-to-longitudinal-data.html#cb497-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">&quot;REML&quot;</span>, <span class="at">data =</span> tlc_long, </span>
<span id="cb497-3"><a href="introduction-to-longitudinal-data.html#cb497-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">corr =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> ID)) <span class="co"># unstructured cov</span></span></code></pre></div>
<p>We perform hypothesis test to see if we can simplify the correlation structure further. For this example, we will be considering the following correlation structures: independent, exchangeable, and AR(1). We recognize there are other structures that could also be explored, but consider these structures for the purposes of this example. We see if the simplest correlation structure, the independence structure, fits as well as the current model (unstructured) by a likelihood ratio test. We can perform a LRT because the independence structure is “nested” in unstructured, meaning that we can write the independent structure in terms of the unstructured. Details on what to do for un-nested structures are discussed in <a href="introduction-to-longitudinal-data.html#long-linear-cov">6.3.8</a>.</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="introduction-to-longitudinal-data.html#cb498-1" aria-hidden="true" tabindex="-1"></a>fit3_tlc_REML_ind <span class="ot">&lt;-</span> <span class="fu">gls</span>(bloodlev <span class="sc">~</span> week<span class="sc">*</span>Group <span class="sc">+</span> weeksq<span class="sc">*</span>Group <span class="sc">+</span> weekcb<span class="sc">*</span>Group,  </span>
<span id="cb498-2"><a href="introduction-to-longitudinal-data.html#cb498-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">&quot;REML&quot;</span>, <span class="at">data =</span> tlc_long) <span class="co"># default cor: independent</span></span>
<span id="cb498-3"><a href="introduction-to-longitudinal-data.html#cb498-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-4"><a href="introduction-to-longitudinal-data.html#cb498-4" aria-hidden="true" tabindex="-1"></a><span class="co">#perform LRT</span></span>
<span id="cb498-5"><a href="introduction-to-longitudinal-data.html#cb498-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit3_tlc_REML, fit3_tlc_REML_ind)</span></code></pre></div>
<pre><code>## Warning in nlme::anova.lme(object = fit3_tlc_REML, fit3_tlc_REML_ind): fitted
## objects with different fixed effects. REML comparisons are not meaningful.</code></pre>
<pre><code>##                   Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fit3_tlc_REML         1 15 2497.949 2557.517 -1233.974                        
## fit3_tlc_REML_ind     2  9 2670.572 2706.314 -1326.286 1 vs 2 184.6236  &lt;.0001</code></pre>
<p>We reject the null hypothesis that the model with the independent correlation structure fits as well as the unstructured model. We note that we come to a similar conclusion when assessing the AIC for each model.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="introduction-to-longitudinal-data.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit3_tlc_REML)</span></code></pre></div>
<pre><code>## [1] 2497.949</code></pre>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="introduction-to-longitudinal-data.html#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit3_tlc_REML_ind)</span></code></pre></div>
<pre><code>## [1] 2670.572</code></pre>
<p>The model with an unstructured correlation structure has a much lower AIC, indicating a better fit than the independent structure.</p>
<p>We next see if an exchangeable correlation structure will be sufficient. We re-fit the model again with an exchangeable correlation structure, and compare it to the unstructured model.</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="introduction-to-longitudinal-data.html#cb505-1" aria-hidden="true" tabindex="-1"></a>fit3_tlc_REML_exch <span class="ot">&lt;-</span> <span class="fu">gls</span>(bloodlev <span class="sc">~</span> Group<span class="sc">*</span>week <span class="sc">+</span> Group<span class="sc">*</span>weeksq <span class="sc">+</span> Group<span class="sc">*</span>weekcb,  </span>
<span id="cb505-2"><a href="introduction-to-longitudinal-data.html#cb505-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">&quot;REML&quot;</span>, <span class="at">data =</span> tlc_long,</span>
<span id="cb505-3"><a href="introduction-to-longitudinal-data.html#cb505-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">corr =</span> <span class="fu">corCompSymm</span>(<span class="at">form=</span><span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> ID)) <span class="co"># exchangeable</span></span>
<span id="cb505-4"><a href="introduction-to-longitudinal-data.html#cb505-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-5"><a href="introduction-to-longitudinal-data.html#cb505-5" aria-hidden="true" tabindex="-1"></a><span class="co">#perform LRT</span></span>
<span id="cb505-6"><a href="introduction-to-longitudinal-data.html#cb505-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit3_tlc_REML, fit3_tlc_REML_exch)</span></code></pre></div>
<pre><code>##                    Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fit3_tlc_REML          1 15 2497.949 2557.517 -1233.974                        
## fit3_tlc_REML_exch     2 10 2506.938 2546.651 -1243.469 1 vs 2 18.98944  0.0019</code></pre>
<p>We again reject the null hypothesis and conclude the unstructured model fits better. We note that we come to a similar conclusion when assessing the AIC for each model.</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="introduction-to-longitudinal-data.html#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit3_tlc_REML)</span></code></pre></div>
<pre><code>## [1] 2497.949</code></pre>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="introduction-to-longitudinal-data.html#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit3_tlc_REML_exch)</span></code></pre></div>
<pre><code>## [1] 2506.938</code></pre>
<p>We can next consider an AR(1) model for the correlation structure.</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="introduction-to-longitudinal-data.html#cb511-1" aria-hidden="true" tabindex="-1"></a>fit3_tlc_REML_ar1 <span class="ot">&lt;-</span> <span class="fu">gls</span>(bloodlev <span class="sc">~</span> Group<span class="sc">*</span>week <span class="sc">+</span> Group<span class="sc">*</span>weeksq <span class="sc">+</span> Group<span class="sc">*</span>weekcb,  </span>
<span id="cb511-2"><a href="introduction-to-longitudinal-data.html#cb511-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">&quot;REML&quot;</span>, <span class="at">data =</span> tlc_long,</span>
<span id="cb511-3"><a href="introduction-to-longitudinal-data.html#cb511-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">corr =</span> <span class="fu">corAR1</span>(<span class="at">form=</span><span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> ID)) <span class="co"># AR(1)</span></span>
<span id="cb511-4"><a href="introduction-to-longitudinal-data.html#cb511-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-5"><a href="introduction-to-longitudinal-data.html#cb511-5" aria-hidden="true" tabindex="-1"></a><span class="co">#perform LRT</span></span>
<span id="cb511-6"><a href="introduction-to-longitudinal-data.html#cb511-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit3_tlc_REML, fit3_tlc_REML_ar1)</span></code></pre></div>
<pre><code>##                   Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fit3_tlc_REML         1 15 2497.949 2557.517 -1233.974                        
## fit3_tlc_REML_ar1     2 10 2518.948 2558.660 -1249.474 1 vs 2 30.99904  &lt;.0001</code></pre>
<p>We reject this null hypothesis as well. We again come to a similar conclusion when assessing the AIC for each model.</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="introduction-to-longitudinal-data.html#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit3_tlc_REML)</span></code></pre></div>
<pre><code>## [1] 2497.949</code></pre>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="introduction-to-longitudinal-data.html#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit3_tlc_REML_ar1)</span></code></pre></div>
<pre><code>## [1] 2518.948</code></pre>
<p>We try one final structure, the exponential correlation structure.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="introduction-to-longitudinal-data.html#cb517-1" aria-hidden="true" tabindex="-1"></a>fit3_tlc_REML_exp <span class="ot">&lt;-</span> <span class="fu">gls</span>(bloodlev <span class="sc">~</span> Group<span class="sc">*</span>week <span class="sc">+</span> Group<span class="sc">*</span>weeksq <span class="sc">+</span> Group<span class="sc">*</span>weekcb,  </span>
<span id="cb517-2"><a href="introduction-to-longitudinal-data.html#cb517-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">&quot;REML&quot;</span>, <span class="at">data =</span> tlc_long,</span>
<span id="cb517-3"><a href="introduction-to-longitudinal-data.html#cb517-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">corr =</span> <span class="fu">corExp</span>(<span class="at">form=</span><span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> ID)) <span class="co"># exponential</span></span>
<span id="cb517-4"><a href="introduction-to-longitudinal-data.html#cb517-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-5"><a href="introduction-to-longitudinal-data.html#cb517-5" aria-hidden="true" tabindex="-1"></a><span class="co">#perform LRT</span></span>
<span id="cb517-6"><a href="introduction-to-longitudinal-data.html#cb517-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit3_tlc_REML, fit3_tlc_REML_exp)</span></code></pre></div>
<pre><code>##                   Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fit3_tlc_REML         1 15 2497.949 2557.517 -1233.974                        
## fit3_tlc_REML_exp     2 10 2518.948 2558.660 -1249.474 1 vs 2 30.99904  &lt;.0001</code></pre>
<p>We again reject the null hypothesis. Checking the AIC:</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="introduction-to-longitudinal-data.html#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit3_tlc_REML)</span></code></pre></div>
<pre><code>## [1] 2497.949</code></pre>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="introduction-to-longitudinal-data.html#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit3_tlc_REML_exp)</span></code></pre></div>
<pre><code>## [1] 2518.948</code></pre>
<p>We obtain the same conclusion that the unstructured correlation structure fits better. Based on these tests, we decide to stay with the unstructured correlation structure as there is no evidence that we are able to simplify it into any of the above options.</p>
<p><strong>Step 5: Selecting Variables</strong></p>
<p>Now that we have the form of the time trend and the correlation structure chosen, we consider variable selection in our model, meaning we attempt to simplify the model as much as possible by reducing the number of variables in our model. We first re-fit the model using the <code>ML</code> method as we are no longer concerned about estimation of the correlation structure.</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="introduction-to-longitudinal-data.html#cb523-1" aria-hidden="true" tabindex="-1"></a>fit_tlc_full <span class="ot">&lt;-</span> <span class="fu">gls</span>(bloodlev <span class="sc">~</span> Group<span class="sc">*</span>week <span class="sc">+</span> Group<span class="sc">*</span>weeksq <span class="sc">+</span> Group<span class="sc">*</span>weekcb,  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>,</span>
<span id="cb523-2"><a href="introduction-to-longitudinal-data.html#cb523-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> tlc_long, <span class="at">corr =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> ID))</span></code></pre></div>
<p>We can first investigate if the treatment groups’ blood lead levels differ at baseline. We can do this by performing a hypothesis test to see if the <code>Group</code> term is necessary in the model, or equivalently if <span class="math inline">\(\beta_1 = 0\)</span> in the model</p>
<p><span class="math display">\[
\begin{aligned}
\mu_{ij} = \beta_0 + \beta_1\text{Group}_{ij} + &amp;\beta_2 \text{week}_{ij} + \beta_3\text{week}^2_{ij} + \beta_4\text{week}^3 + \beta_5\text{Group}_i\text{week}_{ij} +\\
&amp;\beta_6\text{Group}_i\text{week}^2_{ij} + \beta_7\text{Group}_i\text{week}_{ij}^3.
\end{aligned}
\]</span>
The results of this hypothesis test are given in the model summary, which we can view using the <code>summary()</code> function on our model:</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="introduction-to-longitudinal-data.html#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_tlc_full)</span></code></pre></div>
<pre><code>## Generalized least squares fit by maximum likelihood
##   Model: bloodlev ~ Group * week + Group * weeksq + Group * weekcb 
##   Data: tlc_long 
##        AIC      BIC    logLik
##   2481.445 2541.317 -1225.722
## 
## Correlation Structure: General
##  Formula: ~1 | ID 
##  Parameter estimate(s):
##  Correlation: 
##   1     2     3    
## 2 0.596            
## 3 0.582 0.769      
## 4 0.536 0.552 0.551
## 
## Coefficients:
##                           Value Std.Error   t-value p-value
## (Intercept)           26.272000 0.9374730 28.024274  0.0000
## GroupSuccimer          0.268000 1.3257870  0.202144  0.8399
## week                  -2.203767 1.2319182 -1.788890  0.0744
## weeksq                 0.651250 0.4519714  1.440910  0.1504
## weekcb                -0.059483 0.0454380 -1.309111  0.1913
## GroupSuccimer:week   -16.253733 1.7421954 -9.329455  0.0000
## GroupSuccimer:weeksq   5.293000 0.6391840  8.280870  0.0000
## GroupSuccimer:weekcb  -0.445267 0.0642590 -6.929250  0.0000
## 
##  Correlation: 
##                      (Intr) GrpScc week   weeksq weekcb GropSccmr:wk
## GroupSuccimer        -0.707                                         
## week                 -0.436  0.308                                  
## weeksq                0.386 -0.273 -0.964                           
## weekcb               -0.355  0.251  0.891 -0.978                    
## GroupSuccimer:week    0.308 -0.436 -0.707  0.682 -0.630             
## GroupSuccimer:weeksq -0.273  0.386  0.682 -0.707  0.691 -0.964      
## GroupSuccimer:weekcb  0.251 -0.355 -0.630  0.691 -0.707  0.891      
##                      GrpSccmr:wks
## GroupSuccimer                    
## week                             
## weeksq                           
## weekcb                           
## GroupSuccimer:week               
## GroupSuccimer:weeksq             
## GroupSuccimer:weekcb -0.978      
## 
## Standardized residuals:
##        Min         Q1        Med         Q3        Max 
## -2.5390445 -0.7040965 -0.1513186  0.5596352  6.5735988 
## 
## Residual standard error: 6.562311 
## Degrees of freedom: 400 total; 392 residual</code></pre>
<p>Under the “coefficients” section of the summary, the estimated coefficients along with their standard errors, <span class="math inline">\(t\)</span>-values, and <span class="math inline">\(p\)</span>-values for the hypothesis test that that coefficient is equal to zero are presented. For the <code>GroupSuccimer</code> variable that indicates if the treatment group is succimer or not, the <span class="math inline">\(p\)</span>-value for the hypothesis test is 0.8399, which is large. This indicates that we fail to reject the null hypothesis of <span class="math inline">\(H_0: \beta_1 = 0\)</span> and conclude that we do not need to keep this variable in the model, and the treatment groups’ mean blood lead level do not differ at baseline.</p>
<p>We re-fit the model without this variable. In this case, we need to write out individual terms as using * will include the non-interaction terms as well.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="introduction-to-longitudinal-data.html#cb526-1" aria-hidden="true" tabindex="-1"></a>fit_tlc_full2 <span class="ot">&lt;-</span> <span class="fu">gls</span>(bloodlev <span class="sc">~</span> week <span class="sc">+</span> weeksq <span class="sc">+</span> weekcb <span class="sc">+</span> Group<span class="sc">:</span>week <span class="sc">+</span> </span>
<span id="cb526-2"><a href="introduction-to-longitudinal-data.html#cb526-2" aria-hidden="true" tabindex="-1"></a>                    Group<span class="sc">:</span>weeksq <span class="sc">+</span> Group<span class="sc">:</span>weekcb,  </span>
<span id="cb526-3"><a href="introduction-to-longitudinal-data.html#cb526-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>,</span>
<span id="cb526-4"><a href="introduction-to-longitudinal-data.html#cb526-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> tlc_long, <span class="at">corr =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> ID))</span>
<span id="cb526-5"><a href="introduction-to-longitudinal-data.html#cb526-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_tlc_full2)</span></code></pre></div>
<pre><code>## Generalized least squares fit by maximum likelihood
##   Model: bloodlev ~ week + weeksq + weekcb + Group:week + Group:weeksq +      Group:weekcb 
##   Data: tlc_long 
##        AIC      BIC    logLik
##   2479.487 2535.367 -1225.743
## 
## Correlation Structure: General
##  Formula: ~1 | ID 
##  Parameter estimate(s):
##  Correlation: 
##   1     2     3    
## 2 0.596            
## 3 0.582 0.769      
## 4 0.536 0.552 0.551
## 
## Coefficients:
##                           Value Std.Error   t-value p-value
## (Intercept)           26.406000 0.6621227  39.88082  0.0000
## week                  -2.280478 1.1705109  -1.94828  0.0521
## weeksq                 0.676158 0.4342959   1.55691  0.1203
## weekcb                -0.061792 0.0439236  -1.40680  0.1603
## week:GroupSuccimer   -16.100310 1.5661533 -10.28016  0.0000
## weeksq:GroupSuccimer   5.243185 0.5890086   8.90171  0.0000
## weekcb:GroupSuccimer  -0.440650 0.0599862  -7.34585  0.0000
## 
##  Correlation: 
##                      (Intr) week   weeksq weekcb wk:GrS wks:GS
## week                 -0.324                                   
## weeksq                0.283 -0.961                            
## weekcb               -0.260  0.883 -0.976                     
## week:GroupSuccimer    0.000 -0.669  0.650 -0.597              
## weeksq:GroupSuccimer  0.000  0.641 -0.678  0.666 -0.959       
## weekcb:GroupSuccimer  0.000 -0.585  0.661 -0.683  0.875 -0.975
## 
## Standardized residuals:
##        Min         Q1        Med         Q3        Max 
## -2.5278255 -0.7018094 -0.1484155  0.5498241  6.5838114 
## 
## Residual standard error: 6.563036 
## Degrees of freedom: 400 total; 393 residual</code></pre>
<p>We can also double-check that this new model is a better fit than the old one by an LRT:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="introduction-to-longitudinal-data.html#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_tlc_full, fit_tlc_full2)</span></code></pre></div>
<pre><code>##               Model df      AIC      BIC    logLik   Test    L.Ratio p-value
## fit_tlc_full      1 15 2481.445 2541.317 -1225.722                          
## fit_tlc_full2     2 14 2479.486 2535.367 -1225.743 1 vs 2 0.04169119  0.8382</code></pre>
<p>As expected, we fail to reject the null hypothesis that the simpler model fits as well as the full model, indicating that we can in fact use the model without the <code>Group</code> term that allows the baseline values to vary between treatment groups.</p>
<p>Our new model can be written as
<span class="math display">\[
\mu_{ij} = \beta_0 + \beta_1 \text{week}_{ij} + \beta_2\text{week}^2_{ij} + \beta_3\text{week}^3 + \beta_4\text{Group}_i\text{week}_{ij} + \beta_5\text{Group}_i\text{week}^2_{ij} + \beta_6\text{Group}_i\text{week}_{ij}^3.
\]</span></p>
<p>Note: if other baseline covariates were present in the model, we could see if those should be included in the model as well by similar hypothesis tests. We can also consider higher-order terms of other continuous covariates, not just time.</p>
<p>We again assess that we need the higher-order time terms using a hypothesis test as the model has changed. <strong>This would be particularly important if the correlation structure changed during our model building process</strong>. We can perform a hypothesis test for <span class="math inline">\(H_0: \beta_3 = \beta_6 = 0\)</span> to see if the cubic time term is necessary. To do so, we set up the matrix with one column for each estimated coefficient (including the intercept) and one row for each coefficient in the hypothesis test. We assign a value of 1 to the coefficient of interest in each row for the hypothesis test.</p>
<p><span class="math display">\[
\bm{L} = \begin{bmatrix}
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;1\\
\end{bmatrix},
\]</span>
In R, we perform this hypothesis test by creating the matrix, and getting the estimated coefficients and variances from the model fit to obtain a test statistic. More details are in <a href="introduction-to-longitudinal-data.html#long-linear-HT">6.3.6</a></p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="introduction-to-longitudinal-data.html#cb530-1" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb530-2"><a href="introduction-to-longitudinal-data.html#cb530-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),<span class="co"># beta3</span></span>
<span id="cb530-3"><a href="introduction-to-longitudinal-data.html#cb530-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># beta6</span></span>
<span id="cb530-4"><a href="introduction-to-longitudinal-data.html#cb530-4" aria-hidden="true" tabindex="-1"></a>) <span class="co"># create L matrix as above</span></span>
<span id="cb530-5"><a href="introduction-to-longitudinal-data.html#cb530-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-6"><a href="introduction-to-longitudinal-data.html#cb530-6" aria-hidden="true" tabindex="-1"></a>betahat <span class="ot">&lt;-</span> fit_tlc_full2<span class="sc">$</span>coef <span class="co"># get estimated beta hats from the model</span></span>
<span id="cb530-7"><a href="introduction-to-longitudinal-data.html#cb530-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-8"><a href="introduction-to-longitudinal-data.html#cb530-8" aria-hidden="true" tabindex="-1"></a>asvar <span class="ot">&lt;-</span> fit_tlc_full2<span class="sc">$</span>varBeta <span class="co"># get estimated covariances</span></span>
<span id="cb530-9"><a href="introduction-to-longitudinal-data.html#cb530-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-10"><a href="introduction-to-longitudinal-data.html#cb530-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the Wald test statistic</span></span>
<span id="cb530-11"><a href="introduction-to-longitudinal-data.html#cb530-11" aria-hidden="true" tabindex="-1"></a>waldtest_stat <span class="ot">&lt;-</span> <span class="fu">t</span>(L <span class="sc">%*%</span> betahat) <span class="sc">%*%</span> <span class="fu">solve</span>(L <span class="sc">%*%</span> asvar <span class="sc">%*%</span> <span class="fu">t</span>(L)) <span class="sc">%*%</span> (L <span class="sc">%*%</span> betahat)</span>
<span id="cb530-12"><a href="introduction-to-longitudinal-data.html#cb530-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-13"><a href="introduction-to-longitudinal-data.html#cb530-13" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain the p-value</span></span>
<span id="cb530-14"><a href="introduction-to-longitudinal-data.html#cb530-14" aria-hidden="true" tabindex="-1"></a>pval <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">pchisq</span>(waldtest_stat, <span class="at">df =</span> <span class="dv">2</span>) <span class="co"># two degrees of freedom for two coefficients</span></span>
<span id="cb530-15"><a href="introduction-to-longitudinal-data.html#cb530-15" aria-hidden="true" tabindex="-1"></a><span class="co"># in H0 (or num rows of L)</span></span>
<span id="cb530-16"><a href="introduction-to-longitudinal-data.html#cb530-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-17"><a href="introduction-to-longitudinal-data.html#cb530-17" aria-hidden="true" tabindex="-1"></a>pval</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    0</code></pre>
<p>The <span class="math inline">\(p\)</span>-value is 0, indicating that we reject the null hypothesis. We conclude that at least one of the coefficients is non-zero, meaning the higher-order terms are needed in this model.</p>
<p>We can perform a similar test to see if the interactions as a whole (<span class="math inline">\(H_0: \beta_4 = \beta_5 = \beta_6 = 0\)</span>) are necessary.</p>
<p>Similar to the previous hypothesis test, we define a matrix
<span class="math display">\[
\bm{L} = \begin{bmatrix}
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;1 \\
\end{bmatrix},
\]</span>
and compute the <span class="math inline">\(p\)</span>-value in R using</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="introduction-to-longitudinal-data.html#cb532-1" aria-hidden="true" tabindex="-1"></a>L2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb532-2"><a href="introduction-to-longitudinal-data.html#cb532-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="co">#beta5</span></span>
<span id="cb532-3"><a href="introduction-to-longitudinal-data.html#cb532-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co">#beta6</span></span>
<span id="cb532-4"><a href="introduction-to-longitudinal-data.html#cb532-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co">#beta7</span></span>
<span id="cb532-5"><a href="introduction-to-longitudinal-data.html#cb532-5" aria-hidden="true" tabindex="-1"></a>) <span class="co"># create L matrix as above</span></span>
<span id="cb532-6"><a href="introduction-to-longitudinal-data.html#cb532-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-7"><a href="introduction-to-longitudinal-data.html#cb532-7" aria-hidden="true" tabindex="-1"></a>betahat2 <span class="ot">&lt;-</span> fit_tlc_full2<span class="sc">$</span>coef <span class="co"># get estimated beta hats from the model</span></span>
<span id="cb532-8"><a href="introduction-to-longitudinal-data.html#cb532-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-9"><a href="introduction-to-longitudinal-data.html#cb532-9" aria-hidden="true" tabindex="-1"></a>asvar2 <span class="ot">&lt;-</span> fit_tlc_full2<span class="sc">$</span>varBeta <span class="co"># get estimated covariances</span></span>
<span id="cb532-10"><a href="introduction-to-longitudinal-data.html#cb532-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-11"><a href="introduction-to-longitudinal-data.html#cb532-11" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the Wald test statistic</span></span>
<span id="cb532-12"><a href="introduction-to-longitudinal-data.html#cb532-12" aria-hidden="true" tabindex="-1"></a>waldtest_stat2 <span class="ot">&lt;-</span> <span class="fu">t</span>(L2 <span class="sc">%*%</span> betahat2) <span class="sc">%*%</span> <span class="fu">solve</span>(L2 <span class="sc">%*%</span> asvar2 <span class="sc">%*%</span> <span class="fu">t</span>(L2)) <span class="sc">%*%</span> (L2 <span class="sc">%*%</span> betahat2)</span>
<span id="cb532-13"><a href="introduction-to-longitudinal-data.html#cb532-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-14"><a href="introduction-to-longitudinal-data.html#cb532-14" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain the p-value</span></span>
<span id="cb532-15"><a href="introduction-to-longitudinal-data.html#cb532-15" aria-hidden="true" tabindex="-1"></a>pval2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">pchisq</span>(waldtest_stat2, <span class="at">df =</span> <span class="dv">3</span>) <span class="co"># three degrees of freedom for three coefficients</span></span>
<span id="cb532-16"><a href="introduction-to-longitudinal-data.html#cb532-16" aria-hidden="true" tabindex="-1"></a><span class="co"># in H0 (or num rows of L)</span></span>
<span id="cb532-17"><a href="introduction-to-longitudinal-data.html#cb532-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-18"><a href="introduction-to-longitudinal-data.html#cb532-18" aria-hidden="true" tabindex="-1"></a>pval2</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    0</code></pre>
<p>The <span class="math inline">\(p\)</span>-value is zero, meaning we reject the null hypothesis and conclude that at least one of the coefficients on the interaction terms is non-zero. As such, we leave the interaction terms in the model.</p>
<p>We note that if a model includes time interactions, it should also include the individual time effects for each variable in the interaction, which is why we do not perform a hypothesis test on the <code>week</code>, <code>weeksq</code>, and <code>weekcb</code> variables individually after finding that the interaction terms were to be included in the model.</p>
<p><strong>Answering the Research Questions</strong></p>
<p>The model fitting procedure is now done, and we use the model with cubic time term and all interaction terms, no individual group variable, and with an unstructured correlation structure, as our final model. We can now answer the research questions of interest. Recall the research question of whether there is a difference in the mean blood lead level over time between the succimer or placebo group. We present the model summary again for clarity:</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="introduction-to-longitudinal-data.html#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_tlc_full2)</span></code></pre></div>
<pre><code>## Generalized least squares fit by maximum likelihood
##   Model: bloodlev ~ week + weeksq + weekcb + Group:week + Group:weeksq +      Group:weekcb 
##   Data: tlc_long 
##        AIC      BIC    logLik
##   2479.487 2535.367 -1225.743
## 
## Correlation Structure: General
##  Formula: ~1 | ID 
##  Parameter estimate(s):
##  Correlation: 
##   1     2     3    
## 2 0.596            
## 3 0.582 0.769      
## 4 0.536 0.552 0.551
## 
## Coefficients:
##                           Value Std.Error   t-value p-value
## (Intercept)           26.406000 0.6621227  39.88082  0.0000
## week                  -2.280478 1.1705109  -1.94828  0.0521
## weeksq                 0.676158 0.4342959   1.55691  0.1203
## weekcb                -0.061792 0.0439236  -1.40680  0.1603
## week:GroupSuccimer   -16.100310 1.5661533 -10.28016  0.0000
## weeksq:GroupSuccimer   5.243185 0.5890086   8.90171  0.0000
## weekcb:GroupSuccimer  -0.440650 0.0599862  -7.34585  0.0000
## 
##  Correlation: 
##                      (Intr) week   weeksq weekcb wk:GrS wks:GS
## week                 -0.324                                   
## weeksq                0.283 -0.961                            
## weekcb               -0.260  0.883 -0.976                     
## week:GroupSuccimer    0.000 -0.669  0.650 -0.597              
## weeksq:GroupSuccimer  0.000  0.641 -0.678  0.666 -0.959       
## weekcb:GroupSuccimer  0.000 -0.585  0.661 -0.683  0.875 -0.975
## 
## Standardized residuals:
##        Min         Q1        Med         Q3        Max 
## -2.5278255 -0.7018094 -0.1484155  0.5498241  6.5838114 
## 
## Residual standard error: 6.563036 
## Degrees of freedom: 400 total; 393 residual</code></pre>
<p>Based on the resultant model and the hypothesis test for (<span class="math inline">\(H_0: \beta_5 = \beta_6 = \beta_7 = 0\)</span>), we have evidence that the mean blood level varies between the groups over time. We found that the groups do not however vary at baseline, because we had evidence that we did not need the individual, stand-alone treatment group variable in the model.</p>
<!-- MEM section -->
</div>
</div>
<div id="long-linearmixed" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Linear Mixed Effect Models for Longitudinal Data<a href="introduction-to-longitudinal-data.html#long-linearmixed" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The previous section introduced a linear model for inference on the population level. This section introduces linear mixed-effects (LME) models, which model both the population average along with subject-specific trends. By allowing a subset of the regression parameters to vary randomly between subjects, we account for sources of natural heterogeneity (differences) in the population of interest <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span>. That is, the mean response is modelled as a combination of the population characteristics which are assumed to be the same for all subjects, and the unique subject-specific characteristics for each subject in the study. We do this by including subject-specific regression coefficients, or <a href="https://en.wikipedia.org/wiki/Random_effects_model">“random effects”</a> <span class="math inline">\(\bm{b}_i\)</span>, into our model, along with our population coefficients or <a href="https://en.wikipedia.org/wiki/Fixed_effects_model">“fixed effects”</a> <span class="math inline">\(\bm{\beta}\)</span>.</p>
<p>As linear mixed-effects models model subject-specific trends, not only can we describe how the response of interest changes over time (the response trajectory) in a population, but we can also predict how the individual, subject-level responses change within an individual subject over time. We also can deal with irregular, imbalanced longitudinal data where the number and timing of observations per subject may differ.</p>
<div id="long-linearmixed-notation" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Notation and Model Specification<a href="introduction-to-longitudinal-data.html#long-linearmixed-notation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Formally, we consider the model
<span class="math display">\[
Y_{ij} = \bm{x}_{ij}^T\bm{\beta} + \bm{z}_{ij}^T\bm{b}_{i} + \epsilon_{ij},
\]</span>
where</p>
<ul>
<li><span class="math inline">\(Y_{ij}\)</span> is the response of individual <span class="math inline">\(i\)</span> at time <span class="math inline">\(j\)</span>,</li>
<li><span class="math inline">\(\bm{x}_{ij}\)</span> is a <span class="math inline">\(p \times 1\)</span> covariate vector for the fixed effects,</li>
<li><span class="math inline">\(\bm{\beta}\)</span> is the vector of parameters for the fixed effects,</li>
<li><span class="math inline">\(\bm{z}_{ij}\)</span> is a <span class="math inline">\(q \times 1\)</span> covariate vector for the random effects,</li>
<li><span class="math inline">\(\bm{b}_{ij}\)</span> is a vector of parameters for the random effects, and</li>
<li><span class="math inline">\(\epsilon_{ij}\)</span> is the random error associated with individual <span class="math inline">\(i\)</span> at time <span class="math inline">\(j\)</span>.</li>
</ul>
<p>Typically we assume the covariate vector for the random effects is a subset of the fixed effects.</p>
<p>We can write this in matrix form as
<span class="math display">\[
\bm{Y}_i = \bm{X}_i \bm{\beta} + \bm{Z}_i\bm{b}_i + \bm{\epsilon}_i,
\]</span>
where
<span class="math display">\[
\YY_i = \begin{bmatrix}
Y_{i1} \\
Y_{i2} \\
\vdots \\
Y_{i,k_i}\\
\end{bmatrix} ,    \XX_i = \begin{bmatrix}
\bm{x}_{i1}^T\\
\bm{x}_{i2}^T \\
\vdots \\
\bm{x}_{i, k_i}^T\\
\end{bmatrix}, \ZZ_i = \begin{bmatrix}
\bm{z}_{i1}^T\\
\bm{z}_{i2}^T \\
\vdots \\
\bm{z}_{i, k_i}^T\\
\end{bmatrix}, \text{     and } \bm{\epsilon}_i = \begin{bmatrix}
\epsilon_{i1}^T\\
\epsilon_{i2}^T\\
\vdots\\
\epsilon_{i,k_i}^T
\end{bmatrix},
\]</span>
where <span class="math inline">\(k_i\)</span> is the number of observations for subject <span class="math inline">\(i\)</span>, which may differ among subjects.</p>
<p>Under this model, we have a number of distributional assumptions. First, we assume the random effects, <span class="math inline">\(\bm{b}_i\)</span> are distributed with a multivariate normal distribution:
<span class="math display">\[
\bm{b}_i \sim \N(\bm{0}, \bm{D}),
\]</span>
where <span class="math inline">\(\bm{D}\)</span> is a <span class="math inline">\(q \times q\)</span> covariance matrix for the random effects <span class="math inline">\(\bm{b}_i\)</span>, which are common for subjects. We assume <span class="math inline">\(\bm{D}\)</span> is <a href="https://en.wikipedia.org/wiki/Symmetric_matrix">symmetric</a>, <a href="https://en.wikipedia.org/wiki/Definite_matrix">positive-definite</a>, and unstructured.</p>
<p>We also make assumptions on the random errors, <span class="math inline">\(\bm{\epsilon}_i\)</span>, such that
<span class="math display">\[
\bm{\epsilon}_i \sim \N(\bm{0}, \bm{V}_i),
\]</span>
where <span class="math inline">\(\bm{V}_i\)</span> is a <span class="math inline">\(k_i \times k_i\)</span> covariance matrix for the error terms, which we typically assume to be <span class="math inline">\(\bm{V}_i =\sigma^2\bm{I}\)</span> where <span class="math inline">\(\bm{I}\)</span> is the <a href="https://en.wikipedia.org/wiki/Identity_matrix">identity matrix</a>. We finally assume that the random effects and random errors are all mutually independent.</p>
<p>Under these assumptions, we can obtain estimates of the mean on the population and subject-specific levels. We can show that:</p>
<ul>
<li><p>the conditional, subject-specific mean of our outcome is <span class="math inline">\(E(\YY_i | \bm{b}_i) = \XX_i\bm{\beta} + \bm{Z}_i\bm{b}_i\)</span>;</p></li>
<li><p>the conditional, subject-specific covariance is <span class="math inline">\(Var(\YY_i | \bm{b}_i) = Var(\bm{\epsilon}_i) = \bm{V}_i\)</span>; and</p></li>
<li><p>due to the normality of the error term, we have <span class="math inline">\(\YY_i | \bm{b}_i \sim \N(\XX_i\bm{\beta}_i + \bm{Z}_i \bm{b}_i, \bm{V}_i)\)</span>.</p></li>
</ul>
<p>We can also derive marginal properties of our outcome. That is, we can show that:</p>
<ul>
<li><p>the marginal (unconditional), population-level mean of our outcome is <span class="math inline">\(E(\YY_i) = \XX_i\bm{\beta}\)</span>;</p></li>
<li><p>the marginal (unconditional), population-level covariance is <span class="math inline">\(Var(\YY_i) = \bm{Z}_i\bm{D}\bm{Z}_i^T + \bm{V}_i\)</span>;</p></li>
<li><p>due to the normality of our random effects <span class="math inline">\(\bm{b}_i\)</span> and error term <span class="math inline">\(\epsilon_i\)</span>, we have <span class="math inline">\(\YY_i \sim \N(\XX_i\bm{\beta}_i, \bm{Z}_i\bm{D}\bm{Z}_i + \bm{V}_i)\)</span>. From this formulation, we see that the population variance of our outcome comprises of different sources of variation; the between-subject (inter-subject) variation from <span class="math inline">\(Var(\bm{b}_i) = \bm{D}\)</span>, and the within-subject (intra-subject) variation from <span class="math inline">\(Var(\epsilon_i) = \bm{V}_i =\sigma^2\bm{I}\)</span>.</p></li>
</ul>
<p>Note that in general, <span class="math inline">\(\bm{Z}_i\bm{D}\bm{Z}_i^T + \bm{V}_i\)</span> is not a diagonal matrix and we do not assume that the outcomes are independent. This is unsurprising as we expect responses/outcomes from the same subject to be correlated. This expression for the variance also varies between subjects (note the subscript <span class="math inline">\(i\)</span>), making it suitable for unbalanced data.</p>
</div>
<div id="long-linearmixed-randomintercept" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Random Intercept Models<a href="introduction-to-longitudinal-data.html#long-linearmixed-randomintercept" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One of the simplest linear mixed-effects models is the random intercept model. In this model, we have a linear model with a randomly varying subject effect; that is, we assume that each subject in our study has an underlying level of response that persists over time <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span>. As such, we consider the following model:
<span class="math display">\[
Y_{ij} = X_{ij}^T\beta + b_i + \epsilon_{ij},
\]</span>
where <span class="math inline">\(b_i\)</span> is the random individual effect (the random intercept) and <span class="math inline">\(\epsilon_{ij}\)</span> is the measurement or sampling errors <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span>. Recall that the random intercept and error term are assumed to be random. In this formulation, we can denote <span class="math inline">\(Var(b_i) = \sigma_{b,0}^2\)</span> and recall <span class="math inline">\(Var(\epsilon_{ij}) = \sigma^2\)</span> (this comes from the matrix form <span class="math inline">\(Var(\epsilon_i) = \bm{V}_i =\sigma^2\bm{I}\)</span>). Additionally, we assume that <span class="math inline">\(b_i\)</span> and <span class="math inline">\(\epsilon_{ij}\)</span> are independent of each other.</p>
<p>Under this model, the mean response trajectory over time for any subject is
<span class="math display">\[
E(Y_{ij}|b_i) = X_{ij}^T\beta +b_i,
\]</span>
and the mean outcome at the population level (when averaging over all study subjects) is
<span class="math display">\[
E(Y_{ij}) = X_{ij}^T\beta.
\]</span>
Note that both of these quantities are technically conditional on the covariates <span class="math inline">\(X_{ij}\)</span> as well. This notation, which does not explicitly state that the expectations are conditional on <span class="math inline">\(X_{ij}\)</span>, is commonly used in the literature and thus is presented here.</p>
<p>Another feature of the random intercept model is the <em>intra-class correlation</em> (ICC), which is the correlation between any two responses of the same individual. We can calculate this as
<span class="math display">\[
\begin{aligned}
\cor(Y_{ij}, Y_{il}) &amp;= \frac{\cov(Y_{ij}, Y_{il})}{\sqrt{\var(Y_{ij})\var{Y_{il}}}}\\
&amp;= \frac{\sigma_{b,0}^2}{\sigma_{b,0}^2 + \sigma^2},
\end{aligned}
\]</span>
which is the ratio of the between-subject and total variability. This formulation shows that the correlation between any two responses within the same individual is the same.</p>
<p>As an applied example, let’s go back to the data set on orthodontic measurements. We shall consider a simple linear mixed-effects (LME) model of the form
<span class="math display">\[
\begin{aligned}
Y_{ij} &amp;= \bm{x}_{ij}^T\bm{\beta} + \bm{b}_{0,i} + \epsilon_{ij} \\
&amp;= \beta_0 + \beta_1z_{i} + \beta_2t_{ij} + b_{0,i} + \epsilon_{ij},
\end{aligned}
\]</span>
where <span class="math inline">\(Y_{ij}\)</span> is the orthodontic measurement of subject <span class="math inline">\(i\)</span> at occasion <span class="math inline">\(j\)</span>, <span class="math inline">\(z_{i}\)</span> is the indicator for if subject <span class="math inline">\(i\)</span> is male or not and <span class="math inline">\(t_{ij}\)</span> is a continuous time variable representing the age of subject <span class="math inline">\(i\)</span> at occasion <span class="math inline">\(j\)</span>. In this model, the population average profile is assumed to be linear, and <span class="math inline">\(\beta_2\)</span> describes the change in mean response over time. The random intercept, <span class="math inline">\(b_{0,i}\)</span> represents the subject’s individual deviation from the population average trend after accounting for the time effects and controlling for sex. We can think of the random slope model as subjects having varying “baseline” orthodontic measurements. For further details, see Chapter 8.1 in <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span>.</p>
<p>We can interpret <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> as the expected change in the outcome for a one unit increase in the covariate, controlling for the other covariates in the mode.</p>
</div>
<div id="long-linearmixed-randominterceptslope" class="section level3 hasAnchor" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> Random Intercept and Slope Models<a href="introduction-to-longitudinal-data.html#long-linearmixed-randominterceptslope" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can also consider random slopes along with the random intercepts in LME models. In this model, we assume that the response (or outcome) of interest varies not only at baseline (the intercept) but also in terms of the rate of change over time (the slope). We also generalize this to incorporate additional randomly varying regression coefficients that allow the random effects to depend on a set of covariates. That is, we can consider a collection of covariates for the random effects, <span class="math inline">\(Z\)</span>, that are typically a subset of our fixed effects <span class="math inline">\(X\)</span>.</p>
<p>For the orthodontic measurement data, we can consider the following model
<span class="math display">\[
Y_{ij} = \beta_0 + \beta_1z_i + \beta_2t_{ij} + b_{0,i} + b_{1,i}t_{ij} + \epsilon_{ij},
\]</span>
where, again, <span class="math inline">\(Y_{ij}\)</span> is the orthodontic measurement of subject <span class="math inline">\(i\)</span> at occasion <span class="math inline">\(j\)</span>, <span class="math inline">\(z_{i}\)</span> is the indicator for if subject <span class="math inline">\(i\)</span> is male or not and <span class="math inline">\(t_{ij}\)</span> is a continuous time variable representing the age of subject <span class="math inline">\(i\)</span> at occasion <span class="math inline">\(j\)</span>. Note: we assume that the variable for <code>sex</code> is not time-varying, and hence can drop the <span class="math inline">\(j\)</span> subscript in this setting and consider it a time-invariant covariate.</p>
<p>In this model, the population average subject-specific profiles are assumed to be linear. This model includes subject-specific intercepts, <span class="math inline">\(b_{0,i}\)</span>, and subject-specific slopes, <span class="math inline">\(b_{1,i}\)</span> for the time effects.</p>
<p>We can rewrite this model in matrix form as
<span class="math display">\[
\YY_{i} = \XX_i \bm{\beta} + \bm{Z}_i\bm{b}_i + \bm{\epsilon}_i,
\]</span>
where in this case,
<span class="math display">\[
\XX_i = \begin{bmatrix}
1 &amp; z_i &amp; t_{i1} \\
1 &amp; z_i &amp; t_{i2} \\
\vdots &amp; \vdots &amp; \vdots \\
1 &amp; z_i &amp;t_{ik_i}
\end{bmatrix}, \bm{\beta} = \begin{bmatrix}
\beta_0 \\
\beta_1
\end{bmatrix}, \bm{Z}_i = \begin{bmatrix}
1  &amp; t_{i1} \\
1  &amp; t_{i2} \\
\vdots  &amp; \vdots \\
1  &amp; t_{ik_i}
\end{bmatrix}, \text{    and  } \bm{b}_i = \begin{bmatrix}
b_{0,i} \\
b_{1,i}
\end{bmatrix}.
\]</span></p>
<p>We recall that the vector of random effects <span class="math inline">\(\bm{b}_i = \begin{bmatrix} b_{0,i} \\ b_{1,i} \end{bmatrix}\)</span> follows a bivariate normal distribution <span class="math inline">\(\bm{b}_i \sim \N(0, \bm{D})\)</span> in this setting, where
<span class="math display">\[
D = \begin{bmatrix}
d_{11}  &amp; d_{12} \\
d_{12}  &amp; d_{22}
\end{bmatrix}.
\]</span></p>
<p>Each of the components of our correlation matrix <span class="math inline">\(D\)</span> has meaningful interpretations:</p>
<ul>
<li><p><span class="math inline">\(\sqrt{d_{11}}\)</span> is the subject-to-subject deviation in the overall response at baseline (variation of random intercept),</p></li>
<li><p><span class="math inline">\(\sqrt{d_{22}}\)</span> is the subject-to-subject deviation in the change (time slope) of the response (variation of random slope for the time), and</p></li>
<li><p><span class="math inline">\(d_{12}\)</span> is the covariance between the individual, subject-specific intercepts, and slopes.</p></li>
</ul>
<p>Note that LME models are not limited to having only one random effect for the time variable. One can choose to have random effects for multiple variables of interest.</p>
<p>Under LME models, the correlation structure is more flexible than in the regular linear model case and also can be time-dependent. Additionally, we can distinguish between the between- and within-subject sources of variation. It is also recommended to fit this model using an unstructured correlation structure for our random effects, <span class="math inline">\(\bm{D}\)</span>. More details can be found in Chapter 8.1 of <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span>.</p>
</div>
<div id="long-linearmixed-estimation" class="section level3 hasAnchor" number="6.4.4">
<h3><span class="header-section-number">6.4.4</span> Estimation<a href="introduction-to-longitudinal-data.html#long-linearmixed-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We wish to estimate the fixed effects <span class="math inline">\(\bm{\beta}\)</span> and the components of our correlation structure <span class="math inline">\(\bm{D}\)</span> along with <span class="math inline">\(\bm{V}_i = \sigma^2\bm{I}\)</span>. We will let the column vector <span class="math inline">\(\bm{\theta}\)</span> denote the collection of correlation components of <span class="math inline">\(\bm{D}\)</span> and the variance component <span class="math inline">\(\sigma^2\)</span>, which we intend to estimate. We also may want to predict our random effects, <span class="math inline">\(\bm{b}_i\)</span>.</p>
<p>We have unconditional (marginal) normality of our outcome <span class="math inline">\(\bm{Y}_i\)</span>, that is
<span class="math display">\[
\bm{Y}_i \sim \N(\bm{X}_i\bm{\beta}, \bm{Z}_i\bm{D}\bm{Z}_i^T + \sigma^2\bm{I}).
\]</span></p>
<p>To estimate our fixed effects, <span class="math inline">\(\beta\)</span>, we use maximum likelihood estimation (ML), and to estimate our variance and covariance parameters <span class="math inline">\(\bm{\theta}\)</span>, we use restricted maximum likelihood estimation (REML).</p>
<p>To conduct inference on our fixed effects, based on asymptotic normality we have
<span class="math display">\[
\widehat{\bm{\beta}} \sim \N \left(\bm{\beta}, \left[\sum_{i=1}^n \bm{X}_i^T \bm{\Sigma}_i^{-1}(\bm{\theta})\bm{X}_i \right]^{-1} \right),
\]</span>
where <span class="math inline">\(\bm{\Sigma}_i(\bm{\theta}) = \bm{Z}_i\bm{D}\bm{Z}_i^T + \sigma^2\bm{I}\)</span>. This means that we can use a Wald test for investigating certain fixed effects and calculating confidence intervals. That is,
<span class="math display">\[
\frac{\widehat{\beta}_j - \beta_j}{se(\widehat{\beta}_j)} \sim N(0,1).
\]</span></p>
<p>Similar to what we saw in Section <a href="introduction-to-longitudinal-data.html#long-linear-estimation">6.3.4</a>, we can estimate the asymptotic variance (and thus the asymptotic standard error) of <span class="math inline">\(\beta_j\)</span> by looking at the <span class="math inline">\((j,j)^{th}\)</span> element of <span class="math inline">\(\left[\sum_{i=1}^n \bm{X}_i^T \bm{\Sigma}_i^{-1}(\bm{\theta})\bm{X}_i \right]^{-1}\)</span>. This will allow us to perform hypothesis testing of the form <span class="math inline">\(H_0: \beta_j = 0\)</span>. We can also perform likelihood ratio tests on models with nested fixed effects (and the same random effects), similar to Section <a href="introduction-to-longitudinal-data.html#long-linear-estimation">6.3.4</a>.</p>
<p>For inference on the variance and correlation parameters <span class="math inline">\(\bm{\theta}\)</span>, we have some asymptotic results yet again. However, the form of the variance of <span class="math inline">\(\hat{\bm{\theta}}\)</span> is complicated and the parameter space is constrained which can make our typical distributional approximations inadequate.</p>
<p>For example, we <strong>cannot</strong> use a simple Wald test to test something like <span class="math inline">\(H_0: \var(b_{1,i}) = 0\)</span> as the test statistic does not follow a standard normal distribution under <span class="math inline">\(H_0\)</span>. However, testing if the variance of the random intercept is zero is equivalent to performing a likelihood ratio test on whether the random slope <span class="math inline">\(b_{1,i}\)</span> is needed in the model. Thus, we could perform a LRT comparing two nested models: one including a random slope term and one that does not, all else being equal.</p>
<p>In general, to compare a model with <span class="math inline">\(q\)</span> random effects versus one with <span class="math inline">\(q+1\)</span> random effects, we can use LRT but <strong>must not use the given <span class="math inline">\(p\)</span>-value</strong> because the test is based on a mixture distribution. To obtain the correct <span class="math inline">\(p\)</span>-value, we can use the <code>pchibarsq()</code> function in the <a href="https://CRAN.R-project.org/package=emdbook"><strong>emdbook</strong></a> package to obtain the <span class="math inline">\(p\)</span>-value. An example is given in the following section.</p>
<p>For more complex nested random effects models, the distribution of the LRT is not well understood. However, we can still conduct the tests in an ad-hoc fashion. For example, if we wanted to compare two models that differ by more than one random effect, we can use a standard chi-squared distribution with the degrees of freedom equal to the difference in the number of parameters and use a larger significance threshold, such as 0.1 as opposed to the usual 0.05.</p>
<p>We can use both ML and REML to perform LRT comparing nested random effects structures, however, REML should only be used when the fixed effects are the same for both models. When we are comparing non-nested models, we can use information criteria such as AIC and BIC, where a smaller AIC or BIC indicates a better model. AIC and BIC measure different aspects of a model’s fit, thus choice between using AIC or BIC is data specific. We generally use AIC and BIC together and do not have a strong preference between the two quantities. More information can be found <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion#Comparison_with_BIC">here</a>.</p>
</div>
<div id="long-linearmixed-R" class="section level3 hasAnchor" number="6.4.5">
<h3><span class="header-section-number">6.4.5</span> Modelling in R<a href="introduction-to-longitudinal-data.html#long-linearmixed-R" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Linear mixed-effects models can fit in R by using the <code>lme()</code> function from the <a href="https://CRAN.R-project.org/package=nlme"><strong>nlme</strong></a> library. This function has a number of parameters, including:</p>
<ul>
<li><p><code>fixed</code>: a two-sided linear formula for the fixed effects of the form <code>response ~ fixedeffect1 + ... + fixedeffectp</code> where fixedeffect1, …, fixedeffectp are the names of the desired covariates for the fixed effects in the model;</p></li>
<li><p><code>random</code>: a one-sided linear formula for the random effects of the form <code>~ randeffect1 + ... + randeffectp</code> where randeffect1, …, randeffectp are the names of the desired covariates for the random effects in the models;</p></li>
<li><p><code>pdMat</code>: the specification of the correlation structure for the random effects (<span class="math inline">\(D\)</span>). Options for this argument include <code>pdSymm</code> (the default, unstructured correlation structure), <code>pdDiag</code> (independent), and <code>pdCompSymm</code> (exchangeable);</p></li>
<li><p><code>correlation</code>: the specification of the within-subject correlation structure (<span class="math inline">\(V\)</span>). The default is an independent structure, and the specifications are the same as for the <code>gls()</code> function shown in Section <a href="introduction-to-longitudinal-data.html#long-linear-R">6.3.5</a>; and</p></li>
<li><p><code>method</code>: the specification of the method used to fit the model (“ML” for maximum likelihood and “REML” (default) for restricted maximum likelihood estimation).</p></li>
</ul>
<p>As an example, we will fit the models described in Sections <a href="introduction-to-longitudinal-data.html#long-linearmixed-randominterceptslope">6.4.3</a> and <a href="introduction-to-longitudinal-data.html#long-linearmixed-randomintercept">6.4.2</a>. We begin with the random intercept model of the form
<span class="math display">\[
\begin{aligned}
Y_{ij} &amp;= \bm{x}_{ij}^T\bm{\beta} + \bm{b}_{0,i} + \epsilon_{ij} \\
&amp;= \beta_0 + \beta_1z_{i} + \beta_2t_{ij} + b_{0,i} + \epsilon_{ij},
\end{aligned}
\]</span>
where <span class="math inline">\(Y_{ij}\)</span> is the orthodontic measurement of subject <span class="math inline">\(i\)</span> at occasion <span class="math inline">\(j\)</span>, <span class="math inline">\(z_{i}\)</span> is the indicator for if subject <span class="math inline">\(i\)</span> is male or not and <span class="math inline">\(t_{ij}\)</span> is a continuous time variable representing the age of subject <span class="math inline">\(i\)</span> at occasion <span class="math inline">\(j\)</span>.</p>
<p>To fit this, we do the following:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="introduction-to-longitudinal-data.html#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the random intercept only model</span></span>
<span id="cb536-2"><a href="introduction-to-longitudinal-data.html#cb536-2" aria-hidden="true" tabindex="-1"></a>fitLME_intercept <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb536-3"><a href="introduction-to-longitudinal-data.html#cb536-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> distance <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="co"># specify fixed effects</span></span>
<span id="cb536-4"><a href="introduction-to-longitudinal-data.html#cb536-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> subject, <span class="co"># random intercept only</span></span>
<span id="cb536-5"><a href="introduction-to-longitudinal-data.html#cb536-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dental_long</span>
<span id="cb536-6"><a href="introduction-to-longitudinal-data.html#cb536-6" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation</span></span>
<span id="cb536-7"><a href="introduction-to-longitudinal-data.html#cb536-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-8"><a href="introduction-to-longitudinal-data.html#cb536-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitLME_intercept) <span class="co"># look at the output</span></span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: dental_long 
##        AIC      BIC    logLik
##   447.5125 460.7823 -218.7563
## 
## Random effects:
##  Formula: ~1 | subject
##         (Intercept) Residual
## StdDev:    1.807425 1.431592
## 
## Fixed effects:  distance ~ age + sex 
##                 Value Std.Error DF   t-value p-value
## (Intercept) 15.385690 0.8959848 80 17.171820  0.0000
## age          0.660185 0.0616059 80 10.716263  0.0000
## sexM         2.321023 0.7614168 25  3.048294  0.0054
##  Correlation: 
##      (Intr) age   
## age  -0.756       
## sexM -0.504  0.000
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -3.74889609 -0.55034466 -0.02516628  0.45341781  3.65746539 
## 
## Number of Observations: 108
## Number of Groups: 27</code></pre>
<p>We reiterate that by not specifying the structures for our correlation of the random effects and within-subject correlation, we use the default settings (unstructured and independent, respectively). We also did not specify the <code>method</code>, which defaults to using REML. When estimating the correlation structures, we prefer to use REML.</p>
<p>From the output, we have a number of fit statistics (AIC/BIC), and under the “Random effects:” section we can obtain estimates of <span class="math inline">\(\sigma_{b,0} = \sqrt{\var(b_{0,i})}\)</span> which is estimated to be 1.8074 and <span class="math inline">\(\sigma = \sqrt{\var(\epsilon_{ij})}\)</span> which is estimated to be 1.4316.</p>
<p>We also have our typical estimates for our fixed effects, along with their standard errors and <span class="math inline">\(p\)</span>-values from the Wald test for the null hypothesis of <span class="math inline">\(\beta_i = 0\)</span>. In this case, we see that there is a statistically significant time trend (<span class="math inline">\(p\)</span>-value = 0.0000) and there are significant differences in growth between male and female children (<span class="math inline">\(p\)</span>-value = 0.0054).</p>
<p>We can also fit a random slope and intercept model. To do this, we perform the following:</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="introduction-to-longitudinal-data.html#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library of nlme already loaded</span></span>
<span id="cb538-2"><a href="introduction-to-longitudinal-data.html#cb538-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb538-3"><a href="introduction-to-longitudinal-data.html#cb538-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the random intercept and slope model</span></span>
<span id="cb538-4"><a href="introduction-to-longitudinal-data.html#cb538-4" aria-hidden="true" tabindex="-1"></a>fitLME_slope <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb538-5"><a href="introduction-to-longitudinal-data.html#cb538-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> distance <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="co"># specify fixed effects</span></span>
<span id="cb538-6"><a href="introduction-to-longitudinal-data.html#cb538-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> age <span class="sc">|</span> subject, <span class="co"># random slope on time variable,</span></span>
<span id="cb538-7"><a href="introduction-to-longitudinal-data.html#cb538-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb538-8"><a href="introduction-to-longitudinal-data.html#cb538-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dental_long</span>
<span id="cb538-9"><a href="introduction-to-longitudinal-data.html#cb538-9" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb538-10"><a href="introduction-to-longitudinal-data.html#cb538-10" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb538-11"><a href="introduction-to-longitudinal-data.html#cb538-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb538-12"><a href="introduction-to-longitudinal-data.html#cb538-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitLME_slope) <span class="co"># look at the output</span></span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: dental_long 
##        AIC      BIC    logLik
##   449.2339 467.8116 -217.6169
## 
## Random effects:
##  Formula: ~age | subject
##  Structure: General positive-definite, Log-Cholesky parametrization
##             StdDev    Corr  
## (Intercept) 2.7970227 (Intr)
## age         0.2264274 -0.766
## Residual    1.3100398       
## 
## Fixed effects:  distance ~ age + sex 
##                 Value Std.Error DF   t-value p-value
## (Intercept) 15.489709 0.9442868 80 16.403606   0.000
## age          0.660185 0.0712532 80  9.265338   0.000
## sexM         2.145492 0.7574539 25  2.832504   0.009
##  Correlation: 
##      (Intr) age   
## age  -0.787       
## sexM -0.475  0.000
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -3.08141704 -0.45675583  0.01552695  0.44704158  3.89437694 
## 
## Number of Observations: 108
## Number of Groups: 27</code></pre>
<p>Without specifying the <code>method</code> parameter, we fit this model using REML. Again, from the output we see a number of fit statistics including AIC and BIC, which are slightly larger than in the random intercept model. Under the <code>Random effects:</code> header, we can obtain estimates for the standard deviations of our random slope and intercept, along with the standard deviations of our error term and the estimated correlation between our random slope and intercept. We can then calculate:</p>
<ul>
<li>the estimated variance of our random intercept as <span class="math inline">\(\widehat{\sigma}_{b,0}^2 = 2.797^2 =\)</span> 7.8232,</li>
<li>the estimated variance of our random slope as <span class="math inline">\(\widehat{\sigma}_{b,1}^2 = 0.1609^2 =\)</span> 0.0259,</li>
<li>the estimated variance of our error term as <span class="math inline">\(\widehat{\sigma}^2 = 0.6683^2 =\)</span> 0.4466, and</li>
<li>the estimated correlation between the random slope and intercept as <span class="math inline">\(\widehat{\cor}(b_{0,i}, b_{1,i}) = -0.3540\)</span>.</li>
</ul>
<p>We also have our usual summary of the fixed effect regression coefficients, including with test statistics and <span class="math inline">\(p\)</span>-values for the hypothesis test of <span class="math inline">\(\beta_j = 0\)</span>. The correlations of the fixed effect regression coefficients (not the covariates themselves) is of little interest here.</p>
<p>Now that we have fit two models, one with and one without a random slope term, we can perform a LRT to see which model fit is most appropriate for this data. We do this through the <code>anova()</code> function, however <strong>we cannot use the given <span class="math inline">\(p\)</span>-value and must use a table or R function to calculate the correct <span class="math inline">\(p\)</span>-value</strong>. We must obtain the <span class="math inline">\(p\)</span>-value using the <code>pchibarsq()</code> function, with the degrees of freedom equal to the difference in random effects between the two models. In this case, we are testing a model with a random slope versus without, so one random effect differs between the two models.</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="introduction-to-longitudinal-data.html#cb540-1" aria-hidden="true" tabindex="-1"></a>LRT_mix <span class="ot">&lt;-</span> <span class="fu">anova</span>(fitLME_slope, fitLME_intercept) <span class="co">#perform test</span></span>
<span id="cb540-2"><a href="introduction-to-longitudinal-data.html#cb540-2" aria-hidden="true" tabindex="-1"></a>teststat_mix <span class="ot">&lt;-</span> LRT_mix<span class="sc">$</span>L.Ratio[<span class="dv">2</span>] <span class="co">#grab test statistics</span></span>
<span id="cb540-3"><a href="introduction-to-longitudinal-data.html#cb540-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb540-4"><a href="introduction-to-longitudinal-data.html#cb540-4" aria-hidden="true" tabindex="-1"></a><span class="co">#degree of freedom is 1 because we have one random effect differing</span></span>
<span id="cb540-5"><a href="introduction-to-longitudinal-data.html#cb540-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pchibarsq</span>(teststat_mix, <span class="at">df =</span> <span class="dv">1</span>, <span class="at">mix =</span> <span class="fl">0.5</span>) </span></code></pre></div>
<pre><code>## [1] 0.934417</code></pre>
<p>From this output, our <span class="math inline">\(p\)</span>-value is large and we do not have evidence to reject the hypothesis that the simpler, random intercept only model is better. That is, the hypothesis test tells us that we do not have evidence to include a random slope term. We thus conclude that the linear trend of growth is quite homogeneous among children in the study. Note that the AIC value also is smaller for the intercept-only model, providing us with evidence for the same conclusion.</p>
<p>As such, we will draw our conclusions from the linear mixed-effects model with only a random intercept. Although statistical tests have lead us to this model selection, we can assess the choice of the random-intercept model by plotting a <a href="https://en.wikipedia.org/wiki/Spaghetti_plot">spaghetti plot</a> of observations under varying baseline measurements. The similar trajectories over time for individuals in the study will indicate the relevance of the random-intercept model.</p>
<p>We can do this in R by the following commands using <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> package:</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="introduction-to-longitudinal-data.html#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dental_long, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> distance, <span class="at">group =</span> subject)) <span class="sc">+</span></span>
<span id="cb542-2"><a href="introduction-to-longitudinal-data.html#cb542-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb542-3"><a href="introduction-to-longitudinal-data.html#cb542-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> sex) <span class="sc">+</span></span>
<span id="cb542-4"><a href="introduction-to-longitudinal-data.html#cb542-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>() <span class="sc">+</span></span>
<span id="cb542-5"><a href="introduction-to-longitudinal-data.html#cb542-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Spaghetti Plot for Orthodontic Data Observations (Stratified by Sex)&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-spaghettiplotdent"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-spaghettiplotdent-1.png" alt="Plot of individual trajectories for the distance over time, stratified by sex." width="672" />
<p class="caption">
Figure 6.4: Plot of individual trajectories for the distance over time, stratified by sex.
</p>
</div>
<p>In Figure <a href="introduction-to-longitudinal-data.html#fig:long-lme-spaghettiplotdent">6.4</a>, each line is one subject’s observations over time (age). The groups are stratified by sex to account for differences in trajectory by sex, which was a statistically significant factor in our model. We see that subjects within each strata have very different baseline measurements, but see similar trajectories (slopes) over time. This is particularly evident in the subset of females enrolled in the study. Our random intercept model thus makes sense for this setting.</p>
</div>
<div id="long-linearmixed-diagnostics" class="section level3 hasAnchor" number="6.4.6">
<h3><span class="header-section-number">6.4.6</span> Model Diagnostics for Linear Mixed-Effects Models<a href="introduction-to-longitudinal-data.html#long-linearmixed-diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>After fitting our LME model, we need to assess the model fit to make sure it is appropriate for the data.</p>
<p><strong>Serial Correlation</strong></p>
<p>First, we can assess if there is <a href="https://en.wikipedia.org/wiki/Autocorrelation">serial correlation</a> among the random error term in the model. This will provide insights on if the choice of correlation structure <span class="math inline">\(\bm{V}_i\)</span> (which is typically chosen to be an independent structure) was appropriate.</p>
<p>If the observations were taken such that subsequent observations were nearly equidistant to each other (which is the case for our dental data set where we have observations at 8, 10, 12, and 14 years), then we can call the <code>ACF()</code> function from the <a href="https://CRAN.R-project.org/package=nlme"><strong>nlme</strong></a> package to assess serial correlation. This can be done in R as follows:</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="introduction-to-longitudinal-data.html#cb543-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ACF</span>(fitLME_intercept), <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">main =</span> <span class="st">&quot;Plot of Estimated Autocorrelation&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-acfplot"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-acfplot-1.png" alt="ACF plot for assessing serial correlation in the fitted model." width="672" />
<p class="caption">
Figure 6.5: ACF plot for assessing serial correlation in the fitted model.
</p>
</div>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="introduction-to-longitudinal-data.html#cb544-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Variogram</span>(fitLME_intercept, <span class="at">form =</span> <span class="sc">~</span> age <span class="sc">|</span> subject, <span class="at">collapse =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb544-2"><a href="introduction-to-longitudinal-data.html#cb544-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">restype =</span> <span class="st">&quot;pearson&quot;</span>), <span class="at">xlab =</span> <span class="st">&quot;years&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Variogram Plot&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-variogramplot"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-variogramplot-1.png" alt="Variogram plot for assessing serial correlation in the fitted model." width="672" />
<p class="caption">
Figure 6.6: Variogram plot for assessing serial correlation in the fitted model.
</p>
</div>
<p>In Figures <a href="introduction-to-longitudinal-data.html#fig:long-lme-acfplot">6.5</a> and <a href="introduction-to-longitudinal-data.html#fig:long-lme-variogramplot">6.6</a>, we have plotted the estimated autocorrelation at various lags and also plotted a 95% confidence interval for the values. Ignoring the first value (lag = 0), we do have lags at which the values fall outside of the 95% confidence interval, indicating issues with serial correlation. However, the trend line <a href="https://www.rdocumentation.org/packages/geoR/versions/1.8-1/topics/plot.variogram">variogram</a> does not show any obvious patterns or trends. We see it is perhaps an outlier that is driving the serial correlation to be so high. Based on the information from both of these plots together, we see that serial correlation is not evident in this model and our choice of correlation structure was adequate.</p>
<p>If the trend line on the variogram had not appeared to be flat, we could refit the model using other correlation structures and re-assess the fit.</p>
<p><strong>Common Variances</strong></p>
<p>We next assess the common variance assumption (sometimes referred to as <a href="https://en.wikipedia.org/wiki/Homoscedasticity">homoscedasticity</a>). We can do this visually by looking at a plot of the residuals.</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="introduction-to-longitudinal-data.html#cb545-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">residuals</span>(fitLME_intercept), <span class="at">main =</span> <span class="st">&quot;Plot of Residuals for Random Intercept Model&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-residualplot"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-residualplot-1.png" alt="Residual plot used to assess homoscedasticity." width="672" />
<p class="caption">
Figure 6.7: Residual plot used to assess homoscedasticity.
</p>
</div>
<p>From Figure <a href="introduction-to-longitudinal-data.html#fig:long-lme-residualplot">6.7</a>, we do not see any clustering or patterns, or many values outside of 2 standard deviations, indicating we have likely satisfied the common variance assumption. We can similarly look at a different plot:</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="introduction-to-longitudinal-data.html#cb546-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fitLME_intercept, subject <span class="sc">~</span> <span class="fu">resid</span>(.), <span class="at">horizontal =</span> F, </span>
<span id="cb546-2"><a href="introduction-to-longitudinal-data.html#cb546-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel =</span> <span class="cf">function</span>(x,y){<span class="fu">panel.bwplot</span>(x,y)},</span>
<span id="cb546-3"><a href="introduction-to-longitudinal-data.html#cb546-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Boxplot of Standardized Residuals by Subject&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-residualplot2"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-residualplot2-1.png" alt="Box plot of residuals used to assess homoscedasticity." width="672" />
<p class="caption">
Figure 6.8: Box plot of residuals used to assess homoscedasticity.
</p>
</div>
<p>We do not see any systematic over/under of the residuals about 0 in Figure <a href="introduction-to-longitudinal-data.html#fig:long-lme-residualplot2">6.8</a>. This indicates we have indeed satisfied the assumption.</p>
<p><strong>Normality of Errors</strong></p>
<p>The next assumption we can check is the normality assumption for the random error term. We can check this using a Q-Q plot of the residuals:</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="introduction-to-longitudinal-data.html#cb547-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(fitLME_intercept, <span class="sc">~</span> <span class="fu">resid</span>(.), <span class="at">id =</span> <span class="fl">0.05</span>, <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb547-2"><a href="introduction-to-longitudinal-data.html#cb547-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Q-Q Plot of Residuals&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-normalityerrors"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-normalityerrors-1.png" alt="Q-Q plot for assessing normality of the random error term." width="672" />
<p class="caption">
Figure 6.9: Q-Q plot for assessing normality of the random error term.
</p>
</div>
<p>Most points lie on the line in Figure <a href="introduction-to-longitudinal-data.html#fig:long-lme-normalityerrors">6.9</a>, indicating that the normality assumption is satisfied for the residuals.</p>
<p>We can also check the assumption of normality for the random intercepts in our model by performing the following:</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="introduction-to-longitudinal-data.html#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(fitLME_intercept, <span class="sc">~</span><span class="fu">ranef</span>(.), <span class="at">id =</span> <span class="fl">0.05</span>, <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb548-2"><a href="introduction-to-longitudinal-data.html#cb548-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Q-Q plot of Predicted Random Intercepts&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-normalityint"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-normalityint-1.png" alt="Q-Q plot for assessing normality assumption for the random intercepts." width="672" />
<p class="caption">
Figure 6.10: Q-Q plot for assessing normality assumption for the random intercepts.
</p>
</div>
<p>In Figure <a href="introduction-to-longitudinal-data.html#fig:long-lme-normalityint">6.10</a>, the Q-Q plot indicates that we do not have exactly normally distributed random intercepts. However, we often see in practice that the predicted random effects do not perfectly satisfy the normality assumption. In this setting, we consider this to be adequate for our assumption.</p>
<p><strong>Linearity</strong></p>
<p>The next assumption we check is the linearity assumption. We can first check this for the entire study population:</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="introduction-to-longitudinal-data.html#cb549-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fitLME_intercept, distance <span class="sc">~</span> <span class="fu">fitted</span>(.), <span class="at">id =</span> <span class="fl">0.05</span>, <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb549-2"><a href="introduction-to-longitudinal-data.html#cb549-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Observed vs. Fitted Values&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-linearitypop"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-linearitypop-1.png" alt="Plot for assessing linearity." width="672" />
<p class="caption">
Figure 6.11: Plot for assessing linearity.
</p>
</div>
<p>Linearity appears to be satisfied here. We can also look at linearity within each treatment group:</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="introduction-to-longitudinal-data.html#cb550-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fitLME_intercept, distance <span class="sc">~</span> <span class="fu">fitted</span>(.)<span class="sc">|</span>sex, <span class="at">id =</span> <span class="fl">0.05</span>, <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb550-2"><a href="introduction-to-longitudinal-data.html#cb550-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Observed vs. Fitted Values by Treatment Group&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-linearitypop2"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-linearitypop2-1.png" alt="Plot for assessing linearity within each treatment group." width="672" />
<p class="caption">
Figure 6.12: Plot for assessing linearity within each treatment group.
</p>
</div>
<p>The assumption of linearity again appears to be satisfied. Finally, we can check for linearity in each of the 27 subjects:</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="introduction-to-longitudinal-data.html#cb551-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fitLME_intercept, distance <span class="sc">~</span> <span class="fu">fitted</span>(.)<span class="sc">|</span>subject, <span class="at">id =</span> <span class="fl">0.05</span>, <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb551-2"><a href="introduction-to-longitudinal-data.html#cb551-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Observed vs. Fitted Values by Treatment Group&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-linearitysubj"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-linearitysubj-1.png" alt="Plot for assessing linearity for each subject." width="672" />
<p class="caption">
Figure 6.13: Plot for assessing linearity for each subject.
</p>
</div>
<p>We have a small number of observations per subject, but linearity also appears to be satisfied in this settings.</p>
</div>
<div id="long-linearmixed-popmeans" class="section level3 hasAnchor" number="6.4.7">
<h3><span class="header-section-number">6.4.7</span> Population Means<a href="introduction-to-longitudinal-data.html#long-linearmixed-popmeans" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finding the estimates and 95% confidence intervals for fixed and random effects is straightforward in R. We can call the <code>intervals()</code> function on the model of interest, as:</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="introduction-to-longitudinal-data.html#cb552-1" aria-hidden="true" tabindex="-1"></a><span class="fu">intervals</span>(fitLME_intercept)</span></code></pre></div>
<pre><code>## Approximate 95% confidence intervals
## 
##  Fixed effects:
##                  lower       est.      upper
## (Intercept) 13.6026236 15.3856902 17.1687569
## age          0.5375855  0.6601852  0.7827849
## sexM         0.7528554  2.3210227  3.8891901
## 
##  Random Effects:
##   Level: subject 
##                   lower     est.    upper
## sd((Intercept)) 1.31035 1.807425 2.493061
## 
##  Within-group standard error:
##    lower     est.    upper 
## 1.226105 1.431592 1.671517</code></pre>
<p>From this output, we can make inferences. For example, we see that the an increase of one year in age corresponds to an estimated increase in the distance of 0.6602 (95% CI: 0.5376, 0.7823), controlling for sex.</p>
<p>We can also gain insights on the variability in the data. For example, we have an estimated standard error of the random intercept of 1.807 and an estimated within-group standard error of 1.4312. this tells us that we have stronger between subject variability in this model.</p>
<p>We can also use this model to make predictions. For example, we can predict the distance of a 13 year old male. We first create a data set for this hypothetical individual, assigning it an id of 100, and then predict:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="introduction-to-longitudinal-data.html#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create the new subject</span></span>
<span id="cb554-2"><a href="introduction-to-longitudinal-data.html#cb554-2" aria-hidden="true" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">subject =</span> <span class="dv">100</span>, <span class="at">sex =</span> <span class="dv">1</span>, <span class="at">age =</span> <span class="dv">13</span>)</span>
<span id="cb554-3"><a href="introduction-to-longitudinal-data.html#cb554-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb554-4"><a href="introduction-to-longitudinal-data.html#cb554-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predict (level = c(0) provides individual subject prediction)</span></span>
<span id="cb554-5"><a href="introduction-to-longitudinal-data.html#cb554-5" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fitLME_intercept, <span class="at">newdata =</span> newdat, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">0</span>))[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## Warning in model.frame.default(formula = asOneFormula(formula(reSt), fixed), :
## variable &#39;sex&#39; is not a factor</code></pre>
<pre><code>## [1] 26.28912</code></pre>
<p>We estimate the distance for a 13 year old male to be 26.2891.</p>
</div>
<div id="long-linearmixed-ht" class="section level3 hasAnchor" number="6.4.8">
<h3><span class="header-section-number">6.4.8</span> Hypothesis Testing for Fixed Effects<a href="introduction-to-longitudinal-data.html#long-linearmixed-ht" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We may be interested in performing hypothesis tests on the fixed effects’ parameters (<span class="math inline">\(\bm{\beta}\)</span>) of the linear mixed-effects model. For tests on single parameters, we can employ the <code>summary()</code> function to perform a t-test.</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="introduction-to-longitudinal-data.html#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitLME_intercept)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: dental_long 
##        AIC      BIC    logLik
##   447.5125 460.7823 -218.7563
## 
## Random effects:
##  Formula: ~1 | subject
##         (Intercept) Residual
## StdDev:    1.807425 1.431592
## 
## Fixed effects:  distance ~ age + sex 
##                 Value Std.Error DF   t-value p-value
## (Intercept) 15.385690 0.8959848 80 17.171820  0.0000
## age          0.660185 0.0616059 80 10.716263  0.0000
## sexM         2.321023 0.7614168 25  3.048294  0.0054
##  Correlation: 
##      (Intr) age   
## age  -0.756       
## sexM -0.504  0.000
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -3.74889609 -0.55034466 -0.02516628  0.45341781  3.65746539 
## 
## Number of Observations: 108
## Number of Groups: 27</code></pre>
<p>The output provides us with the test statistic (<span class="math inline">\(t\)</span>-value) and associated <span class="math inline">\(p\)</span>-value for the test of <span class="math inline">\(H_0: \beta_j = 0\)</span> for each coefficient. For example, for the test of if age is significantly associated with distance in our dental data set, we may be interested in the test <span class="math inline">\(H_0: \beta_1 = 0\)</span>. From the output, we see the test statistic is 10.716 and the <span class="math inline">\(p\)</span>-value is 0.0000, meaning we reject the null hypothesis and conclude that age is associated with distance, while controlling for sex.</p>
<p>We can perform more general hypothesis tests of the for <span class="math inline">\(H_0: \bm{C}\bm{\beta} = 0\)</span> vs <span class="math inline">\(H_a: \bm{C}\bm{\beta} \ne 0\)</span> using the following function:</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="introduction-to-longitudinal-data.html#cb559-1" aria-hidden="true" tabindex="-1"></a>waldTestFunction <span class="ot">&lt;-</span> <span class="cf">function</span>(C, lme){</span>
<span id="cb559-2"><a href="introduction-to-longitudinal-data.html#cb559-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># outputs results of Wald test on fixed effects for H_0: C*beta = 0 </span></span>
<span id="cb559-3"><a href="introduction-to-longitudinal-data.html#cb559-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb559-4"><a href="introduction-to-longitudinal-data.html#cb559-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># C: matrix for the hypothesis test H_0: C*Beta = 0</span></span>
<span id="cb559-5"><a href="introduction-to-longitudinal-data.html#cb559-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lme: lme object (fitted model)</span></span>
<span id="cb559-6"><a href="introduction-to-longitudinal-data.html#cb559-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb559-7"><a href="introduction-to-longitudinal-data.html#cb559-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.vector</span>(C)){</span>
<span id="cb559-8"><a href="introduction-to-longitudinal-data.html#cb559-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(<span class="at">C =</span> <span class="fu">matrix</span>(C, <span class="at">nrow =</span> <span class="dv">1</span>))</span>
<span id="cb559-9"><a href="introduction-to-longitudinal-data.html#cb559-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb559-10"><a href="introduction-to-longitudinal-data.html#cb559-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb559-11"><a href="introduction-to-longitudinal-data.html#cb559-11" aria-hidden="true" tabindex="-1"></a>  wald_stat <span class="ot">=</span> (<span class="fu">t</span>(<span class="fu">as.matrix</span>(lme<span class="sc">$</span>coefficients<span class="sc">$</span>fixed)) <span class="sc">%*%</span> <span class="fu">t</span>(C)) <span class="sc">%*%</span> </span>
<span id="cb559-12"><a href="introduction-to-longitudinal-data.html#cb559-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">solve</span>(C <span class="sc">%*%</span> <span class="fu">as.matrix</span>(lme<span class="sc">$</span>varFix) <span class="sc">%*%</span> <span class="fu">t</span>(C)) <span class="sc">%*%</span> </span>
<span id="cb559-13"><a href="introduction-to-longitudinal-data.html#cb559-13" aria-hidden="true" tabindex="-1"></a>    (C <span class="sc">%*%</span> <span class="fu">as.matrix</span>(lme<span class="sc">$</span>coefficients<span class="sc">$</span>fixed))</span>
<span id="cb559-14"><a href="introduction-to-longitudinal-data.html#cb559-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb559-15"><a href="introduction-to-longitudinal-data.html#cb559-15" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">=</span> <span class="fu">min</span>(<span class="fu">dim</span>(C)[<span class="dv">1</span>], <span class="fu">dim</span>(C)[<span class="dv">2</span>])</span>
<span id="cb559-16"><a href="introduction-to-longitudinal-data.html#cb559-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb559-17"><a href="introduction-to-longitudinal-data.html#cb559-17" aria-hidden="true" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(wald_stat, df)</span>
<span id="cb559-18"><a href="introduction-to-longitudinal-data.html#cb559-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb559-19"><a href="introduction-to-longitudinal-data.html#cb559-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p_value <span class="sc">&gt;=</span> <span class="fl">0.001</span>){</span>
<span id="cb559-20"><a href="introduction-to-longitudinal-data.html#cb559-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>, <span class="st">&#39;Wald test chi-squared statistic is&#39;</span>, <span class="fu">round</span>(wald_stat, <span class="dv">4</span>), <span class="st">&#39;with&#39;</span>, df, <span class="st">&#39;df, p-value =&#39;</span>, <span class="fu">round</span>(p_value, <span class="dv">4</span>), <span class="st">&#39;.&#39;</span>, <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb559-21"><a href="introduction-to-longitudinal-data.html#cb559-21" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb559-22"><a href="introduction-to-longitudinal-data.html#cb559-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>, <span class="st">&#39;Wald test chi-squared statistic is&#39;</span>, <span class="fu">round</span>(wald_stat, <span class="dv">4</span>), <span class="st">&#39;with&#39;</span>, df, <span class="st">&#39;df, p-value &lt;0.001.&#39;</span>, <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb559-23"><a href="introduction-to-longitudinal-data.html#cb559-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb559-24"><a href="introduction-to-longitudinal-data.html#cb559-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Hypotheses such as testing if the effect is the same over more than two treatments (for example, <span class="math inline">\(H_0: \beta_1 = \beta_2 = \beta_3 = 0\)</span> in a hypothetical model) can be tested using this function.</p>
</div>
<div id="long-lme-modelfitting" class="section level3 hasAnchor" number="6.4.9">
<h3><span class="header-section-number">6.4.9</span> Model Fitting Procedure<a href="introduction-to-longitudinal-data.html#long-lme-modelfitting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We summarize the model fitting procedure in the following steps:</p>
<ol style="list-style-type: decimal">
<li><p>read in and clean the data, and then</p></li>
<li><p>check assumptions (see Section <a href="introduction-to-longitudinal-data.html#long-linear-assumptions">6.3.1</a>). We note that we do not require observation times to be the same for individuals in this model, as this model can account for unbalanced data.</p></li>
</ol>
<p>If the normality assumption is satisfied, we may start with the model fitting procedure. We then</p>
<ol start="3" style="list-style-type: decimal">
<li><p>focus on the time trend of response, ignoring any covariates other than those highly important such as treatment classifications. Assess whether we should have continuous or discrete time variables, higher-order terms, interactions), then</p></li>
<li><p>determine the appropriate random effects structures (do we need random intercepts, slopes?), then</p></li>
<li><p>perform variable selection on time-dependent and time-invariant covariates (including looking at interactions, non-linear terms), and finally</p></li>
<li><p>assess model diagnostics, and iterate through above steps (if needed) until a final model is selected for the research question of interest.</p></li>
</ol>
<p>Once an adequate model is found, we can interpret the model and answer the research question(s).</p>
<p>We note that the model building process can be done with the consultation of expert opinions, if available, to include “a priori” variables in the model that should be included regardless of statistical significance.</p>
</div>
<div id="long-lme-ex2" class="section level3 hasAnchor" number="6.4.10">
<h3><span class="header-section-number">6.4.10</span> Example - Milk Protein and Diet<a href="introduction-to-longitudinal-data.html#long-lme-ex2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We follow the model fitting procedure presented in <a href="introduction-to-longitudinal-data.html#long-lme-modelfitting">6.4.9</a> to answer a different research question on a new data set. We will be using the <code>Milk</code> data set from the <a href="https://CRAN.R-project.org/package=nlme"><strong>nlme</strong></a> package. In this data set, 79 cows on different diets had measurements taken of the protein content of their milk on a weekly basis. In this data set, some measurements were missed causing an unbalanced data set. We will examine whether there was a difference in milk protein content between diets, and whether or not protein content varied over time.</p>
<p><strong>Step 1: Data Read in and Cleaning</strong></p>
<p>We first read in our data set using the following R commands:</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="introduction-to-longitudinal-data.html#cb560-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Milk)</span>
<span id="cb560-2"><a href="introduction-to-longitudinal-data.html#cb560-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Milk)</span></code></pre></div>
<pre><code>## Grouped Data: protein ~ Time | Cow
##   protein Time Cow   Diet
## 1    3.63    1 B01 barley
## 2    3.57    2 B01 barley
## 3    3.47    3 B01 barley
## 4    3.65    4 B01 barley
## 5    3.89    5 B01 barley
## 6    3.73    6 B01 barley</code></pre>
<p>We see that our data is already in long form where we have one row per observation, and multiple rows for each subject, so we do not need to further process the data.</p>
<p><strong>Step 2: Assessing Normality</strong></p>
<p>We can begin to explore the data. We first need to assess the normality of the outcome of interest, <code>protein</code>. We can do this by looking at the distribution of the outcome by generating a histogram and also a Q-Q plot.</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="introduction-to-longitudinal-data.html#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set graphs to appear in one row and 2 columns (side by side)</span></span>
<span id="cb562-2"><a href="introduction-to-longitudinal-data.html#cb562-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) </span>
<span id="cb562-3"><a href="introduction-to-longitudinal-data.html#cb562-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb562-4"><a href="introduction-to-longitudinal-data.html#cb562-4" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of the outcome</span></span>
<span id="cb562-5"><a href="introduction-to-longitudinal-data.html#cb562-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Milk<span class="sc">$</span>protein, <span class="at">xlab =</span> <span class="st">&quot;Protein Content&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Histogram of Outcome&quot;</span>)</span>
<span id="cb562-6"><a href="introduction-to-longitudinal-data.html#cb562-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb562-7"><a href="introduction-to-longitudinal-data.html#cb562-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Q-Q plot and line</span></span>
<span id="cb562-8"><a href="introduction-to-longitudinal-data.html#cb562-8" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(Milk<span class="sc">$</span>protein) <span class="co"># plots quantiles against std normal distribution</span></span>
<span id="cb562-9"><a href="introduction-to-longitudinal-data.html#cb562-9" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(Milk<span class="sc">$</span>protein)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex2-normality"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex2-normality-1.png" alt="Plots used to assess normality." width="672" />
<p class="caption">
Figure 6.14: Plots used to assess normality.
</p>
</div>
<p>From these plots in Figure <a href="introduction-to-longitudinal-data.html#fig:long-lme-ex2-normality">6.14</a>, it appears that we have satisfied the normality assumption.</p>
<p><strong>Step 3: Assessing Time Trend</strong></p>
<p>The next step in our analysis is to assess the time trend. We first visualize the individual cow’s protein content over time using a spaghetti plot.</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="introduction-to-longitudinal-data.html#cb563-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Milk, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> protein, <span class="at">group =</span> Cow)) <span class="sc">+</span></span>
<span id="cb563-2"><a href="introduction-to-longitudinal-data.html#cb563-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb563-3"><a href="introduction-to-longitudinal-data.html#cb563-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> Diet) <span class="sc">+</span></span>
<span id="cb563-4"><a href="introduction-to-longitudinal-data.html#cb563-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Spaghetti Plot for Cow Protein Content (Stratified by Diet)&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex2-spaghetti"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex2-spaghetti-1.png" alt="Spaghetti plot of individual cows, stratifiet by diet group." width="672" />
<p class="caption">
Figure 6.15: Spaghetti plot of individual cows, stratifiet by diet group.
</p>
</div>
<p>Due to the large number of subjects in the data set, it is quite difficult to look at the time trends and see patterns within each group from the individual. We note that for data with irregular observation timings, it is not appropriate to look at the mean protein level at each observation (as we did in previous examples with balanced longitudinal data). As such, we can use a technique to visualize the time trend by looking at a smoothed estimate of the average time trend within each diet group using <a href="https://en.wikipedia.org/wiki/Local_regression">LOESS</a>.</p>
<p>To do so, we can plot the following:</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="introduction-to-longitudinal-data.html#cb564-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Milk, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> protein)) <span class="sc">+</span> </span>
<span id="cb564-2"><a href="introduction-to-longitudinal-data.html#cb564-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span> <span class="co"># plots smoothed estimate</span></span>
<span id="cb564-3"><a href="introduction-to-longitudinal-data.html#cb564-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> Diet) <span class="sc">+</span> <span class="co"># groups by diet group</span></span>
<span id="cb564-4"><a href="introduction-to-longitudinal-data.html#cb564-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;LOESS Curves of Protein Content by Diet Group&quot;</span>) <span class="co"># adds title</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex2-loess"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex2-loess-1.png" alt="LOESS curves used to assess time trend by group." width="672" />
<p class="caption">
Figure 6.16: LOESS curves used to assess time trend by group.
</p>
</div>
<p>On average, we see non-linear time trends and different trends by group, particularly for the lupins only diet group. We thus want to consider including higher order time variables to account for the non-linear trend, and also consider interactions to allow for the time trend to differ by diet group. With a large number of observations per subject, we treat <code>Time</code> (in weeks) as a continuous time variable.</p>
<p>When assessing the form of the time trend, we include integral variables like the treatment assignment (in our case, diet) and assume an unstructured correlation structure in our model. From the spaghetti plot in Figure <a href="introduction-to-longitudinal-data.html#fig:long-lme-ex2-spaghetti">6.15</a>, we see cows have varying baseline measurements (intercepts) and time trends (slopes) and thus we should consider starting with a random intercept and slope model. As such, we start with the following model:</p>
<p><span class="math display">\[
\mu_{ij} = \beta_0 +  \beta_1D1_{i} + \beta_2D2_i + \beta_3t_{ij} + b_{0,i}  + b_{1, i}
\]</span>
where <span class="math inline">\(D1_i = 1\)</span> if cow <span class="math inline">\(i\)</span> is on diet 1 (barley only), <span class="math inline">\(D2_i = 1\)</span> if cow <span class="math inline">\(i\)</span> is on diet 2 (barley + lupins), <span class="math inline">\(t_{ij}\)</span> is the time since calving (in weeks), <span class="math inline">\(b_{0,i}\)</span> is the random intercept that allows cows to have varying baseline protein content measurements, and <span class="math inline">\(b_{1,i}\)</span> is the random slope that allows the time trend to vary by cow. Note we are comparing diets to the lupins only diet (reference diet).</p>
<p>We fit this model with an unstructured correlation structure to begin using the <code>ML</code> method (as we are interested in fixed effects right now), using the following code:</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="introduction-to-longitudinal-data.html#cb565-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first make variables for diet groups</span></span>
<span id="cb565-2"><a href="introduction-to-longitudinal-data.html#cb565-2" aria-hidden="true" tabindex="-1"></a>Milk<span class="sc">$</span>D1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Milk<span class="sc">$</span>Diet <span class="sc">==</span> <span class="st">&quot;barley&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb565-3"><a href="introduction-to-longitudinal-data.html#cb565-3" aria-hidden="true" tabindex="-1"></a>Milk<span class="sc">$</span>D2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Milk<span class="sc">$</span>Diet <span class="sc">==</span> <span class="st">&quot;barley+lupins&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb565-4"><a href="introduction-to-longitudinal-data.html#cb565-4" aria-hidden="true" tabindex="-1"></a>Milk<span class="sc">$</span>D3 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Milk<span class="sc">$</span>Diet <span class="sc">==</span> <span class="st">&quot;lupins&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb565-5"><a href="introduction-to-longitudinal-data.html#cb565-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-6"><a href="introduction-to-longitudinal-data.html#cb565-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-7"><a href="introduction-to-longitudinal-data.html#cb565-7" aria-hidden="true" tabindex="-1"></a>fitcows1 <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb565-8"><a href="introduction-to-longitudinal-data.html#cb565-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> protein <span class="sc">~</span> D1 <span class="sc">+</span> D2 <span class="sc">+</span> Time, <span class="co"># specify fixed effects</span></span>
<span id="cb565-9"><a href="introduction-to-longitudinal-data.html#cb565-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> Time<span class="sc">|</span> Cow, <span class="co"># random slope on time variable,</span></span>
<span id="cb565-10"><a href="introduction-to-longitudinal-data.html#cb565-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb565-11"><a href="introduction-to-longitudinal-data.html#cb565-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Milk,</span>
<span id="cb565-12"><a href="introduction-to-longitudinal-data.html#cb565-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb565-13"><a href="introduction-to-longitudinal-data.html#cb565-13" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb565-14"><a href="introduction-to-longitudinal-data.html#cb565-14" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span></code></pre></div>
<p>We wish to compare this model to one including higher-order time terms. We create a squared time term as a fixed effect and fit an additional model as:</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="introduction-to-longitudinal-data.html#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First create a squared time term</span></span>
<span id="cb566-2"><a href="introduction-to-longitudinal-data.html#cb566-2" aria-hidden="true" tabindex="-1"></a>Milk<span class="sc">$</span>Timesq <span class="ot">&lt;-</span> (Milk<span class="sc">$</span>Time)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb566-3"><a href="introduction-to-longitudinal-data.html#cb566-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb566-4"><a href="introduction-to-longitudinal-data.html#cb566-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model including new time^2 variable as a fixed effect</span></span>
<span id="cb566-5"><a href="introduction-to-longitudinal-data.html#cb566-5" aria-hidden="true" tabindex="-1"></a>fitcows2 <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb566-6"><a href="introduction-to-longitudinal-data.html#cb566-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> protein <span class="sc">~</span> D1 <span class="sc">+</span> D2 <span class="sc">+</span> Time <span class="sc">+</span> Timesq, <span class="co"># specify fixed effects</span></span>
<span id="cb566-7"><a href="introduction-to-longitudinal-data.html#cb566-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> Time<span class="sc">|</span> Cow, <span class="co"># random slope on time variable,</span></span>
<span id="cb566-8"><a href="introduction-to-longitudinal-data.html#cb566-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb566-9"><a href="introduction-to-longitudinal-data.html#cb566-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Milk,</span>
<span id="cb566-10"><a href="introduction-to-longitudinal-data.html#cb566-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb566-11"><a href="introduction-to-longitudinal-data.html#cb566-11" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb566-12"><a href="introduction-to-longitudinal-data.html#cb566-12" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span></code></pre></div>
<p>We then can see which model fit is better using an LRT. The null hypothesis is that the simpler model (<code>fitcows1</code>) fits as well as the more complex model (<code>fitcows2</code>). We do this in R by:</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="introduction-to-longitudinal-data.html#cb567-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fitcows1, fitcows2)</span></code></pre></div>
<pre><code>##          Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fitcows1     1  8 358.1166 399.7021 -171.0583                        
## fitcows2     2  9 309.1581 355.9418 -145.5791 1 vs 2 50.95847  &lt;.0001</code></pre>
<p>We reject the null hypothesis and conclude that the more complex model provides a better fit due to the small <span class="math inline">\(p\)</span>-value. As such, we continue looking at our time trend from this model. We may want to consider cubic time terms. As such, we fit a model including <code>Time^3</code> as a covariate, and perform another LRT.</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="introduction-to-longitudinal-data.html#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First create a squared time term</span></span>
<span id="cb569-2"><a href="introduction-to-longitudinal-data.html#cb569-2" aria-hidden="true" tabindex="-1"></a>Milk<span class="sc">$</span>Timecb <span class="ot">&lt;-</span> (Milk<span class="sc">$</span>Time)<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb569-3"><a href="introduction-to-longitudinal-data.html#cb569-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-4"><a href="introduction-to-longitudinal-data.html#cb569-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model including new time^2 variable as a fixed effect</span></span>
<span id="cb569-5"><a href="introduction-to-longitudinal-data.html#cb569-5" aria-hidden="true" tabindex="-1"></a>fitcows3 <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb569-6"><a href="introduction-to-longitudinal-data.html#cb569-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> protein <span class="sc">~</span> D1 <span class="sc">+</span> D2 <span class="sc">+</span> Time <span class="sc">+</span> Timesq <span class="sc">+</span> Timecb, <span class="co"># specify fixed effects</span></span>
<span id="cb569-7"><a href="introduction-to-longitudinal-data.html#cb569-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> Time<span class="sc">|</span> Cow, <span class="co"># random slope on time variable,</span></span>
<span id="cb569-8"><a href="introduction-to-longitudinal-data.html#cb569-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb569-9"><a href="introduction-to-longitudinal-data.html#cb569-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Milk,</span>
<span id="cb569-10"><a href="introduction-to-longitudinal-data.html#cb569-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb569-11"><a href="introduction-to-longitudinal-data.html#cb569-11" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb569-12"><a href="introduction-to-longitudinal-data.html#cb569-12" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb569-13"><a href="introduction-to-longitudinal-data.html#cb569-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-14"><a href="introduction-to-longitudinal-data.html#cb569-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform LRT of model including cubic time term vs not</span></span>
<span id="cb569-15"><a href="introduction-to-longitudinal-data.html#cb569-15" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fitcows2, fitcows3)</span></code></pre></div>
<pre><code>##          Model df      AIC      BIC     logLik   Test  L.Ratio p-value
## fitcows2     1  9 309.1581 355.9418 -145.57906                        
## fitcows3     2 10 192.8049 244.7868  -86.40246 1 vs 2 118.3532  &lt;.0001</code></pre>
<p>The small <span class="math inline">\(p\)</span>-value tells us that we should in fact include the cubic time term in our model. We continue model building from <code>fitcows3</code>.</p>
<p>The next step is to see if we need to include interaction terms for the diet groups. We first consider interactions on the linear time term. We create this variable in R and then fit the model and perform another LRT:</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="introduction-to-longitudinal-data.html#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the interaction of the diet and linear time term</span></span>
<span id="cb571-2"><a href="introduction-to-longitudinal-data.html#cb571-2" aria-hidden="true" tabindex="-1"></a>Milk<span class="sc">$</span>inter_D1Time <span class="ot">&lt;-</span> Milk<span class="sc">$</span>Time<span class="sc">*</span>Milk<span class="sc">$</span>D1</span>
<span id="cb571-3"><a href="introduction-to-longitudinal-data.html#cb571-3" aria-hidden="true" tabindex="-1"></a>Milk<span class="sc">$</span>inter_D2Time <span class="ot">&lt;-</span> Milk<span class="sc">$</span>Time<span class="sc">*</span>Milk<span class="sc">$</span>D2</span>
<span id="cb571-4"><a href="introduction-to-longitudinal-data.html#cb571-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb571-5"><a href="introduction-to-longitudinal-data.html#cb571-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model including this interaction</span></span>
<span id="cb571-6"><a href="introduction-to-longitudinal-data.html#cb571-6" aria-hidden="true" tabindex="-1"></a>fitcows4 <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb571-7"><a href="introduction-to-longitudinal-data.html#cb571-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> protein <span class="sc">~</span> D1 <span class="sc">+</span> D2 <span class="sc">+</span> Time <span class="sc">+</span> Timesq <span class="sc">+</span> Timecb <span class="sc">+</span></span>
<span id="cb571-8"><a href="introduction-to-longitudinal-data.html#cb571-8" aria-hidden="true" tabindex="-1"></a>    inter_D1Time <span class="sc">+</span> inter_D2Time, <span class="co"># specify fixed effects</span></span>
<span id="cb571-9"><a href="introduction-to-longitudinal-data.html#cb571-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> Time<span class="sc">|</span> Cow, <span class="co"># random slope on time variable,</span></span>
<span id="cb571-10"><a href="introduction-to-longitudinal-data.html#cb571-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb571-11"><a href="introduction-to-longitudinal-data.html#cb571-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Milk,</span>
<span id="cb571-12"><a href="introduction-to-longitudinal-data.html#cb571-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb571-13"><a href="introduction-to-longitudinal-data.html#cb571-13" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb571-14"><a href="introduction-to-longitudinal-data.html#cb571-14" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb571-15"><a href="introduction-to-longitudinal-data.html#cb571-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb571-16"><a href="introduction-to-longitudinal-data.html#cb571-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform LRT of model including linear interaction vs not</span></span>
<span id="cb571-17"><a href="introduction-to-longitudinal-data.html#cb571-17" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fitcows3, fitcows4)</span></code></pre></div>
<pre><code>##          Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fitcows3     1 10 192.8049 244.7868 -86.40246                        
## fitcows4     2 12 195.2882 257.6664 -85.64411 1 vs 2 1.516694  0.4684</code></pre>
<p>We fail to reject the null hypothesis with this large <span class="math inline">\(p\)</span>-value, and conclude that we can use the model without linear interactions. We continue with <code>fitcows3</code> for our analysis.</p>
<p><strong>Step 4: Consider Appropriate Random Effects Structure</strong></p>
<p>Now that the time trend has been assessed, we can focus on choosing the random effects. In the previous model, we assumed that we had a random intercept and a random slope on the linear time covariate. We can first investigate whether or not the random slope was needed by comparing the model to one that does not include a random slope for time.</p>
<p>We first need to fit/refit these models in R using the <code>REML</code> method (default) as we are interested in inference on the random effects structure and then perform an LRT (with caution that we cannot use the given <span class="math inline">\(p\)</span>-value). The degrees of freedom is 1 because the models differ by one random effect.</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="introduction-to-longitudinal-data.html#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="co"># refit model using REML</span></span>
<span id="cb573-2"><a href="introduction-to-longitudinal-data.html#cb573-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-3"><a href="introduction-to-longitudinal-data.html#cb573-3" aria-hidden="true" tabindex="-1"></a>fitcows3_REML <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb573-4"><a href="introduction-to-longitudinal-data.html#cb573-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> protein <span class="sc">~</span> D1 <span class="sc">+</span> D2 <span class="sc">+</span> Time <span class="sc">+</span> Timesq <span class="sc">+</span> Timecb, <span class="co"># specify fixed effects</span></span>
<span id="cb573-5"><a href="introduction-to-longitudinal-data.html#cb573-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> Time<span class="sc">|</span> Cow, <span class="co"># random slope on time variable,</span></span>
<span id="cb573-6"><a href="introduction-to-longitudinal-data.html#cb573-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb573-7"><a href="introduction-to-longitudinal-data.html#cb573-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Milk,</span>
<span id="cb573-8"><a href="introduction-to-longitudinal-data.html#cb573-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;REML&quot;</span></span>
<span id="cb573-9"><a href="introduction-to-longitudinal-data.html#cb573-9" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb573-10"><a href="introduction-to-longitudinal-data.html#cb573-10" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb573-11"><a href="introduction-to-longitudinal-data.html#cb573-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-12"><a href="introduction-to-longitudinal-data.html#cb573-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-13"><a href="introduction-to-longitudinal-data.html#cb573-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-14"><a href="introduction-to-longitudinal-data.html#cb573-14" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model without random slope on time</span></span>
<span id="cb573-15"><a href="introduction-to-longitudinal-data.html#cb573-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-16"><a href="introduction-to-longitudinal-data.html#cb573-16" aria-hidden="true" tabindex="-1"></a>fitcows5_REML <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb573-17"><a href="introduction-to-longitudinal-data.html#cb573-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> protein <span class="sc">~</span> D1 <span class="sc">+</span> D2 <span class="sc">+</span> Time <span class="sc">+</span> Timesq <span class="sc">+</span> Timecb, <span class="co"># specify fixed effects</span></span>
<span id="cb573-18"><a href="introduction-to-longitudinal-data.html#cb573-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> Cow, <span class="co"># random intercept only</span></span>
<span id="cb573-19"><a href="introduction-to-longitudinal-data.html#cb573-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb573-20"><a href="introduction-to-longitudinal-data.html#cb573-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Milk,</span>
<span id="cb573-21"><a href="introduction-to-longitudinal-data.html#cb573-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;REML&quot;</span></span>
<span id="cb573-22"><a href="introduction-to-longitudinal-data.html#cb573-22" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb573-23"><a href="introduction-to-longitudinal-data.html#cb573-23" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb573-24"><a href="introduction-to-longitudinal-data.html#cb573-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-25"><a href="introduction-to-longitudinal-data.html#cb573-25" aria-hidden="true" tabindex="-1"></a><span class="co"># perform LRT but ignore the p-value</span></span>
<span id="cb573-26"><a href="introduction-to-longitudinal-data.html#cb573-26" aria-hidden="true" tabindex="-1"></a>LRT_mix_cows35 <span class="ot">&lt;-</span> <span class="fu">anova</span>(fitcows3_REML, fitcows5_REML)</span>
<span id="cb573-27"><a href="introduction-to-longitudinal-data.html#cb573-27" aria-hidden="true" tabindex="-1"></a>teststat_mix_cows35 <span class="ot">&lt;-</span> LRT_mix_cows35<span class="sc">$</span>L.Ratio[<span class="dv">2</span>]</span>
<span id="cb573-28"><a href="introduction-to-longitudinal-data.html#cb573-28" aria-hidden="true" tabindex="-1"></a><span class="fu">pchibarsq</span>(teststat_mix_cows35, <span class="at">df =</span> <span class="dv">1</span>, <span class="at">mix =</span> <span class="fl">0.5</span>) <span class="co"># degree of freedom is 1</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>The <span class="math inline">\(p\)</span>-value is large, indicating that we do not have evidence to reject the null hypothesis that the simpler model is better. As such, we can continue analysis without the random effect on the linear time term (<code>fitcows5</code>). We can still check whether we should have a random effect on higher-order time trends by comparing the intercept only model (<code>fitcows5</code>) to a new model including random effects on <code>timesq</code> and <code>timecb</code>:</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="introduction-to-longitudinal-data.html#cb575-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model without random slope on timesq and timecb</span></span>
<span id="cb575-2"><a href="introduction-to-longitudinal-data.html#cb575-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb575-3"><a href="introduction-to-longitudinal-data.html#cb575-3" aria-hidden="true" tabindex="-1"></a>fitcows6_REML <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb575-4"><a href="introduction-to-longitudinal-data.html#cb575-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> protein <span class="sc">~</span> D1 <span class="sc">+</span> D2 <span class="sc">+</span> Time <span class="sc">+</span> Timesq <span class="sc">+</span> Timecb, <span class="co"># specify fixed effects</span></span>
<span id="cb575-5"><a href="introduction-to-longitudinal-data.html#cb575-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span>  Timesq <span class="sc">+</span> Timecb <span class="sc">|</span> Cow, <span class="co"># random int and slopes</span></span>
<span id="cb575-6"><a href="introduction-to-longitudinal-data.html#cb575-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb575-7"><a href="introduction-to-longitudinal-data.html#cb575-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Milk,</span>
<span id="cb575-8"><a href="introduction-to-longitudinal-data.html#cb575-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;REML&quot;</span></span>
<span id="cb575-9"><a href="introduction-to-longitudinal-data.html#cb575-9" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb575-10"><a href="introduction-to-longitudinal-data.html#cb575-10" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb575-11"><a href="introduction-to-longitudinal-data.html#cb575-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb575-12"><a href="introduction-to-longitudinal-data.html#cb575-12" aria-hidden="true" tabindex="-1"></a><span class="co"># perform LRT but ignore the p-value</span></span>
<span id="cb575-13"><a href="introduction-to-longitudinal-data.html#cb575-13" aria-hidden="true" tabindex="-1"></a>LRT_mix_cows56 <span class="ot">&lt;-</span> <span class="fu">anova</span>(fitcows5_REML, fitcows6_REML)</span>
<span id="cb575-14"><a href="introduction-to-longitudinal-data.html#cb575-14" aria-hidden="true" tabindex="-1"></a>teststat_mix_cows56 <span class="ot">&lt;-</span> LRT_mix_cows56<span class="sc">$</span>L.Ratio[<span class="dv">2</span>]</span>
<span id="cb575-15"><a href="introduction-to-longitudinal-data.html#cb575-15" aria-hidden="true" tabindex="-1"></a><span class="fu">pchibarsq</span>(teststat_mix_cows56, <span class="at">df =</span> <span class="dv">1</span>, <span class="at">mix =</span> <span class="fl">0.5</span>) <span class="co"># degree of freedom is 1</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>It is unsurprising that we also fail to reject this null hypothesis. We confirm that we should continue analysis with the random intercept only model (<code>fitcows5</code>).</p>
<p><strong>Step 5: Variable Selection</strong>
Using our current model, <code>fitcows5</code>, we consider other fixed effect variables at our disposal. If we had more variables to add into our model, we could add them and fit the model using the <code>ML</code> method and perform a LRT to see if the model fit is better with those variables included.</p>
<p>Although we do not have more variables to consider at our data set, we can still look at our current model and see if all variables we included at the beginning are necessary. We first must re-fit the model using the <code>ML</code> method as we are interested again with the fixed effects.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="introduction-to-longitudinal-data.html#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model without random slope on time</span></span>
<span id="cb577-2"><a href="introduction-to-longitudinal-data.html#cb577-2" aria-hidden="true" tabindex="-1"></a>fitcows5<span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb577-3"><a href="introduction-to-longitudinal-data.html#cb577-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> protein <span class="sc">~</span> D1 <span class="sc">+</span> D2 <span class="sc">+</span> Time <span class="sc">+</span> Timesq <span class="sc">+</span> Timecb, <span class="co"># specify fixed effects</span></span>
<span id="cb577-4"><a href="introduction-to-longitudinal-data.html#cb577-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> Cow, <span class="co"># random intercept only</span></span>
<span id="cb577-5"><a href="introduction-to-longitudinal-data.html#cb577-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb577-6"><a href="introduction-to-longitudinal-data.html#cb577-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> Milk,</span>
<span id="cb577-7"><a href="introduction-to-longitudinal-data.html#cb577-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb577-8"><a href="introduction-to-longitudinal-data.html#cb577-8" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb577-9"><a href="introduction-to-longitudinal-data.html#cb577-9" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb577-10"><a href="introduction-to-longitudinal-data.html#cb577-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-11"><a href="introduction-to-longitudinal-data.html#cb577-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitcows5)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##   Data: Milk 
##        AIC      BIC    logLik
##   327.5777 369.1632 -155.7889
## 
## Random effects:
##  Formula: ~1 | Cow
##         (Intercept)  Residual
## StdDev:   0.1651774 0.2556705
## 
## Fixed effects:  protein ~ D1 + D2 + Time + Timesq + Timecb 
##                 Value  Std.Error   DF   t-value p-value
## (Intercept)  3.766946 0.04714803 1255  79.89615  0.0000
## D1           0.204011 0.04915651   76   4.15023  0.0001
## D2           0.108376 0.04820020   76   2.24847  0.0274
## Time        -0.173380 0.01442092 1255 -12.02284  0.0000
## Timesq       0.016945 0.00169194 1255  10.01533  0.0000
## Timecb      -0.000480 0.00005705 1255  -8.41528  0.0000
##  Correlation: 
##        (Intr) D1     D2     Time   Timesq
## D1     -0.501                            
## D2     -0.511  0.491                     
## Time   -0.641 -0.001 -0.002              
## Timesq  0.572  0.001  0.002 -0.974       
## Timecb -0.518 -0.002 -0.002  0.926 -0.986
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -3.06241162 -0.65172129  0.05634077  0.65653761  3.65613145 
## 
## Number of Observations: 1337
## Number of Groups: 79</code></pre>
<p>This model can be written as:</p>
<p><span class="math display">\[
\mu_{ij} = \beta_0 +  \beta_1D1_{i} + \beta_2D2_i + \beta_3t_{ij} + \beta_4t_{ij}^2 + \beta_5t_{ij}^3 +  b_{0,i}
\]</span></p>
<p>Looking at the summary of this model, it appears that most covariates are statistically significant. We can still do a test to see if the treatment variables are necessary in the model. To do so, we perform a hypothesis test of <span class="math inline">\(H_0: \beta_1 = \beta_2 = 0\)</span>. To do so, we employ the <code>waldTestFunction</code> presented in <a href="introduction-to-longitudinal-data.html#long-linearmixed-ht">6.4.8</a>. To perform this test, we need to create a matrix <span class="math inline">\(\bm{C}\)</span> that will indicate the hypothesis test we wish to perform. <span class="math inline">\(\bm{C}\)</span> will have one column for each coefficient for fixed effects (including <span class="math inline">\(\beta_0\)</span>), and one row for each coefficient in our hypothesis test. In this case, we let</p>
<p><span class="math display">\[
\bm{C} = \begin{bmatrix}
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0  \\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
\end{bmatrix}
\]</span>
and perform the hypothesis test in R by:</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="introduction-to-longitudinal-data.html#cb579-1" aria-hidden="true" tabindex="-1"></a>Cmat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb579-2"><a href="introduction-to-longitudinal-data.html#cb579-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb579-3"><a href="introduction-to-longitudinal-data.html#cb579-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb579-4"><a href="introduction-to-longitudinal-data.html#cb579-4" aria-hidden="true" tabindex="-1"></a><span class="fu">waldTestFunction</span>(Cmat, fitcows5)</span></code></pre></div>
<pre><code>## 
##  Wald test chi-squared statistic is 17.3612 with 2 df, p-value &lt;0.001.</code></pre>
<p>We reject the null hypothesis and conclude that at least one of <span class="math inline">\(\beta_1\)</span> or <span class="math inline">\(\beta_2\)</span> is not zero.</p>
<p>Although we had already assessed the form of the time trend, we should double check that the form is still appropriate as our random effects structure has changed (we assessed the time trend assuming a random slope on time, which we since removed). For the hypothesis test seeing if we need the cubic time term, we can look at the model summary. The <span class="math inline">\(p\)</span>-value for <span class="math inline">\(\beta_5 = 0\)</span> is 0.0000, indicating that we do need the cubic time trend. All individual time trend terms are significant, but we can still perform a hypothesis test confirming that we need all three terms, as <span class="math inline">\(H_0: \beta_3 = \beta_4 = \beta_5 = 0\)</span>. To do so, we perform the following:</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="introduction-to-longitudinal-data.html#cb581-1" aria-hidden="true" tabindex="-1"></a>Cmat2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb581-2"><a href="introduction-to-longitudinal-data.html#cb581-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb581-3"><a href="introduction-to-longitudinal-data.html#cb581-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb581-4"><a href="introduction-to-longitudinal-data.html#cb581-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb581-5"><a href="introduction-to-longitudinal-data.html#cb581-5" aria-hidden="true" tabindex="-1"></a><span class="fu">waldTestFunction</span>(Cmat2, fitcows5)</span></code></pre></div>
<pre><code>## 
##  Wald test chi-squared statistic is 200.4164 with 3 df, p-value &lt;0.001.</code></pre>
<p>We reject the null hypothesis and conclude at least one of the terms is non-zero, and thus keep all three terms in the model.</p>
<p>Note: for individual covariates, we could look at the <span class="math inline">\(p\)</span>-value given in the model summary for the hypothesis test of <span class="math inline">\(H_0: \beta_j = 0\)</span> or do an LRT for nested models.</p>
<p><strong>Step 6: Model Diagnostics</strong></p>
<p>Now that we have fit a model, we need to perform model diagnostics to assess the fit. If the fit appears to be inadequate, we can iterate through the above procedure again until the fit is adequate. More details on diagnostics can be found in Section <a href="introduction-to-longitudinal-data.html#long-linearmixed-diagnostics">6.4.6</a>.</p>
<p>First we assess if there is evidence of serial correlation among the random error term in our model. We can do this by plotting a variogram:</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="introduction-to-longitudinal-data.html#cb583-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Variogram</span>(fitcows5, <span class="at">form =</span> <span class="sc">~</span> Time <span class="sc">|</span> Cow, <span class="at">collapse =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb583-2"><a href="introduction-to-longitudinal-data.html#cb583-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">restype =</span> <span class="st">&quot;pearson&quot;</span>, <span class="at">smooth =</span> <span class="cn">TRUE</span>), <span class="at">xlab =</span> <span class="st">&quot;Weeks&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Variogram Plot&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex2-variogram"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex2-variogram-1.png" alt="Plots used to assess serial correlation." width="672" />
<p class="caption">
Figure 6.17: Plots used to assess serial correlation.
</p>
</div>
<p>We do not see a systematic trend in the trend line included in the Variogram plot in <a href="introduction-to-longitudinal-data.html#fig:long-lme-ex2-variogram">6.17</a>. As such, we do not have evidence of serial correlation.</p>
<p>Next, we check the common variance assumption with</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="introduction-to-longitudinal-data.html#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">residuals</span>(fitcows5, <span class="at">type =</span> <span class="st">&quot;normalized&quot;</span>), <span class="at">main =</span> <span class="st">&quot;Plot of Residuals for Random Intercept Model&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex2-commonvar"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex2-commonvar-1.png" alt="Plot for assessing common variance assumption." width="672" />
<p class="caption">
Figure 6.18: Plot for assessing common variance assumption.
</p>
</div>
<p>The residuals appear to be randomly spread out about 0 with most observations within 2 standard deviations, with the exception of a few outliers.</p>
<p>We next check the normality of errors assumption. We do this by creating a Q-Q plot of the residuals:</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="introduction-to-longitudinal-data.html#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(fitcows5, </span>
<span id="cb585-2"><a href="introduction-to-longitudinal-data.html#cb585-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Q-Q Plot of Residuals&quot;</span>, <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex2-normerrors"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex2-normerrors-1.png" alt="Plor for assessing normality of random error term." width="672" />
<p class="caption">
Figure 6.19: Plor for assessing normality of random error term.
</p>
</div>
<p>From the plot in Figure <a href="introduction-to-longitudinal-data.html#fig:long-lme-ex2-normerrors">6.19</a>, we appear to satisfy the normality of errors assumption.</p>
<p>Next, we look at the normality of the random intercept:</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="introduction-to-longitudinal-data.html#cb586-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(fitcows5, <span class="sc">~</span><span class="fu">ranef</span>(.), <span class="at">id =</span> <span class="fl">0.05</span>, <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="co"># abline adjusted due to scale</span></span>
<span id="cb586-2"><a href="introduction-to-longitudinal-data.html#cb586-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Q-Q plot of Predicted Random Intercepts&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex2-normint"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex2-normint-1.png" alt="Plot for assessing normality of random intercept term." width="672" />
<p class="caption">
Figure 6.20: Plot for assessing normality of random intercept term.
</p>
</div>
<p>In Figure <a href="introduction-to-longitudinal-data.html#fig:long-lme-ex2-normint">6.20</a>, the Q-Q plot indicates that we do not have exactly normally distributed random intercepts. However, we often see in practice that the predicted random effects do not perfectly satisfy the normality assumption. In this setting, we consider this to be adequate for our assumption.</p>
<p>We next assess linearity, which we can do my looking at the observed versus fitted values over the entire study population:</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="introduction-to-longitudinal-data.html#cb587-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fitcows5, protein <span class="sc">~</span> <span class="fu">fitted</span>(.), <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb587-2"><a href="introduction-to-longitudinal-data.html#cb587-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Observed vs. Fitted Values&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex2-normpop"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex2-normpop-1.png" alt="Plot to assess linearity in the population." width="672" />
<p class="caption">
Figure 6.21: Plot to assess linearity in the population.
</p>
</div>
<p>As in <a href="introduction-to-longitudinal-data.html#fig:long-lme-ex2-normpop">6.21</a>, we appear to have satisfied the linearity assumption. We can also check for linearity within the diet groups:</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="introduction-to-longitudinal-data.html#cb588-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fitcows5, protein <span class="sc">~</span> <span class="fu">fitted</span>(.)<span class="sc">|</span>Diet, <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb588-2"><a href="introduction-to-longitudinal-data.html#cb588-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Observed vs. Fitted Values&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex2-normdiet"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex2-normdiet-1.png" alt="Plot to assess linearity in each diet group." width="672" />
<p class="caption">
Figure 6.22: Plot to assess linearity in each diet group.
</p>
</div>
<p>Linearity appears to be satisfied again.</p>
<p><strong>Answering the Research Questions</strong></p>
<p>We have satisfied all of the model assumptions based on our diagnostics, and can move onto interpreting the model and answering the research question of interest. Let’s look again at the model summary:</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="introduction-to-longitudinal-data.html#cb589-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitcows5)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##   Data: Milk 
##        AIC      BIC    logLik
##   327.5777 369.1632 -155.7889
## 
## Random effects:
##  Formula: ~1 | Cow
##         (Intercept)  Residual
## StdDev:   0.1651774 0.2556705
## 
## Fixed effects:  protein ~ D1 + D2 + Time + Timesq + Timecb 
##                 Value  Std.Error   DF   t-value p-value
## (Intercept)  3.766946 0.04714803 1255  79.89615  0.0000
## D1           0.204011 0.04915651   76   4.15023  0.0001
## D2           0.108376 0.04820020   76   2.24847  0.0274
## Time        -0.173380 0.01442092 1255 -12.02284  0.0000
## Timesq       0.016945 0.00169194 1255  10.01533  0.0000
## Timecb      -0.000480 0.00005705 1255  -8.41528  0.0000
##  Correlation: 
##        (Intr) D1     D2     Time   Timesq
## D1     -0.501                            
## D2     -0.511  0.491                     
## Time   -0.641 -0.001 -0.002              
## Timesq  0.572  0.001  0.002 -0.974       
## Timecb -0.518 -0.002 -0.002  0.926 -0.986
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -3.06241162 -0.65172129  0.05634077  0.65653761  3.65613145 
## 
## Number of Observations: 1337
## Number of Groups: 79</code></pre>
<p>We conclude that protein content does vary over time, in a non-linear fashion. We also can conclude that protein content varied by the type of diet that the cow was given. A barley-only diet was associated with a 0.204 unit increase in protein content compared to a lupins-only diet (controlling for time) (<span class="math inline">\(p\)</span> = 0.0001). A barley and lupins diet was associated with a 0.108 unit increase in protein consumption compared to a lupins-only diet (controlling for time) (<span class="math inline">\(p\)</span> = 0.0274).</p>
<p>We could further test if there is a difference between the barley-only and barely and lupins diets by testing the hypothesis that <span class="math inline">\(\beta_1 = \beta_2\)</span>. We can do this in R by the following:</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="introduction-to-longitudinal-data.html#cb591-1" aria-hidden="true" tabindex="-1"></a>Cmat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb591-2"><a href="introduction-to-longitudinal-data.html#cb591-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb591-3"><a href="introduction-to-longitudinal-data.html#cb591-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb591-4"><a href="introduction-to-longitudinal-data.html#cb591-4" aria-hidden="true" tabindex="-1"></a><span class="fu">waldTestFunction</span>(Cmat, fitcows5)</span></code></pre></div>
<pre><code>## 
##  Wald test chi-squared statistic is 17.3612 with 2 df, p-value &lt;0.001.</code></pre>
<p>We reject the null hypothesis and conclude that the barley-only and the barley and lupins diets are significantly different from each other. That is, we conclude that all three diets are significantly different from each other, where the barley-only diet is associated with the highest protein content followed by the barely and lupins diet.</p>
</div>
<div id="example---aids-clinical-trial-group" class="section level3 hasAnchor" number="6.4.11">
<h3><span class="header-section-number">6.4.11</span> Example - AIDS Clinical Trial Group<a href="introduction-to-longitudinal-data.html#example---aids-clinical-trial-group" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We follow the model fitting procedure presented in <a href="introduction-to-longitudinal-data.html#long-lme-modelfitting">6.4.9</a> to answer a different research question on a new data set. We will be using data from the AIDS Clinical Trial Group (ACTG), which can be downloaded <a href="https://content.sph.harvard.edu/fitzmaur/ala2e/cd4.txt">here</a>. In this data set, 1309 AIDS patients with advanced immune suppression were randomized to one of four daily treatment regimens. Three of the regimens (Treatments 1-3) involve a dual combination of HIV-1 transcriptase inhibitors, and the fourth involves a triple combination of HIV-1 transcriptase inhibitors.</p>
<p>Measures of CD4 counts were scheduled to be taken at every 8 week interval during follow-up, however the data set is considered unbalanced due to mistimed measurements, skipped visits, and drop-out. Lower CD4 counts represent lower immune function.</p>
<p>Researchers are interested in seeing if the change in log-transformed CD4 counts (log(CD4 counts + 1)) from baseline varied between treatment groups, with increased interest in the effect of the dual vs triple combination treatments. Such transformation on the CD4 counts was proposed by experts in the field and exists as a variable in the data set. We assume any missingness and drop-out is at <a href="https://en.wikipedia.org/wiki/Missing_data#Missing_completely_at_random">completely at random</a> and does not need to be accounted for in the analysis, although this may not be true in practice.</p>
<p><strong>Step 1: Data Read in and Cleaning</strong></p>
<p>We first read in the data, which is located in the “data” folder, and name the columns. Note: any preamble information, such as the description of the data set should be removed from the .txt file before reading into R.</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="introduction-to-longitudinal-data.html#cb593-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the data set</span></span>
<span id="cb593-2"><a href="introduction-to-longitudinal-data.html#cb593-2" aria-hidden="true" tabindex="-1"></a>aidsdat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/ACTG.txt&quot;</span>)</span>
<span id="cb593-3"><a href="introduction-to-longitudinal-data.html#cb593-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb593-4"><a href="introduction-to-longitudinal-data.html#cb593-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb593-5"><a href="introduction-to-longitudinal-data.html#cb593-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(aidsdat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;treatment&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;week&quot;</span>, <span class="st">&quot;logcount&quot;</span>)</span></code></pre></div>
<p>This data is already in long form, but we need to make sure that the variables for treatment and gender are treated as categorical variables. We can do this by either renaming the variables to be characters, or by using the <code>as.factor()</code> function. For clarity, we will rename the gender variable, where 1 is male and 0 is female. We will keep the treatment numbers as 1 - 4 but create dummy variables (we can also assign them as <code>as.factors()</code> but this allows us to be more flexible):</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="introduction-to-longitudinal-data.html#cb594-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change gender values to M, F</span></span>
<span id="cb594-2"><a href="introduction-to-longitudinal-data.html#cb594-2" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(aidsdat<span class="sc">$</span>gender <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>) <span class="co"># change 1 to M, 0 to F</span></span>
<span id="cb594-3"><a href="introduction-to-longitudinal-data.html#cb594-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-4"><a href="introduction-to-longitudinal-data.html#cb594-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create individual treatment variables</span></span>
<span id="cb594-5"><a href="introduction-to-longitudinal-data.html#cb594-5" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>T1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(aidsdat<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb594-6"><a href="introduction-to-longitudinal-data.html#cb594-6" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>T2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(aidsdat<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb594-7"><a href="introduction-to-longitudinal-data.html#cb594-7" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>T3 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(aidsdat<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb594-8"><a href="introduction-to-longitudinal-data.html#cb594-8" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>T4 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(aidsdat<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code></pre></div>
<p><strong>Step 2: Assessing Normality</strong></p>
<p>Now that our data is the correct form, we can begin to explore the data. We first assess the normality assumption for the outcome of interest <code>logcount</code>. We do this by looking at the distribution of the outcome, and creating a Q-Q plot.</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="introduction-to-longitudinal-data.html#cb595-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set graphs to appear in one row and two columns</span></span>
<span id="cb595-2"><a href="introduction-to-longitudinal-data.html#cb595-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb595-3"><a href="introduction-to-longitudinal-data.html#cb595-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-4"><a href="introduction-to-longitudinal-data.html#cb595-4" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of outcome</span></span>
<span id="cb595-5"><a href="introduction-to-longitudinal-data.html#cb595-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(aidsdat<span class="sc">$</span>logcount, <span class="at">xlab =</span> <span class="st">&quot;Log(count + 1)&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Histogram of Outcome&quot;</span>)</span>
<span id="cb595-6"><a href="introduction-to-longitudinal-data.html#cb595-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-7"><a href="introduction-to-longitudinal-data.html#cb595-7" aria-hidden="true" tabindex="-1"></a><span class="co"># QQ plot and line</span></span>
<span id="cb595-8"><a href="introduction-to-longitudinal-data.html#cb595-8" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(aidsdat<span class="sc">$</span>logcount) <span class="co"># plots quantiles against st normal</span></span>
<span id="cb595-9"><a href="introduction-to-longitudinal-data.html#cb595-9" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(aidsdat<span class="sc">$</span>logcount)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex3-normalityaids"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex3-normalityaids-1.png" alt="Plot for assessing normality in the ACTG data set." width="672" />
<p class="caption">
Figure 6.23: Plot for assessing normality in the ACTG data set.
</p>
</div>
<p>From the plots in Figure <a href="introduction-to-longitudinal-data.html#fig:long-lme-ex3-normalityaids">6.23</a>, we do not have strong evidence that the normality assumption is violated as most observations are close to the theoretical quantiles in the Q-Q plot. We do see quite a few individuals with Log(1 + CD4 count) of 0. We may want to look into these observations further to determine if we should remove these from the analysis. we note that we could consider using a Generalized Linear Mixed Effect Model (GLMM) as we do have slight skewness in the distribution of our outcome. A GLMM would allow us to assign a different distribution to the outcome and is suitable for data that is not normally distributed. However, for the purpose of this analysis we will continue with the entire data set. See Section <a href="introduction-to-longitudinal-data.html#long-linear-assumptions">6.3.1</a> for more information on tests of normality.</p>
<p><strong>Step 3: Assessing Time Trend</strong></p>
<p>The next step is to assess the time trend. When looking for the proper form of the time trend, we include integral variables like the treatment and assume an unstructured correlation structure in our model. We have so many observations in our data set at irregular times that many data visualization techniques previously shown to look at the time trend will fail.</p>
<p>To gain some insight on the time trend, we can look at a smoothed estimate of the average time trend within each treatment group, and we can also look at a small random sample of individuals and look at their individual trajectories. We can group them by treatment group, as well.</p>
<p>We first look at a smoothed estimate at the population trend using <a href="https://en.wikipedia.org/wiki/Local_regression">LOESS</a>.</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="introduction-to-longitudinal-data.html#cb596-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot response over time for this group, grouped by treatment</span></span>
<span id="cb596-2"><a href="introduction-to-longitudinal-data.html#cb596-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> aidsdat, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> logcount)) <span class="sc">+</span></span>
<span id="cb596-3"><a href="introduction-to-longitudinal-data.html#cb596-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb596-4"><a href="introduction-to-longitudinal-data.html#cb596-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> treatment) <span class="sc">+</span></span>
<span id="cb596-5"><a href="introduction-to-longitudinal-data.html#cb596-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>() <span class="sc">+</span></span>
<span id="cb596-6"><a href="introduction-to-longitudinal-data.html#cb596-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;LOESS Curves of log(CD4 counts + 1) Stratified by Treatment&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex3-ggplotloess"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex3-ggplotloess-1.png" alt="Estimated curves for log(CD4 counts + 1) estimated by LOESS within each treatment group/" width="672" />
<p class="caption">
Figure 6.24: Estimated curves for log(CD4 counts + 1) estimated by LOESS within each treatment group/
</p>
</div>
<p>We see that the trend differs greatly between groups. In particular, treatment 4 (triple therapy) differs greatly from treatments 1 - 3 (dual therapies), which are similar to one another. We may want to consider higher order time terms due to the curvature in the trend for treatment 4 in particular for our fixed-effects.</p>
<p>Next, we look at a random sample of 50 individuals from our data set, grouped by treatment group.</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="introduction-to-longitudinal-data.html#cb597-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed so results reproducible</span></span>
<span id="cb597-2"><a href="introduction-to-longitudinal-data.html#cb597-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb597-3"><a href="introduction-to-longitudinal-data.html#cb597-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb597-4"><a href="introduction-to-longitudinal-data.html#cb597-4" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly select 50 ids</span></span>
<span id="cb597-5"><a href="introduction-to-longitudinal-data.html#cb597-5" aria-hidden="true" tabindex="-1"></a>randomids <span class="ot">&lt;-</span> <span class="fu">sample</span>(aidsdat<span class="sc">$</span>id, <span class="dv">50</span>)</span>
<span id="cb597-6"><a href="introduction-to-longitudinal-data.html#cb597-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb597-7"><a href="introduction-to-longitudinal-data.html#cb597-7" aria-hidden="true" tabindex="-1"></a><span class="co"># make data set of just those individuals that were randomly selected</span></span>
<span id="cb597-8"><a href="introduction-to-longitudinal-data.html#cb597-8" aria-hidden="true" tabindex="-1"></a>aidsdat_rand <span class="ot">&lt;-</span> aidsdat[<span class="fu">which</span>(aidsdat<span class="sc">$</span>id <span class="sc">%in%</span> randomids),]</span>
<span id="cb597-9"><a href="introduction-to-longitudinal-data.html#cb597-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb597-10"><a href="introduction-to-longitudinal-data.html#cb597-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot response over time for this group, grouped by treatment</span></span>
<span id="cb597-11"><a href="introduction-to-longitudinal-data.html#cb597-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> aidsdat_rand, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> logcount, <span class="at">group =</span> id)) <span class="sc">+</span></span>
<span id="cb597-12"><a href="introduction-to-longitudinal-data.html#cb597-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb597-13"><a href="introduction-to-longitudinal-data.html#cb597-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb597-14"><a href="introduction-to-longitudinal-data.html#cb597-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> treatment) <span class="sc">+</span></span>
<span id="cb597-15"><a href="introduction-to-longitudinal-data.html#cb597-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>() <span class="sc">+</span></span>
<span id="cb597-16"><a href="introduction-to-longitudinal-data.html#cb597-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Spaghetti Plot for Random Sample (n = 50) of log(CD4 counts + 1) </span><span class="sc">\n</span><span class="st"> Stratified by Treatment&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex3-randomsample"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex3-randomsample-1.png" alt="Spaghetti plot showing trajectories of a random sample of 50 individuals, stratified by treatment group." width="672" />
<p class="caption">
Figure 6.25: Spaghetti plot showing trajectories of a random sample of 50 individuals, stratified by treatment group.
</p>
</div>
<p>We see from this small sample that individual trajectory varies greatly both between and within groups. We see non-linear time effects, and also differing slopes and intercepts within each treatment groups. This means we should consider random slope and intercept models that includes higher-orders of time and interactions that include the treatment group variable. We note that we must consider time as a continuous covariate in this setting because of the irregularity in the observation times.</p>
<p>When modelling the treatment, we will use treatment 4 as a reference as it’s the only triple therapy treatment. To do so, we start with a main-effects random slope and intercept model of the form
<span class="math display">\[
\mu_{ij} = \beta_0 + \beta_1\text{Trt1}_{ij} + \beta_2\text{Trt2}_{ij} + \beta_3\text{Trt3}_{ij} + \beta_4t_{ij} + b_{0,i} + b_{1,i}t_{ij}
\]</span>
where <span class="math inline">\(\text{Trt1}_{ij} = 1\)</span> if subject <span class="math inline">\(i\)</span> is assigned to treatment 1 and = 0 otherwise, <span class="math inline">\(\text{Trt2}_{ij} = 1\)</span> if subject <span class="math inline">\(i\)</span> is assigned to treatment 2 and = 0 otherwise, <span class="math inline">\(\text{Trt3}_{ij} = 1\)</span> if subject <span class="math inline">\(i\)</span> is assigned to treatment 3 and = 0 otherwise, <span class="math inline">\(t_{ij}\)</span> is the time of observation <span class="math inline">\(j\)</span> for individual <span class="math inline">\(i\)</span> (in weeks since baseline), and <span class="math inline">\(b_{0,i}\)</span> and <span class="math inline">\(b_{1,i}\)</span> are the random intercept and slope, respectively.</p>
<p>To begin, we assume an unstructured correlation structure for the random effects and independent structure for the within-subject correlation (default). We note that since we are interested in looking at the time trend specifically (fixed effect), we fit the model using the <code>ML</code> method. We fit this model with the following code:</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="introduction-to-longitudinal-data.html#cb598-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the random intercept and slope model</span></span>
<span id="cb598-2"><a href="introduction-to-longitudinal-data.html#cb598-2" aria-hidden="true" tabindex="-1"></a>fitaids1 <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb598-3"><a href="introduction-to-longitudinal-data.html#cb598-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> logcount <span class="sc">~</span> T1 <span class="sc">+</span> T2 <span class="sc">+</span> T3 <span class="sc">+</span> week, <span class="co"># specify fixed effects</span></span>
<span id="cb598-4"><a href="introduction-to-longitudinal-data.html#cb598-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> week <span class="sc">|</span> id, <span class="co"># random slope on time variable,</span></span>
<span id="cb598-5"><a href="introduction-to-longitudinal-data.html#cb598-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb598-6"><a href="introduction-to-longitudinal-data.html#cb598-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> aidsdat,</span>
<span id="cb598-7"><a href="introduction-to-longitudinal-data.html#cb598-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb598-8"><a href="introduction-to-longitudinal-data.html#cb598-8" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb598-9"><a href="introduction-to-longitudinal-data.html#cb598-9" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span></code></pre></div>
<p>We wish to compare this model with one that includes higher orders of time as well as interactions. We consider comparing the main-effects model against:
<span class="math display">\[
\begin{aligned}
\mu_{ij} = \beta_0 &amp;+ \beta_1\text{Trt1}_{ij} + \beta_2\text{Trt2}_{ij} + \beta_3\text{Trt3}_{ij} + \beta_4t_{ij} + \beta_5t_{ij}^2 + \\
&amp;\beta_6\text{Trt1}_{ij}t_{ij} +\beta_7\text{Trt2}_{ij}t_{ij} + \beta_8\text{Trt4}_{ij}t_{ij} + \\
&amp;\beta_9\text{Trt1}_{ij}t_{ij}^2 +\beta_{10}\text{Trt2}_{ij}t_{ij}^2 + \beta_{11}\text{Trt4}_{ij}t_{ij}^2  + \\
&amp;b_{0,i} + b_{1,i}t_{ij}
\end{aligned}
\]</span>
In this model, we allow for a non-linear time trend that can vary between treatment groups. We leave the random effects as is, and will assess the structure of random effects after assessing the time trend. To fit this model in R, we first need to manually create the squared time variable and interactions. We note that again, we fit the model using the <code>ML</code> method.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="introduction-to-longitudinal-data.html#cb599-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create squared time variable</span></span>
<span id="cb599-2"><a href="introduction-to-longitudinal-data.html#cb599-2" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>weeksq <span class="ot">&lt;-</span> (aidsdat<span class="sc">$</span>week)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb599-3"><a href="introduction-to-longitudinal-data.html#cb599-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-4"><a href="introduction-to-longitudinal-data.html#cb599-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create all interactions</span></span>
<span id="cb599-5"><a href="introduction-to-longitudinal-data.html#cb599-5" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>inter_T1week <span class="ot">&lt;-</span> aidsdat<span class="sc">$</span>T1<span class="sc">*</span>aidsdat<span class="sc">$</span>week</span>
<span id="cb599-6"><a href="introduction-to-longitudinal-data.html#cb599-6" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>inter_T2week <span class="ot">&lt;-</span> aidsdat<span class="sc">$</span>T2<span class="sc">*</span>aidsdat<span class="sc">$</span>week</span>
<span id="cb599-7"><a href="introduction-to-longitudinal-data.html#cb599-7" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>inter_T3week <span class="ot">&lt;-</span> aidsdat<span class="sc">$</span>T3<span class="sc">*</span>aidsdat<span class="sc">$</span>week</span>
<span id="cb599-8"><a href="introduction-to-longitudinal-data.html#cb599-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-9"><a href="introduction-to-longitudinal-data.html#cb599-9" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>inter_T1weeksq <span class="ot">&lt;-</span> aidsdat<span class="sc">$</span>T1<span class="sc">*</span>aidsdat<span class="sc">$</span>weeksq</span>
<span id="cb599-10"><a href="introduction-to-longitudinal-data.html#cb599-10" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>inter_T2weeksq <span class="ot">&lt;-</span> aidsdat<span class="sc">$</span>T2<span class="sc">*</span>aidsdat<span class="sc">$</span>weeksq</span>
<span id="cb599-11"><a href="introduction-to-longitudinal-data.html#cb599-11" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>inter_T3weeksq <span class="ot">&lt;-</span> aidsdat<span class="sc">$</span>T3<span class="sc">*</span>aidsdat<span class="sc">$</span>weeksq</span>
<span id="cb599-12"><a href="introduction-to-longitudinal-data.html#cb599-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-13"><a href="introduction-to-longitudinal-data.html#cb599-13" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model</span></span>
<span id="cb599-14"><a href="introduction-to-longitudinal-data.html#cb599-14" aria-hidden="true" tabindex="-1"></a>fitaids2 <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb599-15"><a href="introduction-to-longitudinal-data.html#cb599-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> logcount <span class="sc">~</span> T1 <span class="sc">+</span> T2 <span class="sc">+</span> T3 <span class="sc">+</span> week <span class="sc">+</span> weeksq <span class="sc">+</span></span>
<span id="cb599-16"><a href="introduction-to-longitudinal-data.html#cb599-16" aria-hidden="true" tabindex="-1"></a>    inter_T1week <span class="sc">+</span> inter_T2week <span class="sc">+</span> inter_T3week <span class="sc">+</span></span>
<span id="cb599-17"><a href="introduction-to-longitudinal-data.html#cb599-17" aria-hidden="true" tabindex="-1"></a>    inter_T1weeksq <span class="sc">+</span> inter_T2weeksq <span class="sc">+</span> inter_T3weeksq, <span class="co"># specify fixed effects</span></span>
<span id="cb599-18"><a href="introduction-to-longitudinal-data.html#cb599-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> week <span class="sc">|</span> id, <span class="co"># random slope on time variable,</span></span>
<span id="cb599-19"><a href="introduction-to-longitudinal-data.html#cb599-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb599-20"><a href="introduction-to-longitudinal-data.html#cb599-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> aidsdat,</span>
<span id="cb599-21"><a href="introduction-to-longitudinal-data.html#cb599-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb599-22"><a href="introduction-to-longitudinal-data.html#cb599-22" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb599-23"><a href="introduction-to-longitudinal-data.html#cb599-23" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span></code></pre></div>
<p>The main effects model is nested in this model, and we have the same random effects present, so we can perform a LRT to see which model fits better. The null hypothesis is that the simpler model (fit1) fits as well as the fuller model (fit2). We do this in R by:</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="introduction-to-longitudinal-data.html#cb600-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fitaids1, fitaids2)</span></code></pre></div>
<pre><code>##          Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fitaids1     1  9 12110.30 12169.02 -6046.151                        
## fitaids2     2 16 11985.39 12089.78 -5976.694 1 vs 2 138.9134  &lt;.0001</code></pre>
<p>Our <span class="math inline">\(p\)</span>-value is small, indicating that we reject the null hypothesis and conclude that the simpler model is not adequate.</p>
<p>We continue the model building process from this model.</p>
<p><strong>Step 4: Consider Appropriate Random Effects Structure</strong></p>
<p>Now that our time trend has been assessed, we focus on choosing the random effects. Our model is currently fit with an random intercept and random slope on our linear time effect. We can consider including other random covariates in our model at this stage.</p>
<p>First, as we included higher-order time terms, we can assess whether or not we should have a random effect on our <code>weeksq</code> variable. We fit a model including <code>weeksq</code> in the <code>random =</code> component of our model, and compare it to our original model using a modified LRT. We note that we cannot use the given <span class="math inline">\(p\)</span>-value when comparing models with different random effects. As inference is on the random effects, we must re-fit the models using the <code>REML</code> estimation method.</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="introduction-to-longitudinal-data.html#cb602-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-fit the model with only one random slope using REML</span></span>
<span id="cb602-2"><a href="introduction-to-longitudinal-data.html#cb602-2" aria-hidden="true" tabindex="-1"></a>fitaids2_REML <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb602-3"><a href="introduction-to-longitudinal-data.html#cb602-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> logcount <span class="sc">~</span> T1 <span class="sc">+</span> T2 <span class="sc">+</span> T3 <span class="sc">+</span> week <span class="sc">+</span> weeksq <span class="sc">+</span></span>
<span id="cb602-4"><a href="introduction-to-longitudinal-data.html#cb602-4" aria-hidden="true" tabindex="-1"></a>    inter_T1week <span class="sc">+</span> inter_T2week <span class="sc">+</span> inter_T3week <span class="sc">+</span></span>
<span id="cb602-5"><a href="introduction-to-longitudinal-data.html#cb602-5" aria-hidden="true" tabindex="-1"></a>    inter_T1weeksq <span class="sc">+</span> inter_T2weeksq <span class="sc">+</span> inter_T3weeksq, <span class="co"># specify fixed effects</span></span>
<span id="cb602-6"><a href="introduction-to-longitudinal-data.html#cb602-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> week <span class="sc">|</span> id, <span class="co"># random slope on time variable,</span></span>
<span id="cb602-7"><a href="introduction-to-longitudinal-data.html#cb602-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb602-8"><a href="introduction-to-longitudinal-data.html#cb602-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> aidsdat,</span>
<span id="cb602-9"><a href="introduction-to-longitudinal-data.html#cb602-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;REML&quot;</span></span>
<span id="cb602-10"><a href="introduction-to-longitudinal-data.html#cb602-10" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb602-11"><a href="introduction-to-longitudinal-data.html#cb602-11" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb602-12"><a href="introduction-to-longitudinal-data.html#cb602-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-13"><a href="introduction-to-longitudinal-data.html#cb602-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-14"><a href="introduction-to-longitudinal-data.html#cb602-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-15"><a href="introduction-to-longitudinal-data.html#cb602-15" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the new model with random slope on time and time^2</span></span>
<span id="cb602-16"><a href="introduction-to-longitudinal-data.html#cb602-16" aria-hidden="true" tabindex="-1"></a>fitaids3_REML <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb602-17"><a href="introduction-to-longitudinal-data.html#cb602-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> logcount <span class="sc">~</span> T1 <span class="sc">+</span> T2 <span class="sc">+</span> T3 <span class="sc">+</span> week <span class="sc">+</span> weeksq <span class="sc">+</span></span>
<span id="cb602-18"><a href="introduction-to-longitudinal-data.html#cb602-18" aria-hidden="true" tabindex="-1"></a>    inter_T1week <span class="sc">+</span> inter_T2week <span class="sc">+</span> inter_T3week <span class="sc">+</span></span>
<span id="cb602-19"><a href="introduction-to-longitudinal-data.html#cb602-19" aria-hidden="true" tabindex="-1"></a>    inter_T1weeksq <span class="sc">+</span> inter_T2weeksq <span class="sc">+</span> inter_T3weeksq, <span class="co"># specify fixed effects</span></span>
<span id="cb602-20"><a href="introduction-to-longitudinal-data.html#cb602-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> week <span class="sc">+</span> weeksq <span class="sc">|</span> id, <span class="co"># random slope on time and time^2 variable,</span></span>
<span id="cb602-21"><a href="introduction-to-longitudinal-data.html#cb602-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb602-22"><a href="introduction-to-longitudinal-data.html#cb602-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> aidsdat,</span>
<span id="cb602-23"><a href="introduction-to-longitudinal-data.html#cb602-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;REML&quot;</span></span>
<span id="cb602-24"><a href="introduction-to-longitudinal-data.html#cb602-24" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb602-25"><a href="introduction-to-longitudinal-data.html#cb602-25" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb602-26"><a href="introduction-to-longitudinal-data.html#cb602-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-27"><a href="introduction-to-longitudinal-data.html#cb602-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-28"><a href="introduction-to-longitudinal-data.html#cb602-28" aria-hidden="true" tabindex="-1"></a><span class="co"># perform the modified LRT</span></span>
<span id="cb602-29"><a href="introduction-to-longitudinal-data.html#cb602-29" aria-hidden="true" tabindex="-1"></a>LRT_mix_aids <span class="ot">&lt;-</span> <span class="fu">anova</span>(fitaids3_REML, fitaids2_REML) <span class="co">#perform test</span></span>
<span id="cb602-30"><a href="introduction-to-longitudinal-data.html#cb602-30" aria-hidden="true" tabindex="-1"></a>teststat_mix_aids <span class="ot">&lt;-</span> LRT_mix_aids<span class="sc">$</span>L.Ratio[<span class="dv">2</span>] <span class="co">#grab test statistics</span></span>
<span id="cb602-31"><a href="introduction-to-longitudinal-data.html#cb602-31" aria-hidden="true" tabindex="-1"></a><span class="fu">pchibarsq</span>(teststat_mix_aids, <span class="at">df =</span> <span class="dv">1</span>, <span class="at">mix =</span> <span class="fl">0.5</span>) <span class="co">#degree of freedom is 1</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>The large <span class="math inline">\(p\)</span>-value indicates that we do not have evidence to reject the null hypothesis that the simpler model with only one random effect is better. As such, we can continue our analysis with the simpler model with a random intercept and random slope only on the linear time term (<code>fitaids2</code>).</p>
<p><strong>Step 5: Variable Selection</strong></p>
<p>Under the model above, we consider other fixed-effect variables at our disposal. In our model, we can consider age and gender as other covariates. We refit the model with these fixed effects and look at the model summary. We fit this model using the <code>ML</code> method as we are interested in the fixed effects.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="introduction-to-longitudinal-data.html#cb604-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model</span></span>
<span id="cb604-2"><a href="introduction-to-longitudinal-data.html#cb604-2" aria-hidden="true" tabindex="-1"></a><span class="co"># re-fit the model with only one random slope using REML</span></span>
<span id="cb604-3"><a href="introduction-to-longitudinal-data.html#cb604-3" aria-hidden="true" tabindex="-1"></a>fitaids4 <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb604-4"><a href="introduction-to-longitudinal-data.html#cb604-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> logcount <span class="sc">~</span> T1 <span class="sc">+</span> T2 <span class="sc">+</span> T3 <span class="sc">+</span> week <span class="sc">+</span> weeksq <span class="sc">+</span> age <span class="sc">+</span> gender <span class="sc">+</span></span>
<span id="cb604-5"><a href="introduction-to-longitudinal-data.html#cb604-5" aria-hidden="true" tabindex="-1"></a>    inter_T1week <span class="sc">+</span> inter_T2week <span class="sc">+</span> inter_T3week <span class="sc">+</span></span>
<span id="cb604-6"><a href="introduction-to-longitudinal-data.html#cb604-6" aria-hidden="true" tabindex="-1"></a>    inter_T1weeksq <span class="sc">+</span> inter_T2weeksq <span class="sc">+</span> inter_T3weeksq, <span class="co"># specify fixed effects</span></span>
<span id="cb604-7"><a href="introduction-to-longitudinal-data.html#cb604-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> week <span class="sc">|</span> id, <span class="co"># random slope on time variable,</span></span>
<span id="cb604-8"><a href="introduction-to-longitudinal-data.html#cb604-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb604-9"><a href="introduction-to-longitudinal-data.html#cb604-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> aidsdat,</span>
<span id="cb604-10"><a href="introduction-to-longitudinal-data.html#cb604-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb604-11"><a href="introduction-to-longitudinal-data.html#cb604-11" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb604-12"><a href="introduction-to-longitudinal-data.html#cb604-12" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb604-13"><a href="introduction-to-longitudinal-data.html#cb604-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-14"><a href="introduction-to-longitudinal-data.html#cb604-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitaids4)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##   Data: aidsdat 
##        AIC      BIC    logLik
##   11976.97 12094.41 -5970.483
## 
## Random effects:
##  Formula: ~week | id
##  Structure: General positive-definite, Log-Cholesky parametrization
##             StdDev     Corr  
## (Intercept) 0.80125818 (Intr)
## week        0.01616871 0.18  
## Residual    0.57290009       
## 
## Fixed effects:  logcount ~ T1 + T2 + T3 + week + weeksq + age + gender + inter_T1week +      inter_T2week + inter_T3week + inter_T1weeksq + inter_T2weeksq +      inter_T3weeksq 
##                     Value  Std.Error   DF   t-value p-value
## (Intercept)     2.5496261 0.13909953 3719 18.329510  0.0000
## T1              0.0932740 0.07589996 1303  1.228907  0.2193
## T2              0.0849522 0.07581109 1303  1.120578  0.2627
## T3              0.0525470 0.07556476 1303  0.695391  0.4869
## week            0.0331363 0.00445349 3719  7.440537  0.0000
## weeksq         -0.0010068 0.00012212 3719 -8.243865  0.0000
## age             0.0106712 0.00307945 1303  3.465283  0.0005
## genderM        -0.0796127 0.07705184 1303 -1.033235  0.3017
## inter_T1week   -0.0461711 0.00641107 3719 -7.201772  0.0000
## inter_T2week   -0.0390965 0.00635733 3719 -6.149837  0.0000
## inter_T3week   -0.0260990 0.00636904 3719 -4.097786  0.0000
## inter_T1weeksq  0.0008925 0.00017706 3719  5.040844  0.0000
## inter_T2weeksq  0.0007545 0.00017415 3719  4.332539  0.0000
## inter_T3weeksq  0.0004848 0.00017621 3719  2.751460  0.0060
##  Correlation: 
##                (Intr) T1     T2     T3     week   weeksq age    gendrM
## T1             -0.264                                                 
## T2             -0.276  0.495                                          
## T3             -0.288  0.496  0.497                                   
## week           -0.129  0.240  0.240  0.241                            
## weeksq          0.107 -0.198 -0.198 -0.199 -0.925                     
## age            -0.788  0.003  0.005  0.017 -0.001  0.001              
## genderM        -0.397 -0.017  0.004  0.007 -0.002  0.002 -0.105       
## inter_T1week    0.087 -0.342 -0.167 -0.167 -0.695  0.643  0.004  0.001
## inter_T2week    0.090 -0.168 -0.339 -0.169 -0.701  0.648  0.003  0.000
## inter_T3week    0.094 -0.168 -0.168 -0.341 -0.699  0.647  0.001 -0.007
## inter_T1weeksq -0.072  0.282  0.137  0.137  0.638 -0.690 -0.002 -0.001
## inter_T2weeksq -0.075  0.139  0.280  0.140  0.649 -0.701 -0.002  0.001
## inter_T3weeksq -0.077  0.137  0.138  0.281  0.641 -0.693 -0.001  0.006
##                inter_T1wk inter_T2wk inter_T3wk intr_T1wks intr_T2wks
## T1                                                                   
## T2                                                                   
## T3                                                                   
## week                                                                 
## weeksq                                                               
## age                                                                  
## genderM                                                              
## inter_T1week                                                         
## inter_T2week    0.487                                                
## inter_T3week    0.486      0.490                                     
## inter_T1weeksq -0.925     -0.447     -0.446                          
## inter_T2weeksq -0.451     -0.924     -0.454      0.484               
## inter_T3weeksq -0.445     -0.449     -0.925      0.478      0.486    
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -4.32307934 -0.43840832  0.03613471  0.48612402  3.58800387 
## 
## Number of Observations: 5036
## Number of Groups: 1309</code></pre>
<p>We notice that the categorical gender variable has a large <span class="math inline">\(p\)</span>-value, indicating it is not important to the model. We also notice that the stand-alone variables for treatments 1 to 3 are insignificant individually. We can test if these variables (which allow the log CD4 count to vary at baseline by treatment) are necessary.</p>
<p>We first re-fit the model without the gender variable:</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="introduction-to-longitudinal-data.html#cb606-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model</span></span>
<span id="cb606-2"><a href="introduction-to-longitudinal-data.html#cb606-2" aria-hidden="true" tabindex="-1"></a>fitaids5 <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb606-3"><a href="introduction-to-longitudinal-data.html#cb606-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> logcount <span class="sc">~</span> T1 <span class="sc">+</span> T2 <span class="sc">+</span> T3 <span class="sc">+</span> week <span class="sc">+</span> weeksq <span class="sc">+</span> age <span class="sc">+</span></span>
<span id="cb606-4"><a href="introduction-to-longitudinal-data.html#cb606-4" aria-hidden="true" tabindex="-1"></a>    inter_T1week <span class="sc">+</span> inter_T2week <span class="sc">+</span> inter_T3week <span class="sc">+</span></span>
<span id="cb606-5"><a href="introduction-to-longitudinal-data.html#cb606-5" aria-hidden="true" tabindex="-1"></a>    inter_T1weeksq <span class="sc">+</span> inter_T2weeksq <span class="sc">+</span> inter_T3weeksq, <span class="co"># specify fixed effects</span></span>
<span id="cb606-6"><a href="introduction-to-longitudinal-data.html#cb606-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> week <span class="sc">|</span> id, <span class="co"># random slope on time variable,</span></span>
<span id="cb606-7"><a href="introduction-to-longitudinal-data.html#cb606-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb606-8"><a href="introduction-to-longitudinal-data.html#cb606-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> aidsdat,</span>
<span id="cb606-9"><a href="introduction-to-longitudinal-data.html#cb606-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb606-10"><a href="introduction-to-longitudinal-data.html#cb606-10" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb606-11"><a href="introduction-to-longitudinal-data.html#cb606-11" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb606-12"><a href="introduction-to-longitudinal-data.html#cb606-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb606-13"><a href="introduction-to-longitudinal-data.html#cb606-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitaids5)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##   Data: aidsdat 
##        AIC      BIC    logLik
##   11976.03 12086.95 -5971.017
## 
## Random effects:
##  Formula: ~week | id
##  Structure: General positive-definite, Log-Cholesky parametrization
##             StdDev     Corr  
## (Intercept) 0.80139901 (Intr)
## week        0.01617039 0.183 
## Residual    0.57288806       
## 
## Fixed effects:  logcount ~ T1 + T2 + T3 + week + weeksq + age + inter_T1week +      inter_T2week + inter_T3week + inter_T1weeksq + inter_T2weeksq +      inter_T3weeksq 
##                     Value  Std.Error   DF   t-value p-value
## (Intercept)     2.4927063 0.12771463 3719 19.517782  0.0000
## T1              0.0919180 0.07588943 1304  1.211210  0.2260
## T2              0.0852870 0.07581145 1304  1.124988  0.2608
## T3              0.0530581 0.07556417 1304  0.702159  0.4827
## week            0.0331239 0.00445302 3719  7.438537  0.0000
## weeksq         -0.0010066 0.00012211 3719 -8.243094  0.0000
## age             0.0103336 0.00306341 1304  3.373251  0.0008
## inter_T1week   -0.0461640 0.00641042 3719 -7.201401  0.0000
## inter_T2week   -0.0390977 0.00635671 3719 -6.150622  0.0000
## inter_T3week   -0.0261423 0.00636826 3719 -4.105094  0.0000
## inter_T1weeksq  0.0008924 0.00017704 3719  5.040482  0.0000
## inter_T2weeksq  0.0007547 0.00017413 3719  4.333950  0.0000
## inter_T3weeksq  0.0004858 0.00017618 3719  2.757298  0.0059
##  Correlation: 
##                (Intr) T1     T2     T3     week   weeksq age    inter_T1wk
## T1             -0.295                                                     
## T2             -0.299  0.495                                              
## T3             -0.311  0.496  0.497                                       
## week           -0.141  0.240  0.240  0.241                                
## weeksq          0.117 -0.198 -0.198 -0.199 -0.925                         
## age            -0.909  0.002  0.005  0.017 -0.001  0.001                  
## inter_T1week    0.095 -0.342 -0.167 -0.167 -0.695  0.643  0.004           
## inter_T2week    0.097 -0.168 -0.339 -0.169 -0.701  0.648  0.002  0.487    
## inter_T3week    0.100 -0.168 -0.168 -0.340 -0.699  0.647  0.000  0.486    
## inter_T1weeksq -0.079  0.282  0.137  0.137  0.638 -0.690 -0.002 -0.925    
## inter_T2weeksq -0.081  0.139  0.280  0.140  0.649 -0.701 -0.002 -0.451    
## inter_T3weeksq -0.081  0.137  0.138  0.281  0.641 -0.693 -0.001 -0.445    
##                inter_T2wk inter_T3wk intr_T1wks intr_T2wks
## T1                                                        
## T2                                                        
## T3                                                        
## week                                                      
## weeksq                                                    
## age                                                       
## inter_T1week                                              
## inter_T2week                                              
## inter_T3week    0.490                                     
## inter_T1weeksq -0.447     -0.446                          
## inter_T2weeksq -0.924     -0.454      0.484               
## inter_T3weeksq -0.449     -0.925      0.478      0.486    
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -4.32689940 -0.43909720  0.03549493  0.48585347  3.58573422 
## 
## Number of Observations: 5036
## Number of Groups: 1309</code></pre>
<p>This model can be written as
<span class="math display">\[
\begin{aligned}
\mu_{ij} = \beta_0 &amp;+ \beta_1\text{Trt1}_{ij} + \beta_2\text{Trt2}_{ij} + \beta_3\text{Trt3}_{ij} + \beta_4t_{ij} + \beta_5t_{ij}^2 + \beta_6\text{age}_{ij} \\
&amp;\beta_7\text{Trt1}_{ij}t_{ij} +\beta_8\text{Trt2}_{ij}t_{ij} + \beta_9\text{Trt4}_{ij}t_{ij} + \\
&amp;\beta_{10}\text{Trt1}_{ij}t_{ij}^2 +\beta_{11}\text{Trt2}_{ij}t_{ij}^2 + \beta_{12}\text{Trt4}_{ij}t_{ij}^2  + \\
&amp;b_{0,i} + b_{1,i}t_{ij}
\end{aligned}
\]</span></p>
<p>To test if the individual, stand-alone treatment variables are necessary in the model, we can test <span class="math inline">\(H_0: \beta_1 = \beta_2 = \beta_3 = 0\)</span> vs <span class="math inline">\(H_A:\)</span> at least one of these coefficients is non-zero. We can use the <code>waldTestFunction</code> presented in <a href="introduction-to-longitudinal-data.html#long-linearmixed-ht">6.4.8</a> to perform this test. We first create a matrix <span class="math inline">\(\bm{C}\)</span> that will indicate the hypothesis test of interest. In our case, we want one column for each coefficient (including <span class="math inline">\(\beta_0\)</span>) and one row for each coefficient in our hypothesis test.
<span class="math display">\[
\bm{C} = \begin{bmatrix}
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
\end{bmatrix},
\]</span>
In R, we create this matrix and perform the hypothesis test by:</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="introduction-to-longitudinal-data.html#cb608-1" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb608-2"><a href="introduction-to-longitudinal-data.html#cb608-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb608-3"><a href="introduction-to-longitudinal-data.html#cb608-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb608-4"><a href="introduction-to-longitudinal-data.html#cb608-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb608-5"><a href="introduction-to-longitudinal-data.html#cb608-5" aria-hidden="true" tabindex="-1"></a><span class="fu">waldTestFunction</span>(C, fitaids5)</span></code></pre></div>
<pre><code>## 
##  Wald test chi-squared statistic is 1.846 with 3 df, p-value = 0.605 .</code></pre>
<p>We fail to reject the null hypothesis and conclude that we do not need those terms in the model. As such, we can refit the model without those terms:</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="introduction-to-longitudinal-data.html#cb610-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model</span></span>
<span id="cb610-2"><a href="introduction-to-longitudinal-data.html#cb610-2" aria-hidden="true" tabindex="-1"></a>fitaids6 <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb610-3"><a href="introduction-to-longitudinal-data.html#cb610-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> logcount <span class="sc">~</span> week <span class="sc">+</span> weeksq <span class="sc">+</span> age <span class="sc">+</span></span>
<span id="cb610-4"><a href="introduction-to-longitudinal-data.html#cb610-4" aria-hidden="true" tabindex="-1"></a>    inter_T1week <span class="sc">+</span> inter_T2week <span class="sc">+</span> inter_T3week <span class="sc">+</span></span>
<span id="cb610-5"><a href="introduction-to-longitudinal-data.html#cb610-5" aria-hidden="true" tabindex="-1"></a>    inter_T1weeksq <span class="sc">+</span> inter_T2weeksq <span class="sc">+</span> inter_T3weeksq, <span class="co"># specify fixed effects</span></span>
<span id="cb610-6"><a href="introduction-to-longitudinal-data.html#cb610-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> week <span class="sc">|</span> id, <span class="co"># random slope on time variable,</span></span>
<span id="cb610-7"><a href="introduction-to-longitudinal-data.html#cb610-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb610-8"><a href="introduction-to-longitudinal-data.html#cb610-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> aidsdat,</span>
<span id="cb610-9"><a href="introduction-to-longitudinal-data.html#cb610-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb610-10"><a href="introduction-to-longitudinal-data.html#cb610-10" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb610-11"><a href="introduction-to-longitudinal-data.html#cb610-11" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb610-12"><a href="introduction-to-longitudinal-data.html#cb610-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb610-13"><a href="introduction-to-longitudinal-data.html#cb610-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb610-14"><a href="introduction-to-longitudinal-data.html#cb610-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitaids6)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##   Data: aidsdat 
##        AIC      BIC   logLik
##   11971.88 12063.22 -5971.94
## 
## Random effects:
##  Formula: ~week | id
##  Structure: General positive-definite, Log-Cholesky parametrization
##             StdDev    Corr  
## (Intercept) 0.8021100 (Intr)
## week        0.0161687 0.182 
## Residual    0.5729115       
## 
## Fixed effects:  logcount ~ week + weeksq + age + inter_T1week + inter_T2week +      inter_T3week + inter_T1weeksq + inter_T2weeksq + inter_T3weeksq 
##                     Value  Std.Error   DF   t-value p-value
## (Intercept)     2.5503002 0.11867209 3719 21.490312  0.0000
## week            0.0314956 0.00425444 3719  7.402995  0.0000
## weeksq         -0.0009696 0.00011840 3719 -8.189111  0.0000
## age             0.0103243 0.00306385 1307  3.369712  0.0008
## inter_T1week   -0.0435212 0.00602318 3719 -7.225622  0.0000
## inter_T2week   -0.0366747 0.00597912 3719 -6.133800  0.0000
## inter_T3week   -0.0246364 0.00598716 3719 -4.114881  0.0000
## inter_T1weeksq  0.0008323 0.00016983 3719  4.900474  0.0000
## inter_T2weeksq  0.0006998 0.00016712 3719  4.187267  0.0000
## inter_T3weeksq  0.0004517 0.00016907 3719  2.671707  0.0076
##  Correlation: 
##                (Intr) week   weeksq age    inter_T1wk inter_T2wk inter_T3wk
## week           -0.036                                                      
## weeksq          0.030 -0.921                                               
## age            -0.974 -0.004  0.003                                        
## inter_T1week   -0.005 -0.683  0.631  0.005                                 
## inter_T2week   -0.004 -0.689  0.636  0.004  0.486                          
## inter_T3week   -0.006 -0.687  0.635  0.006  0.486      0.489               
## inter_T1weeksq  0.004  0.623 -0.682 -0.003 -0.919     -0.444     -0.443    
## inter_T2weeksq  0.003  0.634 -0.693 -0.003 -0.448     -0.918     -0.450    
## inter_T3weeksq  0.006  0.626 -0.685 -0.006 -0.442     -0.446     -0.919    
##                intr_T1wks intr_T2wks
## week                                
## weeksq                              
## age                                 
## inter_T1week                        
## inter_T2week                        
## inter_T3week                        
## inter_T1weeksq                      
## inter_T2weeksq  0.483               
## inter_T3weeksq  0.478      0.486    
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -4.32687871 -0.43823484  0.03516623  0.48710764  3.58566831 
## 
## Number of Observations: 5036
## Number of Groups: 1309</code></pre>
<p>We can additionally make sure that the higher-order interaction terms are needed in the model:</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="introduction-to-longitudinal-data.html#cb612-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model</span></span>
<span id="cb612-2"><a href="introduction-to-longitudinal-data.html#cb612-2" aria-hidden="true" tabindex="-1"></a>fitaids7 <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb612-3"><a href="introduction-to-longitudinal-data.html#cb612-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> logcount <span class="sc">~</span> week <span class="sc">+</span> weeksq <span class="sc">+</span> age <span class="sc">+</span></span>
<span id="cb612-4"><a href="introduction-to-longitudinal-data.html#cb612-4" aria-hidden="true" tabindex="-1"></a>    inter_T1week <span class="sc">+</span> inter_T2week <span class="sc">+</span> inter_T3week , <span class="co"># specify fixed effects</span></span>
<span id="cb612-5"><a href="introduction-to-longitudinal-data.html#cb612-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> week <span class="sc">|</span> id, <span class="co"># random slope on time variable,</span></span>
<span id="cb612-6"><a href="introduction-to-longitudinal-data.html#cb612-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb612-7"><a href="introduction-to-longitudinal-data.html#cb612-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> aidsdat,</span>
<span id="cb612-8"><a href="introduction-to-longitudinal-data.html#cb612-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb612-9"><a href="introduction-to-longitudinal-data.html#cb612-9" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb612-10"><a href="introduction-to-longitudinal-data.html#cb612-10" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb612-11"><a href="introduction-to-longitudinal-data.html#cb612-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-12"><a href="introduction-to-longitudinal-data.html#cb612-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-13"><a href="introduction-to-longitudinal-data.html#cb612-13" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fitaids6, fitaids7)</span></code></pre></div>
<pre><code>##          Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fitaids6     1 14 11971.88 12063.22 -5971.940                        
## fitaids7     2 11 11994.26 12066.03 -5986.132 1 vs 2 28.38466  &lt;.0001</code></pre>
<p>We reject the null hypothesis that the simpler model is adequate, and as such conclude that the model including the higher-order interaction terms is more appropriate.</p>
<p>We can also check to see if we should include higher-order terms of our <code>age</code> variable, or interactions between it and the treatment to see if there was a additional change in protein content of the milk produced by age within in each group. We first check if we should include <code>age^2</code> in our model:</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="introduction-to-longitudinal-data.html#cb614-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create squared age variable</span></span>
<span id="cb614-2"><a href="introduction-to-longitudinal-data.html#cb614-2" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>agesq <span class="ot">&lt;-</span> (aidsdat<span class="sc">$</span>age)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb614-3"><a href="introduction-to-longitudinal-data.html#cb614-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb614-4"><a href="introduction-to-longitudinal-data.html#cb614-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb614-5"><a href="introduction-to-longitudinal-data.html#cb614-5" aria-hidden="true" tabindex="-1"></a>fitaids8 <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb614-6"><a href="introduction-to-longitudinal-data.html#cb614-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> logcount <span class="sc">~</span> week <span class="sc">+</span> weeksq <span class="sc">+</span> age <span class="sc">+</span> agesq <span class="sc">+</span></span>
<span id="cb614-7"><a href="introduction-to-longitudinal-data.html#cb614-7" aria-hidden="true" tabindex="-1"></a>    inter_T1week <span class="sc">+</span> inter_T2week <span class="sc">+</span> inter_T3week <span class="sc">+</span></span>
<span id="cb614-8"><a href="introduction-to-longitudinal-data.html#cb614-8" aria-hidden="true" tabindex="-1"></a>    inter_T1weeksq <span class="sc">+</span> inter_T2weeksq <span class="sc">+</span> inter_T3weeksq, <span class="co"># specify fixed effects</span></span>
<span id="cb614-9"><a href="introduction-to-longitudinal-data.html#cb614-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> week <span class="sc">|</span> id, <span class="co"># random slope on time variable,</span></span>
<span id="cb614-10"><a href="introduction-to-longitudinal-data.html#cb614-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb614-11"><a href="introduction-to-longitudinal-data.html#cb614-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> aidsdat,</span>
<span id="cb614-12"><a href="introduction-to-longitudinal-data.html#cb614-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb614-13"><a href="introduction-to-longitudinal-data.html#cb614-13" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb614-14"><a href="introduction-to-longitudinal-data.html#cb614-14" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb614-15"><a href="introduction-to-longitudinal-data.html#cb614-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb614-16"><a href="introduction-to-longitudinal-data.html#cb614-16" aria-hidden="true" tabindex="-1"></a><span class="co">#compare to model 6 that does not include agesq variable</span></span>
<span id="cb614-17"><a href="introduction-to-longitudinal-data.html#cb614-17" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fitaids6, fitaids8)</span></code></pre></div>
<pre><code>##          Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fitaids6     1 14 11971.88 12063.22 -5971.940                        
## fitaids8     2 15 11973.70 12071.56 -5971.849 1 vs 2 0.180606  0.6709</code></pre>
<p>We fail to reject the null hypothesis that the simpler model (model 6, without the squared age term) fits as well as the model that includes the squared term. As such, we conclude that that term is not needed and continue model building from model 6.</p>
<p>Next, we check if we should have interactions between age and treatment. We first create the interaction term and see if they should be included in the model:</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="introduction-to-longitudinal-data.html#cb616-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create the interactions between age and treatment</span></span>
<span id="cb616-2"><a href="introduction-to-longitudinal-data.html#cb616-2" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>inter_T1age <span class="ot">&lt;-</span> aidsdat<span class="sc">$</span>age<span class="sc">*</span>aidsdat<span class="sc">$</span>T1</span>
<span id="cb616-3"><a href="introduction-to-longitudinal-data.html#cb616-3" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>inter_T2age <span class="ot">&lt;-</span> aidsdat<span class="sc">$</span>age<span class="sc">*</span>aidsdat<span class="sc">$</span>T2</span>
<span id="cb616-4"><a href="introduction-to-longitudinal-data.html#cb616-4" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>inter_T3age <span class="ot">&lt;-</span> aidsdat<span class="sc">$</span>age<span class="sc">*</span>aidsdat<span class="sc">$</span>T3</span>
<span id="cb616-5"><a href="introduction-to-longitudinal-data.html#cb616-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-6"><a href="introduction-to-longitudinal-data.html#cb616-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-7"><a href="introduction-to-longitudinal-data.html#cb616-7" aria-hidden="true" tabindex="-1"></a>fitaids9 <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb616-8"><a href="introduction-to-longitudinal-data.html#cb616-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> logcount <span class="sc">~</span> week <span class="sc">+</span> weeksq <span class="sc">+</span> age <span class="sc">+</span> agesq <span class="sc">+</span></span>
<span id="cb616-9"><a href="introduction-to-longitudinal-data.html#cb616-9" aria-hidden="true" tabindex="-1"></a>    inter_T1week <span class="sc">+</span> inter_T2week <span class="sc">+</span> inter_T3week <span class="sc">+</span></span>
<span id="cb616-10"><a href="introduction-to-longitudinal-data.html#cb616-10" aria-hidden="true" tabindex="-1"></a>    inter_T1weeksq <span class="sc">+</span> inter_T2weeksq <span class="sc">+</span> inter_T3weeksq <span class="sc">+</span></span>
<span id="cb616-11"><a href="introduction-to-longitudinal-data.html#cb616-11" aria-hidden="true" tabindex="-1"></a>    inter_T1age <span class="sc">+</span> inter_T2age <span class="sc">+</span> inter_T3age, <span class="co"># specify fixed effects</span></span>
<span id="cb616-12"><a href="introduction-to-longitudinal-data.html#cb616-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> week <span class="sc">|</span> id, <span class="co"># random slope on time variable,</span></span>
<span id="cb616-13"><a href="introduction-to-longitudinal-data.html#cb616-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb616-14"><a href="introduction-to-longitudinal-data.html#cb616-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> aidsdat,</span>
<span id="cb616-15"><a href="introduction-to-longitudinal-data.html#cb616-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb616-16"><a href="introduction-to-longitudinal-data.html#cb616-16" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb616-17"><a href="introduction-to-longitudinal-data.html#cb616-17" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb616-18"><a href="introduction-to-longitudinal-data.html#cb616-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb616-19"><a href="introduction-to-longitudinal-data.html#cb616-19" aria-hidden="true" tabindex="-1"></a><span class="co">#compare to model 6 that does not include agesq variable</span></span>
<span id="cb616-20"><a href="introduction-to-longitudinal-data.html#cb616-20" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fitaids6, fitaids9)</span></code></pre></div>
<pre><code>##          Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## fitaids6     1 14 11971.88 12063.22 -5971.940                        
## fitaids9     2 18 11977.42 12094.86 -5970.712 1 vs 2 2.454881  0.6527</code></pre>
<p>We again fail to reject the null hypothesis that the simpler model fits as well as the more complex model. As such, we should continue analysis with <code>fitaids6</code> that includes the higher-order interaction terms between time (week) and treatment group, and a linear term for age.</p>
<p><strong>Step 6: Model Diagnostics</strong></p>
<p>As a final step, we assess the fit of this model. If the fit appears to be inadequate, we can iterate through the above procedure again. Detailed information on model diagnostics can be found in Section <a href="introduction-to-longitudinal-data.html#long-linearmixed-diagnostics">6.4.6</a>.</p>
<p>To assess if there is serial correlation among the random error term in our model, we can plot a variogram. We prefer to use a variogram instead of an ACF plot because we have irregularly spaced observations in our data set. To plot the variogram, we perform the following in R:</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="introduction-to-longitudinal-data.html#cb618-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Variogram</span>(fitaids6, <span class="at">form =</span> <span class="sc">~</span> week <span class="sc">|</span> id, <span class="at">collapse =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb618-2"><a href="introduction-to-longitudinal-data.html#cb618-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">restype =</span> <span class="st">&quot;pearson&quot;</span>, <span class="at">smooth =</span> <span class="cn">TRUE</span>), <span class="at">xlab =</span> <span class="st">&quot;weeks&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Variogram Plot&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex3-variogramex3"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex3-variogramex3-1.png" alt="Variogram plot used to assess serial correlation in the fitted model: Model 6." width="672" />
<p class="caption">
Figure 6.26: Variogram plot used to assess serial correlation in the fitted model: Model 6.
</p>
</div>
<p>We look to see if there are any patterns or trends in the trend line, estimated by <a href="https://en.wikipedia.org/wiki/Local_regression">LOESS</a>. It is difficult to see in this plot due to the number of observations, but the overall trend line is relatively flat and does not appear to increase or decrease over time. Most observations are low on the graph, indicating low degrees of serial correlation. As such, serial correlation is not an issue in this model.</p>
<p>Next, we check the common variances assumption by looking at a plot of the residuals. We do this in R by:</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="introduction-to-longitudinal-data.html#cb619-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">residuals</span>(fitaids6, <span class="at">type =</span> <span class="st">&quot;normalized&quot;</span>),  <span class="at">main =</span> <span class="st">&quot;Plot of Residuals for Model 6&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex3-commonvarex3"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex3-commonvarex3-1.png" alt="Residual plot for assessing the common variance assumption: Model 6" width="672" />
<p class="caption">
Figure 6.27: Residual plot for assessing the common variance assumption: Model 6
</p>
</div>
<p>Most values here are within 2 standard deviations, and do not show any systematic patterns or clustering. This assumption appears to be satisfied.</p>
<p>Next, we check the normality of the errors through a Q-Q plot:</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="introduction-to-longitudinal-data.html#cb620-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(fitaids6, <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb620-2"><a href="introduction-to-longitudinal-data.html#cb620-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Q-Q Plot of Residuals&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex3-normalityerrors"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex3-normalityerrors-1.png" alt="Plot for assessing normality of errors: Model 6" width="672" />
<p class="caption">
Figure 6.28: Plot for assessing normality of errors: Model 6
</p>
</div>
<p>Here the Q-Q plot does not appear to be perfectly linear, however the majority of points are very close to the quantiles of the standard normal distribution. We conclude that the normality assumption here is satisfied.</p>
<p>Next, we look at the normality of the random intercept and slope:</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="introduction-to-longitudinal-data.html#cb621-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(fitaids6, <span class="sc">~</span><span class="fu">ranef</span>(.), </span>
<span id="cb621-2"><a href="introduction-to-longitudinal-data.html#cb621-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Q-Q plot of Predicted Random Intercepts&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex3-normint"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex3-normint-1.png" alt="Plot for assessing normality of random slop andintercept." width="672" />
<p class="caption">
Figure 6.29: Plot for assessing normality of random slop andintercept.
</p>
</div>
<p>Both plots appear to be relatively straight with no strange patterns or clustering, which indicates we have satisfied the normality assumption of the random effects.</p>
<p>Next, we assess linearity, which we can do my looking at the observed versus fitted values over the entire study population:</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="introduction-to-longitudinal-data.html#cb622-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fitaids6, logcount <span class="sc">~</span> <span class="fu">fitted</span>(.), <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb622-2"><a href="introduction-to-longitudinal-data.html#cb622-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Observed vs. Fitted Values&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex3-linpop"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex3-linpop-1.png" alt="Plot for assessing linearity in the population." width="672" />
<p class="caption">
Figure 6.30: Plot for assessing linearity in the population.
</p>
</div>
<p>Most observations appear to be linear. The banding in the bottom left corner is likely caused by the sample of individuals with log(1 + CD4 counts) = 0. We can also look at stratifying by treatment group:</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="introduction-to-longitudinal-data.html#cb623-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fitaids6, logcount <span class="sc">~</span> <span class="fu">fitted</span>(.)<span class="sc">|</span>treatment, <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb623-2"><a href="introduction-to-longitudinal-data.html#cb623-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Observed vs. Fitted Values&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-lme-ex3-lintrt"></span>
<img src="topics_in_consulting_files/figure-html/long-lme-ex3-lintrt-1.png" alt="Plot for assessing linearity in each treatment." width="672" />
<p class="caption">
Figure 6.31: Plot for assessing linearity in each treatment.
</p>
</div>
<p>Again, most observations appear to be linear. There are too many subjects to look at it on an individual level for the entire population.</p>
<p><strong>Answering the Research Questions</strong></p>
<p>Now that the assumptions have been satisfied, we can look at answering the research questions of interest. Let’s look at the model summary again:</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="introduction-to-longitudinal-data.html#cb624-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitaids6)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##   Data: aidsdat 
##        AIC      BIC   logLik
##   11971.88 12063.22 -5971.94
## 
## Random effects:
##  Formula: ~week | id
##  Structure: General positive-definite, Log-Cholesky parametrization
##             StdDev    Corr  
## (Intercept) 0.8021100 (Intr)
## week        0.0161687 0.182 
## Residual    0.5729115       
## 
## Fixed effects:  logcount ~ week + weeksq + age + inter_T1week + inter_T2week +      inter_T3week + inter_T1weeksq + inter_T2weeksq + inter_T3weeksq 
##                     Value  Std.Error   DF   t-value p-value
## (Intercept)     2.5503002 0.11867209 3719 21.490312  0.0000
## week            0.0314956 0.00425444 3719  7.402995  0.0000
## weeksq         -0.0009696 0.00011840 3719 -8.189111  0.0000
## age             0.0103243 0.00306385 1307  3.369712  0.0008
## inter_T1week   -0.0435212 0.00602318 3719 -7.225622  0.0000
## inter_T2week   -0.0366747 0.00597912 3719 -6.133800  0.0000
## inter_T3week   -0.0246364 0.00598716 3719 -4.114881  0.0000
## inter_T1weeksq  0.0008323 0.00016983 3719  4.900474  0.0000
## inter_T2weeksq  0.0006998 0.00016712 3719  4.187267  0.0000
## inter_T3weeksq  0.0004517 0.00016907 3719  2.671707  0.0076
##  Correlation: 
##                (Intr) week   weeksq age    inter_T1wk inter_T2wk inter_T3wk
## week           -0.036                                                      
## weeksq          0.030 -0.921                                               
## age            -0.974 -0.004  0.003                                        
## inter_T1week   -0.005 -0.683  0.631  0.005                                 
## inter_T2week   -0.004 -0.689  0.636  0.004  0.486                          
## inter_T3week   -0.006 -0.687  0.635  0.006  0.486      0.489               
## inter_T1weeksq  0.004  0.623 -0.682 -0.003 -0.919     -0.444     -0.443    
## inter_T2weeksq  0.003  0.634 -0.693 -0.003 -0.448     -0.918     -0.450    
## inter_T3weeksq  0.006  0.626 -0.685 -0.006 -0.442     -0.446     -0.919    
##                intr_T1wks intr_T2wks
## week                                
## weeksq                              
## age                                 
## inter_T1week                        
## inter_T2week                        
## inter_T3week                        
## inter_T1weeksq                      
## inter_T2weeksq  0.483               
## inter_T3weeksq  0.478      0.486    
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -4.32687871 -0.43823484  0.03516623  0.48710764  3.58566831 
## 
## Number of Observations: 5036
## Number of Groups: 1309</code></pre>
<p>This model can be written as:
<span class="math display">\[
\begin{aligned}
\mu_{ij} = \beta_0 &amp;+  \beta_1t_{ij} + \beta_2t_{ij}^2 + \beta_3\text{age}_{ij} \\
&amp;\beta_4\text{Trt1}_{ij}t_{ij} +\beta_5\text{Trt2}_{ij}t_{ij} + \beta_6\text{Trt4}_{ij}t_{ij} + \\
&amp;\beta_{7}\text{Trt1}_{ij}t_{ij}^2 +\beta_{8}\text{Trt2}_{ij}t_{ij}^2 + \beta_{9}\text{Trt4}_{ij}t_{ij}^2  + \\
&amp;b_{0,i} + b_{1,i}t_{ij}
\end{aligned}
\]</span></p>
<p>We are interested in seeing if the change in log-transformed CD4 counts (log(CD4 counts + 1)) from baseline varied between treatment groups, with increased interest in the effect of the dual vs triple combination treatments. Based on this model, we have statistically significant interaction terms that indicate that the time trend of log(1 + CD4 counts) varies by treatment group.</p>
<p>From the <code>fitaids6</code> model, we conclude that the change in log(1 + CD4 counts) from baseline varies by treatment groups, with a non-linear trend, particularly for the triple therapy treatment (treatment 4). We also note that age is significantly associated with increased log(1 + CD4 counts), controlling for treatment allocation and the time effect.</p>
<p>We note that we are also interested in seeing if there is a difference between the dual and triple therapies. To investigate this hypothesis, we can create a new variable that represents the individual was assigned to treatment 4 (triple therapy) or not (dual).</p>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="introduction-to-longitudinal-data.html#cb626-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create triple treatment indicator</span></span>
<span id="cb626-2"><a href="introduction-to-longitudinal-data.html#cb626-2" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>triple <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(aidsdat<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb626-3"><a href="introduction-to-longitudinal-data.html#cb626-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-4"><a href="introduction-to-longitudinal-data.html#cb626-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create interaction terms</span></span>
<span id="cb626-5"><a href="introduction-to-longitudinal-data.html#cb626-5" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>inter_tripleweek <span class="ot">&lt;-</span> aidsdat<span class="sc">$</span>triple<span class="sc">*</span>aidsdat<span class="sc">$</span>week</span>
<span id="cb626-6"><a href="introduction-to-longitudinal-data.html#cb626-6" aria-hidden="true" tabindex="-1"></a>aidsdat<span class="sc">$</span>inter_tripleweeksq <span class="ot">&lt;-</span> aidsdat<span class="sc">$</span>triple<span class="sc">*</span>aidsdat<span class="sc">$</span>weeksq</span>
<span id="cb626-7"><a href="introduction-to-longitudinal-data.html#cb626-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-8"><a href="introduction-to-longitudinal-data.html#cb626-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-9"><a href="introduction-to-longitudinal-data.html#cb626-9" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model</span></span>
<span id="cb626-10"><a href="introduction-to-longitudinal-data.html#cb626-10" aria-hidden="true" tabindex="-1"></a>fitaids6_combtreatments <span class="ot">&lt;-</span> <span class="fu">lme</span>(</span>
<span id="cb626-11"><a href="introduction-to-longitudinal-data.html#cb626-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> logcount <span class="sc">~</span> week <span class="sc">+</span> weeksq <span class="sc">+</span> age <span class="sc">+</span></span>
<span id="cb626-12"><a href="introduction-to-longitudinal-data.html#cb626-12" aria-hidden="true" tabindex="-1"></a>    inter_tripleweek <span class="sc">+</span> inter_tripleweeksq, <span class="co"># specify fixed effects</span></span>
<span id="cb626-13"><a href="introduction-to-longitudinal-data.html#cb626-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> week <span class="sc">|</span> id, <span class="co"># random slope on time variable,</span></span>
<span id="cb626-14"><a href="introduction-to-longitudinal-data.html#cb626-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intercept is included by default</span></span>
<span id="cb626-15"><a href="introduction-to-longitudinal-data.html#cb626-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> aidsdat,</span>
<span id="cb626-16"><a href="introduction-to-longitudinal-data.html#cb626-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;ML&quot;</span></span>
<span id="cb626-17"><a href="introduction-to-longitudinal-data.html#cb626-17" aria-hidden="true" tabindex="-1"></a>) <span class="co"># default unstructured correlation for</span></span>
<span id="cb626-18"><a href="introduction-to-longitudinal-data.html#cb626-18" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects and independence for within-subj correlation</span></span>
<span id="cb626-19"><a href="introduction-to-longitudinal-data.html#cb626-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-20"><a href="introduction-to-longitudinal-data.html#cb626-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-21"><a href="introduction-to-longitudinal-data.html#cb626-21" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fitaids6_combtreatments)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##   Data: aidsdat 
##        AIC      BIC    logLik
##   11976.54 12041.79 -5978.271
## 
## Random effects:
##  Formula: ~week | id
##  Structure: General positive-definite, Log-Cholesky parametrization
##             StdDev     Corr  
## (Intercept) 0.80201053 (Intr)
## week        0.01627928 0.185 
## Residual    0.57344311       
## 
## Fixed effects:  logcount ~ week + weeksq + age + inter_tripleweek + inter_tripleweeksq 
##                         Value  Std.Error   DF   t-value p-value
## (Intercept)         2.5502189 0.11869448 3723 21.485572  0.0000
## week               -0.0033565 0.00259880 3723 -1.291575  0.1966
## weeksq             -0.0003105 0.00007228 3723 -4.295298  0.0000
## age                 0.0103217 0.00306450 1307  3.368134  0.0008
## inter_tripleweek    0.0348610 0.00486959 3723  7.158933  0.0000
## inter_tripleweeksq -0.0006594 0.00013657 3723 -4.828543  0.0000
##  Correlation: 
##                    (Intr) week   weeksq age    inter_trplwk
## week               -0.072                                  
## weeksq              0.059 -0.923                           
## age                -0.974  0.005 -0.004                    
## inter_tripleweek    0.007 -0.487  0.454 -0.006             
## inter_tripleweeksq -0.005  0.451 -0.498  0.005 -0.919      
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -4.31270016 -0.44144321  0.03870598  0.48492477  3.58419390 
## 
## Number of Observations: 5036
## Number of Groups: 1309</code></pre>
<p>Under this parameterization, we do see that the interaction terms are individually significant. This indicates that there is a difference in time trend by dual versus triple therapy, controlling for age. For example, we see that the effect of time on the triple action treatment on log(CD4 counts + 1) is greater by 0.035 units compared to dual action therapy, controlling for age. We also see that the squared time effect interaction is significant but the effect size is small (-0.001). We can interpret this that the effect of the squared time term on log(CD4 counts + 1) is smaller by 0.001 units for the triple action therapy compared to dual action therapy controlling for other factors.</p>
<p>We can see if this model is more adequate, indicating that treatments 1, 2, and 3 have the same treatment effect over time.</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="introduction-to-longitudinal-data.html#cb628-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fitaids6, fitaids6_combtreatments)</span></code></pre></div>
<pre><code>##                         Model df      AIC      BIC    logLik   Test  L.Ratio
## fitaids6                    1 14 11971.88 12063.22 -5971.940                
## fitaids6_combtreatments     2 10 11976.54 12041.79 -5978.271 1 vs 2 12.66315
##                         p-value
## fitaids6                       
## fitaids6_combtreatments   0.013</code></pre>
<p>We reject the null hypothesis that the model that combines treatments 1, 2 and 3 is adequate compared to the original model. This indicates that there exists at least one dual-treatment therapy that has a different time effect on the log(1 + CD4 counts). Looking at the LOESS curves from Figure <a href="introduction-to-longitudinal-data.html#fig:long-lme-ex3-ggplotloess">6.24</a>, this is unsurprising as treatment 3 appears to have a different time trend than treatments 1 and 2, which are similar.</p>
<!-- ## Generalized Estimating Equations {#long-gee} -->
</div>
</div>
<div id="long-glmm" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Generalized Linear Mixed-Effects Models<a href="introduction-to-longitudinal-data.html#long-glmm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As seen in the previous section, linear mixed effect models are useful for analyzing relationships between normally distributed outcomes and covariates over time. However, we are often interested in non-normal longitudinal outcomes, such as skewed, binary, or count outcomes. To handle these outcomes, we can use the generalized linear mixed-effects model (GLMM, or sometimes referred to as a GLMEM), which is an generalization of the linear mixed effect model presented in Section <a href="introduction-to-longitudinal-data.html#long-linearmixed">6.4</a>.</p>
<p>Like the linear mixed-effects model, GLMMs again allow a subset of the regression parameters to vary randomly between the subjects to account for sources of natural heterogeneity in the population. GLMMs model the mean response as a combination of the population characteristics (which are assumed to be the same for all subjects), and the unique subject-specific characteristics for each subject. We allow for this by including random effects <span class="math inline">\(\boldsymbol{b}_i\)</span> (sometimes referred to as the subject-specific regression coefficients) along with the usual population coefficients or “fixed effects” <span class="math inline">\(\boldsymbol{\beta}\)</span> in the model. Readers are directed to Section <a href="introduction-to-longitudinal-data.html#long-linearmixed">6.4</a> for more information on fixed and random effects.</p>
<p>The GLMM can also be viewed as an extension of the generalized linear model (GLM), which was presented in Section <a href="glm.html#glm">4</a>. It will be beneficial for readers unfamiliar with GLMs to read Section <a href="glm.html#glm">4</a> as we will assume readers have a basic understanding of GLMs in this section.</p>
<div id="long-glmm-notation" class="section level3 hasAnchor" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Notation and Model Specification<a href="introduction-to-longitudinal-data.html#long-glmm-notation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We follow the notation presented in <a href="introduction-to-longitudinal-data.html#long-linearmixed-notation">6.4.1</a>, where</p>
<ul>
<li><span class="math inline">\(Y_{ij}\)</span> is the response of individual <span class="math inline">\(i\)</span> at time <span class="math inline">\(j\)</span>,</li>
<li><span class="math inline">\(\bm{x}_{ij}\)</span> is a <span class="math inline">\(p \times 1\)</span> covariate vector for the fixed effects,</li>
<li><span class="math inline">\(\bm{\beta}\)</span> is the vector of parameters for the fixed effects,</li>
<li><span class="math inline">\(\bm{z}_{ij}\)</span> is a <span class="math inline">\(q \times 1\)</span> covariate vector for the random effects, and</li>
<li><span class="math inline">\(\bm{b}_{ij}\)</span> is a vector of parameters for the random effects.</li>
</ul>
<p>Typically we assume the covariate vector for the random effects <span class="math inline">\(\bm{z}\)</span> is a subset of the fixed effects <span class="math inline">\(\bm{x}\)</span>. also allow the number of observations for subject <span class="math inline">\(i\)</span> to vary. We denote the number of observation for subject <span class="math inline">\(i\)</span> as <span class="math inline">\(k_i\)</span>.</p>
<p>We extend the linear mixed effect model to the general setting by introducing a three-part specification, as introduced in <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span>:</p>
<ol style="list-style-type: decimal">
<li><p>We assume that the conditional distribution of <span class="math inline">\(Y_{ij}\)</span> given the random effects <span class="math inline">\(b_i\)</span> belongs to the <a href="https://en.wikipedia.org/wiki/Exponential_family">exponential family of distributions</a>. We further assume that the conditional variance <span class="math inline">\(\var(Y_{ij} | b_i) = v(E(Y_{ij}|b_i)\)</span> is a function of the conditional mean where <span class="math inline">\(v(\cdot)\)</span> is a known variance function. We also assume that outcomes <span class="math inline">\(Y_{ij}\)</span> are conditionally independent of one another given the random effects.</p></li>
<li><p>We assume that the conditional mean is dependent on the fixed and random effects through
<span class="math display">\[
g(E(Y_{ij} | b_i)) = \eta_{ij}  = \bm{x}_{ij}^T\bm{\beta} + \bm{z}_{ij}^T\bm{b}_{i}
\]</span>
where <span class="math inline">\(g(\cdot)\)</span> is some known <a href="https://en.wikipedia.org/wiki/Generalized_linear_model#Link_function">link function</a> (see Section <a href="glm.html#glm-links">4.3.2</a> for more information and examples of link functions). We emphasize that there is no random error term here as we are modelling the conditional mean.</p></li>
<li><p>We assume the random effects have some probability distribution (typically a multivariate normal distribution with zero mean and a <span class="math inline">\(q \times q\)</span> covariance matrix <span class="math inline">\(D\)</span>). We also assume the random effects <span class="math inline">\(\bm{b}_i\)</span> are independent of the covariates <span class="math inline">\(\bm{x}_i\)</span>.</p></li>
</ol>
<p>These three components together formulate the generalized linear mixed-effects model <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span>. The choice of link function (based on the observed data) will dictate how we interpret the model, similar to our usual GLM. For example, if we have binary outcome data, we would fit a logistic mixed-effects model for the conditional mean using the logit link. If we have count data, we would specify a log-linear mixed-effects model for the conditional mean using the log link. Model interpretations differ from the GLM and the linear mixed effects model and are discussed in the following sections.</p>
</div>
<div id="long-glmm-R" class="section level3 hasAnchor" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> Modelling in R<a href="introduction-to-longitudinal-data.html#long-glmm-R" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this section, we describe how to fit generalized linear mixed-effects models in R. We will be using the <code>glmer()</code> function from the <a href="https://CRAN.R-project.org/package=lme4"><strong>lme4</strong></a> package. This function requires the data to be in long form (see Section <a href="introduction-to-longitudinal-data.html#long-datastruc">6.2</a> for details on long versus wide form longitudinal data). GLMMs can also be fit using the <a href="https://CRAN.R-project.org/package=glmm"><strong>glmm</strong></a> package in R. There are a number of important arguments in this function:</p>
<ul>
<li><code>formula</code>: the two-sided linear formula object describing both the fixed and random effects in the model, written as <code>response ~ fixed effec1 + fixed effect1 + ... + 1(subject) + (time|subject)</code> where <code>(1|subject)</code> is the random intercept grouped by subject and <code>(time|subject)</code> is an example of a random slope on time grouped by subject.</li>
<li><code>family</code>: similar to in a GLM, the name of the exponential family distribution and the link function. For example, for a binary data we may specify <code>family = binomial(link = "logit")</code>.</li>
<li><code>nAGQ</code>: the argument for the number of quadrature points to be used for the approximation (adaptive Gaussian quadrature approximation). We need to use numerical approximation methods as the likelihood function under a GLMM is high-dimensional and complicated to solve for. When <code>nAGQ = 1</code>, we use Laplace approximation. We can specify <code>nAGQ</code> larger than one only for GLMMs with single random effect terms. The larger the value, the more accurate the approximation. However, computational complexity will increase as we increase the value of <code>nAGQ</code>.</li>
</ul>
<p>As this function only allows for approximation by adaptive Gaussian quadrature, we often see GLMMs fit using SAS software’s built-in GLIMMIX procedure. Readers interested in fitting GLMMs in SAS are directed <a href="https://support.sas.com/documentation/onlinedoc/stat/131/glimmix.pdf">here</a>.</p>
<p>We will demonstrate how to fit this model using data from a randomized clinical trial investigating the effect of an anti-epileptic drug Progabide, as shown in <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span>. 59 patients suffering from epilepsy were randomly assigned to Progabide or a placebo and followed for 8 weeks. The number of seizures occurring in each 2-week interval since randomization were recorded. We also have baseline seizure counts for the 8 weeks prior to being randomized. We want to see if using Progabide reduced the number of seizures, compared to the placebo. We wish to model the population and subject-specific trend, and see if there is a difference in seizure rates between the Progabide and placebo groups after randomization.</p>
<p>We first load in this data set from the R package <a href="https://CRAN.R-project.org/package=HSAUR2"><strong>HSAUR2</strong></a> and look at the first 6 observations by:</p>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="introduction-to-longitudinal-data.html#cb630-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load in the data set</span></span>
<span id="cb630-2"><a href="introduction-to-longitudinal-data.html#cb630-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;epilepsy&quot;</span>)</span>
<span id="cb630-3"><a href="introduction-to-longitudinal-data.html#cb630-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb630-4"><a href="introduction-to-longitudinal-data.html#cb630-4" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the first 6 observations</span></span>
<span id="cb630-5"><a href="introduction-to-longitudinal-data.html#cb630-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(epilepsy)</span></code></pre></div>
<pre><code>##     treatment base age seizure.rate period subject
## 1     placebo   11  31            5      1       1
## 110   placebo   11  31            3      2       1
## 112   placebo   11  31            3      3       1
## 114   placebo   11  31            3      4       1
## 2     placebo   11  30            3      1       2
## 210   placebo   11  30            5      2       2</code></pre>
<p>This data set (which is already in long form) contains information on the treatment that each subject was randomized to (<code>treatment</code>), the baseline number of seizures in the 8 weeks before receiving treatment or placebo (<code>base</code>), baseline age (<code>age</code>), the number of seizures during each 2-week interval (<code>seizure.rate</code> for each <code>period</code>), and a subject indicator (<code>subject</code>). As <code>seizure.rate</code> is actually the count of seizures, and <code>age</code> is the baseline age at study entry, we rename these variable for clarity:</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="introduction-to-longitudinal-data.html#cb632-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load in the data set</span></span>
<span id="cb632-2"><a href="introduction-to-longitudinal-data.html#cb632-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(epilepsy) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;treatment&quot;</span>, <span class="st">&quot;base&quot;</span>, <span class="st">&quot;baseline_age&quot;</span>, <span class="st">&quot;seizure_count&quot;</span>, <span class="st">&quot;period&quot;</span>, <span class="st">&quot;subject&quot;</span>)</span></code></pre></div>
<p>We may want to include the baseline number of seizures in our data analysis, so we need to include this data in long form for <code>period = 0</code>. We can do this with some data manipulation by:</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="introduction-to-longitudinal-data.html#cb633-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change levels of period to be 0-4, keep as categorical factor</span></span>
<span id="cb633-2"><a href="introduction-to-longitudinal-data.html#cb633-2" aria-hidden="true" tabindex="-1"></a>epilepsy<span class="sc">$</span>period  <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="at">x =</span> epilepsy<span class="sc">$</span>period, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>), <span class="at">ordered =</span> T)</span>
<span id="cb633-3"><a href="introduction-to-longitudinal-data.html#cb633-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb633-4"><a href="introduction-to-longitudinal-data.html#cb633-4" aria-hidden="true" tabindex="-1"></a><span class="co"># copy one row per subject (here we chose period == 1)</span></span>
<span id="cb633-5"><a href="introduction-to-longitudinal-data.html#cb633-5" aria-hidden="true" tabindex="-1"></a>newdf <span class="ot">&lt;-</span> epilepsy[epilepsy<span class="sc">$</span>period <span class="sc">==</span> <span class="dv">1</span>, ]</span>
<span id="cb633-6"><a href="introduction-to-longitudinal-data.html#cb633-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb633-7"><a href="introduction-to-longitudinal-data.html#cb633-7" aria-hidden="true" tabindex="-1"></a><span class="co"># update the value of period to be zero and the value of </span></span>
<span id="cb633-8"><a href="introduction-to-longitudinal-data.html#cb633-8" aria-hidden="true" tabindex="-1"></a><span class="co"># seizure.rate to be the baseline</span></span>
<span id="cb633-9"><a href="introduction-to-longitudinal-data.html#cb633-9" aria-hidden="true" tabindex="-1"></a>newdf<span class="sc">$</span>period <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb633-10"><a href="introduction-to-longitudinal-data.html#cb633-10" aria-hidden="true" tabindex="-1"></a>newdf<span class="sc">$</span>seizure_count <span class="ot">&lt;-</span> newdf<span class="sc">$</span>base</span>
<span id="cb633-11"><a href="introduction-to-longitudinal-data.html#cb633-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb633-12"><a href="introduction-to-longitudinal-data.html#cb633-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add this data frame to the existing one</span></span>
<span id="cb633-13"><a href="introduction-to-longitudinal-data.html#cb633-13" aria-hidden="true" tabindex="-1"></a>epilepsy <span class="ot">&lt;-</span> <span class="fu">rbind</span>(epilepsy, newdf)</span>
<span id="cb633-14"><a href="introduction-to-longitudinal-data.html#cb633-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb633-15"><a href="introduction-to-longitudinal-data.html#cb633-15" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the data by ID (change to numeric first) then period</span></span>
<span id="cb633-16"><a href="introduction-to-longitudinal-data.html#cb633-16" aria-hidden="true" tabindex="-1"></a>epilepsy <span class="ot">&lt;-</span> epilepsy[<span class="fu">order</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(epilepsy<span class="sc">$</span>subject)), epilepsy<span class="sc">$</span>period), ]</span>
<span id="cb633-17"><a href="introduction-to-longitudinal-data.html#cb633-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb633-18"><a href="introduction-to-longitudinal-data.html#cb633-18" aria-hidden="true" tabindex="-1"></a><span class="co">#view first 6 observations</span></span>
<span id="cb633-19"><a href="introduction-to-longitudinal-data.html#cb633-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(epilepsy)</span></code></pre></div>
<pre><code>##     treatment base baseline_age seizure_count period subject
## 116   placebo   11           31            11      0       1
## 1     placebo   11           31             5      1       1
## 110   placebo   11           31             3      2       1
## 112   placebo   11           31             3      3       1
## 114   placebo   11           31             3      4       1
## 216   placebo   11           30            11      0       2</code></pre>
<p>We note that the column <code>base</code> is now no longer needed as the information is stored in <code>seizure.rate</code> for <code>period = 0</code>. We first plot the individual trajectories using <code>ggplot()</code> from the <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> package:</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="introduction-to-longitudinal-data.html#cb635-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a plot of individual trajectories over the period, faceted by treatment</span></span>
<span id="cb635-2"><a href="introduction-to-longitudinal-data.html#cb635-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> epilepsy, <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> seizure_count, <span class="at">group =</span> subject, <span class="at">color =</span> treatment)) <span class="sc">+</span></span>
<span id="cb635-3"><a href="introduction-to-longitudinal-data.html#cb635-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb635-4"><a href="introduction-to-longitudinal-data.html#cb635-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> treatment) <span class="sc">+</span></span>
<span id="cb635-5"><a href="introduction-to-longitudinal-data.html#cb635-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Spaghetti Plot for Epilepsy (Stratified by Treatment)&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-glmm-spaghettiplotdent"></span>
<img src="topics_in_consulting_files/figure-html/long-glmm-spaghettiplotdent-1.png" alt="Plot of individual trajectories for the number of seizures over time, stratified by treatment group." width="672" />
<p class="caption">
Figure 6.32: Plot of individual trajectories for the number of seizures over time, stratified by treatment group.
</p>
</div>
<p>The population trend is not very clear from these plots. We can calculate the mean number of seizures at each time group for each of the placebo and Progabide groups, and plot them. We can do so in R by the following code:</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="introduction-to-longitudinal-data.html#cb636-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create data set with the means</span></span>
<span id="cb636-2"><a href="introduction-to-longitudinal-data.html#cb636-2" aria-hidden="true" tabindex="-1"></a>gd <span class="ot">&lt;-</span> epilepsy <span class="sc">%&gt;%</span> </span>
<span id="cb636-3"><a href="introduction-to-longitudinal-data.html#cb636-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(treatment, period) <span class="sc">%&gt;%</span> </span>
<span id="cb636-4"><a href="introduction-to-longitudinal-data.html#cb636-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">seizure_count =</span> <span class="fu">mean</span>(seizure_count))</span>
<span id="cb636-5"><a href="introduction-to-longitudinal-data.html#cb636-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb636-6"><a href="introduction-to-longitudinal-data.html#cb636-6" aria-hidden="true" tabindex="-1"></a><span class="co"># create above plot with average trend plotted overtop</span></span>
<span id="cb636-7"><a href="introduction-to-longitudinal-data.html#cb636-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(epilepsy, <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> seizure_count, <span class="at">color =</span> treatment)) <span class="sc">+</span></span>
<span id="cb636-8"><a href="introduction-to-longitudinal-data.html#cb636-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> subject), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span> <span class="co">#alpha = 0.3 makes the lines more transparent</span></span>
<span id="cb636-9"><a href="introduction-to-longitudinal-data.html#cb636-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> gd, <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> seizure_count, <span class="at">group =</span> treatment), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb636-10"><a href="introduction-to-longitudinal-data.html#cb636-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb636-11"><a href="introduction-to-longitudinal-data.html#cb636-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Epileptic Seizure Rates by Treatment Group&quot;</span>,</span>
<span id="cb636-12"><a href="introduction-to-longitudinal-data.html#cb636-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Period&quot;</span>,</span>
<span id="cb636-13"><a href="introduction-to-longitudinal-data.html#cb636-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Seizure Count&quot;</span>,</span>
<span id="cb636-14"><a href="introduction-to-longitudinal-data.html#cb636-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span></span>
<span id="cb636-15"><a href="introduction-to-longitudinal-data.html#cb636-15" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="topics_in_consulting_files/figure-html/long-glmm-meantrend-1.png" width="672" /></p>
<p>The trend lines on this scale are difficult to see individually, so we can plot them without the individual data points.</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="introduction-to-longitudinal-data.html#cb637-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot just the means</span></span>
<span id="cb637-2"><a href="introduction-to-longitudinal-data.html#cb637-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(epilepsy, <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> seizure_count, <span class="at">color =</span> treatment)) <span class="sc">+</span></span>
<span id="cb637-3"><a href="introduction-to-longitudinal-data.html#cb637-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> gd, <span class="fu">aes</span>(<span class="at">x =</span> period, <span class="at">y =</span> seizure_count, <span class="at">group =</span> treatment), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb637-4"><a href="introduction-to-longitudinal-data.html#cb637-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb637-5"><a href="introduction-to-longitudinal-data.html#cb637-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Epileptic Seizure Rates by Treatment Group&quot;</span>,</span>
<span id="cb637-6"><a href="introduction-to-longitudinal-data.html#cb637-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Period&quot;</span>,</span>
<span id="cb637-7"><a href="introduction-to-longitudinal-data.html#cb637-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Seizure Count&quot;</span>,</span>
<span id="cb637-8"><a href="introduction-to-longitudinal-data.html#cb637-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span></span>
<span id="cb637-9"><a href="introduction-to-longitudinal-data.html#cb637-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="topics_in_consulting_files/figure-html/long-glmm-meantrend2-1.png" width="672" /></p>
<p>On this scale, we see that the trends appear to differ between the treatment (Progabide) and control (placebo) groups after period 1, when the treatment was randomized. As we have baseline data for seizure counts prior to randomization, it will be useful to perform a pre-post analysis to see how the seizure rate differed before and after treatment.</p>
<p>For this analysis, as we are modelling count data, we will use a log-linear mixed effects model. That is, we want to model
<span class="math display">\[
\log(\mu_{ij}) = \log(E(Y_{ij} | b_i)) = \bm{x}_{ij}^T\bm{\beta} + \bm{z}_{ij}^T\bm{b}_i.
\]</span></p>
<p>One thing we have to be cautious of is the length of periods that seizure counts were observed. Although after the treatment was randomized we have equal 2 week long intervals, the first interval (prior to treatment) is 8 weeks long. We must account for this different in our analysis. The log-linear (Poisson) GLMM will allow us to account for some heterogeneity in the counts of the outcome based on unequal interval lengths. Recall for Poisson models that we can model the mean as <span class="math inline">\(\mu_{ij} = \lambda_{ij}\times t_{ij}\)</span> where <span class="math inline">\(\lambda_{ij}\)</span> is the rate of seizures in a given time interval and <span class="math inline">\(t_{ij}\)</span> is the length of the interval. Using this, we can re-write above model as
<span class="math display">\[
\begin{aligned}
\log(\mu_{ij}) &amp;= \log(\lambda_{ij}\times t_{ij})\\
&amp;= \log(\lambda_{ij}) + log(t_{ij})\\
&amp;= \bm{x}_{ij}^T\bm{\beta} + \bm{z}_{ij}^T\bm{b}_i + \log(t_{ij}).
\end{aligned}
\]</span>
That is, we account for the irregularity in the length of time intervals pre- and post- treatment by using an offset term of <span class="math inline">\(\log(t_{ij})\)</span>. We note that not all Poisson or count models will require an offset term if our intervals remain the same.</p>
<p>We start with a model random slope and intercept model of the form:
<span class="math display">\[
\begin{aligned}
\log(\mu_{ij}) = \beta_0 + \beta_1\text{post}_{ij} &amp;+ \beta_2\text{trt}_{i} + \beta_3\text{post}_{ij}\text{trt}_{i} + \beta_4\text{baseage}_i \\
&amp;+ b_{0,i} + b_{1,i}\text{post}_{ij} + \log(t_{ij})
\end{aligned}
\]</span>
where
- <span class="math inline">\(trt_i\)</span> is the treatment subject <span class="math inline">\(i\)</span> was randomized to
- <span class="math inline">\(\text{post}_{ij}\)</span> indicates the period is 1, 2, 3, or 4 (post-randomization)
- <span class="math inline">\(\text{baseage}_i\)</span> is the baseline age of subject <span class="math inline">\(i\)</span>
- <span class="math inline">\(t_{ij}\)</span> is the length of the observation period for period <span class="math inline">\(j\)</span> (period 0 is eight weeks, periods 1 - 4 are two weeks).</p>
<p>We are looking only at the time effect as pre- and post- randomization because the average group trend is relatively stable across time after randomization. We allow for an interaction effect between <span class="math inline">\(trt\)</span> and <span class="math inline">\(post\)</span> because there will likely be a difference in seizure rates before and after randomization (after period 0) which may differ by the treatment group. We allow for a random intercept <span class="math inline">\(b_{0,i}\)</span> as in the above plots we see that individuals tend to have different baseline seizure counts. We also allow for a random effect on <span class="math inline">\(post\)</span> as individual subjects may see different time trends after randomization.</p>
<p>We note that this model may change as we perform statistical tests to see which covariates should be included or excluded in the model.</p>
<p>Prior to fitting this model in R, we need to include a categorical variable indicating we are post randomization, and also the information on the time period length in our data set. We will need to use the <span class="math inline">\(\log()\)</span> of this time so we will calculate that as well and include it as its own column:</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="introduction-to-longitudinal-data.html#cb638-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if period &gt; 0, we are post randomization</span></span>
<span id="cb638-2"><a href="introduction-to-longitudinal-data.html#cb638-2" aria-hidden="true" tabindex="-1"></a>epilepsy<span class="sc">$</span>post <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(epilepsy<span class="sc">$</span>period <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb638-3"><a href="introduction-to-longitudinal-data.html#cb638-3" aria-hidden="true" tabindex="-1"></a>epilepsy<span class="sc">$</span> post <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(epilepsy<span class="sc">$</span>post)</span>
<span id="cb638-4"><a href="introduction-to-longitudinal-data.html#cb638-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-5"><a href="introduction-to-longitudinal-data.html#cb638-5" aria-hidden="true" tabindex="-1"></a><span class="co"># if period is 0, tlength is 8. otherwise it is 2</span></span>
<span id="cb638-6"><a href="introduction-to-longitudinal-data.html#cb638-6" aria-hidden="true" tabindex="-1"></a>epilepsy<span class="sc">$</span>tlength <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(epilepsy<span class="sc">$</span>period <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">8</span>, <span class="dv">2</span>)</span>
<span id="cb638-7"><a href="introduction-to-longitudinal-data.html#cb638-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-8"><a href="introduction-to-longitudinal-data.html#cb638-8" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate and store the log of the length</span></span>
<span id="cb638-9"><a href="introduction-to-longitudinal-data.html#cb638-9" aria-hidden="true" tabindex="-1"></a>epilepsy<span class="sc">$</span>logtlength <span class="ot">&lt;-</span> <span class="fu">log</span>(epilepsy<span class="sc">$</span>tlength)</span></code></pre></div>
<p>We fit this model in R using the following code:</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="introduction-to-longitudinal-data.html#cb639-1" aria-hidden="true" tabindex="-1"></a>epilepsy_fit1 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(seizure_count <span class="sc">~</span> post <span class="sc">+</span> treatment <span class="sc">+</span> treatment<span class="sc">*</span>post <span class="sc">+</span> baseline_age <span class="sc">+</span></span>
<span id="cb639-2"><a href="introduction-to-longitudinal-data.html#cb639-2" aria-hidden="true" tabindex="-1"></a>                         (<span class="dv">1</span> <span class="sc">+</span> post <span class="sc">|</span> subject) <span class="sc">+</span> <span class="fu">offset</span>(logtlength),</span>
<span id="cb639-3"><a href="introduction-to-longitudinal-data.html#cb639-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> epilepsy,</span>
<span id="cb639-4"><a href="introduction-to-longitudinal-data.html#cb639-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb639-5"><a href="introduction-to-longitudinal-data.html#cb639-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-6"><a href="introduction-to-longitudinal-data.html#cb639-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(epilepsy_fit1)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: poisson  ( log )
## Formula: seizure_count ~ post + treatment + treatment * post + baseline_age +  
##     (1 + post | subject) + offset(logtlength)
##    Data: epilepsy
## 
##      AIC      BIC   logLik deviance df.resid 
##   1863.3   1892.8   -923.6   1847.3      287 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.1367 -0.7203 -0.0730  0.5164  6.9634 
## 
## Random effects:
##  Groups  Name        Variance Std.Dev. Corr
##  subject (Intercept) 0.4812   0.6937       
##          post1       0.2305   0.4801   0.21
## Number of obs: 295, groups:  subject, 59
## 
## Fixed effects:
##                           Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)               1.719624   0.466831   3.684  0.00023 ***
## post1                    -0.007713   0.108940  -0.071  0.94356    
## treatmentProgabide        0.017662   0.190602   0.093  0.92617    
## baseline_age             -0.022232   0.015334  -1.450  0.14712    
## post1:treatmentProgabide -0.302923   0.150144  -2.018  0.04364 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) post1  trtmnP bsln_g
## post1       -0.008                     
## trtmntPrgbd -0.322 -0.035              
## baseline_ag -0.955  0.022  0.114       
## pst1:trtmnP  0.007 -0.710  0.057 -0.019</code></pre>
<p>For this model, we see that the interaction effect is statistically significant. The individual components of the interaction are not significant, and neither is the covariate <code>baseline_age</code>. Let’s try to re-fit the model without baseline age as a covariate. We can also see if this model fits better than the previous by performing a likelihood ratio test (LRT) since we have the same random effects in the model and only removed a fixed effect.</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="introduction-to-longitudinal-data.html#cb641-1" aria-hidden="true" tabindex="-1"></a>epilepsy_fit2 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(seizure_count <span class="sc">~</span>post <span class="sc">+</span> treatment <span class="sc">+</span>  treatment<span class="sc">*</span>post <span class="sc">+</span></span>
<span id="cb641-2"><a href="introduction-to-longitudinal-data.html#cb641-2" aria-hidden="true" tabindex="-1"></a>                         (<span class="dv">1</span> <span class="sc">+</span> post <span class="sc">|</span> subject) <span class="sc">+</span> <span class="fu">offset</span>(logtlength),</span>
<span id="cb641-3"><a href="introduction-to-longitudinal-data.html#cb641-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> epilepsy,</span>
<span id="cb641-4"><a href="introduction-to-longitudinal-data.html#cb641-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb641-5"><a href="introduction-to-longitudinal-data.html#cb641-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb641-6"><a href="introduction-to-longitudinal-data.html#cb641-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(epilepsy_fit1, epilepsy_fit2, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Data: epilepsy
## Models:
## epilepsy_fit2: seizure_count ~ post + treatment + treatment * post + (1 + post | subject) + offset(logtlength)
## epilepsy_fit1: seizure_count ~ post + treatment + treatment * post + baseline_age + (1 + post | subject) + offset(logtlength)
##               npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)
## epilepsy_fit2    7 1863.3 1889.2 -924.67   1849.3                     
## epilepsy_fit1    8 1863.3 1892.8 -923.64   1847.3 2.0558  1     0.1516</code></pre>
<p>The LRT has a <span class="math inline">\(p\)</span>-value of 0.1516, which is moderately large. As such, we fail to reject the null hypothesis that the simpler model (without baseline age) fits as well as the larger model. As such, we conclude that we do not need baseline age in our model. Let’s look at the model summary:</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="introduction-to-longitudinal-data.html#cb643-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(epilepsy_fit2)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: poisson  ( log )
## Formula: seizure_count ~ post + treatment + treatment * post + (1 + post |  
##     subject) + offset(logtlength)
##    Data: epilepsy
## 
##      AIC      BIC   logLik deviance df.resid 
##   1863.3   1889.1   -924.7   1849.3      288 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.1388 -0.7118 -0.0607  0.5189  6.9652 
## 
## Random effects:
##  Groups  Name        Variance Std.Dev. Corr
##  subject (Intercept) 0.4999   0.7070       
##          post1       0.2319   0.4815   0.17
## Number of obs: 295, groups:  subject, 59
## 
## Fixed effects:
##                           Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)               1.071299   0.140268   7.638 2.21e-14 ***
## post1                    -0.002394   0.109092  -0.022   0.9825    
## treatmentProgabide        0.049481   0.192717   0.257   0.7974    
## post1:treatmentProgabide -0.307159   0.150452  -2.042   0.0412 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) post1  trtmnP
## post1        0.016              
## trtmntPrgbd -0.725 -0.017       
## pst1:trtmnP -0.018 -0.709  0.030</code></pre>
<p>From the summary of the second fit, we see that the individual effects of treatment and post-randomization have large <span class="math inline">\(p\)</span>-values. Lets see if we can remove the individual treatment effect from the model, as it is not included in our random effects.</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="introduction-to-longitudinal-data.html#cb645-1" aria-hidden="true" tabindex="-1"></a><span class="co">#using : provides only the interaction effect and not the individual ones</span></span>
<span id="cb645-2"><a href="introduction-to-longitudinal-data.html#cb645-2" aria-hidden="true" tabindex="-1"></a>epilepsy_fit3 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(seizure_count <span class="sc">~</span> post <span class="sc">+</span> treatment<span class="sc">:</span>post <span class="sc">+</span> </span>
<span id="cb645-3"><a href="introduction-to-longitudinal-data.html#cb645-3" aria-hidden="true" tabindex="-1"></a>                         (<span class="dv">1</span> <span class="sc">+</span> post <span class="sc">|</span> subject) <span class="sc">+</span> <span class="fu">offset</span>(logtlength),</span>
<span id="cb645-4"><a href="introduction-to-longitudinal-data.html#cb645-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> epilepsy,</span>
<span id="cb645-5"><a href="introduction-to-longitudinal-data.html#cb645-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb645-6"><a href="introduction-to-longitudinal-data.html#cb645-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb645-7"><a href="introduction-to-longitudinal-data.html#cb645-7" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(epilepsy_fit2, epilepsy_fit3, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Data: epilepsy
## Models:
## epilepsy_fit2: seizure_count ~ post + treatment + treatment * post + (1 + post | subject) + offset(logtlength)
## epilepsy_fit3: seizure_count ~ post + treatment:post + (1 + post | subject) + offset(logtlength)
##               npar    AIC    BIC  logLik deviance Chisq Df Pr(&gt;Chisq)
## epilepsy_fit2    7 1863.3 1889.2 -924.67   1849.3                    
## epilepsy_fit3    7 1863.3 1889.2 -924.67   1849.3     0  0</code></pre>
<p>For the test of <span class="math inline">\(H_0:\)</span> the simpler model fit is adequate, we reject the null hypothesis as our <span class="math inline">\(p\)</span>-value &lt; 0.001. That is, we conclude that our model should have the individual treatment effect term in the model and fit3 is not adequate compared to fit 2.</p>
</div>
<div id="model-diagnostics-long-glmm-md" class="section level3 hasAnchor" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> Model Diagnostics {long-glmm-md}<a href="introduction-to-longitudinal-data.html#model-diagnostics-long-glmm-md" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Residual plots can be used to assess model fit, however we note that we do not assume normality of the residuals under non-identity links. Let’s look at the residuals of the second model fit:</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="introduction-to-longitudinal-data.html#cb647-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(epilepsy_fit2, <span class="at">id =</span> <span class="fl">0.005</span>)</span></code></pre></div>
<p><img src="topics_in_consulting_files/figure-html/long-glmm-fit2resid-1.png" width="672" /></p>
<p>It appears to that subject 25 has a very poor fit. Let’s look at fitting the model without this observation to see if it is influential.</p>
<div class="sourceCode" id="cb648"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb648-1"><a href="introduction-to-longitudinal-data.html#cb648-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create new data set without subject 25</span></span>
<span id="cb648-2"><a href="introduction-to-longitudinal-data.html#cb648-2" aria-hidden="true" tabindex="-1"></a>epilepsy2 <span class="ot">&lt;-</span> epilepsy[epilepsy<span class="sc">$</span>subject <span class="sc">!=</span> <span class="dv">25</span>, ]</span>
<span id="cb648-3"><a href="introduction-to-longitudinal-data.html#cb648-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-4"><a href="introduction-to-longitudinal-data.html#cb648-4" aria-hidden="true" tabindex="-1"></a><span class="co">#fit same model (fit2) on new data set</span></span>
<span id="cb648-5"><a href="introduction-to-longitudinal-data.html#cb648-5" aria-hidden="true" tabindex="-1"></a>epilepsy_fit4 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(seizure_count <span class="sc">~</span>  post <span class="sc">+</span> treatment <span class="sc">+</span> treatment<span class="sc">*</span>post <span class="sc">+</span></span>
<span id="cb648-6"><a href="introduction-to-longitudinal-data.html#cb648-6" aria-hidden="true" tabindex="-1"></a>                         (<span class="dv">1</span> <span class="sc">+</span> post <span class="sc">|</span> subject) <span class="sc">+</span> <span class="fu">offset</span>(logtlength),</span>
<span id="cb648-7"><a href="introduction-to-longitudinal-data.html#cb648-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> epilepsy2,</span>
<span id="cb648-8"><a href="introduction-to-longitudinal-data.html#cb648-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb648-9"><a href="introduction-to-longitudinal-data.html#cb648-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(epilepsy_fit4)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: poisson  ( log )
## Formula: seizure_count ~ post + treatment + treatment * post + (1 + post |  
##     subject) + offset(logtlength)
##    Data: epilepsy2
## 
##      AIC      BIC   logLik deviance df.resid 
##   1771.7   1797.4   -878.9   1757.7      283 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.1304 -0.6826 -0.0622  0.5177  3.9566 
## 
## Random effects:
##  Groups  Name        Variance Std.Dev. Corr
##  subject (Intercept) 0.4965   0.7046       
##          post1       0.2137   0.4623   0.13
## Number of obs: 290, groups:  subject, 58
## 
## Fixed effects:
##                          Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)               1.04054    0.14257   7.298 2.91e-13 ***
## post1                    -0.04197    0.10857  -0.387   0.6991    
## treatmentProgabide        0.07870    0.19413   0.405   0.6852    
## post1:treatmentProgabide -0.25969    0.14818  -1.753   0.0797 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) post1  trtmnP
## post1       -0.024              
## trtmntPrgbd -0.731  0.012       
## pst1:trtmnP  0.012 -0.716 -0.009</code></pre>
<p>We see that the coefficients in the model changed greatly, indicating that subject 25 was an influential observation.</p>
<p>Let’s look at the new residual plot:</p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb650-1"><a href="introduction-to-longitudinal-data.html#cb650-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(epilepsy_fit4, <span class="at">id =</span> <span class="fl">0.001</span>)</span></code></pre></div>
<p><img src="topics_in_consulting_files/figure-html/long-glmm-fit4resid-1.png" width="672" /></p>
<p>We can also look at the fit of the model, stratified by treatment group using the following plot:</p>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="introduction-to-longitudinal-data.html#cb651-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(epilepsy_fit4, seizure_count <span class="sc">~</span> <span class="fu">fitted</span>(.)<span class="sc">|</span>treatment, <span class="at">abline =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb651-2"><a href="introduction-to-longitudinal-data.html#cb651-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Observed vs. Fitted Values&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:long-glmm-plot1"></span>
<img src="topics_in_consulting_files/figure-html/long-glmm-plot1-1.png" alt="Plot of observed versus fitted values for fit 4, stratified by treatment" width="672" />
<p class="caption">
Figure 6.33: Plot of observed versus fitted values for fit 4, stratified by treatment
</p>
</div>
<p>We see good concordance between the fitted and observed values in the model.</p>
<p>From this model, we should also check for <a href="https://en.wikipedia.org/wiki/Overdispersion">overdispersion</a> (see Section <a href="glm.html#glm-poisson-example-md">4.8.1.2</a> for more information on overdispersion). We can do this by using the <code>check_overdispersion()</code> function from the <a href="https://CRAN.R-project.org/package=performance"><strong>performance</strong></a> package.</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="introduction-to-longitudinal-data.html#cb652-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_overdispersion</span>(epilepsy_fit4)</span></code></pre></div>
<pre><code>## # Overdispersion test
## 
##        dispersion ratio =   1.139
##   Pearson&#39;s Chi-Squared = 322.375
##                 p-value =   0.054</code></pre>
<pre><code>## No overdispersion detected.</code></pre>
<p>The results of the test show a small to moderate <span class="math inline">\(p\)</span>-value, on the threshold of a commonly used significance cut off of <span class="math inline">\(p &lt; 0.05\)</span>. We will fail to reject the null hypothesis as we do not have strong evidence of overdispersion here with a <span class="math inline">\(p\)</span>-value of 0.054. That is, we can continue using this model.</p>
<p>We also note that currently accounting for overdispersion using a negative binomial distribution for the GLMM is not currently supported in the <code>glmer()</code> function. Users are able to fit these models using SAS.</p>
</div>
<div id="long-glmm-interpret" class="section level3 hasAnchor" number="6.5.4">
<h3><span class="header-section-number">6.5.4</span> Model Interpretations<a href="introduction-to-longitudinal-data.html#long-glmm-interpret" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When interpreting generalized linear mixed-effects models, the regression parameters <span class="math inline">\(\bm{\beta}\)</span> have different interpretations than models that have previously been introduced. These coefficients have subject-specific interpretations instead of population interpretations. Specifically, the regression coefficient represents the effect of a change in the within-subject covariate on the (transformed) mean response, holding all other covariates constant. For example, using a log link function would mean that <span class="math inline">\(\beta_j\)</span> represents the change in an individuals log relative rate of response for a one unit increase in <span class="math inline">\(x_j\)</span>, holding all the individuals covariates fixed (including the unobserved random effects). These interpretations are most useful when we want to look at subject-level changes, and not the population averages. We also note that these interpretations are most natural for covariates that vary within the subject.</p>
<p>When we have time-invariant covariates in the model, the interpretations of the regression coefficients are potentially misleading. For more information on this, see Section 14.3 in <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span>.</p>
<p>Recall the summary of the final model:</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="introduction-to-longitudinal-data.html#cb655-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(epilepsy_fit4)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: poisson  ( log )
## Formula: seizure_count ~ post + treatment + treatment * post + (1 + post |  
##     subject) + offset(logtlength)
##    Data: epilepsy2
## 
##      AIC      BIC   logLik deviance df.resid 
##   1771.7   1797.4   -878.9   1757.7      283 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.1304 -0.6826 -0.0622  0.5177  3.9566 
## 
## Random effects:
##  Groups  Name        Variance Std.Dev. Corr
##  subject (Intercept) 0.4965   0.7046       
##          post1       0.2137   0.4623   0.13
## Number of obs: 290, groups:  subject, 58
## 
## Fixed effects:
##                          Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)               1.04054    0.14257   7.298 2.91e-13 ***
## post1                    -0.04197    0.10857  -0.387   0.6991    
## treatmentProgabide        0.07870    0.19413   0.405   0.6852    
## post1:treatmentProgabide -0.25969    0.14818  -1.753   0.0797 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) post1  trtmnP
## post1       -0.024              
## trtmntPrgbd -0.731  0.012       
## pst1:trtmnP  0.012 -0.716 -0.009</code></pre>
<p>We can write the model as
<span class="math display">\[
\begin{aligned}
\log(\mu_{ij}) = \beta_0 + \beta_1\text{post}_{ij} &amp;+ \beta_2\text{trt}_{i} + \beta_3\text{post}_{ij}\text{trt}_{i}  \\
&amp;+ b_{0,i} + b_{1,i}\text{post}_{ij} + \log(t_{ij})
\end{aligned}
\]</span>
where</p>
<ul>
<li><span class="math inline">\(trt_i\)</span> is the treatment subject <span class="math inline">\(i\)</span> was randomized to</li>
<li><span class="math inline">\(\text{post}_{ij}\)</span> indicates the period is 1, 2, 3, or 4 (post-randomization)</li>
<li><span class="math inline">\(t_{ij}\)</span> is the length of the observation period for period <span class="math inline">\(j\)</span> (period 0 is eight weeks, periods 1 - 4 are two weeks).</li>
</ul>
<p>The following table may be helpful in summarizing the model and interpreting the coefficients:</p>
<table>
<colgroup>
<col width="36%" />
<col width="39%" />
<col width="24%" />
</colgroup>
<thead>
<tr class="header">
<th>Treatment Group</th>
<th align="center">Time</th>
<th align="right">Conditional Log RR given <span class="math inline">\(b_i\)</span> (adjusted for offset)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Placebo</td>
<td align="center">Pre-Randomization</td>
<td align="right"><span class="math inline">\(\beta_0 + b_{0,i}\)</span></td>
</tr>
<tr class="even">
<td></td>
<td align="center">Post-Randomization</td>
<td align="right"><span class="math inline">\((\beta_0 + b_{0,i}) + (\beta_1 + b_{1,i})\)</span></td>
</tr>
<tr class="odd">
<td>Progabide</td>
<td align="center">Pre-Randomization</td>
<td align="right"><span class="math inline">\(\beta_0 + b_{0,i} + \beta_2\)</span></td>
</tr>
<tr class="even">
<td></td>
<td align="center">Post-Randomization</td>
<td align="right"><span class="math inline">\(\beta_0 + b_{0,i} + (\beta_1 + b_{1,i}) + \beta_2 + \beta_3\)</span></td>
</tr>
</tbody>
</table>
<p>In this model, <span class="math inline">\(\exp(\beta_1) = \exp(-0.042) = 0.959\)</span> represents the relative rate of seizures per week for those post-randomization versus pre-randomization for the “average” patient in the placebo group (a patient with unobserved random slope <span class="math inline">\(b_{0,i} = E(b_{0,i}) = 0\)</span>). This result is not statistically significant.</p>
<p>We interpret <span class="math inline">\(\exp(\beta_2) = \exp(0.079) = 1.082\)</span> represents the increase in relative rate of seizures per week for those on Progabide versus placebo for the “average” patient in pre-randomization. We note that this result is also not statistically significant</p>
<p><span class="math inline">\(\exp(\beta_3) = \exp(-0.260) = 0.771\)</span> represents the increase in relative rate of seizures per week for post- versus pre-randomization comparing two patients: one from the Progabide group and one from the placebo group with the same unobserved random effects. We note that in this way, <span class="math inline">\(\beta_3\)</span> is not a population average like we have previously seen. With a <span class="math inline">\(p\)</span>-value or 0.0797, some may consider this result statistically significant depending on the definition of “significant”. We will refer to this value as moderately significant in this setting. As such, we conclude that there is evidence that the rate of seizures per week for post- versus pre- randomization was further reduced in the Progabide group, indicating that the drug is useful for reducing seizures for epileptic patients.</p>
<p>From this model, we also can estimate the patient-to-patient variability in terms of their baseline rate, which is <span class="math inline">\(\widehat{\sigma}^2_{b_0} = 0.496\)</span>. The estimate of the variance of the random slope representing the patient-to-patient variability in their change of rate from pre- to post-randomization is <span class="math inline">\(\widehat{\sigma}^2_{b_1} = 0.214\)</span>. We also obtain an estimate of the correlation between the random slope and intercept, which is 0.13. This is small, indicating that the expected changes in seizure rates are not directly related to the patients baseline seizure rate prior to randomization.</p>
</div>
</div>
<div id="a-note-on-irregular-longitudinal-data" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> A Note on Irregular Longitudinal Data<a href="introduction-to-longitudinal-data.html#a-note-on-irregular-longitudinal-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As previously mentioned, we frequently encounter studies where the observation times vary across individuals in the study. We refer to this as irregular longitudinal data. While methods like the generalized estimating equation (GEE - see <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span>) and the generalized linear mixed effects model (GLMM - see Section <a href="introduction-to-longitudinal-data.html#long-glmm">6.5</a>) can handle irregular data, we must be careful as we can end up with incorrect results and interpretations from our model if the longitudinal outcome is related to the observation times, known as outcome-dependent follow-up or informative follow-up. If this is the case, readers are directed <a href="https://cran.r-project.org/web/packages/IrregLong/vignettes/Irreglong-vignette.html">here</a> for options on how to deal with this issue.</p>
</div>
<div id="further-reading-1" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> Further Reading<a href="introduction-to-longitudinal-data.html#further-reading-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Readers are directed to <span class="citation">(<a href="#ref-fitzmaurice11" role="doc-biblioref">Fitzmaurice, Laird, and Ware 2011</a>)</span> and <span class="citation">(<a href="#ref-diggle02" role="doc-biblioref">Diggle et al. 2002</a>)</span> for more information on longitudinal data analysis.</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-diggle02" class="csl-entry">
Diggle, Peter J., Patrick Heagerty, Kung-Yee Liang, and Scott L. Zeger. 2002. <em>Analysis of Longitudinal Data</em>. 2nd ed. Oxford, UK: Oxford University Press.
</div>
<div id="ref-fitzmaurice11" class="csl-entry">
Fitzmaurice, Garrett M., Nan M. Laird, and James H. Ware. 2011. <em>Applied Longitudinal Analysis</em>. 2nd ed. Hoboken, NJ: Wiley.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-to-nonparametric-statistics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="introduction-to-questionnaire-design.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

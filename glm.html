<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Introduction to Generalized Linear Models | Topics in Statistical Consulting</title>
  <meta name="description" content="4 Introduction to Generalized Linear Models | Topics in Statistical Consulting" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Introduction to Generalized Linear Models | Topics in Statistical Consulting" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Introduction to Generalized Linear Models | Topics in Statistical Consulting" />
  
  
  



<meta name="date" content="2024-08-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-to-linear-regression.html"/>
<link rel="next" href="introduction-to-nonparametric-statistics.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Latex macros for html output

A few very common things you should use:

- $\bm{}$: Bold math.  Use bold for everything except scalars.
- $\tx{}$: Text within math.  Use for abbreviating words, e.g., $A_{\tx{miss}}$.
- $\xx, \YY$: Default macro convention for bold letters (small and capital case).
- $\aal, \TTh$: Default macro convention for bold symbols (first two letters of symbol name, i.e., $\bm{\alpha}$ and $\bm{\Theta}$).
- common stats symbols e.g., $\var$, $\cov$, $\iid$, $\N, defined below.
-->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      TeX: {
	  Macros: {
	      bm: ["\\boldsymbol{#1}",1], <!--bold math-->
	      tx: ["\\textrm{#1}",1], <!--text within math-->
	      rv: ["#2_{#1},\\ldots,#2_{#3}",3,"1"], <!--random variable \rv{X}{n}: X_1, ..., X_n-->
	      iid: ["\\overset{\\;\\tx{iid}\\;}{\\sim}"], <!--iid follows-->
	      ind: ["\\overset{\\:\\tx{ind}\\:}{\\sim}"], <!--ind follows-->
	      var: ["\\operatorname{var}"], <!--variance-->
	      cov: ["\\operatorname{cov}"], <!--coveraince-->
	      cor: ["\\operatorname{cor}"], <!--correlation-->
	      std: ["\\operatorname{se}"], <!--standard error-->
	      diag: ["\\operatorname{diag}"], <!--diagonal matrix-->
	      logit: ["\\operatorname{logit}"], <!--logit function-->
	      N: ["\\mathcal{N}"], <!--normal distribution-->
	      unif: ["\\operatorname{Unif}"], <!--Uniform distribution-->
	      ud: ["\\mathop{}\\!\\mathrm{d}"], <!--d in tegeral-->
	      der: ["\\frac{\\ud^{#1}}{\\ud{#2}^{#1}}", 2, ""], <!--\der{x}{f} d/dx f--> 
	      del: ["\\frac{\\partial^{#1}}{\\partial{#2}^{#1}}", 2, ""], <!--\del{x}{f} d/dx f-->
	      fder: ["\\frac{\\ud^{#1}#3}{\\ud{#2}^{#1}}", 3, ""], <!--\fder{x}{f} df/dx -->
	      fdel: ["\\frac{\\partial^{#1}#3}{\\partial{#2}^{#1}}", 3, ""], <!--\fdel{x}{f} df/dx -->
	      hess: ["\\frac{\\partial^2}{\\partial{#1}\\partial{#1}'}", 1], <!--\hess{x} d/dxdx -->
	      fhess: ["\\frac{\\partial^2#2}{\\partial{#1}\\partial{#1}'}", 2], <!--\fhess{x}{f} df/dxdx -->
              kbt: ["k_{\\tx{B}}T"],
	      IH: ["{\\mathfrak P}"], <!--p curl-->
	      eps: ["\\varepsilon"], <!--epsilon-->
	      paug: ["p_{\\tx{A}}"], <!--p_A-->
	      Ka: ["{\\mathcal K}"], <!--K curl-->
	      Ua: ["{\\mathcal U}"], <!--U curl-->
	      Ha: ["{\\mathcal H}"], <!--H curl-->
	      curr: ["{\\tx{curr}}"], <!--curr-->
	      prop: ["{\\tx{prop}}"], <!--prop-->
	      obs: ["{\\tx{obs}}"], <!--obs-->
	      bz: ["{\\bm{0}}"], <!--boldface 0-->
	      mm: ["{\\bm{m}}"], <!--boldface m-->
	      ww: ["{\\bm{w}}"], <!--boldface w-->
	      vv: ["{\\bm{v}}"], <!--boldface v-->
	      xx: ["{\\bm{x}}"], <!--boldface x-->
	      yy: ["{\\bm{y}}"], <!--boldface y-->
	      zz: ["{\\bm{z}}"], <!--boldface z-->
	      UU: ["{\\bm{U}}"], <!--boldface U-->
	      II: ["{\\bm{I}}"], <!--boldface I-->
	      HH: ["{\\bm{H}}"], <!--boldface H-->
	      XX: ["{\\bm{X}}"], <!--boldface X-->
	      YY: ["{\\bm{Y}}"], <!--boldface Y-->
	      ZZ: ["{\\bm{Z}}"], <!--boldface Z-->
	      aal: ["{\\bm{\\alpha}}"], <!--boldface alpha-->
	      bbe: ["{\\bm{\\beta}}"], <!--boldface beta-->
	      gga: ["{\\bm{\\gamma}}"], <!--boldface gamma-->
	      eet: ["{\\bm{\\eta}}"], <!--boldface eta-->
	      lla: ["{\\bm{\\lambda}}"], <!--boldface lambda-->
	      mmu: ["{\\bm{\\mu}}"], <!--boldface mu-->
	      pph: ["{\\bm{\\phi}}"], <!--boldface phi-->
	      pps: ["{\\bm{\\psi}}"], <!--boldface psi-->
	      rrh: ["{\\bm{\\rho}}"], <!--boldface rho-->
	      ssi: ["{\\bm{\\sigma}}"], <!--boldface sigma-->
	      tta: ["{\\bm{\\tau}}"], <!--boldface tau-->
	      tth: ["{\\bm{\\theta}}"], <!--boldface theta-->
	      eeps: ["{\\bm{\\varepsilon}}"], <!--boldface varepsilon-->
	      GGa: ["{\\bm{\\Gamma}}"], <!--boldface Gamma-->
	      SSi: ["{\\bm{\\Sigma}}"], <!--boldface Sigma-->
	      TTh: ["{\\bm{\\Theta}}"], <!--boldface Theta-->
	      cU: ["\\bm{\\mathcal{U}}"], <!--boldface U curl-->
	      rx: ["{\\tx{x}}"], <!--text x-->
	      ry: ["{\\tx{y}}"], <!--text y-->
	      rz: ["{\\tx{z}}"], <!--text z-->
	      rvx: ["{\\mathbf{x}}"], <!--boldface text x-->
	      rvz: ["{\\mathbf{z}}"], <!--boldface text z-->
	      rvc: ["{\\mathbf{c}}"], <!--boldface text c-->
	      rvzl: ["{\\mathbf{z}^{\\tx{l}}}"], <!--bold face z^l-->
	      rvzg: ["{\\mathbf{z}^{\\tx{g}}}"], <!--bold face z^g-->
	      rvt: ["{\\mathbf{t}}"], <!--boldface t-->
	      Q: ["{\\mathcal{Q}}"], <!--Q curl-->
	      O: ["{\\mathcal{O}}"], <!--O curl-->
	      U: ["{\\mathcal{U}}"], <!--U curl-->
	      R: ["{\\mathbb{R}}"], <!--real set-->
	      kl: ["{\\operatorname{KL}}"], <!--KL-->
	      sfT: ["{\\mathsf{T}}"], <!--sf T-->
	      sfk: ["{\\mathsf{k}}"], <!--sf k-->
	      sfa: ["{\\mathsf{a}}"], <!--sf a-->
	      sfh: ["{\\mathsf{h}}"], <!--sf h-->
  	      sfkl: ["{\\mathsf{k}^{\\tx{l}}}"], <!--sf k^l-->
	      sfal: ["{\\mathsf{a}^{\\tx{l}}}"], <!--sf a^l-->
	      sfhl: ["{\\mathsf{h}^{\\tx{l}}}"], <!--sf h^l-->
  	      sfkg: ["{\\mathsf{k}^{\\tx{g}}}"], <!--sf k^g-->
	      sfag: ["{\\mathsf{a}^{\\tx{g}}}"], <!--sf a^g-->
	      sfhg: ["{\\mathsf{h}^{\\tx{g}}}"], <!--sf h^g-->
	      sft: ["{\\mathsf{t}}"], <!--sf t-->
	      sfr: ["{\\mathsf{r}}"], <!--sf r-->
	      argmin: ["\\operatorname{arg\\,min}"], <!--argmin-->
	      argmax: ["\\operatorname{arg\\,max}"], <!--argmax-->
	      E: ["{\\mathbb{E}}"], <!--expectation-->
	      L: ["{\\mathcal{L}}"], <!--curl L likelihood-->
	      ellap: ["\\ell_{\\tx{Lap}}"] <!--curl l_Lap-->
	  }
      }
  });
</script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://uwaterloo.ca/statistical-consulting-and-collaborative-research-unit/" target="blank">Statistical Consulting and Collaborative Research Unit</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors"><i class="fa fa-check"></i>Authors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#editors"><i class="fa fa-check"></i>Editors</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>1</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-and-rstudio"><i class="fa fa-check"></i><b>1.1</b> R and RStudio</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-r"><i class="fa fa-check"></i><b>1.2</b> Basic R</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#rintro-calculate"><i class="fa fa-check"></i><b>1.2.1</b> Calculating with R</a></li>
<li class="chapter" data-level="1.2.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#variables"><i class="fa fa-check"></i><b>1.2.2</b> Variables</a></li>
<li class="chapter" data-level="1.2.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#vectors"><i class="fa fa-check"></i><b>1.2.3</b> Vectors</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-data-analysis-workflow"><i class="fa fa-check"></i><b>1.3</b> Basic Data Analysis Workflow</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-data-into-r"><i class="fa fa-check"></i><b>1.3.1</b> Reading Data into R</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#descriptive-statistics"><i class="fa fa-check"></i><b>1.3.2</b> Descriptive Statistics</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-visualization"><i class="fa fa-check"></i><b>1.3.3</b> Data Visualization</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#some-coding-tips"><i class="fa fa-check"></i><b>1.4</b> Some Coding Tips</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#source-editor"><i class="fa fa-check"></i><b>1.4.1</b> Source Editor</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#commenting"><i class="fa fa-check"></i><b>1.4.2</b> Commenting</a></li>
<li class="chapter" data-level="1.4.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#saving-the-environment"><i class="fa fa-check"></i><b>1.4.3</b> Saving the Environment</a></li>
<li class="chapter" data-level="1.4.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#installing-and-loading-libraries"><i class="fa fa-check"></i><b>1.4.4</b> Installing and Loading Libraries</a></li>
<li class="chapter" data-level="1.4.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#good-coding-practices"><i class="fa fa-check"></i><b>1.4.5</b> Good Coding Practices</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-help"><i class="fa fa-check"></i><b>1.5</b> Getting Help</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-documentation"><i class="fa fa-check"></i><b>1.5.1</b> R Documentation</a></li>
<li class="chapter" data-level="1.5.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#online-resources"><i class="fa fa-check"></i><b>1.5.2</b> Online Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html"><i class="fa fa-check"></i><b>2</b> Introduction to ggplot2</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#example-data-set"><i class="fa fa-check"></i><b>2.1.1</b> Example Data Set</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#data"><i class="fa fa-check"></i><b>2.2</b> Data</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#aesthetics"><i class="fa fa-check"></i><b>2.3</b> Aesthetics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#the-colour-component"><i class="fa fa-check"></i><b>2.3.1</b> The Colour Component</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#the-size-component"><i class="fa fa-check"></i><b>2.3.2</b> The Size Component</a></li>
<li class="chapter" data-level="2.3.3" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#the-shape-component"><i class="fa fa-check"></i><b>2.3.3</b> The Shape Component</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#geometrics"><i class="fa fa-check"></i><b>2.4</b> Geometrics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#line-graphs"><i class="fa fa-check"></i><b>2.4.1</b> Line Graphs</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#bar-plots"><i class="fa fa-check"></i><b>2.4.2</b> Bar Plots</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#others"><i class="fa fa-check"></i><b>2.5</b> Others</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#axes-labels"><i class="fa fa-check"></i><b>2.5.1</b> Axes Labels</a></li>
<li class="chapter" data-level="2.5.2" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#title-of-the-graph"><i class="fa fa-check"></i><b>2.5.2</b> Title of the Graph</a></li>
<li class="chapter" data-level="2.5.3" data-path="introduction-to-ggplot2.html"><a href="introduction-to-ggplot2.html#legends"><i class="fa fa-check"></i><b>2.5.3</b> Legends</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html"><i class="fa fa-check"></i><b>3</b> Introduction to Linear Regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#list-of-r-packages-used"><i class="fa fa-check"></i><b>3.1.1</b> List of R packages Used</a></li>
<li class="chapter" data-level="3.1.2" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#motivating-example"><i class="fa fa-check"></i><b>3.1.2</b> Motivating Example</a></li>
<li class="chapter" data-level="3.1.3" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#variables-1"><i class="fa fa-check"></i><b>3.1.3</b> Variables</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#linreg-slm"><i class="fa fa-check"></i><b>3.2</b> Simple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#linreg-slm-assumption"><i class="fa fa-check"></i><b>3.2.1</b> Assumptions</a></li>
<li class="chapter" data-level="3.2.2" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#linreg-slm-est"><i class="fa fa-check"></i><b>3.2.2</b> Estimation</a></li>
<li class="chapter" data-level="3.2.3" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#inference"><i class="fa fa-check"></i><b>3.2.3</b> Inference</a></li>
<li class="chapter" data-level="3.2.4" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#linreg-slm-modelcheck"><i class="fa fa-check"></i><b>3.2.4</b> Model Checking</a></li>
<li class="chapter" data-level="3.2.5" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#simple-linear-regression-on-a-binary-covariate"><i class="fa fa-check"></i><b>3.2.5</b> Simple Linear Regression on a Binary Covariate</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#linreg-mlm"><i class="fa fa-check"></i><b>3.3</b> Multiple Linear Regression</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#linreg-mlm-est"><i class="fa fa-check"></i><b>3.3.1</b> Estimation</a></li>
<li class="chapter" data-level="3.3.2" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#interaction-effects"><i class="fa fa-check"></i><b>3.3.2</b> Interaction Effects</a></li>
<li class="chapter" data-level="3.3.3" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#model-selection"><i class="fa fa-check"></i><b>3.3.3</b> Model Selection</a></li>
<li class="chapter" data-level="3.3.4" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#model-diagnostics"><i class="fa fa-check"></i><b>3.3.4</b> Model Diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#further-extensions"><i class="fa fa-check"></i><b>3.4</b> Further Extensions</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="introduction-to-linear-regression.html"><a href="introduction-to-linear-regression.html#recommendations"><i class="fa fa-check"></i><b>3.4.1</b> Recommendations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>4</b> Introduction to Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="glm.html"><a href="glm.html#glm-intro"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="glm.html"><a href="glm.html#glm-rpackages"><i class="fa fa-check"></i><b>4.2</b> List of R Packages</a></li>
<li class="chapter" data-level="4.3" data-path="glm.html"><a href="glm.html#glm-framework"><i class="fa fa-check"></i><b>4.3</b> Generalized Linear Model Framework</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="glm.html"><a href="glm.html#glm-assumptions"><i class="fa fa-check"></i><b>4.3.1</b> Assumptions</a></li>
<li class="chapter" data-level="4.3.2" data-path="glm.html"><a href="glm.html#glm-links"><i class="fa fa-check"></i><b>4.3.2</b> Link Functions</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="glm.html"><a href="glm.html#glm-modelselection"><i class="fa fa-check"></i><b>4.4</b> Notes on Model Selection</a></li>
<li class="chapter" data-level="4.5" data-path="glm.html"><a href="glm.html#glm-normal"><i class="fa fa-check"></i><b>4.5</b> Normally Distributed Outcomes</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="glm.html"><a href="glm.html#glm-normal-ex"><i class="fa fa-check"></i><b>4.5.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="glm.html"><a href="glm.html#glm-logreg"><i class="fa fa-check"></i><b>4.6</b> Bernoulli Distributed Outcomes (Logistic Regression)</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="glm.html"><a href="glm.html#glm-logreg-example"><i class="fa fa-check"></i><b>4.6.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="glm.html"><a href="glm.html#glm-binprop"><i class="fa fa-check"></i><b>4.7</b> Binominal Distributed/Proportional Outcomes (Logistic Regression on Proportions)</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="glm.html"><a href="glm.html#glm-binprop-example"><i class="fa fa-check"></i><b>4.7.1</b> Example</a></li>
<li class="chapter" data-level="4.7.2" data-path="glm.html"><a href="glm.html#glm-binprop-DR"><i class="fa fa-check"></i><b>4.7.2</b> Dose-response Models</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="glm.html"><a href="glm.html#glm-poisson"><i class="fa fa-check"></i><b>4.8</b> Poisson Distributed Outcomes (Log-linear Regression)</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="glm.html"><a href="glm.html#glm-poisson-example"><i class="fa fa-check"></i><b>4.8.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="glm.html"><a href="glm.html#glm-gamma"><i class="fa fa-check"></i><b>4.9</b> Gamma Distributed (Skewed) Outcomes</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="glm.html"><a href="glm.html#glm-gamma-example"><i class="fa fa-check"></i><b>4.9.1</b> Example</a></li>
<li class="chapter" data-level="4.9.2" data-path="glm.html"><a href="glm.html#glm-gamma-example-md"><i class="fa fa-check"></i><b>4.9.2</b> Model Diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="glm.html"><a href="glm.html#further-reading"><i class="fa fa-check"></i><b>4.10</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html"><i class="fa fa-check"></i><b>5</b> Introduction to Nonparametric Statistics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#r-packages-and-data"><i class="fa fa-check"></i><b>5.1.1</b> R Packages and Data</a></li>
<li class="chapter" data-level="5.1.2" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-rank"><i class="fa fa-check"></i><b>5.1.2</b> Sample Ranks</a></li>
<li class="chapter" data-level="5.1.3" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-sd"><i class="fa fa-check"></i><b>5.1.3</b> Sampling Distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#two-sample-hypothesis-testing"><i class="fa fa-check"></i><b>5.2</b> Two-sample Hypothesis Testing</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#quick-reference-table"><i class="fa fa-check"></i><b>5.2.1</b> Quick Reference Table</a></li>
<li class="chapter" data-level="5.2.2" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-mwu"><i class="fa fa-check"></i><b>5.2.2</b> Wilcoxon Rank-Sum Test</a></li>
<li class="chapter" data-level="5.2.3" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#other-softwares"><i class="fa fa-check"></i><b>5.2.3</b> Other Softwares</a></li>
<li class="chapter" data-level="5.2.4" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-wst"><i class="fa fa-check"></i><b>5.2.4</b> Wilcoxon Signed Rank Test</a></li>
<li class="chapter" data-level="5.2.5" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-tst"><i class="fa fa-check"></i><b>5.2.5</b> Siegel-Tukey Test</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-anova"><i class="fa fa-check"></i><b>5.3</b> ANOVA-type Methods</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#one-way-anova"><i class="fa fa-check"></i><b>5.3.1</b> One-way ANOVA</a></li>
<li class="chapter" data-level="5.3.2" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#post-hoc-comparisons-for-kw-anova"><i class="fa fa-check"></i><b>5.3.2</b> Post Hoc Comparisons for KW ANOVA</a></li>
<li class="chapter" data-level="5.3.3" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#repeated-measures-anova-friedman-test"><i class="fa fa-check"></i><b>5.3.3</b> Repeated Measures ANOVA (Friedman Test)</a></li>
<li class="chapter" data-level="5.3.4" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#post-hoc-tests"><i class="fa fa-check"></i><b>5.3.4</b> Post Hoc tests</a></li>
<li class="chapter" data-level="5.3.5" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#an-example-using-r-6"><i class="fa fa-check"></i><b>5.3.5</b> An example using R</a></li>
<li class="chapter" data-level="5.3.6" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#additional-resources-for-nonparametric-anova-procedures"><i class="fa fa-check"></i><b>5.3.6</b> Additional Resources for Nonparametric ANOVA Procedures</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#boostrap-methods"><i class="fa fa-check"></i><b>5.4</b> Boostrap Methods</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#bootstrap-confidence-intervals"><i class="fa fa-check"></i><b>5.4.1</b> Bootstrap Confidence Intervals</a></li>
<li class="chapter" data-level="5.4.2" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#assumptions"><i class="fa fa-check"></i><b>5.4.2</b> Assumptions</a></li>
<li class="chapter" data-level="5.4.3" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#examples-using-r"><i class="fa fa-check"></i><b>5.4.3</b> Examples using R</a></li>
<li class="chapter" data-level="5.4.4" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#additional-resources"><i class="fa fa-check"></i><b>5.4.4</b> Additional Resources</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#random-forests"><i class="fa fa-check"></i><b>5.5</b> Random Forests</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#examples-using-r-1"><i class="fa fa-check"></i><b>5.5.1</b> Examples Using R</a></li>
<li class="chapter" data-level="5.5.2" data-path="introduction-to-nonparametric-statistics.html"><a href="introduction-to-nonparametric-statistics.html#nonpram-arrf"><i class="fa fa-check"></i><b>5.5.2</b> Additional Resources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html"><i class="fa fa-check"></i><b>6</b> Introduction to Longitudinal Data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-intro"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-rpackages"><i class="fa fa-check"></i><b>6.1.1</b> List of R packages Used</a></li>
<li class="chapter" data-level="6.1.2" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-motivating"><i class="fa fa-check"></i><b>6.1.2</b> Motivating Example</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-datastruc"><i class="fa fa-check"></i><b>6.2</b> Data Structure for Longitudinal Responses</a></li>
<li class="chapter" data-level="6.3" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear"><i class="fa fa-check"></i><b>6.3</b> Linear Models for Continuous Outcome</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-assumptions"><i class="fa fa-check"></i><b>6.3.1</b> Assumptions</a></li>
<li class="chapter" data-level="6.3.2" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-modelspec"><i class="fa fa-check"></i><b>6.3.2</b> Notation and Model Specification</a></li>
<li class="chapter" data-level="6.3.3" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-corr"><i class="fa fa-check"></i><b>6.3.3</b> Correlation Structures</a></li>
<li class="chapter" data-level="6.3.4" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-estimation"><i class="fa fa-check"></i><b>6.3.4</b> Estimation</a></li>
<li class="chapter" data-level="6.3.5" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-R"><i class="fa fa-check"></i><b>6.3.5</b> Modelling in R</a></li>
<li class="chapter" data-level="6.3.6" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-HT"><i class="fa fa-check"></i><b>6.3.6</b> Hypothesis Testing</a></li>
<li class="chapter" data-level="6.3.7" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-population"><i class="fa fa-check"></i><b>6.3.7</b> Population Means</a></li>
<li class="chapter" data-level="6.3.8" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-cov"><i class="fa fa-check"></i><b>6.3.8</b> Selecting a Correlation Structure</a></li>
<li class="chapter" data-level="6.3.9" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-procedure"><i class="fa fa-check"></i><b>6.3.9</b> Model Fitting Procedure</a></li>
<li class="chapter" data-level="6.3.10" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linear-example2"><i class="fa fa-check"></i><b>6.3.10</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed"><i class="fa fa-check"></i><b>6.4</b> Linear Mixed Effect Models for Longitudinal Data</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-notation"><i class="fa fa-check"></i><b>6.4.1</b> Notation and Model Specification</a></li>
<li class="chapter" data-level="6.4.2" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-randomintercept"><i class="fa fa-check"></i><b>6.4.2</b> Random Intercept Models</a></li>
<li class="chapter" data-level="6.4.3" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-randominterceptslope"><i class="fa fa-check"></i><b>6.4.3</b> Random Intercept and Slope Models</a></li>
<li class="chapter" data-level="6.4.4" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-estimation"><i class="fa fa-check"></i><b>6.4.4</b> Estimation</a></li>
<li class="chapter" data-level="6.4.5" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-R"><i class="fa fa-check"></i><b>6.4.5</b> Modelling in R</a></li>
<li class="chapter" data-level="6.4.6" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-diagnostics"><i class="fa fa-check"></i><b>6.4.6</b> Model Diagnostics for Linear Mixed-Effects Models</a></li>
<li class="chapter" data-level="6.4.7" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-popmeans"><i class="fa fa-check"></i><b>6.4.7</b> Population Means</a></li>
<li class="chapter" data-level="6.4.8" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-linearmixed-ht"><i class="fa fa-check"></i><b>6.4.8</b> Hypothesis Testing for Fixed Effects</a></li>
<li class="chapter" data-level="6.4.9" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-lme-modelfitting"><i class="fa fa-check"></i><b>6.4.9</b> Model Fitting Procedure</a></li>
<li class="chapter" data-level="6.4.10" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-lme-ex2"><i class="fa fa-check"></i><b>6.4.10</b> Example - Milk Protein and Diet</a></li>
<li class="chapter" data-level="6.4.11" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#example---aids-clinical-trial-group"><i class="fa fa-check"></i><b>6.4.11</b> Example - AIDS Clinical Trial Group</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-glmm"><i class="fa fa-check"></i><b>6.5</b> Generalized Linear Mixed-Effects Models</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-glmm-notation"><i class="fa fa-check"></i><b>6.5.1</b> Notation and Model Specification</a></li>
<li class="chapter" data-level="6.5.2" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-glmm-R"><i class="fa fa-check"></i><b>6.5.2</b> Modelling in R</a></li>
<li class="chapter" data-level="6.5.3" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#model-diagnostics-long-glmm-md"><i class="fa fa-check"></i><b>6.5.3</b> Model Diagnostics {long-glmm-md}</a></li>
<li class="chapter" data-level="6.5.4" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#long-glmm-interpret"><i class="fa fa-check"></i><b>6.5.4</b> Model Interpretations</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#a-note-on-irregular-longitudinal-data"><i class="fa fa-check"></i><b>6.6</b> A Note on Irregular Longitudinal Data</a></li>
<li class="chapter" data-level="6.7" data-path="introduction-to-longitudinal-data.html"><a href="introduction-to-longitudinal-data.html#further-reading-1"><i class="fa fa-check"></i><b>6.7</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduction-to-questionnaire-design.html"><a href="introduction-to-questionnaire-design.html"><i class="fa fa-check"></i><b>7</b> Introduction to Questionnaire Design</a>
<ul>
<li class="chapter" data-level="7.1" data-path="introduction-to-questionnaire-design.html"><a href="introduction-to-questionnaire-design.html#questdes-plan"><i class="fa fa-check"></i><b>7.1</b> Plan the Study</a></li>
<li class="chapter" data-level="7.2" data-path="introduction-to-questionnaire-design.html"><a href="introduction-to-questionnaire-design.html#questdes-prepare"><i class="fa fa-check"></i><b>7.2</b> Prepare the Questions</a></li>
<li class="chapter" data-level="7.3" data-path="introduction-to-questionnaire-design.html"><a href="introduction-to-questionnaire-design.html#questdes-put"><i class="fa fa-check"></i><b>7.3</b> Put Together the Questionnaire</a></li>
<li class="chapter" data-level="7.4" data-path="introduction-to-questionnaire-design.html"><a href="introduction-to-questionnaire-design.html#questdes-pretest"><i class="fa fa-check"></i><b>7.4</b> Pretest the Questionnaire</a></li>
<li class="chapter" data-level="7.5" data-path="introduction-to-questionnaire-design.html"><a href="introduction-to-questionnaire-design.html#a-checklist-for-questionnaire-designs"><i class="fa fa-check"></i><b>7.5</b> A Checklist for Questionnaire Designs</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html"><i class="fa fa-check"></i><b>8</b> Introduction to Sample Size Determination</a>
<ul>
<li class="chapter" data-level="8.1" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#introduction-3"><i class="fa fa-check"></i><b>8.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-rpackages"><i class="fa fa-check"></i><b>8.1.1</b> List of R Packages Used</a></li>
<li class="chapter" data-level="8.1.2" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-errors"><i class="fa fa-check"></i><b>8.1.2</b> Type I and Type II Errors</a></li>
<li class="chapter" data-level="8.1.3" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-effect-size"><i class="fa fa-check"></i><b>8.1.3</b> Effect Size</a></li>
<li class="chapter" data-level="8.1.4" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-equivalence"><i class="fa fa-check"></i><b>8.1.4</b> Equivalence Testing</a></li>
<li class="chapter" data-level="8.1.5" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-precision"><i class="fa fa-check"></i><b>8.1.5</b> Precision-Based Sample Size Determination</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-common-models"><i class="fa fa-check"></i><b>8.2</b> Sample Size Determination for Common Models</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#pwr-pckg"><i class="fa fa-check"></i><b>8.2.1</b> The pwr Package</a></li>
<li class="chapter" data-level="8.2.2" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#gpower-software"><i class="fa fa-check"></i><b>8.2.2</b> G*Power Software</a></li>
<li class="chapter" data-level="8.2.3" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-ex-ANOVA"><i class="fa fa-check"></i><b>8.2.3</b> Sample Size Determination for Balanced One-Way ANOVA</a></li>
<li class="chapter" data-level="8.2.4" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-ex-mlr"><i class="fa fa-check"></i><b>8.2.4</b> Sample Size Determination for Multiple Regression Model</a></li>
<li class="chapter" data-level="8.2.5" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-ex-t"><i class="fa fa-check"></i><b>8.2.5</b> Sample Size Determination to Compare Two Means (Unknown, Common Variance)</a></li>
<li class="chapter" data-level="8.2.6" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-TOSTER"><i class="fa fa-check"></i><b>8.2.6</b> The TOSTER Package</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-sec-sim"><i class="fa fa-check"></i><b>8.3</b> Simulation-Based Sample Size Determination</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-sim-sing"><i class="fa fa-check"></i><b>8.3.1</b> Computing a Single Power Estimation via Simulation</a></li>
<li class="chapter" data-level="8.3.2" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-est-curve"><i class="fa fa-check"></i><b>8.3.2</b> Estimating a Power Curve via Simulation</a></li>
<li class="chapter" data-level="8.3.3" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-parallel"><i class="fa fa-check"></i><b>8.3.3</b> Parallelization for Simulation-Based Sample Size Determination</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="introduction-to-sample-size-determination.html"><a href="introduction-to-sample-size-determination.html#samp-beyond"><i class="fa fa-check"></i><b>8.4</b> Beyond Sample Size Determination</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Topics in Statistical Consulting</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="glm" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Introduction to Generalized Linear Models<a href="glm.html#glm" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><em>Author: Grace Tompkins</em></p>
<p><em>Last Updated: August 5, 2022</em></p>
<hr />
<div id="glm-intro" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Introduction<a href="glm.html#glm-intro" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Although linear models have the potential to answer many research questions, we may be interested in finding the association between an outcome and a set of covariates where the outcome is not necessarily continuous or normally distributed. For example, a researcher may be interested in the relationship between the number of cavities and oral hygiene habits in adolescent patients, or perhaps a researcher is interested in identifying covariates that are related to food insecurity in rural populations. In these settings where we do not have a normally distributed outcome, linear regression model assumptions do not hold, and we cannot use them to analyze such data. Generalized linear models (GLMs) are an extension of linear regression models that allow us to use a variety of distributions for the outcome. In fact, linear regression is a special case of a GLM.</p>
<p>In this section, we will introduce the generalized linear model framework with an emphasis for model fitting in R.</p>
</div>
<div id="glm-rpackages" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> List of R Packages<a href="glm.html#glm-rpackages" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!-- install.packages(c('catdata', 'MASS', 'AER', 'performance', 'faraway', 'car')) -->
<p>In this section, we will be using the packages <a href="https://CRAN.R-project.org/package=catdata"><strong>catdata</strong></a>, <a href="https://CRAN.R-project.org/package=MASS"><strong>MASS</strong></a>, <a href="https://CRAN.R-project.org/package=AER"><strong>AER</strong></a>, <a href="https://CRAN.R-project.org/package=performance"><strong>performance</strong></a>, <a href="https://CRAN.R-project.org/package=faraway"><strong>faraway</strong></a> , and <a href="https://CRAN.R-project.org/package=car"><strong>car</strong></a>. We can load these packages in R after installing them by the following:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="glm.html#cb188-1" tabindex="-1"></a><span class="co">#load the required packages</span></span>
<span id="cb188-2"><a href="glm.html#cb188-2" tabindex="-1"></a><span class="fu">library</span>(catdata)</span>
<span id="cb188-3"><a href="glm.html#cb188-3" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb188-4"><a href="glm.html#cb188-4" tabindex="-1"></a><span class="fu">library</span>(AER)</span>
<span id="cb188-5"><a href="glm.html#cb188-5" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb188-6"><a href="glm.html#cb188-6" tabindex="-1"></a><span class="fu">library</span>(faraway)</span>
<span id="cb188-7"><a href="glm.html#cb188-7" tabindex="-1"></a><span class="fu">library</span>(car)</span></code></pre></div>
</div>
<div id="glm-framework" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Generalized Linear Model Framework<a href="glm.html#glm-framework" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The generalized linear model is comprised of three components:</p>
<ol style="list-style-type: decimal">
<li><p>The Random Component: The distribution of the independently and identically distributed (i.i.d.) response variables are assumed to come from a parametric distribution that is a member of the <a href="https://en.wikipedia.org/wiki/Exponential_family">exponential family</a>. These include (but are not limited to) the binomial, Poisson, normal, exponential, and gamma distributions,</p></li>
<li><p>The Systematic Component: The linear combination of explanatory variables and regression parameters, and</p></li>
<li><p>The Link Function: The function that relates the mean of the distribution of <span class="math inline">\(Y_i\)</span> to the linear predictor through</p></li>
</ol>
<p><span class="math display">\[
g(\mu_i) = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + ...+ \beta_px_{ip}
\]</span>
where <span class="math inline">\(\mu_i = E[Y_i]\)</span> is the mean of outcome and <span class="math inline">\(x_{i1}, ..., x_{ip}\)</span> are the <span class="math inline">\(p\)</span> covariates for individual/subject <span class="math inline">\(i\)</span>. We note that there is no error term on this model, unlike in the usual linear regression model. This is because we are modelling the mean of the outcome and thus a random error term is not needed.</p>
<div id="glm-assumptions" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Assumptions<a href="glm.html#glm-assumptions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We need to satisfy a number of assumptions to use the GLM framework:</p>
<ol style="list-style-type: decimal">
<li>The outcome <span class="math inline">\(Y_i\)</span> is independent between subjects and comes from a distribution that belongs to the exponential family,</li>
<li>There is a linear relationship between a transformation of the mean and the predictors through the link function, and</li>
<li>The errors are uncorrelated with constant variance, but not necessarily normally distributed.</li>
</ol>
<p>We also assume that there is no <a href="https://en.wikipedia.org/wiki/Multicollinearity">multicollinearity</a> among explanatory variables.</p>
<p>Multicollinearity (sometimes referred to as collinearity) occurs when two or more explanatory variables are highly correlated, such that they do not provide unique or independent information in the regression model. If the degree of correlation is high enough between variables, it can cause problems when fitting and interpreting the model. One way to detect multicollinearity is to calculate the <a href="https://en.wikipedia.org/wiki/Variance_inflation_factor">variation inflation factor (VIF)</a> for each covariate in a model. The general guideline is that a VIF larger than 10 indicates that the model has problems estimating the coefficients possibly due to multicollinearity. We will show in Section <a href="glm.html#glm-logreg">4.6</a> how to use R functions to calculate the VIF after model building.</p>
<p>We note that our methodology will be particularly sensitive to these assumptions when sample sizes are small. When collecting data, we also want to ensure that the sample is representative of the population of interest to answer the research question(s).</p>
</div>
<div id="glm-links" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Link Functions<a href="glm.html#glm-links" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall that we are modelling the mean of the outcome through a link function as in
<span class="math display">\[
g(\mu_i) = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + ...+ \beta_px_{ip}.
\]</span>
The link function will essentially transform a non-linear outcome to a linear outcome allowing us to fit a generalized linear model. For each distribution in the exponential family, there is a <a href="https://en.wikipedia.org/wiki/Generalized_linear_model#Link_function">canonical link</a> which is recommended to use as simplifies the process of finding maximum likelihood estimates in our model by ensuring that the mean of our outcome is mapped to <span class="math inline">\((-\infty, \infty)\)</span> so we do not need to worry about constraints when optimizing. It also ensures <span class="math inline">\(\boldsymbol{x}^T\boldsymbol{y}\)</span> is a <a href="https://en.wikipedia.org/wiki/Sufficient_statistic">sufficient</a> statistic for <span class="math inline">\(\boldsymbol{\beta}\)</span>.</p>
<p>The following is a table containing commonly used distributions, their canonical links, and the corresponding name used in R:</p>
<table>
<colgroup>
<col width="36%" />
<col width="39%" />
<col width="24%" />
</colgroup>
<thead>
<tr class="header">
<th>Distribution of <span class="math inline">\(Y\)</span></th>
<th align="center">Canonical Link</th>
<th align="right">Family parameter in R <code>glm</code> function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://en.wikipedia.org/wiki/Normal_distribution">Normal</a> (used for symmetric continuous data)</td>
<td align="center">Identity: <span class="math inline">\(g(\mu) = \mu\)</span></td>
<td align="right"><code>family = gaussian(link = "identity")</code></td>
</tr>
<tr class="even">
<td><a href="https://en.wikipedia.org/wiki/Binomial_distribution">Binomial</a> (Binary data is a special case where n = 1)</td>
<td align="center">Logistic: <span class="math inline">\(g(\mu) = \log\left(\frac{\mu}{n-\mu}\right)\)</span></td>
<td align="right"><code>family = binomial(link = "logit")</code></td>
</tr>
<tr class="odd">
<td><a href="https://en.wikipedia.org/wiki/Poisson_distribution#:~:text=In%20probability%20theory%20and%20statistics,time%20since%20the%20last%20event.">Poisson</a> (used for discrete count data)</td>
<td align="center">Log: <span class="math inline">\(g(\mu) = \log(\mu)\)</span></td>
<td align="right"><code>family = poisson(link = "log")</code></td>
</tr>
<tr class="even">
<td><a href="https://en.wikipedia.org/wiki/Gamma_distribution">Gamma</a> (used for continuous, positive, skewed or heteroskedastic data)</td>
<td align="center">Reciprocal: <span class="math inline">\(g(\mu) = \frac{1}{\mu}\)</span></td>
<td align="right"><code>family = Gamma(link = "inverse")</code></td>
</tr>
</tbody>
</table>
<p>Each link function will dictate how we interpret the model parameters. For example, using a logistic link for binomial outcome data (also known as logistic regression), we interpret our parameters <span class="math inline">\(\beta\)</span> as log odds ratios. More details on this can be found in the dedicated logistic regression module in Section <a href="glm.html#glm-logreg">4.6</a>. When using a log link on Poisson data, our model parameters estimate log relative rates, which we will detail in Section <a href="glm.html#glm-poisson">4.8</a>.</p>
<p>We note that sometimes we will use link functions other than the canonical link. For example, it is common for researchers evaluating dose-response relationships for binary outcomes to use the <a href="https://en.wikipedia.org/wiki/Probit_model">probit</a> link instead of the canonical logistic link. The probit link is the inverse of the standard normal cumulative distribution function. We will also provide a detailed example for this in Section <a href="glm.html#glm-binprop-DR">4.7.2</a>.</p>
<p>To fit a GLM in R, we use the <code>glm()</code> function. In this function, we can specify:</p>
<ul>
<li><code>formula</code>: a description of the model to be fit, similar to that in a regular linear model. For example, to fit a glm with outcome <code>y</code> and covariates <code>x1</code> and <code>x2</code>, we would write <code>y ~ x1 + x2</code>.</li>
<li><code>family</code>: a description of the error distribution and link function. That is, we specify the type of GLM to fit using the calls in the third column of the above table.</li>
<li><code>data</code>: the name of the data frame</li>
<li><code>weights</code>: (optional) a vector of column of weights.</li>
</ul>
<p>We will show concrete examples of how to fit different types of GLMs in the following sections.</p>
</div>
</div>
<div id="glm-modelselection" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Notes on Model Selection<a href="glm.html#glm-modelselection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When fitting GLMs, it is important to perform model selection procedures and assess the model fit before interpreting the results. We aim to find a <a href="https://www.statisticshowto.com/parsimonious-model/#:~:text=Parsimonious%20models%20are%20simple%20models,called%20lex%20parsimoniae%20in%20Latin">parsimonious model</a> that addresses our research questions. That is, we aim to find the simplest model that explains the relationship between the outcome and covariate(s) of interest.</p>
<p>One of the most common ways to compare models against each other is through the <a href="https://en.wikipedia.org/wiki/Likelihood-ratio_test">likelihood ratio test</a> (LRT). For the likelihood ratio test, we can compare <a href="https://www.statology.org/nested-model/#:~:text=A%20nested%20model%20is%20simply,variables%20in%20another%20regression%20model.">nested</a> models. That is, we can compare a full model to a nested model that contains a subset of variables that appear in the full model (and no other variables or transformations). Likelihood ratio tests tend to be the preferred method for building logistic regression models where we want to draw claims and perform hypothesis tests.</p>
<p>We typically start model selection with a full main-effects only model and look at removing the least significant covariates in the full model. We can see if these covariates can be removed in the model by testing the full model against one that does not contain those two covariates by a LRT. The LRT compares the residual deviance from both models we are comparing, with degrees of freedom (df) equal to the difference in the number of covariates between the two models. We are specifically testing the null hypothesis <span class="math inline">\(H_0\)</span>: the simpler model is adequate compared to the more complex model. That is, if the <span class="math inline">\(p\)</span>-value from the test is small, we reject the null and conclude that the simpler model is not adequate, and we should use the fuller model. We can perform an LRT in R by using the <code>anova()</code> function with <code>test = "LRT"</code> in the function call.</p>
<p>For nested or non-nested models, we can also perform model selection by either <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion">Akaike information criterion (AIC)</a> or <a href="https://en.wikipedia.org/wiki/Bayesian_information_criterion">Bayesian information criterion (BIC)</a> where a smaller value represents a better fit. Although both AIC and BIC are similar, research has shown that each are appropriate for different tasks, as discussed <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion#Comparison_with_BIC">here</a>. For the problems discusses in the following sections, AIC and BIC are comparable and either are appropriate for use.</p>
<p>In the following sections, we will outline examples of fitting, assessing, and interpreting various of generalized linear models for commonly used distributions.</p>
</div>
<div id="glm-normal" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Normally Distributed Outcomes<a href="glm.html#glm-normal" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A generalized linear model with a normally distributed outcome using the canonical link (identity) is the same as a linear regression model.</p>
<div id="glm-normal-ex" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Example<a href="glm.html#glm-normal-ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will be demonstrating the use of a glm on normally distributed data using the <code>rent</code> data set from the <a href="https://CRAN.R-project.org/package=catdata"><strong>catdata</strong></a> package in R. This data set contains information on 2053 units’ rent (in euros), rent per squared meter (in euros), number of rooms, and other covariates for renal units in Munich in 2003. A full list and description of the variables can be found using by typing <code>?rent</code> in the R console and reading through the documentation. We read in this data set with the following code, and look at the first 6 observations by;</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="glm.html#cb189-1" tabindex="-1"></a><span class="co"># read in data set</span></span>
<span id="cb189-2"><a href="glm.html#cb189-2" tabindex="-1"></a><span class="fu">data</span>(rent, <span class="at">package =</span> <span class="st">&quot;catdata&quot;</span>)</span>
<span id="cb189-3"><a href="glm.html#cb189-3" tabindex="-1"></a></span>
<span id="cb189-4"><a href="glm.html#cb189-4" tabindex="-1"></a><span class="co"># view first 6 observations</span></span>
<span id="cb189-5"><a href="glm.html#cb189-5" tabindex="-1"></a><span class="fu">head</span>(rent)</span></code></pre></div>
<pre><code>##     rent rentm size rooms year area good best warm central tiles
## 1 741.39 10.90   68     2 1918    2    1    0    0       0     0
## 2 715.82 11.01   65     2 1995    2    1    0    0       0     0
## 3 528.25  8.38   63     3 1918    2    1    0    0       0     0
## 4 553.99  8.52   65     3 1983   16    0    0    0       0     0
## 5 698.21  6.98  100     4 1995   16    1    0    0       0     0
## 6 935.65 11.55   81     4 1980   16    0    0    0       0     0
##   bathextra kitchen
## 1         0       0
## 2         0       0
## 3         0       0
## 4         1       0
## 5         1       1
## 6         0       0</code></pre>
<p>We wish to see what main factors are related to rental prices, and use this model to predict the rental prices of units not included in the sample.</p>
<p>First, we need to assess the distribution of the outcome. We are going to use <code>rentm</code>, which is the clear rent per square meter in euros, as the outcome of interest. To assess the normality of the outcome, we can plot a histogram of the distribution and create a <a href="https://en.wikipedia.org/wiki/Q%E2%80%93Q_plot">quantile-quantile (Q-Q)</a> plot. To do so in R, we perform the following commands:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="glm.html#cb191-1" tabindex="-1"></a><span class="co"># plot two plots side by side</span></span>
<span id="cb191-2"><a href="glm.html#cb191-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)) </span>
<span id="cb191-3"><a href="glm.html#cb191-3" tabindex="-1"></a></span>
<span id="cb191-4"><a href="glm.html#cb191-4" tabindex="-1"></a><span class="co">#plot the histogram</span></span>
<span id="cb191-5"><a href="glm.html#cb191-5" tabindex="-1"></a><span class="fu">hist</span>(rent<span class="sc">$</span>rentm, <span class="at">main =</span> <span class="st">&quot;Histogram of Rent per </span><span class="sc">\n</span><span class="st">Squared Meter&quot;</span>,</span>
<span id="cb191-6"><a href="glm.html#cb191-6" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Rent per Squared Meter&quot;</span>)</span>
<span id="cb191-7"><a href="glm.html#cb191-7" tabindex="-1"></a></span>
<span id="cb191-8"><a href="glm.html#cb191-8" tabindex="-1"></a><span class="co">#plot the qq plot, with reference line</span></span>
<span id="cb191-9"><a href="glm.html#cb191-9" tabindex="-1"></a><span class="fu">qqnorm</span>(rent<span class="sc">$</span>rentm)</span>
<span id="cb191-10"><a href="glm.html#cb191-10" tabindex="-1"></a><span class="fu">qqline</span>(rent<span class="sc">$</span>rentm)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-normal-normalityassumption"></span>
<img src="topics_in_consulting_files/figure-html/glm-normal-normalityassumption-1.png" alt="Plots Used for Assessing Normality" width="672" />
<p class="caption">
Figure 4.1: Plots Used for Assessing Normality
</p>
</div>
<p>From the histogram of <code>rentm</code> in Figure <a href="glm.html#fig:glm-normal-normalityassumption">4.1</a>, we see that we have a fairly symmetric distribution. In the Q-Q plot, most points lie on the line, indicating that we have evidence to suggest the normality assumption is satisfied. That is, the normal distribution seems to be an appropriate distribution to assume for our outcome <span class="math inline">\(Y\)</span> in our GLM.</p>
<p>Let’s fit a generalized linear model to this data set using the <code>glm()</code> function in R, recalling that some covariates are categorical and need to be assigned as a <code>factor()</code> while fitting the model:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="glm.html#cb192-1" tabindex="-1"></a><span class="co"># fit a full model</span></span>
<span id="cb192-2"><a href="glm.html#cb192-2" tabindex="-1"></a>rentm_fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rentm <span class="sc">~</span> size <span class="sc">+</span> <span class="fu">factor</span>(rooms) <span class="sc">+</span> year <span class="sc">+</span> <span class="fu">factor</span>(area) <span class="sc">+</span></span>
<span id="cb192-3"><a href="glm.html#cb192-3" tabindex="-1"></a>                    <span class="fu">factor</span>(good) <span class="sc">+</span> <span class="fu">factor</span>(best) <span class="sc">+</span> <span class="fu">factor</span>(warm) <span class="sc">+</span> </span>
<span id="cb192-4"><a href="glm.html#cb192-4" tabindex="-1"></a>                    <span class="fu">factor</span>(central) <span class="sc">+</span> <span class="fu">factor</span>(tiles) <span class="sc">+</span> <span class="fu">factor</span>(bathextra) <span class="sc">+</span></span>
<span id="cb192-5"><a href="glm.html#cb192-5" tabindex="-1"></a>                    <span class="fu">factor</span>(kitchen), <span class="at">data =</span> rent, <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>))</span>
<span id="cb192-6"><a href="glm.html#cb192-6" tabindex="-1"></a></span>
<span id="cb192-7"><a href="glm.html#cb192-7" tabindex="-1"></a><span class="co"># see summary of model</span></span>
<span id="cb192-8"><a href="glm.html#cb192-8" tabindex="-1"></a><span class="fu">summary</span>(rentm_fit1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = rentm ~ size + factor(rooms) + year + factor(area) + 
##     factor(good) + factor(best) + factor(warm) + factor(central) + 
##     factor(tiles) + factor(bathextra) + factor(kitchen), family = gaussian(link = &quot;identity&quot;), 
##     data = rent)
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        -29.056738   4.353750  -6.674 3.21e-11 ***
## size                -0.012989   0.003553  -3.656 0.000262 ***
## factor(rooms)2      -0.962336   0.168848  -5.699 1.38e-08 ***
## factor(rooms)3      -1.222089   0.211164  -5.787 8.27e-09 ***
## factor(rooms)4      -1.464680   0.286182  -5.118 3.38e-07 ***
## factor(rooms)5      -1.262989   0.445118  -2.837 0.004593 ** 
## factor(rooms)6      -1.348122   0.681699  -1.978 0.048111 *  
## year                 0.020691   0.002210   9.363  &lt; 2e-16 ***
## factor(area)2       -0.579401   0.355480  -1.630 0.103277    
## factor(area)3       -0.649166   0.366119  -1.773 0.076363 .  
## factor(area)4       -0.930954   0.362002  -2.572 0.010192 *  
## factor(area)5       -0.663130   0.360154  -1.841 0.065733 .  
## factor(area)6       -1.104201   0.412643  -2.676 0.007513 ** 
## factor(area)7       -1.881931   0.411139  -4.577 5.00e-06 ***
## factor(area)8       -1.033445   0.419070  -2.466 0.013744 *  
## factor(area)9       -1.070518   0.352590  -3.036 0.002427 ** 
## factor(area)10      -1.413725   0.426175  -3.317 0.000925 ***
## factor(area)11      -1.905430   0.413710  -4.606 4.37e-06 ***
## factor(area)12      -0.746397   0.392809  -1.900 0.057556 .  
## factor(area)13      -1.063768   0.386219  -2.754 0.005934 ** 
## factor(area)14      -2.012162   0.422025  -4.768 2.00e-06 ***
## factor(area)15      -1.450753   0.453376  -3.200 0.001396 ** 
## factor(area)16      -2.097239   0.379343  -5.529 3.65e-08 ***
## factor(area)17      -1.656931   0.412166  -4.020 6.03e-05 ***
## factor(area)18      -1.031686   0.397764  -2.594 0.009563 ** 
## factor(area)19      -1.650084   0.381287  -4.328 1.58e-05 ***
## factor(area)20      -1.643962   0.433051  -3.796 0.000151 ***
## factor(area)21      -1.531664   0.422369  -3.626 0.000295 ***
## factor(area)22      -2.188120   0.534875  -4.091 4.47e-05 ***
## factor(area)23      -1.942936   0.641178  -3.030 0.002475 ** 
## factor(area)24      -2.111553   0.505552  -4.177 3.08e-05 ***
## factor(area)25      -1.779586   0.376323  -4.729 2.41e-06 ***
## factor(good)1        0.494288   0.115915   4.264 2.10e-05 ***
## factor(best)1        1.550206   0.323708   4.789 1.80e-06 ***
## factor(warm)1       -1.901138   0.291068  -6.532 8.22e-11 ***
## factor(central)1    -1.261988   0.199043  -6.340 2.82e-10 ***
## factor(tiles)1      -0.677180   0.118902  -5.695 1.41e-08 ***
## factor(bathextra)1   0.701636   0.165547   4.238 2.35e-05 ***
## factor(kitchen)1     1.388492   0.180393   7.697 2.17e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 4.182963)
## 
##     Null deviance: 12486.0  on 2052  degrees of freedom
## Residual deviance:  8424.5  on 2014  degrees of freedom
## AIC: 8804.7
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>We note that we specified<code>family = gaussian(link = "identity")</code> in our model, but we could also have left this parameter out of the model as the default family is set to Gaussian for the <code>glm()</code> function, or fit the model using the <code>lm()</code> function.</p>
<p>All covariates appear to be significantly associated with the outcome <code>rentm</code>. As some of the levels of the <code>area</code>(municipality) covariate are insignificant, we can perform an LRT to see if the <code>area</code> covariate is needed. To do so, we fit a model without <code>area</code> and compare it to the model that includes <code>area</code> as a covariate using the <code>anova()</code> function:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="glm.html#cb194-1" tabindex="-1"></a><span class="co"># fit a model without area</span></span>
<span id="cb194-2"><a href="glm.html#cb194-2" tabindex="-1"></a>rentm_fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rentm <span class="sc">~</span> size <span class="sc">+</span> <span class="fu">factor</span>(rooms) <span class="sc">+</span> year <span class="sc">+</span></span>
<span id="cb194-3"><a href="glm.html#cb194-3" tabindex="-1"></a>                    <span class="fu">factor</span>(good) <span class="sc">+</span> <span class="fu">factor</span>(best) <span class="sc">+</span> <span class="fu">factor</span>(warm) <span class="sc">+</span> </span>
<span id="cb194-4"><a href="glm.html#cb194-4" tabindex="-1"></a>                    <span class="fu">factor</span>(central) <span class="sc">+</span> <span class="fu">factor</span>(tiles) <span class="sc">+</span> <span class="fu">factor</span>(bathextra) <span class="sc">+</span></span>
<span id="cb194-5"><a href="glm.html#cb194-5" tabindex="-1"></a>                    <span class="fu">factor</span>(kitchen), <span class="at">data =</span> rent, <span class="at">family =</span> <span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>))</span>
<span id="cb194-6"><a href="glm.html#cb194-6" tabindex="-1"></a></span>
<span id="cb194-7"><a href="glm.html#cb194-7" tabindex="-1"></a><span class="co"># perform LRT</span></span>
<span id="cb194-8"><a href="glm.html#cb194-8" tabindex="-1"></a><span class="fu">anova</span>(rentm_fit2, rentm_fit1, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: rentm ~ size + factor(rooms) + year + factor(good) + factor(best) + 
##     factor(warm) + factor(central) + factor(tiles) + factor(bathextra) + 
##     factor(kitchen)
## Model 2: rentm ~ size + factor(rooms) + year + factor(area) + factor(good) + 
##     factor(best) + factor(warm) + factor(central) + factor(tiles) + 
##     factor(bathextra) + factor(kitchen)
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1      2038     8845.0                          
## 2      2014     8424.5 24   420.51 2.441e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The null hypothesis we are testing is that the simpler model (model without <code>area</code>) is adequate compared to the fuller model. We have a small <span class="math inline">\(p\)</span>-value here, indicating that we reject the null hypothesis and conclude that our model fit is better when we do include <code>area</code> as a covariate.</p>
<p>We can continue model building in this fashion, however as a GLM fitted with the identity link is the same as fitting a linear model, readers are directed to Section <a href="introduction-to-linear-regression.html#linreg-mlm">3.3</a> for more information on model fitting, diagnostics, and interpretations.</p>
</div>
</div>
<div id="glm-logreg" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Bernoulli Distributed Outcomes (Logistic Regression)<a href="glm.html#glm-logreg" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://en.wikipedia.org/wiki/Logistic_regression">Logistic regression</a> allows us to quantify the relationship between an outcome and other factors similar to traditional linear regression. However, traditional linear regression is limited to continuous outcomes and is thus not suitable for modelling binary outcomes. This is because the normality assumption of the outcome will be violated.</p>
<p>More specifically, logistic regression relates a binary outcome <span class="math inline">\(\bm{Y_i}\)</span> to a set of covariates <span class="math inline">\(\bm{x_i}\)</span> through the mean, as
<span class="math display">\[
g(\mu_i) = \bm{x}_i^T\bm{\beta}
\]</span>
where <span class="math inline">\(Y_i\)</span> is the binary outcome for individual <span class="math inline">\(i\)</span>, <span class="math inline">\(bm{x}_i\)</span> is a <span class="math inline">\(p \times 1\)</span> vector of covariates for individual <span class="math inline">\(i\)</span>, and <span class="math inline">\(g(\cdot)\)</span> is a <a href="https://en.wikipedia.org/wiki/Generalized_linear_model#Link_function">link function</a>. For logistic regression, we use the <a href="https://en.wikipedia.org/wiki/Logit">logit link</a>, meaning we express our model as</p>
<p><span class="math display">\[
\text{log} \left[\frac{P(Y_i=1|\bm{x}_i)}{P(Y_i=0|\bm{x}_i)} \right] = \text{log} \left[\frac{\pi_i}{1-\pi_i} \right]=\bm{x_i}^T\bm{\beta}
\]</span>
That is, we model the natural logarithm of the ratio of the probability that <span class="math inline">\(Y_i\)</span> is one versus zero. We denote the probability that <span class="math inline">\(Y_i\)</span> is one given covariates <span class="math inline">\(\bm{x}_i\)</span> as <span class="math inline">\(\pi_i\)</span>. We refer to the quantity <span class="math inline">\(\text{log} \left[\frac{\pi_i}{1-\pi_i} \right]\)</span> as the <strong>log-odds</strong> (the logarithm of the <a href="https://en.wikipedia.org/wiki/Odds">odds</a>) where the odds is the ratio of the probability an event occurring (<span class="math inline">\(P(Y_i = 1)\)</span>) versus not occurring (<span class="math inline">\(P(Y_i = 0)\)</span>). For example, in a roll of a standard six-sided die, the odds of rolling a three is
<span class="math display">\[
\text{Odds} = \frac{P(\text{3 is rolled})}{P(\text{3 is not rolled})} = \frac{(1/6)}{(5/6)} = 1/5 = 0.2
\]</span>
We emphasize that the odds are <strong>not</strong> equal to the probability of an event happening. The probability of rolling a three on a standard die is <span class="math inline">\(1/6 = 0.167\)</span>, which is not equal to the odds, however the two quantities are related by the definition of the odds.</p>
<p>Notice that in our model that there is no random error term. This may be surprising as we typically see a random error term in linear regression models, however because we are modelling the mean of the outcome a random error term is not needed.</p>
<p>Our primary interest is in estimating the coefficients <span class="math inline">\(\bm{\beta}\)</span> in our model. These coefficients can be interpreted as log odds ratio of the outcome for a one unit change in the corresponding covariate. For example, if we consider a discrete covariate <span class="math inline">\(x_1\)</span> representing disease presence, we would interpret <span class="math inline">\(\beta_1\)</span> as the estimated log odds ratio of the outcome <span class="math inline">\(Y\)</span> for those with the disease versus without, controlling for other covariates in the model. For continuous covariates such as age, we would interpret the coefficient as the estimated log odds ratio associated with a one year increase in age, controlling for other covariates. We will show examples of the model interpretation for real data examples in the following sections, with a focus on building, evaluating, and interpreting models in R.</p>
<div id="glm-logreg-example" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Example<a href="glm.html#glm-logreg-example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let us look at an example using the <code>heart</code> data set from the <a href="https://CRAN.R-project.org/package=catdata"><strong>catdata</strong></a> package in R. This data set contains a retrospective sample of 462 males between ages 15 and 64 in South Africa where the risk of heart disease is considered high. We have data on whether or not the subject has coronary heart disease (CHD) (<code>y</code> = 1 indicates subject has CHD), measurements of systolic blood pressure (<code>sbp</code>), cumulative tobacco use (<code>tobacco</code>), low density lipoprotein cholesterol (<code>ldl</code>), adiposity (<code>adiposity</code>), whether or not the subject has a family history of heart disease (<code>famhist</code> = 1 indicates family history), measures of type-A behavior (<code>typea</code>), a measure of obesity (<code>obestiy</code>), current alcohol consumption (<code>alcohol</code>), and the subject’s age (<code>age</code>).</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="glm.html#cb196-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;heart&quot;</span>, <span class="at">package =</span> <span class="st">&quot;catdata&quot;</span>) <span class="co"># load the data set heart from catdata package</span></span>
<span id="cb196-2"><a href="glm.html#cb196-2" tabindex="-1"></a><span class="co"># here we specify package because there are other data sets named</span></span>
<span id="cb196-3"><a href="glm.html#cb196-3" tabindex="-1"></a><span class="co"># heart in other loaded packages</span></span>
<span id="cb196-4"><a href="glm.html#cb196-4" tabindex="-1"></a></span>
<span id="cb196-5"><a href="glm.html#cb196-5" tabindex="-1"></a><span class="co"># convert to data frame</span></span>
<span id="cb196-6"><a href="glm.html#cb196-6" tabindex="-1"></a>heart <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(heart)</span>
<span id="cb196-7"><a href="glm.html#cb196-7" tabindex="-1"></a></span>
<span id="cb196-8"><a href="glm.html#cb196-8" tabindex="-1"></a><span class="co"># view first 6 rows of data</span></span>
<span id="cb196-9"><a href="glm.html#cb196-9" tabindex="-1"></a><span class="fu">head</span>(heart)</span></code></pre></div>
<pre><code>##   y sbp tobacco  ldl adiposity famhist typea obesity alcohol age
## 1 1 160   12.00 5.73     23.11       1    49   25.30   97.20  52
## 2 1 144    0.01 4.41     28.61       0    55   28.87    2.06  63
## 3 0 118    0.08 3.48     32.28       1    52   29.14    3.81  46
## 4 1 170    7.50 6.41     38.03       1    51   31.99   24.26  58
## 5 1 134   13.60 3.50     27.78       1    60   25.99   57.34  49
## 6 0 132    6.20 6.47     36.21       1    62   30.77   14.14  45</code></pre>
<p>For illustrative purposes, we will convert <code>age</code> into a categorical variable to have a multi-level categorical variable in our analysis. We will convert our age into 10-year age categories: 1: 15 to 24, 2: 25 to 34, 3: 35 to 44, 4: 45 to 54, 5: 55 to 64. We emphasize that this decision is just to show readers how to work with categorical factors. We convert our variable into a factor using the following code:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="glm.html#cb198-1" tabindex="-1"></a><span class="co">#make a copy of age</span></span>
<span id="cb198-2"><a href="glm.html#cb198-2" tabindex="-1"></a>heart<span class="sc">$</span>age_f <span class="ot">&lt;-</span> heart<span class="sc">$</span>age</span>
<span id="cb198-3"><a href="glm.html#cb198-3" tabindex="-1"></a></span>
<span id="cb198-4"><a href="glm.html#cb198-4" tabindex="-1"></a><span class="co"># overwrite it, making groups by age</span></span>
<span id="cb198-5"><a href="glm.html#cb198-5" tabindex="-1"></a>heart<span class="sc">$</span>age_f[heart<span class="sc">$</span>age <span class="sc">%in%</span> <span class="dv">15</span><span class="sc">:</span><span class="dv">24</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb198-6"><a href="glm.html#cb198-6" tabindex="-1"></a>heart<span class="sc">$</span>age_f[heart<span class="sc">$</span>age <span class="sc">%in%</span> <span class="dv">25</span><span class="sc">:</span><span class="dv">34</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb198-7"><a href="glm.html#cb198-7" tabindex="-1"></a>heart<span class="sc">$</span>age_f[heart<span class="sc">$</span>age <span class="sc">%in%</span> <span class="dv">35</span><span class="sc">:</span><span class="dv">44</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb198-8"><a href="glm.html#cb198-8" tabindex="-1"></a>heart<span class="sc">$</span>age_f[heart<span class="sc">$</span>age <span class="sc">%in%</span> <span class="dv">45</span><span class="sc">:</span><span class="dv">54</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb198-9"><a href="glm.html#cb198-9" tabindex="-1"></a>heart<span class="sc">$</span>age_f[heart<span class="sc">$</span>age <span class="sc">%in%</span> <span class="dv">55</span><span class="sc">:</span><span class="dv">64</span>] <span class="ot">&lt;-</span> <span class="dv">5</span></span></code></pre></div>
<p>From this data set, we’d like to see if there is a relationship between CHD diagnosis and tobacco use. We wish to control for other factors in our analysis, which we can do using a logistic regression model.</p>
<p>Before building logistic regression models in R, we need to pre-process or “clean” the data. The first thing we can do is ensure the covariates in our data set are the correct type (continuous, categorical, etc) so that the model will be appropriately fit. The variables <code>sbp</code>, <code>tobacco</code>, <code>adiposity</code>, <code>obesity</code>, and <code>alcohol</code>, are continuous covariates and thus do not need to be specified as such. The variable <code>famhist</code> is a binary variable, and <code>age.f</code> is a categorical variable so these need to be specified as categorical variables or “factors” in R. We also need to convert the data set to a data frame. We do so with the following:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="glm.html#cb199-1" tabindex="-1"></a><span class="co"># specify categorical variables as factors</span></span>
<span id="cb199-2"><a href="glm.html#cb199-2" tabindex="-1"></a>heart<span class="sc">$</span>famhist_f <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart<span class="sc">$</span>famhist)</span>
<span id="cb199-3"><a href="glm.html#cb199-3" tabindex="-1"></a>heart<span class="sc">$</span>age_f <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart<span class="sc">$</span>age_f)</span></code></pre></div>
<p>Other things we may need to deal with in the data cleaning stage include missing data and duplicated responses. In our case, we do not have to deal with any of these issues and will continue with our analysis.</p>
<div id="glm-logreg-example-fit" class="section level4 hasAnchor" number="4.6.1.1">
<h4><span class="header-section-number">4.6.1.1</span> Model Fitting<a href="glm.html#glm-logreg-example-fit" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To fit a logistic regression model in R, we fit a generalized linear model using the <code>glm()</code> function and specify a logistic link function by using the <code>family=binomial(link = "logit")"</code> argument. For example, we can build the main-effects only logistic regression model considering all covariates previously described by:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="glm.html#cb200-1" tabindex="-1"></a><span class="co">#build the logistic model</span></span>
<span id="cb200-2"><a href="glm.html#cb200-2" tabindex="-1"></a>heart_modelmaineffects <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> sbp <span class="sc">+</span> tobacco <span class="sc">+</span> ldl <span class="sc">+</span> adiposity <span class="sc">+</span> famhist_f <span class="sc">+</span> </span>
<span id="cb200-3"><a href="glm.html#cb200-3" tabindex="-1"></a>                         typea <span class="sc">+</span> obesity <span class="sc">+</span> alcohol <span class="sc">+</span> age_f, </span>
<span id="cb200-4"><a href="glm.html#cb200-4" tabindex="-1"></a>                            <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data=</span>heart)</span>
<span id="cb200-5"><a href="glm.html#cb200-5" tabindex="-1"></a></span>
<span id="cb200-6"><a href="glm.html#cb200-6" tabindex="-1"></a><span class="co">#show the output</span></span>
<span id="cb200-7"><a href="glm.html#cb200-7" tabindex="-1"></a><span class="fu">summary</span>(heart_modelmaineffects)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ sbp + tobacco + ldl + adiposity + famhist_f + 
##     typea + obesity + alcohol + age_f, family = binomial(link = &quot;logit&quot;), 
##     data = heart)
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -6.166777   1.389558  -4.438 9.08e-06 ***
## sbp          0.007399   0.005745   1.288 0.197755    
## tobacco      0.083147   0.026648   3.120 0.001807 ** 
## ldl          0.168207   0.059890   2.809 0.004976 ** 
## adiposity    0.027937   0.029331   0.952 0.340868    
## famhist_f1   0.949461   0.229867   4.130 3.62e-05 ***
## typea        0.039052   0.012308   3.173 0.001510 ** 
## obesity     -0.076045   0.045265  -1.680 0.092959 .  
## alcohol     -0.001241   0.004499  -0.276 0.782638    
## age_f2       1.867250   0.792464   2.356 0.018460 *  
## age_f3       1.899604   0.796106   2.386 0.017027 *  
## age_f4       2.179759   0.809370   2.693 0.007078 ** 
## age_f5       2.710949   0.809071   3.351 0.000806 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 596.11  on 461  degrees of freedom
## Residual deviance: 468.28  on 449  degrees of freedom
## AIC: 494.28
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>Calling <code>summary()</code> on the model fit provides us with various estimates for the regression coefficients (“Estimate”), standard errors (“Std. Error”), and the associated Wald test statistic (“z value”) and <span class="math inline">\(p\)</span>-value (“Pr(&gt;|z|)”) for the null hypothesis that the corresponding coefficient is equal to zero.</p>
<p>While we could interpret this model and perform hypothesis tests, we must consider model selection to find the most appropriate model to answer our research questions.</p>
<p>We notice from the model output that <code>alcohol</code>, <code>adiposity</code> and <code>sbp</code> covariates have large <span class="math inline">\(p\)</span>-values for the Wald test that <span class="math inline">\(\beta_{sbp} = 0\)</span> and <span class="math inline">\(\beta_{adiposity} = 0\)</span> and <span class="math inline">\(\beta_{alcohol} = 0\)</span>. We can see if these covariates are necessary in the model by testing the full model against one that does not contain those two covariates by a LRT. We do so in R by first fitting the new model, obtaining the residual deviance from both models we are comparing, and performing the LRT using the degrees of freedom (df) equal to the difference in the number of covariates between the two models (here, we removed 3 covariates and thus we have 3 degrees of freedom). The null hypothesis here is that <code>heart_model2</code> is adequate compared to <code>heart_modelfull</code>.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="glm.html#cb202-1" tabindex="-1"></a><span class="co"># fit the nested model without sbp, alcohol, or adiposity</span></span>
<span id="cb202-2"><a href="glm.html#cb202-2" tabindex="-1"></a>heart_model2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> tobacco <span class="sc">+</span> ldl <span class="sc">+</span> famhist_f <span class="sc">+</span> typea <span class="sc">+</span> </span>
<span id="cb202-3"><a href="glm.html#cb202-3" tabindex="-1"></a>                      obesity <span class="sc">+</span> age_f, </span>
<span id="cb202-4"><a href="glm.html#cb202-4" tabindex="-1"></a>                    <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data=</span>heart)</span>
<span id="cb202-5"><a href="glm.html#cb202-5" tabindex="-1"></a></span>
<span id="cb202-6"><a href="glm.html#cb202-6" tabindex="-1"></a><span class="co"># perform the LRT </span></span>
<span id="cb202-7"><a href="glm.html#cb202-7" tabindex="-1"></a><span class="fu">anova</span>(heart_model2, heart_modelmaineffects, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: y ~ tobacco + ldl + famhist_f + typea + obesity + age_f
## Model 2: y ~ sbp + tobacco + ldl + adiposity + famhist_f + typea + obesity + 
##     alcohol + age_f
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
## 1       452     471.07                     
## 2       449     468.28  3   2.7856   0.4259</code></pre>
<p>We have a large <span class="math inline">\(p\)</span>-value here, indicating that we do NOT reject the null hypothesis. That is, we are comfortable moving forward with the simpler model. Let’s take a look at the model summary:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="glm.html#cb204-1" tabindex="-1"></a><span class="fu">summary</span>(heart_model2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ tobacco + ldl + famhist_f + typea + obesity + 
##     age_f, family = binomial(link = &quot;logit&quot;), data = heart)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -5.56962    1.16980  -4.761 1.92e-06 ***
## tobacco      0.08307    0.02597   3.199  0.00138 ** 
## ldl          0.18393    0.05839   3.150  0.00163 ** 
## famhist_f1   0.93218    0.22816   4.086 4.40e-05 ***
## typea        0.03717    0.01218   3.052  0.00228 ** 
## obesity     -0.03857    0.02976  -1.296  0.19491    
## age_f2       1.88884    0.78761   2.398  0.01648 *  
## age_f3       2.05322    0.78102   2.629  0.00857 ** 
## age_f4       2.42502    0.78318   3.096  0.00196 ** 
## age_f5       3.03253    0.77335   3.921 8.81e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 596.11  on 461  degrees of freedom
## Residual deviance: 471.07  on 452  degrees of freedom
## AIC: 491.07
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>We notice that as we add and remove covariates, the estimates of our coefficients, standard errors, test statistics, and <span class="math inline">\(p\)</span>-values will change. We see that <code>obestiy</code> does not appear to be significant in the model. We can see if this variable are necessary again by performing an LRT against our second model:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="glm.html#cb206-1" tabindex="-1"></a><span class="co"># fit the nested model without obesity</span></span>
<span id="cb206-2"><a href="glm.html#cb206-2" tabindex="-1"></a>heart_model3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> tobacco <span class="sc">+</span> ldl <span class="sc">+</span> famhist_f <span class="sc">+</span> typea <span class="sc">+</span> age_f, </span>
<span id="cb206-3"><a href="glm.html#cb206-3" tabindex="-1"></a>                    <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data=</span>heart)</span>
<span id="cb206-4"><a href="glm.html#cb206-4" tabindex="-1"></a></span>
<span id="cb206-5"><a href="glm.html#cb206-5" tabindex="-1"></a><span class="co"># perform the LRT </span></span>
<span id="cb206-6"><a href="glm.html#cb206-6" tabindex="-1"></a><span class="fu">anova</span>(heart_model3, heart_model2, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: y ~ tobacco + ldl + famhist_f + typea + age_f
## Model 2: y ~ tobacco + ldl + famhist_f + typea + obesity + age_f
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
## 1       453     472.79                     
## 2       452     471.07  1    1.716   0.1902</code></pre>
<p>We have a moderate <span class="math inline">\(p\)</span>-value of 0.1902 here, indicating that we do NOT reject the null hypothesis. That is, we are comfortable moving forward with the simpler model (<code>heart_model3</code>). Let’s take a look at the model summary:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="glm.html#cb208-1" tabindex="-1"></a><span class="fu">summary</span>(heart_model3)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ tobacco + ldl + famhist_f + typea + age_f, 
##     family = binomial(link = &quot;logit&quot;), data = heart)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -6.31391    1.02645  -6.151 7.69e-10 ***
## tobacco      0.08394    0.02596   3.233 0.001224 ** 
## ldl          0.16274    0.05535   2.940 0.003280 ** 
## famhist_f1   0.92923    0.22777   4.080 4.51e-05 ***
## typea        0.03630    0.01216   2.986 0.002827 ** 
## age_f2       1.78017    0.78250   2.275 0.022908 *  
## age_f3       1.93384    0.77520   2.495 0.012609 *  
## age_f4       2.25988    0.77211   2.927 0.003424 ** 
## age_f5       2.91276    0.76700   3.798 0.000146 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 596.11  on 461  degrees of freedom
## Residual deviance: 472.79  on 453  degrees of freedom
## AIC: 490.79
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>All of the remaining covariates in our model are significantly significant. While we could stop the model selection procedure here, we should also consider interactions and higher-order terms in our model selection.</p>
<p>It is possible that those with a family history of heart disease may have different cholesterol levels than those who do not. We can consider adding in this interaction term to account for the potential difference in cholesterol levels by family history, and its impact on chronic heart disease diagnosis. We further fit another model with the interaction and perform an LRT against the model without the interaction by:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="glm.html#cb210-1" tabindex="-1"></a><span class="co"># fit the nested model with an interaction term</span></span>
<span id="cb210-2"><a href="glm.html#cb210-2" tabindex="-1"></a>heart_model4 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> tobacco <span class="sc">+</span> ldl <span class="sc">+</span> famhist_f <span class="sc">+</span> typea <span class="sc">+</span> age_f <span class="sc">+</span> ldl<span class="sc">*</span>famhist_f, </span>
<span id="cb210-3"><a href="glm.html#cb210-3" tabindex="-1"></a>                    <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data=</span>heart)</span>
<span id="cb210-4"><a href="glm.html#cb210-4" tabindex="-1"></a></span>
<span id="cb210-5"><a href="glm.html#cb210-5" tabindex="-1"></a><span class="co">#show the output</span></span>
<span id="cb210-6"><a href="glm.html#cb210-6" tabindex="-1"></a></span>
<span id="cb210-7"><a href="glm.html#cb210-7" tabindex="-1"></a><span class="co"># perform the LRT </span></span>
<span id="cb210-8"><a href="glm.html#cb210-8" tabindex="-1"></a><span class="fu">anova</span>(heart_model3, heart_model4, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: y ~ tobacco + ldl + famhist_f + typea + age_f
## Model 2: y ~ tobacco + ldl + famhist_f + typea + age_f + ldl * famhist_f
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)   
## 1       453     472.79                        
## 2       452     463.46  1   9.3244 0.002261 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We have a small <span class="math inline">\(p\)</span>-value here, indicating that we reject the null hypothesis that the simpler model fits as well as the larger model. That is, we should include the interaction term in our model. Let’s look at the summary of this model:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="glm.html#cb212-1" tabindex="-1"></a><span class="fu">summary</span>(heart_model4)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ tobacco + ldl + famhist_f + typea + age_f + 
##     ldl * famhist_f, family = binomial(link = &quot;logit&quot;), data = heart)
## 
## Coefficients:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -5.61061    1.04614  -5.363 8.18e-08 ***
## tobacco         0.08901    0.02644   3.366 0.000762 ***
## ldl             0.01087    0.07413   0.147 0.883425    
## famhist_f1     -0.81122    0.62828  -1.291 0.196643    
## typea           0.03625    0.01243   2.917 0.003535 ** 
## age_f2          1.79383    0.78263   2.292 0.021902 *  
## age_f3          1.95366    0.77616   2.517 0.011834 *  
## age_f4          2.24868    0.77355   2.907 0.003650 ** 
## age_f5          2.96258    0.76746   3.860 0.000113 ***
## ldl:famhist_f1  0.34624    0.11725   2.953 0.003146 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 596.11  on 461  degrees of freedom
## Residual deviance: 463.46  on 452  degrees of freedom
## AIC: 483.46
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>We notice that the main effects of <code>ldl</code> and <code>famhist_f</code> are now insignificant. However, as we have the interaction term in the model, we tend to want to keep the main effects in the model as well to interpret. We note that there is a higher chance that the interaction will be significant if the main effects are as well.</p>
<p>We also note that for categorical variables, we do not test if individual levels of the covariate should be included. That is, if one level of <code>age_f</code> was not significant, we do not remove that one level. We would need to do an LRT to see if the entire covariate of <code>age_f</code> was necessary. We can do so by the following:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="glm.html#cb214-1" tabindex="-1"></a><span class="co"># fit the model without age_f</span></span>
<span id="cb214-2"><a href="glm.html#cb214-2" tabindex="-1"></a>heart_model5 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> tobacco <span class="sc">+</span> ldl <span class="sc">+</span> famhist_f <span class="sc">+</span> typea <span class="sc">+</span> ldl<span class="sc">*</span>famhist_f, </span>
<span id="cb214-3"><a href="glm.html#cb214-3" tabindex="-1"></a>                    <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data=</span>heart)</span>
<span id="cb214-4"><a href="glm.html#cb214-4" tabindex="-1"></a></span>
<span id="cb214-5"><a href="glm.html#cb214-5" tabindex="-1"></a><span class="co"># perform the LRT </span></span>
<span id="cb214-6"><a href="glm.html#cb214-6" tabindex="-1"></a><span class="fu">anova</span>(heart_model4, heart_model5, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: y ~ tobacco + ldl + famhist_f + typea + age_f + ldl * famhist_f
## Model 2: y ~ tobacco + ldl + famhist_f + typea + ldl * famhist_f
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1       452     463.46                          
## 2       456     494.11 -4  -30.651 3.606e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We have a very small <span class="math inline">\(p\)</span>-value, indicating that we reject the null hypothesis that the simpler model is better. That is, <code>age_f</code> is necessary in our model and we should use <code>heart_model4</code> as our final model!</p>
<p>We will compare the final model selected by LRTs to a built-in stepwise model selection procedure in R using the <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/step"><code>step()</code></a> function. The <code>step()</code> function evaluates the model on the <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion">Akaike information criterion (AIC)</a>, where a smaller value represents a better fit. To do so in R, we use this function on the full model and perform a backward selection procedure by:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="glm.html#cb216-1" tabindex="-1"></a><span class="co">#fit a full model, including the interaction</span></span>
<span id="cb216-2"><a href="glm.html#cb216-2" tabindex="-1"></a>heart_full <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> sbp <span class="sc">+</span> tobacco <span class="sc">+</span> ldl <span class="sc">+</span> adiposity <span class="sc">+</span> famhist_f <span class="sc">+</span> </span>
<span id="cb216-3"><a href="glm.html#cb216-3" tabindex="-1"></a>                         typea <span class="sc">+</span> obesity <span class="sc">+</span> alcohol <span class="sc">+</span> age_f <span class="sc">+</span> ldl<span class="sc">*</span>famhist_f, </span>
<span id="cb216-4"><a href="glm.html#cb216-4" tabindex="-1"></a>                            <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data=</span>heart)</span>
<span id="cb216-5"><a href="glm.html#cb216-5" tabindex="-1"></a></span>
<span id="cb216-6"><a href="glm.html#cb216-6" tabindex="-1"></a></span>
<span id="cb216-7"><a href="glm.html#cb216-7" tabindex="-1"></a><span class="fu">step</span>(heart_full, <span class="at">direction =</span> <span class="fu">c</span>(<span class="st">&quot;backward&quot;</span>))</span></code></pre></div>
<pre><code>## Start:  AIC=487.47
## y ~ sbp + tobacco + ldl + adiposity + famhist_f + typea + obesity + 
##     alcohol + age_f + ldl * famhist_f
## 
##                 Df Deviance    AIC
## - alcohol        1   459.49 485.49
## - adiposity      1   460.12 486.12
## - sbp            1   460.93 486.93
## &lt;none&gt;               459.47 487.47
## - obesity        1   462.01 488.01
## - ldl:famhist_f  1   468.28 494.28
## - typea          1   469.41 495.41
## - tobacco        1   470.81 496.81
## - age_f          4   479.03 499.03
## 
## Step:  AIC=485.49
## y ~ sbp + tobacco + ldl + adiposity + famhist_f + typea + obesity + 
##     age_f + ldl:famhist_f
## 
##                 Df Deviance    AIC
## - adiposity      1   460.13 484.13
## - sbp            1   460.93 484.93
## &lt;none&gt;               459.49 485.49
## - obesity        1   462.02 486.02
## - ldl:famhist_f  1   468.36 492.36
## - typea          1   469.42 493.42
## - tobacco        1   471.01 495.01
## - age_f          4   479.08 497.08
## 
## Step:  AIC=484.13
## y ~ sbp + tobacco + ldl + famhist_f + typea + obesity + age_f + 
##     ldl:famhist_f
## 
##                 Df Deviance    AIC
## - sbp            1   461.74 483.74
## &lt;none&gt;               460.13 484.13
## - obesity        1   462.33 484.33
## - ldl:famhist_f  1   469.25 491.25
## - typea          1   469.70 491.70
## - tobacco        1   471.86 493.86
## - age_f          4   487.28 503.28
## 
## Step:  AIC=483.74
## y ~ tobacco + ldl + famhist_f + typea + obesity + age_f + ldl:famhist_f
## 
##                 Df Deviance    AIC
## - obesity        1   463.46 483.46
## &lt;none&gt;               461.74 483.74
## - typea          1   471.02 491.02
## - ldl:famhist_f  1   471.07 491.07
## - tobacco        1   473.92 493.92
## - age_f          4   493.79 507.79
## 
## Step:  AIC=483.46
## y ~ tobacco + ldl + famhist_f + typea + age_f + ldl:famhist_f
## 
##                 Df Deviance    AIC
## &lt;none&gt;               463.46 483.46
## - typea          1   472.38 490.38
## - ldl:famhist_f  1   472.79 490.79
## - tobacco        1   475.87 493.87
## - age_f          4   494.11 506.11</code></pre>
<pre><code>## 
## Call:  glm(formula = y ~ tobacco + ldl + famhist_f + typea + age_f + 
##     ldl:famhist_f, family = binomial(link = &quot;logit&quot;), data = heart)
## 
## Coefficients:
##    (Intercept)         tobacco             ldl      famhist_f1  
##       -5.61061         0.08901         0.01087        -0.81122  
##          typea          age_f2          age_f3          age_f4  
##        0.03625         1.79383         1.95366         2.24868  
##         age_f5  ldl:famhist_f1  
##        2.96258         0.34624  
## 
## Degrees of Freedom: 461 Total (i.e. Null);  452 Residual
## Null Deviance:       596.1 
## Residual Deviance: 463.5     AIC: 483.5</code></pre>
<p>The final model contains <code>tobacco</code>, <code>ldl</code>, <code>famhist_f</code>, <code>typea</code>, <code>age_f</code>, and the interaction between <code>ldl</code> and <code>famhist_f</code> as covariates. The model chosen by the <code>step()</code> function in this case is exactly the same as the one we obtained by the LRT. However, depending on the order we perform the likelihood ratio tests, or the direction of the stepwise algorithm, we can obtain different model results. Likelihood ratio tests tend to be preferred over AIC based algorithms for building logistic regression models where we want to draw claims and perform hypothesis tests while AIC based algorithms tend to be preferred for forecasting problems. As such, we will continue our analysis with the model chosen by our LRTs.</p>
</div>
<div id="glm-logreg-example-diagnostics" class="section level4 hasAnchor" number="4.6.1.2">
<h4><span class="header-section-number">4.6.1.2</span> Model Diagnostics<a href="glm.html#glm-logreg-example-diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Before interpreting the chosen model, we must assess the model fit. We can do so by plotting the deviance residuals to give an idea of the model fit. We can do so in R by:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="glm.html#cb219-1" tabindex="-1"></a><span class="co"># Plot the residuals</span></span>
<span id="cb219-2"><a href="glm.html#cb219-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">residuals</span>(heart_model4, <span class="at">type =</span> <span class="st">&quot;pearson&quot;</span>), <span class="at">ylab =</span> <span class="st">&quot;Pearson Residuals&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-logreg-md-plots"></span>
<img src="topics_in_consulting_files/figure-html/glm-logreg-md-plots-1.png" alt="Plot of Residuals for Logistic Regression Model" width="672" />
<p class="caption">
Figure 4.2: Plot of Residuals for Logistic Regression Model
</p>
</div>
<p>We notice that there are two subjects with high residual values. To identify them, we can use the following code;</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="glm.html#cb220-1" tabindex="-1"></a><span class="co"># sort residuals largest to smallest and select the first two</span></span>
<span id="cb220-2"><a href="glm.html#cb220-2" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">residuals</span>(heart_model4, <span class="at">type =</span> <span class="st">&quot;pearson&quot;</span>), <span class="at">decreasing =</span> T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>##      261       21 
## 6.714401 3.987004</code></pre>
<p>Subjects 261 and 21 have high deviance residuals. To see if these are <a href="https://en.wikipedia.org/wiki/Influential_observation#:~:text=In%20statistics%2C%20an%20influential%20observation,effect%20on%20the%20parameter%20estimates.">influential observations</a>, we can refit the logistic regression model without these observations. If the estimates of our model change greatly, then we should remove these two observations as they may affect inference and predictions made with the logistic regression model.</p>
<p>Let’s make a second data set without the 261st observation and see if the results of the model change.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="glm.html#cb222-1" tabindex="-1"></a>heart2 <span class="ot">&lt;-</span> heart[<span class="sc">-</span><span class="dv">261</span>,] <span class="co"># removing the 261st observation</span></span>
<span id="cb222-2"><a href="glm.html#cb222-2" tabindex="-1"></a></span>
<span id="cb222-3"><a href="glm.html#cb222-3" tabindex="-1"></a><span class="co">#fit the model using heart2</span></span>
<span id="cb222-4"><a href="glm.html#cb222-4" tabindex="-1"></a>heart_model4_2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> tobacco <span class="sc">+</span> ldl <span class="sc">+</span> famhist_f <span class="sc">+</span> typea <span class="sc">+</span> age_f <span class="sc">+</span> ldl<span class="sc">*</span>famhist_f, </span>
<span id="cb222-5"><a href="glm.html#cb222-5" tabindex="-1"></a>                    <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data=</span>heart2) <span class="co">#use heart2</span></span>
<span id="cb222-6"><a href="glm.html#cb222-6" tabindex="-1"></a></span>
<span id="cb222-7"><a href="glm.html#cb222-7" tabindex="-1"></a><span class="fu">summary</span>(heart_model4_2) <span class="co">#model summary excluding id 261</span></span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ tobacco + ldl + famhist_f + typea + age_f + 
##     ldl * famhist_f, family = binomial(link = &quot;logit&quot;), data = heart2)
## 
## Coefficients:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -6.41271    1.27032  -5.048 4.46e-07 ***
## tobacco         0.08917    0.02647   3.368 0.000757 ***
## ldl             0.01863    0.07452   0.250 0.802549    
## famhist_f1     -0.74549    0.63251  -1.179 0.238552    
## typea           0.03743    0.01254   2.985 0.002840 ** 
## age_f2          2.48866    1.05440   2.360 0.018262 *  
## age_f3          2.64455    1.04953   2.520 0.011744 *  
## age_f4          2.94108    1.04764   2.807 0.004995 ** 
## age_f5          3.65866    1.04328   3.507 0.000453 ***
## ldl:famhist_f1  0.33576    0.11769   2.853 0.004332 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 593.98  on 460  degrees of freedom
## Residual deviance: 455.17  on 451  degrees of freedom
## AIC: 475.17
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="glm.html#cb224-1" tabindex="-1"></a><span class="fu">summary</span>(heart_model4) <span class="co">#original model summary</span></span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ tobacco + ldl + famhist_f + typea + age_f + 
##     ldl * famhist_f, family = binomial(link = &quot;logit&quot;), data = heart)
## 
## Coefficients:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -5.61061    1.04614  -5.363 8.18e-08 ***
## tobacco         0.08901    0.02644   3.366 0.000762 ***
## ldl             0.01087    0.07413   0.147 0.883425    
## famhist_f1     -0.81122    0.62828  -1.291 0.196643    
## typea           0.03625    0.01243   2.917 0.003535 ** 
## age_f2          1.79383    0.78263   2.292 0.021902 *  
## age_f3          1.95366    0.77616   2.517 0.011834 *  
## age_f4          2.24868    0.77355   2.907 0.003650 ** 
## age_f5          2.96258    0.76746   3.860 0.000113 ***
## ldl:famhist_f1  0.34624    0.11725   2.953 0.003146 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 596.11  on 461  degrees of freedom
## Residual deviance: 463.46  on 452  degrees of freedom
## AIC: 483.46
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>We do see that the estimated coefficients and standard errors change after removing the observation. In particular, the estimated regression coefficients and standard errors of the <code>age_f</code> variable changed greatly. This shows that observation 261 is an influential observation, and should be removed.</p>
<p>We can do the same procedure for removing observation 21:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="glm.html#cb226-1" tabindex="-1"></a>heart3 <span class="ot">&lt;-</span> heart[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">261</span>),] <span class="co"># removing the 21st (and 261st from prev removal) </span></span>
<span id="cb226-2"><a href="glm.html#cb226-2" tabindex="-1"></a><span class="co"># observation</span></span>
<span id="cb226-3"><a href="glm.html#cb226-3" tabindex="-1"></a></span>
<span id="cb226-4"><a href="glm.html#cb226-4" tabindex="-1"></a><span class="co">#fit the model using heart3</span></span>
<span id="cb226-5"><a href="glm.html#cb226-5" tabindex="-1"></a>heart_model4_3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> tobacco <span class="sc">+</span> ldl <span class="sc">+</span> famhist_f <span class="sc">+</span> typea <span class="sc">+</span> age_f <span class="sc">+</span> ldl<span class="sc">*</span>famhist_f, </span>
<span id="cb226-6"><a href="glm.html#cb226-6" tabindex="-1"></a>                    <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data=</span>heart3) <span class="co">#use heart3</span></span>
<span id="cb226-7"><a href="glm.html#cb226-7" tabindex="-1"></a></span>
<span id="cb226-8"><a href="glm.html#cb226-8" tabindex="-1"></a><span class="fu">summary</span>(heart_model4_3) <span class="co">#model summary excluding id 21 and id 261</span></span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ tobacco + ldl + famhist_f + typea + age_f + 
##     ldl * famhist_f, family = binomial(link = &quot;logit&quot;), data = heart3)
## 
## Coefficients:
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -20.65184  793.20342  -0.026 0.979229    
## tobacco          0.08771    0.02635   3.328 0.000874 ***
## ldl              0.03073    0.07479   0.411 0.681168    
## famhist_f1      -0.65602    0.63603  -1.031 0.302337    
## typea            0.03471    0.01254   2.768 0.005642 ** 
## age_f2          16.82365  793.20311   0.021 0.983078    
## age_f3          16.97712  793.20310   0.021 0.982924    
## age_f4          17.26763  793.20310   0.022 0.982632    
## age_f5          17.97553  793.20309   0.023 0.981920    
## ldl:famhist_f1   0.32012    0.11794   2.714 0.006643 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 591.85  on 459  degrees of freedom
## Residual deviance: 446.13  on 450  degrees of freedom
## AIC: 466.13
## 
## Number of Fisher Scoring iterations: 17</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="glm.html#cb228-1" tabindex="-1"></a><span class="fu">summary</span>(heart_model4) <span class="co">#original model summary</span></span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ tobacco + ldl + famhist_f + typea + age_f + 
##     ldl * famhist_f, family = binomial(link = &quot;logit&quot;), data = heart)
## 
## Coefficients:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -5.61061    1.04614  -5.363 8.18e-08 ***
## tobacco         0.08901    0.02644   3.366 0.000762 ***
## ldl             0.01087    0.07413   0.147 0.883425    
## famhist_f1     -0.81122    0.62828  -1.291 0.196643    
## typea           0.03625    0.01243   2.917 0.003535 ** 
## age_f2          1.79383    0.78263   2.292 0.021902 *  
## age_f3          1.95366    0.77616   2.517 0.011834 *  
## age_f4          2.24868    0.77355   2.907 0.003650 ** 
## age_f5          2.96258    0.76746   3.860 0.000113 ***
## ldl:famhist_f1  0.34624    0.11725   2.953 0.003146 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 596.11  on 461  degrees of freedom
## Residual deviance: 463.46  on 452  degrees of freedom
## AIC: 483.46
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>Again we see that the coefficients change significantly and deem the 21st observation to be influential. Thus, we continue our analysis without observation 21 and 261.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="glm.html#cb230-1" tabindex="-1"></a><span class="co"># Plot the residuals</span></span>
<span id="cb230-2"><a href="glm.html#cb230-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">residuals</span>(heart_model4_3, <span class="at">type =</span> <span class="st">&quot;pearson&quot;</span>), <span class="at">ylab =</span> <span class="st">&quot;Pearson Residuals&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-logreg-md-plots2"></span>
<img src="topics_in_consulting_files/figure-html/glm-logreg-md-plots2-1.png" alt="Plot of Residuals for Logistic Regression Model\ with Influential Observation Removed" width="672" />
<p class="caption">
Figure 4.3: Plot of Residuals for Logistic Regression Model with Influential Observation Removed
</p>
</div>
<p>Now, we see that most residual values fall between <span class="math inline">\((-2, 2)\)</span> (with no values beyond <span class="math inline">\(\pm 3\)</span>), which indicates a proper model fit.</p>
<p>We notice that when we look at the model summary, some covariates have very large estimated standard errors and are no longer significant, indicating that after removing the influential observations we should re-do our model fitting.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="glm.html#cb231-1" tabindex="-1"></a><span class="co">#fit a full model, including the interaction</span></span>
<span id="cb231-2"><a href="glm.html#cb231-2" tabindex="-1"></a>heart_full2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> sbp <span class="sc">+</span> tobacco <span class="sc">+</span> ldl <span class="sc">+</span> adiposity <span class="sc">+</span> famhist_f <span class="sc">+</span> </span>
<span id="cb231-3"><a href="glm.html#cb231-3" tabindex="-1"></a>                         typea <span class="sc">+</span> obesity <span class="sc">+</span> alcohol <span class="sc">+</span> age_f <span class="sc">+</span> ldl<span class="sc">*</span>famhist_f, </span>
<span id="cb231-4"><a href="glm.html#cb231-4" tabindex="-1"></a>                            <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data=</span>heart3)</span>
<span id="cb231-5"><a href="glm.html#cb231-5" tabindex="-1"></a></span>
<span id="cb231-6"><a href="glm.html#cb231-6" tabindex="-1"></a></span>
<span id="cb231-7"><a href="glm.html#cb231-7" tabindex="-1"></a><span class="fu">step</span>(heart_full2, <span class="at">direction =</span> <span class="st">&quot;both&quot;</span>, <span class="at">trace =</span> <span class="dv">0</span>) <span class="co">#trace = 0 means don&#39;t print</span></span></code></pre></div>
<pre><code>## 
## Call:  glm(formula = y ~ tobacco + ldl + famhist_f + typea + age_f + 
##     ldl:famhist_f, family = binomial(link = &quot;logit&quot;), data = heart3)
## 
## Coefficients:
##    (Intercept)         tobacco             ldl      famhist_f1  
##      -20.65184         0.08771         0.03073        -0.65602  
##          typea          age_f2          age_f3          age_f4  
##        0.03471        16.82365        16.97712        17.26763  
##         age_f5  ldl:famhist_f1  
##       17.97553         0.32012  
## 
## Degrees of Freedom: 459 Total (i.e. Null);  450 Residual
## Null Deviance:       591.9 
## Residual Deviance: 446.1     AIC: 466.1</code></pre>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="glm.html#cb233-1" tabindex="-1"></a><span class="co"># every step</span></span></code></pre></div>
<p>Let’s see the summary of the model:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="glm.html#cb234-1" tabindex="-1"></a><span class="co"># fit a new model</span></span>
<span id="cb234-2"><a href="glm.html#cb234-2" tabindex="-1"></a>heart_model6 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> tobacco <span class="sc">+</span> ldl <span class="sc">+</span> famhist_f <span class="sc">+</span> </span>
<span id="cb234-3"><a href="glm.html#cb234-3" tabindex="-1"></a>                         typea <span class="sc">+</span> age_f <span class="sc">+</span> ldl<span class="sc">*</span>famhist_f , </span>
<span id="cb234-4"><a href="glm.html#cb234-4" tabindex="-1"></a>                            <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data=</span>heart3)</span>
<span id="cb234-5"><a href="glm.html#cb234-5" tabindex="-1"></a><span class="fu">summary</span>(heart_model6)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ tobacco + ldl + famhist_f + typea + age_f + 
##     ldl * famhist_f, family = binomial(link = &quot;logit&quot;), data = heart3)
## 
## Coefficients:
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -20.65184  793.20342  -0.026 0.979229    
## tobacco          0.08771    0.02635   3.328 0.000874 ***
## ldl              0.03073    0.07479   0.411 0.681168    
## famhist_f1      -0.65602    0.63603  -1.031 0.302337    
## typea            0.03471    0.01254   2.768 0.005642 ** 
## age_f2          16.82365  793.20311   0.021 0.983078    
## age_f3          16.97712  793.20310   0.021 0.982924    
## age_f4          17.26763  793.20310   0.022 0.982632    
## age_f5          17.97553  793.20309   0.023 0.981920    
## ldl:famhist_f1   0.32012    0.11794   2.714 0.006643 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 591.85  on 459  degrees of freedom
## Residual deviance: 446.13  on 450  degrees of freedom
## AIC: 466.13
## 
## Number of Fisher Scoring iterations: 17</code></pre>
<p>Although the stepwise procedure (and an LRT) will tell us otherwise, we should remove the age_f variable due to the large, insignificant estimates. It is likely that for this sample, <code>age_f</code> is not adding any value to our model. We refit this model without <code>age_f</code>:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="glm.html#cb236-1" tabindex="-1"></a><span class="co"># fit a new model</span></span>
<span id="cb236-2"><a href="glm.html#cb236-2" tabindex="-1"></a>heart_model7 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> tobacco <span class="sc">+</span> ldl <span class="sc">+</span> famhist_f <span class="sc">+</span> </span>
<span id="cb236-3"><a href="glm.html#cb236-3" tabindex="-1"></a>                         typea <span class="sc">+</span> ldl<span class="sc">*</span>famhist_f , </span>
<span id="cb236-4"><a href="glm.html#cb236-4" tabindex="-1"></a>                            <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data=</span>heart3)</span>
<span id="cb236-5"><a href="glm.html#cb236-5" tabindex="-1"></a><span class="fu">summary</span>(heart_model7)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ tobacco + ldl + famhist_f + typea + ldl * famhist_f, 
##     family = binomial(link = &quot;logit&quot;), data = heart3)
## 
## Coefficients:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -3.47029    0.74548  -4.655 3.24e-06 ***
## tobacco         0.13821    0.02539   5.444 5.22e-08 ***
## ldl             0.09899    0.07189   1.377  0.16850    
## famhist_f1     -0.39576    0.61446  -0.644  0.51953    
## typea           0.02383    0.01182   2.016  0.04385 *  
## ldl:famhist_f1  0.30096    0.11609   2.592  0.00953 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 591.85  on 459  degrees of freedom
## Residual deviance: 486.83  on 454  degrees of freedom
## AIC: 498.83
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>and see estimates with less extreme values and variances. When we plot the residuals:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="glm.html#cb238-1" tabindex="-1"></a><span class="co"># Plot the residuals</span></span>
<span id="cb238-2"><a href="glm.html#cb238-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">residuals</span>(heart_model7, <span class="at">type =</span> <span class="st">&quot;pearson&quot;</span>), <span class="at">ylab =</span> <span class="st">&quot;Pearson Residuals&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-logreg-md-plots3"></span>
<img src="topics_in_consulting_files/figure-html/glm-logreg-md-plots3-1.png" alt="Plot of Residuals for Second \Logistic Regression Modelwith Influential Observation Removed" width="672" />
<p class="caption">
Figure 4.4: Plot of Residuals for Second Regression Modelwith Influential Observation Removed
</p>
</div>
<p>We see that the residuals are behaving as expected with no extreme values.</p>
<p>We should also check for multicollinearity in our model. We can do so by using the <code>vif()</code> function from the <a href="https://CRAN.R-project.org/package=car"><strong>car</strong></a> package. We can do so by the following R code:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="glm.html#cb239-1" tabindex="-1"></a><span class="co"># there are multiple vif functions so car:: specifies </span></span>
<span id="cb239-2"><a href="glm.html#cb239-2" tabindex="-1"></a><span class="co"># we are using the vif function from the car package</span></span>
<span id="cb239-3"><a href="glm.html#cb239-3" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(heart_model7) </span></code></pre></div>
<pre><code>##       tobacco           ldl     famhist_f         typea 
##      1.034016      1.649904      7.596317      1.013287 
## ldl:famhist_f 
##      8.480374</code></pre>
<p>We see that we only have low-moderate variance inflation factors (VIFs), indicating that multicollinearity is not an issue in this model. We typically are concerned about multicollinearity when VIF values are above 10.</p>
</div>
<div id="glm-logreg-example-ht" class="section level4 hasAnchor" number="4.6.1.3">
<h4><span class="header-section-number">4.6.1.3</span> Model Interpretation and Hypothesis Testing<a href="glm.html#glm-logreg-example-ht" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Odds Ratios</strong></p>
<p>As previously mentioned, we interpret each coefficients as the log odds ratio of the outcome for a one unit change in the corresponding covariate, controlling for the other covariates in the model. That means, to obtain estimates of the odds ratio, we take the exponential (<code>exp()</code> in R) of the coefficient. The estimates of the standard error for the coefficients (log-odds) will be useful for hypothesis testing and constructing confidence intervals.</p>
<p>Let’s look again at the model we chose from the selection procedure:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="glm.html#cb241-1" tabindex="-1"></a><span class="fu">summary</span>(heart_model7)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ tobacco + ldl + famhist_f + typea + ldl * famhist_f, 
##     family = binomial(link = &quot;logit&quot;), data = heart3)
## 
## Coefficients:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    -3.47029    0.74548  -4.655 3.24e-06 ***
## tobacco         0.13821    0.02539   5.444 5.22e-08 ***
## ldl             0.09899    0.07189   1.377  0.16850    
## famhist_f1     -0.39576    0.61446  -0.644  0.51953    
## typea           0.02383    0.01182   2.016  0.04385 *  
## ldl:famhist_f1  0.30096    0.11609   2.592  0.00953 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 591.85  on 459  degrees of freedom
## Residual deviance: 486.83  on 454  degrees of freedom
## AIC: 498.83
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>In mathematical notation, we can write this model as</p>
<p><span class="math display">\[
\begin{aligned}
\text{log} \left[\frac{\pi_i}{1-\pi_i} \right]= \beta_0 + &amp;\beta_1x_1 + \beta_2x_2 + \beta_3x_3 + \beta_4x_4 + \beta_5x_2*x_3
\end{aligned}
\]</span>
where <span class="math inline">\(\pi_i\)</span> is the probability of having CHD, <span class="math inline">\(x_1\)</span> is the measurement of cumulative tobacco use, <span class="math inline">\(x_2\)</span> is the ldl cholesterol measurement, <span class="math inline">\(x_3\)</span> is an indicator for family history, and <span class="math inline">\(x_4\)</span> is the type a measurement.</p>
<p>We are provided with the estimates and standard errors of the log odds ratios, but typically want to interpret and communicate our findings on the scale of odd ratios. To obtain an estimate of the odds ratio for a given covariate, we simply exponentiate the coefficient. For example, the <code>tobacco</code> covariate’s estimated coefficient (<span class="math inline">\(\widehat{\beta_1}\)</span>) is 0.138, meaning we estimate that a one unit increase in <code>tobacco</code> is associated with a <strong>log odds ratio</strong> of chronic heart disease equal to 0.138, controlling for the other factors in the model. Alternatively, we can say that a one unit increase in <code>tobacco</code> is associated with an <strong>odds ratio</strong> of chronic heart disease equal to <span class="math inline">\(\exp(\)</span> 0.138 <span class="math inline">\()\)</span> = 1.148, controlling for other factors.</p>
<p><a href="https://en.wikipedia.org/wiki/Confidence_interval">Confidence intervals</a> (CIs) are useful in communicating the uncertainty in our estimates and are typically presented along with our estimate. Confidence intervals are calculated on the log odds ratio scale, and then exponentiated to find the confidence interval for the odds ratio. We calculate a 95% confidence interval for a log odds ratio as:</p>
<p><span class="math display">\[
\widehat{\beta} \pm 1.96\times \widehat{se}(\widehat{\beta})
\]</span>
where <span class="math inline">\(\widehat{se}(\widehat{\beta})\)</span> is the estimated standard error of the regression coefficient. For example, a 95% confidence interval for the log odds ratio of <code>tobacco</code> is
<span class="math display">\[
0.138 \pm 1.960 \times 0.025 = (0.089, 0.187).
\]</span>
Then, to find the 95% CI for the odds ratio, we exponentiate both sides of the CI as:
<span class="math display">\[
(\exp(0.089), \exp(0.187)) = (1.093, 1.206)
\]</span>
So, we estimate the odds ratio to be 1.148 (95% CI: (1.093, 1.206)) controlling for the other factors in the model. As this 95% CI does not contain the value of OR = 1 in it, we say that we are 95% confident that higher tobacco use is associated with an increased odds of developing CHD.</p>
<p>For the odds ratios and confidence intervals of the regression coefficients individually, one can also call the <code>confint.default()</code> function</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="glm.html#cb243-1" tabindex="-1"></a>logORs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">coef</span>(heart_model7), <span class="fu">confint.default</span>(heart_model7))</span>
<span id="cb243-2"><a href="glm.html#cb243-2" tabindex="-1"></a><span class="fu">colnames</span>(logORs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;logOR&quot;</span>, <span class="st">&quot;Lower&quot;</span>, <span class="st">&quot;Upper&quot;</span>)</span>
<span id="cb243-3"><a href="glm.html#cb243-3" tabindex="-1"></a>logORs</span></code></pre></div>
<pre><code>##                      logOR         Lower       Upper
## (Intercept)    -3.47028789 -4.9314011158 -2.00917466
## tobacco         0.13820940  0.0884465653  0.18797224
## ldl             0.09899415 -0.0419048152  0.23989312
## famhist_f1     -0.39575571 -1.6000802163  0.80856880
## typea           0.02382659  0.0006571497  0.04699603
## ldl:famhist_f1  0.30095626  0.0734244303  0.52848808</code></pre>
<p>and exponentiate it to get the ORs:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="glm.html#cb245-1" tabindex="-1"></a>ORs <span class="ot">&lt;-</span> <span class="fu">exp</span>(logORs)</span>
<span id="cb245-2"><a href="glm.html#cb245-2" tabindex="-1"></a><span class="fu">colnames</span>(ORs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Odds Ratio&quot;</span>, <span class="st">&quot;Lower&quot;</span>, <span class="st">&quot;Upper&quot;</span>)</span>
<span id="cb245-3"><a href="glm.html#cb245-3" tabindex="-1"></a>ORs</span></code></pre></div>
<pre><code>##                Odds Ratio       Lower     Upper
## (Intercept)    0.03110807 0.007216385 0.1340993
## tobacco        1.14821596 1.092475875 1.2068000
## ldl            1.10405984 0.958961055 1.2711133
## famhist_f1     0.67317113 0.201880323 2.2446931
## typea          1.02411271 1.000657366 1.0481178
## ldl:famhist_f1 1.35115024 1.076187206 1.6963656</code></pre>
<p>For another example, let’s look at estimating the odds ratio of CHD for a one unit increase in <code>ldl</code> among those with a family history of CHD, controlling for the other factors. For more complex estimates where we may be interested in combinations of covariates, it can be useful to create a table to determine what regression coefficients we want to use.</p>
<p>Recall the model
<span class="math display">\[
\begin{aligned}
\text{log} \left[\frac{\pi_i}{1-\pi_i} \right]= \beta_0 + &amp;\beta_1x_1 + \beta_2x_2 + \beta_3x_3 + \beta_4x_4 + \beta_5x_2x_3.
\end{aligned}
\]</span>
and recall <span class="math inline">\(x_2\)</span> represents <code>ldl</code> and <span class="math inline">\(x_3\)</span> represents <code>famhist_f</code>.</p>
<p>We wish to estimate the odds ratio of CHD for a one unit increase in <code>ldl</code>, which is the same as looking at <span class="math inline">\(x_2\)</span> = 1 versus <span class="math inline">\(x_2 = 0\)</span> (or <span class="math inline">\(x_2 = 2\)</span> versus <span class="math inline">\(x_2 = 1\)</span>, and so on, however 1 versus 0 is the simplest example). We also are interested in only those with a family history of CHD, represented by <span class="math inline">\(x_3 = 1\)</span>. All of the other covariates are held constant. So, we are comparing</p>
<p><span class="math display">\[
\begin{aligned}
\beta_0 + &amp;\beta_1x_1 + \beta_2(1) + \beta_3(1) + \beta_4x_4 + \beta_5(1)(1)
\end{aligned}
\]</span>
to
<span class="math display">\[
\begin{aligned}
\beta_0 + &amp;\beta_1x_1 + \beta_2(0) + \beta_3(1) + \beta_4x_4 + \beta_5(0)(1)
\end{aligned}
\]</span>
If we look at the difference of these equations, we have
<span class="math display">\[
\begin{aligned}
&amp; \beta_0 + \beta_1x_1 + \beta_2(1) + \beta_3(1) + \beta_4x_4 + \beta_5(1)(1)\\
&amp;-\left(\beta_0 + \beta_1x_1 + \beta_2(0) + \beta_3(1) + \beta_4x_4 + \beta_5(0)(1)\right)\\
\hline
&amp; \qquad \qquad  \qquad \quad \beta_2 \qquad \quad \quad \quad  \qquad  \quad+\beta_5
\end{aligned}
\]</span>
which shows that we should estimate and interpret <span class="math inline">\(\beta_2 + \beta_5\)</span> to answer this question. From the model output, we estimate the log odds ratio as <span class="math inline">\(\widehat{\beta_2} + \widehat{\beta_5} = 0.099 + 0.301 = 0.400\)</span>. Then, the estimated odds ratio is <span class="math inline">\(\exp(0.400) = 1.492\)</span>. So, we estimate that a one unit increase in low density lipoprotein cholesterol is associated with an odds ratio of CHD equal to 1.492, controlling for other factors.</p>
<p>To estimate the confidence interval, we must find the estimated standard error of <span class="math inline">\(\widehat{\beta_2} + \widehat{\beta_5}\)</span> manually, construct a confidence interval for this quantity (the logOR), and then exponentiate each bound of the confidence interval. To do so in R, we can use the following code:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="glm.html#cb247-1" tabindex="-1"></a>varcov <span class="ot">&lt;-</span> <span class="fu">vcov</span>(heart_model7) <span class="co">#get the variance covariance matrix</span></span>
<span id="cb247-2"><a href="glm.html#cb247-2" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co">#represents \beta_2 + \beta_5 (first place is beta_0)</span></span>
<span id="cb247-3"><a href="glm.html#cb247-3" tabindex="-1"></a></span>
<span id="cb247-4"><a href="glm.html#cb247-4" tabindex="-1"></a>var_est <span class="ot">&lt;-</span> L<span class="sc">%*%</span>varcov <span class="sc">%*%</span> L </span>
<span id="cb247-5"><a href="glm.html#cb247-5" tabindex="-1"></a>beta_est <span class="ot">&lt;-</span> L<span class="sc">%*%</span><span class="fu">coef</span>(heart_model7) <span class="co">#vector of coefficients from model</span></span>
<span id="cb247-6"><a href="glm.html#cb247-6" tabindex="-1"></a></span>
<span id="cb247-7"><a href="glm.html#cb247-7" tabindex="-1"></a>CI <span class="ot">&lt;-</span> <span class="fu">c</span>(beta_est <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(var_est), beta_est <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">sqrt</span>(var_est)) </span>
<span id="cb247-8"><a href="glm.html#cb247-8" tabindex="-1"></a></span>
<span id="cb247-9"><a href="glm.html#cb247-9" tabindex="-1"></a><span class="fu">exp</span>(CI) <span class="co">#exponentiate to get CI for OR</span></span></code></pre></div>
<pre><code>## [1] 1.247937 1.783199</code></pre>
<p><strong>Probabilities</strong></p>
<p>Perhaps we are interested in estimating or predicting the probability of the outcome instead of the odds ratio for given covariates.</p>
<p>Suppose we are interested in the probability that a 25 year old with <code>spb</code> = 150, <code>tobacco</code> = 0, <code>ldl</code> = 6, <code>adiposity</code> = 24, no family history of CHD, <code>typea</code> = 60, <code>obesity</code> = 30, and <code>alcohol</code> = 10. Using the required information, we can obtain a prediction using the <code>predict()</code> function as:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="glm.html#cb249-1" tabindex="-1"></a><span class="co"># make a vector of the new information as it would appear in the original </span></span>
<span id="cb249-2"><a href="glm.html#cb249-2" tabindex="-1"></a><span class="co"># dataframe (excluding y). Use colnames(heart) to see the order of variables</span></span>
<span id="cb249-3"><a href="glm.html#cb249-3" tabindex="-1"></a>newsubject <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sbp =</span> <span class="dv">150</span>,</span>
<span id="cb249-4"><a href="glm.html#cb249-4" tabindex="-1"></a>                         <span class="at">tobacco =</span> <span class="dv">0</span>,</span>
<span id="cb249-5"><a href="glm.html#cb249-5" tabindex="-1"></a>                         <span class="at">ldl =</span> <span class="dv">6</span>,</span>
<span id="cb249-6"><a href="glm.html#cb249-6" tabindex="-1"></a>                         <span class="at">adiposity =</span> <span class="dv">24</span>,</span>
<span id="cb249-7"><a href="glm.html#cb249-7" tabindex="-1"></a>                         <span class="at">famhist =</span> <span class="dv">0</span>,</span>
<span id="cb249-8"><a href="glm.html#cb249-8" tabindex="-1"></a>                         <span class="at">typea =</span> <span class="dv">60</span>,</span>
<span id="cb249-9"><a href="glm.html#cb249-9" tabindex="-1"></a>                         <span class="at">obesity =</span> <span class="dv">30</span>,</span>
<span id="cb249-10"><a href="glm.html#cb249-10" tabindex="-1"></a>                         <span class="at">alcohol =</span> <span class="dv">10</span>,</span>
<span id="cb249-11"><a href="glm.html#cb249-11" tabindex="-1"></a>                         <span class="at">age =</span> <span class="dv">25</span>,</span>
<span id="cb249-12"><a href="glm.html#cb249-12" tabindex="-1"></a>                         <span class="at">age_f =</span> <span class="dv">2</span>,</span>
<span id="cb249-13"><a href="glm.html#cb249-13" tabindex="-1"></a>                         <span class="at">famhist_f =</span> <span class="dv">1</span></span>
<span id="cb249-14"><a href="glm.html#cb249-14" tabindex="-1"></a>                         )</span>
<span id="cb249-15"><a href="glm.html#cb249-15" tabindex="-1"></a></span>
<span id="cb249-16"><a href="glm.html#cb249-16" tabindex="-1"></a>newsubject<span class="sc">$</span>age_f <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(newsubject<span class="sc">$</span>age_f)</span>
<span id="cb249-17"><a href="glm.html#cb249-17" tabindex="-1"></a>newsubject<span class="sc">$</span>famhist_f <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(newsubject<span class="sc">$</span>famhist_f)</span>
<span id="cb249-18"><a href="glm.html#cb249-18" tabindex="-1"></a></span>
<span id="cb249-19"><a href="glm.html#cb249-19" tabindex="-1"></a><span class="fu">predict</span>(heart_model7, <span class="at">newdata =</span> newsubject)</span></code></pre></div>
<pre><code>##           1 
## -0.03674586</code></pre>
<p>We estimate that <span class="math inline">\(\frac{\log{\pi}}{1 - \pi} = -0.037\)</span>. So, to estimate the probability, we take the expit() of this estimate, or obtain
<span class="math display">\[
\frac{\exp(-0.037)}{1 + \exp(-0.037)} = 0.491
\]</span>
We estimate this hypothetical individual to have a 49.1% probability of having CHD given their covariates.</p>
</div>
</div>
</div>
<div id="glm-binprop" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Binominal Distributed/Proportional Outcomes (Logistic Regression on Proportions)<a href="glm.html#glm-binprop" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Sometimes when evaluating a binary response, we don’t have data for each individual in the study and cannot fit a logistic regression in the usual way. However, if we have the proportion of outcomes for various subgroups in our data set, we can still model the proportion of outcomes using a binomial generalized linear model. That is, we observe <span class="math inline">\(y_j/m_j\)</span> for each combination <span class="math inline">\(j = 1, 2, ..., J\)</span> of our variables <span class="math inline">\(\boldsymbol{x}\)</span> where <span class="math inline">\(y_j\)</span> is the number of successes/occurrences in a subgroup <span class="math inline">\(j\)</span> of size <span class="math inline">\(m_j\)</span>. We note that this method is recommended over treating the proportion as a continuous outcome and fitting a linear regression model. This is because the proportions may not be normally distributed, or even continuous for small <span class="math inline">\(m\)</span>.</p>
<p>We model the expected proportions as a function of the covariates of interest using a binomial regression model (logistic regression). We can fit a generalized linear model two ways: we can either model the response as a pair where the response is <code>cbind(y, m - y)</code> or model the response as <code>y/m</code> where we set <code>weights = m</code> as a parameter in the <code>glm()</code> function. In both settings, we let <code>family = binomial()</code> and specify a link function.</p>
<p>The following example shows the use of the binomial regression model, and explains how we can fit the model in two different ways.</p>
<div id="glm-binprop-example" class="section level3 hasAnchor" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> Example<a href="glm.html#glm-binprop-example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will be looking at a data set involving the proportions of children who have reached menarche at different ages. The data set contains the average age of the group (which are reasonably homogeneous) (<code>Age</code>), the total number of children in the group (<code>Total</code>), and the number of children in the group who have reached menarche (<code>Menarche</code>). The goal of this analysis is to see quantify the relationship between age and menarche onset. We first load the <code>menarche</code> data set from the <a href="https://CRAN.R-project.org/package=MASS"><strong>MASS</strong></a> package:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="glm.html#cb251-1" tabindex="-1"></a><span class="co"># load the data from MASS package</span></span>
<span id="cb251-2"><a href="glm.html#cb251-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;menarche&quot;</span>) </span>
<span id="cb251-3"><a href="glm.html#cb251-3" tabindex="-1"></a></span>
<span id="cb251-4"><a href="glm.html#cb251-4" tabindex="-1"></a><span class="co"># look at first 6 observations of the data</span></span>
<span id="cb251-5"><a href="glm.html#cb251-5" tabindex="-1"></a><span class="fu">head</span>(menarche)</span></code></pre></div>
<pre><code>##     Age Total Menarche
## 1  9.21   376        0
## 2 10.21   200        0
## 3 10.58    93        0
## 4 10.83   120        2
## 5 11.08    90        2
## 6 11.33    88        5</code></pre>
<p>We see that for different age groups, we have different sizes of the number of individuals in that group (<code>Total</code>), and the corresponding number of children who have reached menarche (<code>Menarche</code>). The proportion of people who have reached menarche in each age group is then <code>Menarche/Total</code>.</p>
<div id="glm-binprop-example-mf" class="section level4 hasAnchor" number="4.7.1.1">
<h4><span class="header-section-number">4.7.1.1</span> Model Fitting<a href="glm.html#glm-binprop-example-mf" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Recall that we can fit a model two ways: fitting the outcome as <code>cbind(y, m - y)</code> or fitting the outcome as <code>y/m</code> where we set <code>weights = m</code> as a parameter in the <code>glm()</code> function. We will show that these models produce the same results. We will fit both models using the canonical logit link. First, we fit the model using the paired response:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="glm.html#cb253-1" tabindex="-1"></a>menarche_fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(Menarche, Total <span class="sc">-</span> Menarche) <span class="sc">~</span> Age, </span>
<span id="cb253-2"><a href="glm.html#cb253-2" tabindex="-1"></a>                     <span class="at">data =</span> menarche, </span>
<span id="cb253-3"><a href="glm.html#cb253-3" tabindex="-1"></a>                     <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb253-4"><a href="glm.html#cb253-4" tabindex="-1"></a></span>
<span id="cb253-5"><a href="glm.html#cb253-5" tabindex="-1"></a><span class="fu">summary</span>(menarche_fit1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = cbind(Menarche, Total - Menarche) ~ Age, family = binomial(link = &quot;logit&quot;), 
##     data = menarche)
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -21.22639    0.77068  -27.54   &lt;2e-16 ***
## Age           1.63197    0.05895   27.68   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 3693.884  on 24  degrees of freedom
## Residual deviance:   26.703  on 23  degrees of freedom
## AIC: 114.76
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Next, we fit the model using the proportions and specifying the <code>weights</code>:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="glm.html#cb255-1" tabindex="-1"></a>menarche_fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Menarche<span class="sc">/</span>Total <span class="sc">~</span> Age, </span>
<span id="cb255-2"><a href="glm.html#cb255-2" tabindex="-1"></a>                     <span class="at">data =</span> menarche, </span>
<span id="cb255-3"><a href="glm.html#cb255-3" tabindex="-1"></a>                     <span class="at">weights =</span> Total,</span>
<span id="cb255-4"><a href="glm.html#cb255-4" tabindex="-1"></a>                     <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>))</span>
<span id="cb255-5"><a href="glm.html#cb255-5" tabindex="-1"></a></span>
<span id="cb255-6"><a href="glm.html#cb255-6" tabindex="-1"></a><span class="fu">summary</span>(menarche_fit2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Menarche/Total ~ Age, family = binomial(link = &quot;logit&quot;), 
##     data = menarche, weights = Total)
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -21.22639    0.77068  -27.54   &lt;2e-16 ***
## Age           1.63197    0.05895   27.68   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 3693.884  on 24  degrees of freedom
## Residual deviance:   26.703  on 23  degrees of freedom
## AIC: 114.76
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>We see that these models are equivalent.</p>
</div>
<div id="glm-binprop-example-md" class="section level4 hasAnchor" number="4.7.1.2">
<h4><span class="header-section-number">4.7.1.2</span> Model Diagnostics<a href="glm.html#glm-binprop-example-md" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can look at the model fit by evaluating the residual and fitted values:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="glm.html#cb257-1" tabindex="-1"></a><span class="co"># first plot the residual vs dose</span></span>
<span id="cb257-2"><a href="glm.html#cb257-2" tabindex="-1"></a>resid_menarche <span class="ot">&lt;-</span> <span class="fu">residuals.glm</span>(menarche_fit1, <span class="st">&quot;deviance&quot;</span>)</span>
<span id="cb257-3"><a href="glm.html#cb257-3" tabindex="-1"></a><span class="fu">plot</span>(menarche<span class="sc">$</span>Age, resid_menarche, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb257-4"><a href="glm.html#cb257-4" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Deviance Residuals vs Age&quot;</span>,</span>
<span id="cb257-5"><a href="glm.html#cb257-5" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb257-6"><a href="glm.html#cb257-6" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>)</span>
<span id="cb257-7"><a href="glm.html#cb257-7" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># add dotted lines at 2 and -2</span></span>
<span id="cb257-8"><a href="glm.html#cb257-8" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-binprop-plot1"></span>
<img src="topics_in_consulting_files/figure-html/glm-binprop-plot1-1.png" alt="Residual plot for Menarche GLM" width="672" />
<p class="caption">
Figure 4.5: Residual plot for Menarche GLM
</p>
</div>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="glm.html#cb258-1" tabindex="-1"></a><span class="co"># then plot the fitted versus dose</span></span>
<span id="cb258-2"><a href="glm.html#cb258-2" tabindex="-1"></a>fitted_menarche <span class="ot">&lt;-</span> menarche_fit1<span class="sc">$</span>fitted.values</span>
<span id="cb258-3"><a href="glm.html#cb258-3" tabindex="-1"></a><span class="fu">plot</span>(menarche<span class="sc">$</span>Age, fitted_menarche, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb258-4"><a href="glm.html#cb258-4" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Fitted Value vs Age&quot;</span>,</span>
<span id="cb258-5"><a href="glm.html#cb258-5" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Probability of Menarche&quot;</span>,</span>
<span id="cb258-6"><a href="glm.html#cb258-6" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>,</span>
<span id="cb258-7"><a href="glm.html#cb258-7" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb258-8"><a href="glm.html#cb258-8" tabindex="-1"></a><span class="fu">points</span>(menarche<span class="sc">$</span>Age, menarche<span class="sc">$</span>Menarche<span class="sc">/</span>menarche<span class="sc">$</span>Total, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">8</span>)</span>
<span id="cb258-9"><a href="glm.html#cb258-9" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">13</span>, <span class="fl">0.3</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Fitted&quot;</span>, <span class="st">&quot;Observed&quot;</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">8</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-binprop-plot2"></span>
<img src="topics_in_consulting_files/figure-html/glm-binprop-plot2-1.png" alt="Diagnostic Plot for Probit Model: Fitted Values" width="672" />
<p class="caption">
Figure 4.6: Diagnostic Plot for Probit Model: Fitted Values
</p>
</div>
<p>The residuals in Figure <a href="glm.html#fig:glm-binprop-plot1">4.5</a> are mostly between -2 and 2, and show no signs of a poor fit. The plot of the fitted and observed values in Figure <a href="glm.html#fig:glm-binprop-plot2">4.6</a> are similar, indicating good prediction for the observations we fit our model on. Overall, this model appears to be a good fit for the data.</p>
</div>
<div id="glm-binprop-example-interpretation" class="section level4 hasAnchor" number="4.7.1.3">
<h4><span class="header-section-number">4.7.1.3</span> Model Interpretation<a href="glm.html#glm-binprop-example-interpretation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>From (either) model output, we see that age is significantly associated with menarche. As we used the logit link, the interpretation of our parameters are log odds ratios. As such, we can interpret the model output as follows:</p>
<ul>
<li><span class="math inline">\(\beta_0\)</span>: At age = 0, the log odds of menarche is estimated to be -21.226 (the odds is estimated to be <span class="math inline">\(\exp(-21.226)\)</span> = 0.000). This makes sense in the context of our study.</li>
<li><span class="math inline">\(\beta_1\)</span>: For a one unit increase in the average age, we estimate the log odds of menarche to be 1.632 times higher (the odds ratio is estimated to be <span class="math inline">\(\exp(1.632)\)</span> = 5.114 times higher). Confidence intervals can be calculated as in Section <a href="glm.html#glm-logreg">4.6</a>.</li>
</ul>
<p>From these results, we conclude that age is significantly associated with menarche onset.</p>
<p>We can also estimate the probability of menarche onset for certain ages. For example, let’s estimate the probability of menarche for a 13 year old child based on this model. Our model is
<span class="math display">\[
\log\left(\frac{\widehat{\pi}_i}{1 - \widehat{\pi}}_i\right) = -21.226 + 1.632*\text{Age}_i
\]</span>
which we can re-write as
<span class="math display">\[
\widehat{\pi}_i = \frac{\exp(-21.226 + 1.632*\text{Age}_i)}{1 + \exp(-21.226 + 1.632*\text{Age}_i)}.
\]</span>
Thus, at age 13, we can estimate the probability of menarche as
<span class="math display">\[
\widehat{\pi}_i = \frac{\exp(-21.226 + 1.632*13)}{1 + \exp(-21.226 + 1.632*13)}.
\]</span>
We can calculate this by hand, or use the following commands in R:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="glm.html#cb259-1" tabindex="-1"></a><span class="co"># grab the coefficients of the model</span></span>
<span id="cb259-2"><a href="glm.html#cb259-2" tabindex="-1"></a>est_beta <span class="ot">&lt;-</span> menarche_fit1<span class="sc">$</span>coefficients <span class="co">#beta[1] is the intercept, </span></span>
<span id="cb259-3"><a href="glm.html#cb259-3" tabindex="-1"></a><span class="co"># beta[2] is the coefficient on age</span></span>
<span id="cb259-4"><a href="glm.html#cb259-4" tabindex="-1"></a></span>
<span id="cb259-5"><a href="glm.html#cb259-5" tabindex="-1"></a></span>
<span id="cb259-6"><a href="glm.html#cb259-6" tabindex="-1"></a><span class="co"># estimate the probability</span></span>
<span id="cb259-7"><a href="glm.html#cb259-7" tabindex="-1"></a>est_prob <span class="ot">&lt;-</span> <span class="fu">exp</span>(est_beta[<span class="dv">1</span>] <span class="sc">+</span> est_beta[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">13</span>)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(est_beta[<span class="dv">1</span>] <span class="sc">+</span> est_beta[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">13</span>))</span>
<span id="cb259-8"><a href="glm.html#cb259-8" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Estimated probability:&quot;</span>, <span class="fu">round</span>(est_prob,<span class="dv">3</span>))) <span class="co">#print it out, rounded</span></span></code></pre></div>
<pre><code>## [1] &quot;Estimated probability: 0.497&quot;</code></pre>
<p>Thus, for a 13 year old child, we estimate the probability of menarche to be 49.7%.</p>
</div>
</div>
<div id="glm-binprop-DR" class="section level3 hasAnchor" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> Dose-response Models<a href="glm.html#glm-binprop-DR" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose we want to quantify a <a href="https://en.wikipedia.org/wiki/Dose%E2%80%93response_relationship">dose-response</a> relationship between a stimulus (dose) and a particular outcome (response). We typically see dose-response relationships in <a href="https://en.wikipedia.org/wiki/Bioassay#:~:text=A%20bioassay%20is%20an%20analytical,or%20quantitative%2C%20direct%20or%20indirect.">bioassay</a> experiments where we expose groups of living subjects to varying doses of a toxin and determine how many deaths or other binary health outcomes there are within a given time period. Given the concentration of the toxin, we calculate the dose as</p>
<p><span class="math display">\[
x = \text{dose} = \log(\text{concentration})
\]</span>
We assume that for each subject in the bioassay study there is a <em>tolerance</em> or <em>threshold</em> dosage where a response will always occur. This value can vary from individual to individual and can be described by a statistical distribution. For each group <span class="math inline">\(j = 1, 2, \dots, J\)</span>, we let <span class="math inline">\(m_j\)</span> be the total number of subjects in group <span class="math inline">\(j\)</span>, <span class="math inline">\(x_j\)</span> be the dose applied to all subjects in group <span class="math inline">\(i\)</span>, and <span class="math inline">\(y_i\)</span> be the number of subjects that responded in group <span class="math inline">\(j\)</span>.</p>
<p>We assume that <span class="math inline">\(Y_j\)</span> follows a binomial distribution with <span class="math inline">\(n\)</span> = <span class="math inline">\(m_j\)</span> and unknown probability of response <span class="math inline">\(\pi_j\)</span>. We can model this using a GLM as
<span class="math display">\[
g(\pi) = \beta_0 + \beta_1x
\]</span>
where <span class="math inline">\(g()\)</span> is a link function.</p>
<p>Choices of <span class="math inline">\(g()\)</span> include the probit, logit, and complimentary log-log (cloglog). The “best” link function depends on the underlying distribution of the probability <span class="math inline">\(\pi\)</span>. After describing the link functions, we will show in an example in Section <a href="glm.html#glm-binprop-DR-ex">4.7.2.1</a> that includes how to choose the link function from the data.</p>
<p><strong>Probit Link</strong></p>
<p>If <span class="math inline">\(\pi(x)\)</span> is normally distributed, use probit link <span class="math inline">\(g(\pi) = \Phi^{-1}(\pi)\)</span> where <span class="math inline">\(\Phi\)</span> is the standard normal distribution CDF (<a href="https://en.wikipedia.org/wiki/Cumulative_distribution_function">cumulative distribution function</a>)</p>
<p>Using this link function, we do not have the interpretation of odds ratios as we are not using the logistic link function. We can re-write the relationship between <span class="math inline">\(\pi\)</span> and the covariate <span class="math inline">\(x\)</span> through the link function as
<span class="math display">\[
\pi(x) = g^{-1}(\beta_0 + \beta_1x) = \Phi\left( \frac{x - \mu}{\sigma} \right)
\]</span>
where <span class="math inline">\(\mu\)</span> is the mean and <span class="math inline">\(\sigma\)</span> is the standard deviation of the tolerance distribution (here we subtract the mean and divide by the standard deviation to create a standard normal distribution).</p>
<p>We may be the median lethal/effective dose at which 50% of the population has a response (<span class="math inline">\(\delta_{0.5}\)</span>), which is calculated as
<span class="math display">\[
\delta_{0.5} = \frac{-\beta_0}{\beta_1}
\]</span></p>
<p>which can be calculated using the GLM model output. We can also obtain expressions for the 100<span class="math inline">\(p\)</span>th percentile of the tolerance distribution (<span class="math inline">\(\delta_p\)</span>) as
<span class="math display">\[
\delta_p = \frac{\Phi^{-1}(p) - \beta_0}{\beta_1}
\]</span>
where <span class="math inline">\(\Phi^{-1}()\)</span> is the inverse of the standard normal CDF.</p>
<p><strong>Logit Link</strong></p>
<p>If we assume the probability has the form <span class="math inline">\(\pi(x) = \frac{\exp(\beta_0 + \beta_1x)}{1 + \exp(\beta_0 + \beta_1x)}\)</span>, then we can use the logit link <span class="math inline">\(g(\pi) = \log\left(\frac{\pi}{1 - \pi}\right)\)</span>. We interpret the parameters <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> as log odds/log odds ratios as in our “usual” logistic regression. That is, <span class="math inline">\(\beta_0\)</span> is the log odds of response for a dose of zero and <span class="math inline">\(\beta_1\)</span> is the log odds ratio for response associated with a one unit increase in the dose. To find odds/odds ratios, we exponentiate the coefficients.</p>
<p>The median lethal/effective dose is the same as the probit link, which is
<span class="math display">\[
\delta_{0.5} = \frac{-\beta_0}{\beta_1}.
\]</span>
It is also possible to obtain expressions for any percentile of the tolerance distribution. That is, the 100<span class="math inline">\(p\)</span>th percentile of the tolerance distribution for <span class="math inline">\((0 &lt; p &lt; 1)\)</span> can be found by solving
<span class="math display">\[
\log{\frac{p}{1-p}} = \beta_0 + \beta_1\delta_p
\]</span>
where <span class="math inline">\(\delta_p\)</span> is the dosage we’d like to solve for.</p>
<p><strong>Complimentary Log-log Link</strong></p>
<p>If we assume <span class="math inline">\(\pi(x) = 1 - \exp(-\exp(\beta_0 + \beta_1x))\)</span> (extreme value distribution), we can use the complementary log-log (cloglog) link <span class="math inline">\(g(\pi) = \log(-\log(1 - \pi))\)</span></p>
<p>The interpretation of the parameters when using a complimentary log-log link function is not as “nice” as when using the logit or probit links, however we can still obtain an expression for the median lethal/effective dose, which is
<span class="math display">\[
\delta_{0.5} = \frac{\log(-\log(1 - 0.5)) - \beta_0}{\beta_1}.
\]</span></p>
<div id="glm-binprop-DR-ex" class="section level4 hasAnchor" number="4.7.2.1">
<h4><span class="header-section-number">4.7.2.1</span> Example<a href="glm.html#glm-binprop-DR-ex" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We use data from a study by <span class="citation">(<a href="#ref-milesi2013">Milesi, Pocquet, and Labbé 2013</a>)</span> to evaluate the dose-response relationship of insecticide dosages and insect fatalities. We will focus on one particular strain of insecticide for the first replicate of the study.</p>
<p>To read in this data, which is located in the “data” folder, we perform the following:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="glm.html#cb261-1" tabindex="-1"></a><span class="co"># read in the data</span></span>
<span id="cb261-2"><a href="glm.html#cb261-2" tabindex="-1"></a>insecticide <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;data/insectdoseresponse.txt&quot;</span>, <span class="at">header =</span> T)</span>
<span id="cb261-3"><a href="glm.html#cb261-3" tabindex="-1"></a></span>
<span id="cb261-4"><a href="glm.html#cb261-4" tabindex="-1"></a><span class="co"># change colnames to english</span></span>
<span id="cb261-5"><a href="glm.html#cb261-5" tabindex="-1"></a><span class="fu">colnames</span>(insecticide) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;insecticide&quot;</span>, <span class="st">&quot;strain&quot;</span>, <span class="st">&quot;dose&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;deaths&quot;</span>, </span>
<span id="cb261-6"><a href="glm.html#cb261-6" tabindex="-1"></a>                           <span class="st">&quot;replicate&quot;</span>, <span class="st">&quot;date&quot;</span>, <span class="st">&quot;color&quot;</span>)</span>
<span id="cb261-7"><a href="glm.html#cb261-7" tabindex="-1"></a></span>
<span id="cb261-8"><a href="glm.html#cb261-8" tabindex="-1"></a><span class="co"># view first 6 observations</span></span>
<span id="cb261-9"><a href="glm.html#cb261-9" tabindex="-1"></a><span class="fu">head</span>(insecticide)</span></code></pre></div>
<pre><code>##   insecticide  strain  dose   m deaths replicate     date color
## 1    temephos KIS-ref 0.000 100      1         1 26/01/11     1
## 2    temephos KIS-ref 0.002  97     47         1 26/01/11     1
## 3    temephos KIS-ref 0.003  96     68         1 26/01/11     1
## 4    temephos KIS-ref 0.004  98     89         1 26/01/11     1
## 5    temephos KIS-ref 0.005  95     90         1 26/01/11     1
## 6    temephos KIS-ref 0.007  99     97         1 26/01/11     1</code></pre>
<p>We are only interested in a subset of this data for the purposes of this example. We are only interested in the first replication of the KIS-ref strain. As such, we subset the data by:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="glm.html#cb263-1" tabindex="-1"></a><span class="co"># only keep rows where souche == KIS-ref and replicate = 1</span></span>
<span id="cb263-2"><a href="glm.html#cb263-2" tabindex="-1"></a>insecticide <span class="ot">&lt;-</span> insecticide[insecticide<span class="sc">$</span>strain <span class="sc">==</span> <span class="st">&quot;KIS-ref&quot;</span> <span class="sc">&amp;</span> insecticide<span class="sc">$</span>replicate <span class="sc">==</span> <span class="dv">1</span>, ]</span>
<span id="cb263-3"><a href="glm.html#cb263-3" tabindex="-1"></a>insecticide</span></code></pre></div>
<pre><code>##   insecticide  strain  dose   m deaths replicate     date color
## 1    temephos KIS-ref 0.000 100      1         1 26/01/11     1
## 2    temephos KIS-ref 0.002  97     47         1 26/01/11     1
## 3    temephos KIS-ref 0.003  96     68         1 26/01/11     1
## 4    temephos KIS-ref 0.004  98     89         1 26/01/11     1
## 5    temephos KIS-ref 0.005  95     90         1 26/01/11     1
## 6    temephos KIS-ref 0.007  99     97         1 26/01/11     1
## 7    temephos KIS-ref 0.010  99     99         1 26/01/11     1</code></pre>
<p>To fit a dose-response GLM to this data, we need to have the total number of insects in each group, the dose (log(concentration)), and construct the appropriate paired response variable for the regression <code>(y, m - y)</code>. In this data set, we already have the dose (<code>dose</code>) and number of events (<code>deaths</code>) and group totals (<code>m</code>). Prior to fitting the glm, we just need to construct the response variable. To do so in R, we perform the following:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="glm.html#cb265-1" tabindex="-1"></a><span class="co"># calculate response variable</span></span>
<span id="cb265-2"><a href="glm.html#cb265-2" tabindex="-1"></a>insecticide<span class="sc">$</span>response <span class="ot">&lt;-</span> <span class="fu">cbind</span>(insecticide<span class="sc">$</span>deaths, insecticide<span class="sc">$</span>m <span class="sc">-</span> insecticide<span class="sc">$</span>deaths)</span>
<span id="cb265-3"><a href="glm.html#cb265-3" tabindex="-1"></a></span>
<span id="cb265-4"><a href="glm.html#cb265-4" tabindex="-1"></a><span class="co"># look at the data</span></span>
<span id="cb265-5"><a href="glm.html#cb265-5" tabindex="-1"></a>insecticide</span></code></pre></div>
<pre><code>##   insecticide  strain  dose   m deaths replicate     date color
## 1    temephos KIS-ref 0.000 100      1         1 26/01/11     1
## 2    temephos KIS-ref 0.002  97     47         1 26/01/11     1
## 3    temephos KIS-ref 0.003  96     68         1 26/01/11     1
## 4    temephos KIS-ref 0.004  98     89         1 26/01/11     1
## 5    temephos KIS-ref 0.005  95     90         1 26/01/11     1
## 6    temephos KIS-ref 0.007  99     97         1 26/01/11     1
## 7    temephos KIS-ref 0.010  99     99         1 26/01/11     1
##   response.1 response.2
## 1          1         99
## 2         47         50
## 3         68         28
## 4         89          9
## 5         90          5
## 6         97          2
## 7         99          0</code></pre>
<p>We will fit three models, one with each of the previously discussed link functions, using the <code>glm()</code> function. We start with the probit link:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="glm.html#cb267-1" tabindex="-1"></a><span class="co"># fit the glm using link = &quot;probit&quot;</span></span>
<span id="cb267-2"><a href="glm.html#cb267-2" tabindex="-1"></a>insecticide_fit_probit <span class="ot">&lt;-</span> <span class="fu">glm</span>(response <span class="sc">~</span> dose, </span>
<span id="cb267-3"><a href="glm.html#cb267-3" tabindex="-1"></a>                              <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;probit&quot;</span>), <span class="at">data =</span> insecticide)</span>
<span id="cb267-4"><a href="glm.html#cb267-4" tabindex="-1"></a></span>
<span id="cb267-5"><a href="glm.html#cb267-5" tabindex="-1"></a><span class="co"># look at the model output</span></span>
<span id="cb267-6"><a href="glm.html#cb267-6" tabindex="-1"></a><span class="fu">summary</span>(insecticide_fit_probit)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = response ~ dose, family = binomial(link = &quot;probit&quot;), 
##     data = insecticide)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -1.5102     0.1508  -10.02   &lt;2e-16 ***
## dose        658.3608    49.5291   13.29   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 433.593  on 6  degrees of freedom
## Residual deviance:  19.862  on 5  degrees of freedom
## AIC: 45.692
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="glm.html#cb269-1" tabindex="-1"></a><span class="co"># assess the residuals</span></span>
<span id="cb269-2"><a href="glm.html#cb269-2" tabindex="-1"></a></span>
<span id="cb269-3"><a href="glm.html#cb269-3" tabindex="-1"></a><span class="co"># first plot the residual vs dose</span></span>
<span id="cb269-4"><a href="glm.html#cb269-4" tabindex="-1"></a>resid_probit <span class="ot">&lt;-</span> <span class="fu">residuals.glm</span>(insecticide_fit_probit, <span class="st">&quot;deviance&quot;</span>)</span>
<span id="cb269-5"><a href="glm.html#cb269-5" tabindex="-1"></a><span class="fu">plot</span>(insecticide<span class="sc">$</span>dose, resid_probit, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb269-6"><a href="glm.html#cb269-6" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Deviance Residuals vs Dose: Probit&quot;</span>,</span>
<span id="cb269-7"><a href="glm.html#cb269-7" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb269-8"><a href="glm.html#cb269-8" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Dose&quot;</span>)</span>
<span id="cb269-9"><a href="glm.html#cb269-9" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># add dotted lines at 2 and -2</span></span>
<span id="cb269-10"><a href="glm.html#cb269-10" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-dr-glmprobitplots1"></span>
<img src="topics_in_consulting_files/figure-html/glm-dr-glmprobitplots1-1.png" alt="Diagnostic Plot for Probit Model: Residuals" width="672" />
<p class="caption">
Figure 4.7: Diagnostic Plot for Probit Model: Residuals
</p>
</div>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="glm.html#cb270-1" tabindex="-1"></a><span class="co"># then plot the fitted versus dose</span></span>
<span id="cb270-2"><a href="glm.html#cb270-2" tabindex="-1"></a>fitted_probit <span class="ot">&lt;-</span> insecticide_fit_probit<span class="sc">$</span>fitted.values</span>
<span id="cb270-3"><a href="glm.html#cb270-3" tabindex="-1"></a><span class="fu">plot</span>(insecticide<span class="sc">$</span>dose, fitted_probit, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb270-4"><a href="glm.html#cb270-4" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Fitted Value vs Dose: Probit Model&quot;</span>,</span>
<span id="cb270-5"><a href="glm.html#cb270-5" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Probability of Death&quot;</span>,</span>
<span id="cb270-6"><a href="glm.html#cb270-6" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Dose&quot;</span>,</span>
<span id="cb270-7"><a href="glm.html#cb270-7" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb270-8"><a href="glm.html#cb270-8" tabindex="-1"></a><span class="fu">points</span>(insecticide<span class="sc">$</span>dose, insecticide<span class="sc">$</span>deaths<span class="sc">/</span>insecticide<span class="sc">$</span>m, </span>
<span id="cb270-9"><a href="glm.html#cb270-9" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">8</span>)</span>
<span id="cb270-10"><a href="glm.html#cb270-10" tabindex="-1"></a><span class="fu">legend</span>(<span class="fl">0.008</span>, <span class="fl">0.3</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Fitted&quot;</span>, <span class="st">&quot;Observed&quot;</span>), </span>
<span id="cb270-11"><a href="glm.html#cb270-11" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">8</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-dr-glmprobitplots2"></span>
<img src="topics_in_consulting_files/figure-html/glm-dr-glmprobitplots2-1.png" alt="Diagnostic Plot for Probit Model: Fitted Values" width="672" />
<p class="caption">
Figure 4.8: Diagnostic Plot for Probit Model: Fitted Values
</p>
</div>
<p>From Plots <a href="glm.html#fig:glm-dr-glmprobitplots1">4.7</a> we see that most residuals fall within (-2, 2), which we would expect for a model with an adequate fit. From Plot <a href="glm.html#fig:glm-dr-glmprobitplots2">4.8</a>, the fitted values mostly agree with the observed values, with no large deviations.</p>
<p>Next, we can fit the model using a logit link:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="glm.html#cb271-1" tabindex="-1"></a><span class="co"># fit the glm using link = &quot;logit&quot;</span></span>
<span id="cb271-2"><a href="glm.html#cb271-2" tabindex="-1"></a>insecticide_fit_logit <span class="ot">&lt;-</span> <span class="fu">glm</span>(response <span class="sc">~</span> dose, </span>
<span id="cb271-3"><a href="glm.html#cb271-3" tabindex="-1"></a>                             <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), <span class="at">data =</span> insecticide)</span>
<span id="cb271-4"><a href="glm.html#cb271-4" tabindex="-1"></a></span>
<span id="cb271-5"><a href="glm.html#cb271-5" tabindex="-1"></a><span class="co"># look at the model output</span></span>
<span id="cb271-6"><a href="glm.html#cb271-6" tabindex="-1"></a><span class="fu">summary</span>(insecticide_fit_logit)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = response ~ dose, family = binomial(link = &quot;logit&quot;), 
##     data = insecticide)
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -2.7636     0.3006  -9.195   &lt;2e-16 ***
## dose        1215.5565   103.6385  11.729   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 433.593  on 6  degrees of freedom
## Residual deviance:  13.457  on 5  degrees of freedom
## AIC: 39.287
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="glm.html#cb273-1" tabindex="-1"></a><span class="co"># assess the residuals</span></span>
<span id="cb273-2"><a href="glm.html#cb273-2" tabindex="-1"></a></span>
<span id="cb273-3"><a href="glm.html#cb273-3" tabindex="-1"></a><span class="co"># first plot the residual vs dose</span></span>
<span id="cb273-4"><a href="glm.html#cb273-4" tabindex="-1"></a>resid_logit <span class="ot">&lt;-</span> <span class="fu">residuals.glm</span>(insecticide_fit_logit, <span class="st">&quot;deviance&quot;</span>)</span>
<span id="cb273-5"><a href="glm.html#cb273-5" tabindex="-1"></a><span class="fu">plot</span>(insecticide<span class="sc">$</span>dose, resid_logit, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb273-6"><a href="glm.html#cb273-6" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Deviance Residuals vs Dose: logit&quot;</span>,</span>
<span id="cb273-7"><a href="glm.html#cb273-7" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb273-8"><a href="glm.html#cb273-8" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Dose&quot;</span>)</span>
<span id="cb273-9"><a href="glm.html#cb273-9" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># add dotted lines at 2 and -2</span></span>
<span id="cb273-10"><a href="glm.html#cb273-10" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-dr-glmlogitplots1"></span>
<img src="topics_in_consulting_files/figure-html/glm-dr-glmlogitplots1-1.png" alt="Diagnostic Plot for logit Model: Residuals" width="672" />
<p class="caption">
Figure 4.9: Diagnostic Plot for logit Model: Residuals
</p>
</div>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="glm.html#cb274-1" tabindex="-1"></a><span class="co"># then plot the fitted versus dose</span></span>
<span id="cb274-2"><a href="glm.html#cb274-2" tabindex="-1"></a>fitted_logit <span class="ot">&lt;-</span> insecticide_fit_logit<span class="sc">$</span>fitted.values</span>
<span id="cb274-3"><a href="glm.html#cb274-3" tabindex="-1"></a><span class="fu">plot</span>(insecticide<span class="sc">$</span>dose, fitted_logit, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb274-4"><a href="glm.html#cb274-4" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Fitted Value vs Dose: logit Model&quot;</span>,</span>
<span id="cb274-5"><a href="glm.html#cb274-5" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Probability of Death&quot;</span>,</span>
<span id="cb274-6"><a href="glm.html#cb274-6" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Dose&quot;</span>,</span>
<span id="cb274-7"><a href="glm.html#cb274-7" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb274-8"><a href="glm.html#cb274-8" tabindex="-1"></a><span class="fu">points</span>(insecticide<span class="sc">$</span>dose, insecticide<span class="sc">$</span>deaths<span class="sc">/</span>insecticide<span class="sc">$</span>m, </span>
<span id="cb274-9"><a href="glm.html#cb274-9" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">8</span>)</span>
<span id="cb274-10"><a href="glm.html#cb274-10" tabindex="-1"></a><span class="fu">legend</span>(<span class="fl">0.008</span>, <span class="fl">0.3</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Fitted&quot;</span>, <span class="st">&quot;Observed&quot;</span>), </span>
<span id="cb274-11"><a href="glm.html#cb274-11" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">8</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-dr-glmlogitplots2"></span>
<img src="topics_in_consulting_files/figure-html/glm-dr-glmlogitplots2-1.png" alt="Diagnostic Plot for logit Model: Fitted Values" width="672" />
<p class="caption">
Figure 4.10: Diagnostic Plot for logit Model: Fitted Values
</p>
</div>
<p>From Plots <a href="glm.html#fig:glm-dr-glmlogitplots1">4.9</a> we see that most residuals fall within (-2, 2), which we would expect for a model with an adequate fit. From Plot <a href="glm.html#fig:glm-dr-glmlogitplots2">4.10</a>, the fitted values mostly agree with the observed values, with no large deviations. This model is very similar to the one with the probit link model.</p>
<p>Next, we fit the model using the complimentary log-log link:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="glm.html#cb275-1" tabindex="-1"></a><span class="co"># fit the glm using link = &quot;cloglog&quot;</span></span>
<span id="cb275-2"><a href="glm.html#cb275-2" tabindex="-1"></a>insecticide_fit_cloglog <span class="ot">&lt;-</span> <span class="fu">glm</span>(response <span class="sc">~</span> dose, </span>
<span id="cb275-3"><a href="glm.html#cb275-3" tabindex="-1"></a>                    <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;cloglog&quot;</span>), <span class="at">data =</span> insecticide)</span></code></pre></div>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="glm.html#cb277-1" tabindex="-1"></a><span class="co"># look at the model output</span></span>
<span id="cb277-2"><a href="glm.html#cb277-2" tabindex="-1"></a><span class="fu">summary</span>(insecticide_fit_cloglog)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = response ~ dose, family = binomial(link = &quot;cloglog&quot;), 
##     data = insecticide)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -1.6246     0.1686  -9.633   &lt;2e-16 ***
## dose        540.3020    47.1056  11.470   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 433.593  on 6  degrees of freedom
## Residual deviance:  55.806  on 5  degrees of freedom
## AIC: 81.636
## 
## Number of Fisher Scoring iterations: 16</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="glm.html#cb279-1" tabindex="-1"></a><span class="co"># assess the residuals</span></span>
<span id="cb279-2"><a href="glm.html#cb279-2" tabindex="-1"></a></span>
<span id="cb279-3"><a href="glm.html#cb279-3" tabindex="-1"></a><span class="co"># first plot the residual vs dose</span></span>
<span id="cb279-4"><a href="glm.html#cb279-4" tabindex="-1"></a>resid_cloglog <span class="ot">&lt;-</span> <span class="fu">residuals.glm</span>(insecticide_fit_cloglog, <span class="st">&quot;deviance&quot;</span>)</span>
<span id="cb279-5"><a href="glm.html#cb279-5" tabindex="-1"></a><span class="fu">plot</span>(insecticide<span class="sc">$</span>dose, resid_cloglog, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">4</span>),</span>
<span id="cb279-6"><a href="glm.html#cb279-6" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Deviance Residuals vs Dose: cloglog&quot;</span>,</span>
<span id="cb279-7"><a href="glm.html#cb279-7" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb279-8"><a href="glm.html#cb279-8" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Dose&quot;</span>)</span>
<span id="cb279-9"><a href="glm.html#cb279-9" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># add dotted lines at 2 and -2</span></span>
<span id="cb279-10"><a href="glm.html#cb279-10" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-dr-glmcloglogplots1"></span>
<img src="topics_in_consulting_files/figure-html/glm-dr-glmcloglogplots1-1.png" alt="Diagnostic Plot for cloglog Model: Residuals" width="672" />
<p class="caption">
Figure 4.11: Diagnostic Plot for cloglog Model: Residuals
</p>
</div>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="glm.html#cb280-1" tabindex="-1"></a><span class="co"># then plot the fitted versus dose</span></span>
<span id="cb280-2"><a href="glm.html#cb280-2" tabindex="-1"></a>fitted_cloglog <span class="ot">&lt;-</span> insecticide_fit_cloglog<span class="sc">$</span>fitted.values</span>
<span id="cb280-3"><a href="glm.html#cb280-3" tabindex="-1"></a><span class="fu">plot</span>(insecticide<span class="sc">$</span>dose, fitted_cloglog, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb280-4"><a href="glm.html#cb280-4" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Fitted Value vs Dose: cloglog Model&quot;</span>,</span>
<span id="cb280-5"><a href="glm.html#cb280-5" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Probability of Death&quot;</span>,</span>
<span id="cb280-6"><a href="glm.html#cb280-6" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Dose&quot;</span>,</span>
<span id="cb280-7"><a href="glm.html#cb280-7" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb280-8"><a href="glm.html#cb280-8" tabindex="-1"></a><span class="fu">points</span>(insecticide<span class="sc">$</span>dose, insecticide<span class="sc">$</span>deaths<span class="sc">/</span>insecticide<span class="sc">$</span>m, </span>
<span id="cb280-9"><a href="glm.html#cb280-9" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">8</span>)</span>
<span id="cb280-10"><a href="glm.html#cb280-10" tabindex="-1"></a><span class="fu">legend</span>(<span class="fl">0.008</span>, <span class="fl">0.3</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Fitted&quot;</span>, <span class="st">&quot;Observed&quot;</span>), </span>
<span id="cb280-11"><a href="glm.html#cb280-11" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">8</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-dr-glmcloglogplots2"></span>
<img src="topics_in_consulting_files/figure-html/glm-dr-glmcloglogplots2-1.png" alt="Diagnostic Plot for cloglog Model: Fitted Values" width="672" />
<p class="caption">
Figure 4.12: Diagnostic Plot for cloglog Model: Fitted Values
</p>
</div>
<p>From Plots <a href="glm.html#fig:glm-dr-glmcloglogplots1">4.11</a> we some very large residuals, indicating an inadequate fit. From Plot <a href="glm.html#fig:glm-dr-glmcloglogplots2">4.12</a>, the fitted values do not agree with the observed values, with some large deviations. From these three models, it appears that the logit or probit models are the best.</p>
<p>We can plot the entire dose/response curve from the logit and probit models using the following code:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="glm.html#cb281-1" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.010</span>, <span class="at">by =</span> <span class="fl">0.0001</span>) <span class="co"># tiny increments over the doses</span></span>
<span id="cb281-2"><a href="glm.html#cb281-2" tabindex="-1"></a>prob_logit <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(x)))</span>
<span id="cb281-3"><a href="glm.html#cb281-3" tabindex="-1"></a>prob_probit <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(x)))</span>
<span id="cb281-4"><a href="glm.html#cb281-4" tabindex="-1"></a></span>
<span id="cb281-5"><a href="glm.html#cb281-5" tabindex="-1"></a><span class="co">#calculate estimated probability at each increment using logit model</span></span>
<span id="cb281-6"><a href="glm.html#cb281-6" tabindex="-1"></a>beta_logit <span class="ot">=</span> <span class="fu">as.vector</span>(insecticide_fit_logit<span class="sc">$</span>coefficients)</span>
<span id="cb281-7"><a href="glm.html#cb281-7" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)){</span>
<span id="cb281-8"><a href="glm.html#cb281-8" tabindex="-1"></a>  prob_logit[i] <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta_logit[<span class="dv">1</span>] <span class="sc">+</span> </span>
<span id="cb281-9"><a href="glm.html#cb281-9" tabindex="-1"></a>              beta_logit[<span class="dv">2</span>]<span class="sc">*</span>x[i])<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(beta_logit[<span class="dv">1</span>] <span class="sc">+</span> beta_logit[<span class="dv">2</span>]<span class="sc">*</span>x[i]))</span>
<span id="cb281-10"><a href="glm.html#cb281-10" tabindex="-1"></a>}</span>
<span id="cb281-11"><a href="glm.html#cb281-11" tabindex="-1"></a></span>
<span id="cb281-12"><a href="glm.html#cb281-12" tabindex="-1"></a><span class="co">#calculate estimated probability at each increment using probit model</span></span>
<span id="cb281-13"><a href="glm.html#cb281-13" tabindex="-1"></a>beta_probit <span class="ot">=</span> <span class="fu">as.vector</span>(insecticide_fit_probit<span class="sc">$</span>coefficients)</span>
<span id="cb281-14"><a href="glm.html#cb281-14" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)){</span>
<span id="cb281-15"><a href="glm.html#cb281-15" tabindex="-1"></a>  prob_probit[i] <span class="ot">&lt;-</span><span class="fu">pnorm</span>(beta_probit[<span class="dv">1</span>] <span class="sc">+</span> beta_probit[<span class="dv">2</span>]<span class="sc">*</span>x[i])</span>
<span id="cb281-16"><a href="glm.html#cb281-16" tabindex="-1"></a>}</span>
<span id="cb281-17"><a href="glm.html#cb281-17" tabindex="-1"></a></span>
<span id="cb281-18"><a href="glm.html#cb281-18" tabindex="-1"></a><span class="co"># plot observed values</span></span>
<span id="cb281-19"><a href="glm.html#cb281-19" tabindex="-1"></a><span class="fu">plot</span>(insecticide<span class="sc">$</span>dose, insecticide<span class="sc">$</span>deaths<span class="sc">/</span>insecticide<span class="sc">$</span>m,</span>
<span id="cb281-20"><a href="glm.html#cb281-20" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">8</span>,</span>
<span id="cb281-21"><a href="glm.html#cb281-21" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Plot of Dose/Response Curve&quot;</span>,</span>
<span id="cb281-22"><a href="glm.html#cb281-22" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Probability of death&quot;</span>,</span>
<span id="cb281-23"><a href="glm.html#cb281-23" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Dose&quot;</span>)</span>
<span id="cb281-24"><a href="glm.html#cb281-24" tabindex="-1"></a></span>
<span id="cb281-25"><a href="glm.html#cb281-25" tabindex="-1"></a><span class="co"># add the dose response curves</span></span>
<span id="cb281-26"><a href="glm.html#cb281-26" tabindex="-1"></a><span class="fu">lines</span>(x, prob_logit, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb281-27"><a href="glm.html#cb281-27" tabindex="-1"></a><span class="fu">lines</span>(x, prob_probit, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;darkgreen&quot;</span>)</span>
<span id="cb281-28"><a href="glm.html#cb281-28" tabindex="-1"></a><span class="fu">legend</span>(<span class="fl">0.008</span>, <span class="fl">0.21</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;logit&quot;</span>, <span class="st">&quot;probit&quot;</span>), </span>
<span id="cb281-29"><a href="glm.html#cb281-29" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="topics_in_consulting_files/figure-html/glm-dr-curve-1.png" width="672" /></p>
<p>Using this plot, we can decide which model fits the observations best. Both models appear to model the observed probabilities similarly. The logit model appears to model the predicted probabilities more closely to the observed probabilities. As such, we will analyze this model. Recall the model output:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="glm.html#cb282-1" tabindex="-1"></a><span class="fu">summary</span>(insecticide_fit_logit)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = response ~ dose, family = binomial(link = &quot;logit&quot;), 
##     data = insecticide)
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -2.7636     0.3006  -9.195   &lt;2e-16 ***
## dose        1215.5565   103.6385  11.729   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 433.593  on 6  degrees of freedom
## Residual deviance:  13.457  on 5  degrees of freedom
## AIC: 39.287
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>Now, let’s estimate the median lethal dose, <span class="math inline">\(\delta_{0.5}\)</span>. For the logit link, recall that we calculate <span class="math inline">\(\delta_{0.5}\)</span> as</p>
<p><span class="math display">\[
\delta_{0.5} = \frac{-\beta_0}{\beta_1}
\]</span></p>
<p>which can be estimated by
<span class="math display">\[
\begin{aligned}
\widehat{\delta}_{0.5} &amp;= \frac{-\widehat{\beta}_0}{\widehat{\beta}_1}\\
&amp;=\frac{-(-2.7636)}{1215.5565}\\
&amp;= 0.0023.
\end{aligned}
\]</span>
That is, based on the logit model we estimate the median lethal dose at which 50% of the population will die to be 0.0023.</p>
<p>For more information on dose response models, readers are directed to <span class="citation">(<a href="#ref-kerr1996">Kerr and Meador 1996</a>)</span> and <span class="citation">(<a href="#ref-karunarathne2022">Karunarathne et al. 2022</a>)</span>.</p>
</div>
</div>
</div>
<div id="glm-poisson" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Poisson Distributed Outcomes (Log-linear Regression)<a href="glm.html#glm-poisson" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Data involving counts of events is commonly used in research, and can be analyzed using a Poisson GLM with a log link (also referred to as log-linear regression). That is, we model
<span class="math display">\[
log(\mu_i) = \boldsymbol{x}_i^T\boldsymbol{\beta}.
\]</span>
We look at count data in terms of the underlying <a href="https://en.wikipedia.org/wiki/Counting_process#:~:text=Counting%20processes%20deal%20with%20the,be%20a%20Markov%20counting%20process.">counting process</a>. We often assume that the counting process can be classified as a <a href="https://en.wikipedia.org/wiki/Poisson_point_process#Interpreted_as_a_counting_process">Poisson process</a>, meaning:</p>
<ol style="list-style-type: decimal">
<li>The number of events in one interval is independent of the number events in a different interval</li>
<li>The distribution of the number of events occurring from (0, t] (denoted <span class="math inline">\(N(t)\)</span>) is given by
<span class="math display">\[
Pr(N(t) = n; \lambda) = \frac{(\lambda t)^ne^{-\lambda t}}{n!}
\]</span>
where <span class="math inline">\(!\)</span> represents the factorial function (for example, <span class="math inline">\(4! = 4\times 3\times 2 \times 1\)</span>) and <span class="math inline">\(\lambda\)</span> is a rate parameter. The expected number of events for an interval of length <span class="math inline">\(t\)</span> is <span class="math inline">\(E(N(t)) = \mu(t) =\lambda t\)</span>. This is a time-homogeneous Poisson process since <span class="math inline">\(\lambda\)</span> is constant, and is not a function of time.</li>
</ol>
<p>Under the log link,
<span class="math display">\[
\begin{aligned}
\log(\mu(t)) &amp;= \log(\lambda t)\\
&amp;= \log(\lambda) + \log(t)
\end{aligned}
\]</span>
by the rules of logarithm operations.</p>
<p>If for each subject we observe the number of events from <span class="math inline">\((0, t_i]\)</span>, along with covariates <span class="math inline">\(x_{i1}, ..., x_{ip}\)</span>, then we can model
<span class="math display">\[
\begin{aligned}
\log(\mu_i(t_i)) &amp;= \log(\lambda_i t_i)\\
&amp;= \log(\lambda_i) + \log(t_i)\\
&amp;= \boldsymbol{x_i}^T\boldsymbol{\beta} + \log(t_i).
\end{aligned}
\]</span>
That is, we model our log-linear regression with an <a href="https://en.wikipedia.org/wiki/Poisson_regression#%22Exposure%22_and_offset">offset</a> term of <span class="math inline">\(\log(t_i)\)</span> that will explain some of the variation in the differing counts of outcomes due to differing lengths of time (or another appropriate measure, depending on the context of the problem). We note that in some cases, an offset term may not be necessary.</p>
<div id="glm-poisson-example" class="section level3 hasAnchor" number="4.8.1">
<h3><span class="header-section-number">4.8.1</span> Example<a href="glm.html#glm-poisson-example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s look at an example of a data set that records the number of times an incident occurs in cargo ships <span class="citation">(<a href="#ref-mccullagh2019">McCullagh and Nelder 2019</a>)</span>, which can be found in the <a href="https://CRAN.R-project.org/package=MASS"><strong>MASS</strong></a> package. We can load the data set and look at the first 6 observations using:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="glm.html#cb284-1" tabindex="-1"></a><span class="fu">data</span>(ships) <span class="co"># loads data set from the MASS package</span></span>
<span id="cb284-2"><a href="glm.html#cb284-2" tabindex="-1"></a><span class="fu">head</span>(ships)</span></code></pre></div>
<pre><code>##   type year period service incidents
## 1    A   60     60     127         0
## 2    A   60     75      63         0
## 3    A   65     60    1095         3
## 4    A   65     75    1095         4
## 5    A   70     60    1512         6
## 6    A   70     75    3353        18</code></pre>
<p>We have the variable <code>type</code> corresponding to the type of ship (A - E), <code>year</code> which is the year of construction (coded as “60” for 1960-1964, “65” for 1965 - 1969, and so on), <code>period</code> which similarly codes the year of operation (which is either “60” for 1960-1974 or “75” for 1975-1979), <code>service</code> which is the number of months of service for the ship, and <code>incidents</code> which is the number of damage incidents for the ship during the months of service.</p>
<p>We wish to see which factors are associated with ship incidents. To see the distribution of our outcome, we can create a histogram by:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="glm.html#cb286-1" tabindex="-1"></a><span class="fu">hist</span>(ships<span class="sc">$</span>incidents, <span class="at">main =</span> <span class="st">&quot;Histogram of Incidents&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Frequency&quot;</span>, </span>
<span id="cb286-2"><a href="glm.html#cb286-2" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Number of Incidents&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-poisson-histogram"></span>
<img src="topics_in_consulting_files/figure-html/glm-poisson-histogram-1.png" alt="Plot showing frequency of incidents for the ships data set. Data is clearly non-normal." width="672" />
<p class="caption">
Figure 4.13: Plot showing frequency of incidents for the ships data set. Data is clearly non-normal.
</p>
</div>
<p>From <a href="glm.html#fig:glm-poisson-histogram">4.13</a>, we see that our distribution of the outcome is not symmetric (very skewed to the right), indicating that we cannot use a linear model (which assumes normality of the outcome). This is expected as we are modelling counts of incidents.</p>
<p>In this data set, as different ships will be in service for different months (which may affect how many incidents the ship has), we can use that variable (which is a measure of time) as our offset term. Specifically, we will fit a Poisson regression model using <code>incidents</code> as our outcome and <code>log(service)</code> as the offset term.</p>
<p>We should first clean the data set. This involves changing all of the categorical variables to factors, and removing ships that were never in service:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="glm.html#cb287-1" tabindex="-1"></a><span class="co"># create new variables in the data set that are factors</span></span>
<span id="cb287-2"><a href="glm.html#cb287-2" tabindex="-1"></a>ships<span class="sc">$</span>type_f <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(ships<span class="sc">$</span>type)</span>
<span id="cb287-3"><a href="glm.html#cb287-3" tabindex="-1"></a>ships<span class="sc">$</span>year_f <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(ships<span class="sc">$</span>year)</span>
<span id="cb287-4"><a href="glm.html#cb287-4" tabindex="-1"></a>ships<span class="sc">$</span>period_f <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(ships<span class="sc">$</span>period)</span>
<span id="cb287-5"><a href="glm.html#cb287-5" tabindex="-1"></a></span>
<span id="cb287-6"><a href="glm.html#cb287-6" tabindex="-1"></a><span class="co"># remove ships (rows) that were never in service (service == 0)</span></span>
<span id="cb287-7"><a href="glm.html#cb287-7" tabindex="-1"></a><span class="co"># find which rows have service == 0</span></span>
<span id="cb287-8"><a href="glm.html#cb287-8" tabindex="-1"></a>toremove <span class="ot">&lt;-</span> <span class="fu">which</span>(ships<span class="sc">$</span>service <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb287-9"><a href="glm.html#cb287-9" tabindex="-1"></a></span>
<span id="cb287-10"><a href="glm.html#cb287-10" tabindex="-1"></a><span class="co"># remove the rows=</span></span>
<span id="cb287-11"><a href="glm.html#cb287-11" tabindex="-1"></a>ships <span class="ot">&lt;-</span> ships[<span class="sc">-</span>toremove, ] <span class="co"># the - sign removes the given rows</span></span></code></pre></div>
<div id="glm-poisson-example-mf" class="section level4 hasAnchor" number="4.8.1.1">
<h4><span class="header-section-number">4.8.1.1</span> Model Fitting<a href="glm.html#glm-poisson-example-mf" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We start with a main-effects only model using all of the covariates at our disposal. We fit this model in R by</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="glm.html#cb288-1" tabindex="-1"></a>ships_fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(incidents <span class="sc">~</span> type_f <span class="sc">+</span> year_f <span class="sc">+</span>period_f <span class="sc">+</span> </span>
<span id="cb288-2"><a href="glm.html#cb288-2" tabindex="-1"></a>                   <span class="fu">offset</span>(<span class="fu">log</span>(service)),</span>
<span id="cb288-3"><a href="glm.html#cb288-3" tabindex="-1"></a>                 <span class="at">family =</span> poisson, <span class="at">data =</span> ships)</span>
<span id="cb288-4"><a href="glm.html#cb288-4" tabindex="-1"></a></span>
<span id="cb288-5"><a href="glm.html#cb288-5" tabindex="-1"></a><span class="co"># look at the model output</span></span>
<span id="cb288-6"><a href="glm.html#cb288-6" tabindex="-1"></a><span class="fu">summary</span>(ships_fit1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = incidents ~ type_f + year_f + period_f + offset(log(service)), 
##     family = poisson, data = ships)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -6.40590    0.21744 -29.460  &lt; 2e-16 ***
## type_fB     -0.54334    0.17759  -3.060  0.00222 ** 
## type_fC     -0.68740    0.32904  -2.089  0.03670 *  
## type_fD     -0.07596    0.29058  -0.261  0.79377    
## type_fE      0.32558    0.23588   1.380  0.16750    
## year_f65     0.69714    0.14964   4.659 3.18e-06 ***
## year_f70     0.81843    0.16977   4.821 1.43e-06 ***
## year_f75     0.45343    0.23317   1.945  0.05182 .  
## period_f75   0.38447    0.11827   3.251  0.00115 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 146.328  on 33  degrees of freedom
## Residual deviance:  38.695  on 25  degrees of freedom
## AIC: 154.56
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>We should test to see if we can remove any covariates by performing likelihood ratio tests (LRTs) on nested models. We first fit a model without <code>type_f</code> and see if the fit is adequate compared to the main-effects only model. In this setting, we are testing the null hypothesis that the simpler model without <code>type_f</code> is adequate compared to the main-effects only model. If we reject the null, that means that <code>type_f</code> should be included in the model (when we compare it to the main-effects only model). We do this in R as:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="glm.html#cb290-1" tabindex="-1"></a><span class="co"># fit the new, nested model</span></span>
<span id="cb290-2"><a href="glm.html#cb290-2" tabindex="-1"></a>ships_fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(incidents <span class="sc">~</span> year_f <span class="sc">+</span>period_f <span class="sc">+</span> <span class="co"># remove type_f as variable</span></span>
<span id="cb290-3"><a href="glm.html#cb290-3" tabindex="-1"></a>                   <span class="fu">offset</span>(<span class="fu">log</span>(service)),</span>
<span id="cb290-4"><a href="glm.html#cb290-4" tabindex="-1"></a>                 <span class="at">family =</span> poisson, <span class="at">data =</span> ships)</span>
<span id="cb290-5"><a href="glm.html#cb290-5" tabindex="-1"></a></span>
<span id="cb290-6"><a href="glm.html#cb290-6" tabindex="-1"></a><span class="co"># perform the LRT</span></span>
<span id="cb290-7"><a href="glm.html#cb290-7" tabindex="-1"></a><span class="fu">anova</span>(ships_fit1, ships_fit2, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: incidents ~ type_f + year_f + period_f + offset(log(service))
## Model 2: incidents ~ year_f + period_f + offset(log(service))
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)    
## 1        25     38.695                         
## 2        29     62.365 -4   -23.67  9.3e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We see from the output we have a small <span class="math inline">\(p\)</span>-value, indicating that we reject the null hypothesis and conclude that the main-effects only model including <code>type_f</code> is a better fit.</p>
<p>Next we can check if we should remove <code>year_f</code> in a similar manner.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="glm.html#cb292-1" tabindex="-1"></a><span class="co"># fit the new, nested model</span></span>
<span id="cb292-2"><a href="glm.html#cb292-2" tabindex="-1"></a>ships_fit3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(incidents <span class="sc">~</span>  type_f  <span class="sc">+</span>period_f <span class="sc">+</span> <span class="co"># remove year_f as variable</span></span>
<span id="cb292-3"><a href="glm.html#cb292-3" tabindex="-1"></a>                   <span class="fu">offset</span>(<span class="fu">log</span>(service)),</span>
<span id="cb292-4"><a href="glm.html#cb292-4" tabindex="-1"></a>                 <span class="at">family =</span> poisson, <span class="at">data =</span> ships)</span>
<span id="cb292-5"><a href="glm.html#cb292-5" tabindex="-1"></a></span>
<span id="cb292-6"><a href="glm.html#cb292-6" tabindex="-1"></a><span class="co"># perform the LRT</span></span>
<span id="cb292-7"><a href="glm.html#cb292-7" tabindex="-1"></a><span class="fu">anova</span>(ships_fit1, ships_fit3, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: incidents ~ type_f + year_f + period_f + offset(log(service))
## Model 2: incidents ~ type_f + period_f + offset(log(service))
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1        25     38.695                          
## 2        28     70.103 -3  -31.408 6.975e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We again have a small <span class="math inline">\(p\)</span>-value and reject the null hypothesis that the simpler model fit is adequate. That is, the main-effects only model fits better between these two models.</p>
<p>Next, we test for <code>period_f</code>.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="glm.html#cb294-1" tabindex="-1"></a><span class="co"># fit the new, nested model</span></span>
<span id="cb294-2"><a href="glm.html#cb294-2" tabindex="-1"></a>ships_fit4 <span class="ot">&lt;-</span> <span class="fu">glm</span>(incidents <span class="sc">~</span> type_f <span class="sc">+</span> year_f <span class="sc">+</span> <span class="co"># remove period_f as variable</span></span>
<span id="cb294-3"><a href="glm.html#cb294-3" tabindex="-1"></a>                   <span class="fu">offset</span>(<span class="fu">log</span>(service)),</span>
<span id="cb294-4"><a href="glm.html#cb294-4" tabindex="-1"></a>                 <span class="at">family =</span> poisson, <span class="at">data =</span> ships)</span>
<span id="cb294-5"><a href="glm.html#cb294-5" tabindex="-1"></a></span>
<span id="cb294-6"><a href="glm.html#cb294-6" tabindex="-1"></a><span class="co"># perform the LRT</span></span>
<span id="cb294-7"><a href="glm.html#cb294-7" tabindex="-1"></a><span class="fu">anova</span>(ships_fit1, ships_fit4, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: incidents ~ type_f + year_f + period_f + offset(log(service))
## Model 2: incidents ~ type_f + year_f + offset(log(service))
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)   
## 1        25     38.695                        
## 2        26     49.355 -1   -10.66 0.001095 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Again, we have a small <span class="math inline">\(p\)</span>-value and choose the main-effects only model.</p>
<p>Although we were unable to remove any covariates, we can still test for possible interactions of the covariates. We again perform LRTs where in this setting, the main effects model will be nested in the model that includes additional interactions.</p>
<p>Let’s first start by seeing if we should have an interaction between <code>type_f</code> and <code>year_f</code>. We do this by fitting a new interaction model and comparing it to the main-effects only model. The null hypothesis here is that the main-effects only model (simpler model) fits as well as the interaction model (more complex model). Rejecting the null hypothesis will tell us that we should include the interaction effect in the final model. We do this in R by:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="glm.html#cb296-1" tabindex="-1"></a><span class="co"># fit the new interaction model</span></span>
<span id="cb296-2"><a href="glm.html#cb296-2" tabindex="-1"></a>ships_fit5 <span class="ot">&lt;-</span> <span class="fu">glm</span>(incidents <span class="sc">~</span> type_f <span class="sc">+</span> year_f <span class="sc">+</span> period_f <span class="sc">+</span> </span>
<span id="cb296-3"><a href="glm.html#cb296-3" tabindex="-1"></a>                    type_f<span class="sc">*</span>year_f <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(service)), <span class="co">#include interaction</span></span>
<span id="cb296-4"><a href="glm.html#cb296-4" tabindex="-1"></a>                 <span class="at">family =</span> poisson, <span class="at">data =</span> ships)</span>
<span id="cb296-5"><a href="glm.html#cb296-5" tabindex="-1"></a></span>
<span id="cb296-6"><a href="glm.html#cb296-6" tabindex="-1"></a><span class="co"># perform the LRT</span></span>
<span id="cb296-7"><a href="glm.html#cb296-7" tabindex="-1"></a><span class="fu">anova</span>(ships_fit5, ships_fit1, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: incidents ~ type_f + year_f + period_f + type_f * year_f + offset(log(service))
## Model 2: incidents ~ type_f + year_f + period_f + offset(log(service))
##   Resid. Df Resid. Dev  Df Deviance Pr(&gt;Chi)  
## 1        13     14.587                        
## 2        25     38.695 -12  -24.108  0.01966 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>With a small <span class="math inline">\(p\)</span>-value, we reject the null hypothesis. That is, we conclude the main-effects only (simpler) model is not adequate and we should have this interaction in the final model. Let’s take a look at the model summary here:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="glm.html#cb298-1" tabindex="-1"></a><span class="fu">summary</span>(ships_fit5)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = incidents ~ type_f + year_f + period_f + type_f * 
##     year_f + offset(log(service)), family = poisson, data = ships)
## 
## Coefficients:
##                    Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)        -23.9891  6625.5246  -0.004  0.99711   
## type_fB             17.0506  6625.5246   0.003  0.99795   
## type_fC             17.0863  6625.5246   0.003  0.99794   
## type_fD             -0.5962  9331.1044   0.000  0.99995   
## type_fE              0.8799 11522.0953   0.000  0.99994   
## year_f65            18.0324  6625.5246   0.003  0.99783   
## year_f70            18.3969  6625.5246   0.003  0.99778   
## year_f75            18.2860  6625.5246   0.003  0.99780   
## period_f75           0.3850     0.1186   3.246  0.00117 **
## type_fB:year_f65   -17.3620  6625.5246  -0.003  0.99791   
## type_fC:year_f65   -18.6108  6625.5247  -0.003  0.99776   
## type_fD:year_f65   -18.4024 11467.2827  -0.002  0.99872   
## type_fE:year_f65     0.4496 11522.0953   0.000  0.99997   
## type_fB:year_f70   -17.6110  6625.5246  -0.003  0.99788   
## type_fC:year_f70   -17.6160  6625.5246  -0.003  0.99788   
## type_fD:year_f70     1.0922  9331.1044   0.000  0.99991   
## type_fE:year_f70    -0.8285 11522.0953   0.000  0.99994   
## type_fB:year_f75   -17.7124  6625.5246  -0.003  0.99787   
## type_fC:year_f75   -17.3813  6625.5247  -0.003  0.99791   
## type_fD:year_f75    -0.3254  9331.1044   0.000  0.99997   
## type_fE:year_f75    -1.8570 11522.0954   0.000  0.99987   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 146.328  on 33  degrees of freedom
## Residual deviance:  14.587  on 13  degrees of freedom
## AIC: 154.45
## 
## Number of Fisher Scoring iterations: 17</code></pre>
<p>Looking at the model summary, we notice that only one covariate is significant and we have huge standard errors for most of our covariates in the model. This indicates that we have over-parameterized our model as we have 12 interaction terms here. Looking at the full data set, we see that for ships with type D in the year 1960-1964 or 1965-1969 category, there are no events. This could cause issues with the model fitting. As such, despite what the statistical test told us, we should not continue with this model or use any models that include any interactions between <code>type_f</code> and <code>year_f</code>.</p>
<p>Next we can test if we should also have an interaction between <code>type_f</code> and <code>period_f</code>. We test this model to the main effects model (<code>ships_fit</code>). We do this in R by:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="glm.html#cb300-1" tabindex="-1"></a><span class="co"># fit the new interaction model</span></span>
<span id="cb300-2"><a href="glm.html#cb300-2" tabindex="-1"></a>ships_fit6 <span class="ot">&lt;-</span> <span class="fu">glm</span>(incidents <span class="sc">~</span> type_f <span class="sc">+</span> year_f <span class="sc">+</span> period_f <span class="sc">+</span> </span>
<span id="cb300-3"><a href="glm.html#cb300-3" tabindex="-1"></a>                    type_f<span class="sc">*</span>period_f <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(service)), <span class="co">#include interaction</span></span>
<span id="cb300-4"><a href="glm.html#cb300-4" tabindex="-1"></a>                 <span class="at">family =</span> poisson, <span class="at">data =</span> ships)</span>
<span id="cb300-5"><a href="glm.html#cb300-5" tabindex="-1"></a></span>
<span id="cb300-6"><a href="glm.html#cb300-6" tabindex="-1"></a><span class="co"># perform the LRT</span></span>
<span id="cb300-7"><a href="glm.html#cb300-7" tabindex="-1"></a><span class="fu">anova</span>(ships_fit6, ships_fit1, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: incidents ~ type_f + year_f + period_f + type_f * period_f + 
##     offset(log(service))
## Model 2: incidents ~ type_f + year_f + period_f + offset(log(service))
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
## 1        21     33.756                     
## 2        25     38.695 -4  -4.9388   0.2936</code></pre>
<p>We have a large <span class="math inline">\(p\)</span>-value, thus we fail to reject the null hypothesis. That is, we conclude the simpler main-effects only model with no interactions is adequate compared to the model with the interaction and continue model building from there.</p>
<p>Next we can test if we should also have an interaction between <code>year_f</code> and <code>period_f</code>. We test this model to the main effects model again.. We do this in R by:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="glm.html#cb302-1" tabindex="-1"></a><span class="co"># fit the new interaction model</span></span>
<span id="cb302-2"><a href="glm.html#cb302-2" tabindex="-1"></a>ships_fit7 <span class="ot">&lt;-</span> <span class="fu">glm</span>(incidents <span class="sc">~</span> type_f <span class="sc">+</span> year_f <span class="sc">+</span> period_f <span class="sc">+</span> </span>
<span id="cb302-3"><a href="glm.html#cb302-3" tabindex="-1"></a>                 year_f<span class="sc">*</span>period_f <span class="sc">+</span>  <span class="fu">offset</span>(<span class="fu">log</span>(service)), <span class="co">#include interaction</span></span>
<span id="cb302-4"><a href="glm.html#cb302-4" tabindex="-1"></a>                 <span class="at">family =</span> poisson, <span class="at">data =</span> ships)</span>
<span id="cb302-5"><a href="glm.html#cb302-5" tabindex="-1"></a></span>
<span id="cb302-6"><a href="glm.html#cb302-6" tabindex="-1"></a><span class="co"># perform the LRT</span></span>
<span id="cb302-7"><a href="glm.html#cb302-7" tabindex="-1"></a><span class="fu">anova</span>(ships_fit7, ships_fit1, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: incidents ~ type_f + year_f + period_f + year_f * period_f + 
##     offset(log(service))
## Model 2: incidents ~ type_f + year_f + period_f + offset(log(service))
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
## 1        23     36.908                     
## 2        25     38.695 -2  -1.7875   0.4091</code></pre>
<p>We have a large <span class="math inline">\(p\)</span>-value, thus we fail to reject the null hypothesis. That is, we conclude themain-effects only model is adequate compared to the one with the interaction.</p>
<p>We finish our model building process and conclude that <code>ships_fit1</code> is the best fitting model of the ones we tested. From the main-effects only model output shown earlier, we see that all covariates have small standard errors, and most levels of the categorical covariates are significant. This is what we should expect from a final model after cycling through the fitting procedure.</p>
</div>
<div id="glm-poisson-example-md" class="section level4 hasAnchor" number="4.8.1.2">
<h4><span class="header-section-number">4.8.1.2</span> Model Diagnostics<a href="glm.html#glm-poisson-example-md" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Residuals</strong></p>
<p>Once we settle on a model from the likelihood ratio tests and initial inspection, we need to check the overall model fit. The first thing we can do is look at a plot of the residual versus fitted values to see if there are any large residuals indicating poor fit in the model. The following code can be used to produce such plots:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="glm.html#cb304-1" tabindex="-1"></a>resid <span class="ot">&lt;-</span> <span class="fu">residuals.glm</span>(ships_fit1)</span>
<span id="cb304-2"><a href="glm.html#cb304-2" tabindex="-1"></a>fitted <span class="ot">&lt;-</span> ships_fit1<span class="sc">$</span>fitted.values</span>
<span id="cb304-3"><a href="glm.html#cb304-3" tabindex="-1"></a><span class="fu">plot</span>(fitted, resid, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">ylab =</span> <span class="st">&quot;Deviance Residuals&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Fitted Values&quot;</span>)</span>
<span id="cb304-4"><a href="glm.html#cb304-4" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb304-5"><a href="glm.html#cb304-5" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-poisson-plot1"></span>
<img src="topics_in_consulting_files/figure-html/glm-poisson-plot1-1.png" alt="Residual diagnostic plot for Poisson GLM." width="672" />
<p class="caption">
Figure 4.14: Residual diagnostic plot for Poisson GLM.
</p>
</div>
<p>We see that most values fall within 2 standard deviations, and there do not appear to be extreme residuals.</p>
<p><strong>Overdispersion</strong></p>
<p>A common issue of Poisson GLMs is <a href="https://en.wikipedia.org/wiki/Overdispersion">overdispersion</a> where we have a larger variation in the data set then would expect for the Poisson model (where in this distribution, we have that the mean and variance are equal to each other). When overdispersion occurs, the standard errors of our regression coefficients may be underestimated and we must adjust them. To test for overdispersion, we can use the <code>dispersiontest()</code> function from the <a href="https://CRAN.R-project.org/package=AER"><strong>AER</strong></a> package. A small <span class="math inline">\(p\)</span>-value indicates that we reject the null hypothesis that our dispersion is less than one (no overdispersion present). We can perform this test on our model by:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="glm.html#cb305-1" tabindex="-1"></a><span class="fu">dispersiontest</span>(ships_fit1)</span></code></pre></div>
<pre><code>## 
##  Overdispersion test
## 
## data:  ships_fit1
## z = 0.9216, p-value = 0.1784
## alternative hypothesis: true dispersion is greater than 1
## sample estimates:
## dispersion 
##   1.313931</code></pre>
<p>We have a moderately large <span class="math inline">\(p\)</span>-value of 0.1784, so we fail to reject the null hypothesis. That is, we do not have evidence of overdispersion in this model and continue our analysis.</p>
<p>If overdispersion is present in a model, one can use an ad-hoc approach to estimate a dispersion parameter or use a mixed model (negative binomial distribution) that introduces a random variable that acts as a dispersion factor. For more information on these models, see <a href="https://online.stat.psu.edu/stat504/lesson/9/9.2-0">this tutorial</a> which provides examples in both R and SAS.</p>
<p><strong>Zero-inflation</strong></p>
<p>We should also check if the amount of observed zeros in our outcome marches what would be predicted from our model. If the amount of predicted zeros is smaller than what is observed, we may need to use a <a href="https://en.wikipedia.org/wiki/Zero-inflated_model">zero-inflated poisson regression</a>. We can check for this looking at the ratio of observed versus predicted zeros. This can be done using the <code>check_zeroinflation()</code> function from the <a href="https://CRAN.R-project.org/package=performance"><strong>performance</strong></a> package in R:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="glm.html#cb307-1" tabindex="-1"></a><span class="fu">check_zeroinflation</span>(ships_fit1)</span></code></pre></div>
<pre><code>## # Check for zero-inflation
## 
##    Observed zeros: 8
##   Predicted zeros: 8
##             Ratio: 1.00</code></pre>
<pre><code>## Model seems ok, ratio of observed and predicted zeros is
##   within the tolerance range.</code></pre>
<p>We see that we have the same number of observed and predicted zeros in the model, and thus we do not need to use a zero-inflated model. There are no strict guidelines for what ratio a zero-inflated model must be used, but it is common for a ratio between 0.95 and 1.05 to be considered good enough to continue with a regular Poisson GLM. More discussion on this issue, along with some more formal statistical tests, can be found <a href="https://stats.oarc.ucla.edu/r/dae/zip/#:~:text=Zero%2Dinflated%20poisson%20regression%20is,zeros%20can%20be%20modeled%20independently.">here</a>.</p>
<p><strong>Multicollinearity</strong></p>
<p>We should also perform a check on the covariates included in the model.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="glm.html#cb310-1" tabindex="-1"></a><span class="co"># again specify using the car package using car::vif()</span></span>
<span id="cb310-2"><a href="glm.html#cb310-2" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(ships_fit1)</span></code></pre></div>
<pre><code>##              GVIF Df GVIF^(1/(2*Df))
## type_f   1.341054  4        1.037363
## year_f   1.524809  3        1.072842
## period_f 1.185194  1        1.088666</code></pre>
<p>All VIF values are low, which indicates that there are no issues with multicollinearity in the model.</p>
</div>
<div id="glm-poisson-example-interpretation" class="section level4 hasAnchor" number="4.8.1.3">
<h4><span class="header-section-number">4.8.1.3</span> Model Interpretation and Hypothesis Testing<a href="glm.html#glm-poisson-example-interpretation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>After checking the fit of our model, we can interpret our model to answer the research question of interest. Here, we are interested in seeing if the type of ship, the year it was built, or the period of operation are associated with an increase or decrease in the number of damage incidents.</p>
<p>We can see a summary of the final model again by calling:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="glm.html#cb312-1" tabindex="-1"></a><span class="fu">summary</span>(ships_fit1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = incidents ~ type_f + year_f + period_f + offset(log(service)), 
##     family = poisson, data = ships)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -6.40590    0.21744 -29.460  &lt; 2e-16 ***
## type_fB     -0.54334    0.17759  -3.060  0.00222 ** 
## type_fC     -0.68740    0.32904  -2.089  0.03670 *  
## type_fD     -0.07596    0.29058  -0.261  0.79377    
## type_fE      0.32558    0.23588   1.380  0.16750    
## year_f65     0.69714    0.14964   4.659 3.18e-06 ***
## year_f70     0.81843    0.16977   4.821 1.43e-06 ***
## year_f75     0.45343    0.23317   1.945  0.05182 .  
## period_f75   0.38447    0.11827   3.251  0.00115 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 146.328  on 33  degrees of freedom
## Residual deviance:  38.695  on 25  degrees of freedom
## AIC: 154.56
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>We can write this model as
<span class="math display">\[
\log(\mu(t)) = \beta_0 + \beta_1x_1 + \beta_2x_2 + \beta_3x_3 + \beta_4x_4 + \beta_5x_5 + \beta_6x_5 + \beta_7x_7 + \beta_8x_8
\]</span>
where <span class="math inline">\(x_1\)</span> indicates the ship is type B, <span class="math inline">\(x_2\)</span> indicates the ship is type C, <span class="math inline">\(x_3\)</span> indicates the ship is type D, <span class="math inline">\(x_4\)</span> indicates the ship is type E, <span class="math inline">\(x_5\)</span> indicates the ship was built between 1965-1969, <span class="math inline">\(x_6\)</span> indicates the ship was built between 1970-1974, <span class="math inline">\(x_7\)</span> indicates the ship was built between 1974-1979, <span class="math inline">\(x_8\)</span> indicates the ship operated between 1975-1979.</p>
<p>Each coefficient can be interpreted as the expected log relative rate (log RR) of incidents. For example, the coefficient for the B type ships (<span class="math inline">\(\beta_1\)</span> or <code>type_fB</code> from the output) is -0.543 which means that for ships constructed in the same year and that operated in the same period, the rate of incidents for ships of type B is <span class="math inline">\(\exp(\)</span> -0.543 <span class="math inline">\()\)</span> = 0.581 times larger than type A ships (the reference group). This indicates that risk of type B ships having incidents was less than that of type A ships (since RR &lt; 1), controlling for period of operation and construction year.</p>
<p>To obtain a confidence interval for this estimate, we can calculate the confidence interval for the log relative rate, and then exponentiate it. In this case, a 95% confidence interval for the log relative rate of incidents for B type ships versus A type ships is <span class="math inline">\(\widehat{\beta_1} \pm\)</span> 1.960 <span class="math inline">\(\times \widehat{se}(\widehat{\beta_1})\)</span> = -0.543 <span class="math inline">\(\pm\)</span> 1.960 <span class="math inline">\(\times\)</span> 0.178 = (-0.891,-0.195). Then, we take those two numbers and exponentiate them to get a 95% confidence interval for the relative rate, which is (<span class="math inline">\(\exp(\)</span>-0.891),<span class="math inline">\(\exp(\)</span>-0.195)) = (0.41,0.823). As this confidence interval does not contain RR = 1, we conclude that the relative rate of incidents for type B ships is significantly lower (since RR &lt; 1) than type A when controlling for period of operation and construction year. Other individual covariates can be similarly interpreted, and confidence intervals for the respective relative rates can easily be found using the <code>confint()</code> function from the <a href="https://CRAN.R-project.org/package=MASS"><strong>MASS</strong></a> package. For example, we can call</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="glm.html#cb314-1" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(ships_fit1))</span></code></pre></div>
<pre><code>## Waiting for profiling to be done...</code></pre>
<pre><code>##                   2.5 %      97.5 %
## (Intercept) 0.001066843 0.002504456
## type_fB     0.414219640 0.832326237
## type_fC     0.252462723 0.928188620
## type_fD     0.510932360 1.608409891
## type_fE     0.866347032 2.192855450
## year_f65    1.503089957 2.705068073
## year_f70    1.627883790 3.169892062
## year_f75    0.987734160 2.469126537
## period_f75  1.165784432 1.854109971</code></pre>
<p>to obtain the 95% individual confidence intervals for the relative rate (after exponentiating). Other confidence intervals can be calculated by changing the <code>level</code> parameter in the <code>confint()</code> function.</p>
<p>If we wanted to compare two ship types to each other where one is not the baseline value in the model, we can still do so with such models. For example, say we want to estimate the relative rate of incidents for ships of type E (<span class="math inline">\(x_4 = 1\)</span>) versus C (<span class="math inline">\(x_2 = 1\)</span>), controlling for construction year and period of operation. It is often helpful to create a table such as:
<span class="math display">\[
\begin{aligned}
&amp; \beta_0 + \beta_1x_1 + \beta_2x_2 + \beta_3x_3 + \beta_4x_4 + \beta_5x_5 +\beta_6x_6 + \beta_7x_7 + \beta_8x_8\\
-&amp; (\beta_0 + \beta_1x_1 + \beta_2x_2 + \beta_3x_3 + \beta_4x_4 + \beta_5x_5 +\beta_6x_6 + \beta_7x_7 + \beta_8x_8)\\
&amp; \hline
\qquad \qquad \qquad \qquad \qquad \qquad??
\end{aligned}
\]</span>
and then fill in the values for each scenario. The top row will be for the type E ship and the second row will be for the type C ship. Note that when we fill in 0 for the other types of ships since this is a categorical variable. We also hold the period of operation and construction year constant, so we can just leave these as arbitrary <span class="math inline">\(x\)</span> values. Then, we perform the subtraction:</p>
<p><span class="math display">\[
\begin{aligned}
&amp; \beta_0 + \beta_1(0) + \beta_2(0)+ \beta_3(0) + \beta_4(1) + \beta_5x_5 +\beta_6x_6 + \beta_7x_7 + \beta_8x_8\\
-&amp; (\beta_0 + \beta_1(0) + \beta_2(1) + \beta_3(0) + \beta_4(0) + \beta_5x_5 +\beta_6x_6 + \beta_7x_7 + \beta_8x_8)\\
&amp; \hline
\qquad \quad  \qquad -\beta_2 \qquad  \qquad \quad  +\beta_4\\
\end{aligned}
\]</span></p>
<p>So, the log relative rate we wish to calculate is <span class="math inline">\(-\beta_2 + \beta_4\)</span> = 0.687 + 0.326 = 1.013. To obtain a confidence interval for this quantity, we first need to obtain the estimated standard error of <span class="math inline">\(-\beta_2 + \beta_4\)</span>. We can do this in R by first creating a vector indicating the quantity we’d like to calculate the standard error for (here it is <span class="math inline">\((\beta_0, \beta_1, \beta_2, \beta_3, \beta_4, \beta_5, \beta_6, \beta_7, \beta_8) = (0, 0, -1, 0 , 1, 0, 0, 0, 0)\)</span>) and then calculating the error by:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="glm.html#cb317-1" tabindex="-1"></a><span class="co"># create the vector for -beta2 + beta4 (don&#39;t forget to include beta0!)</span></span>
<span id="cb317-2"><a href="glm.html#cb317-2" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb317-3"><a href="glm.html#cb317-3" tabindex="-1"></a></span>
<span id="cb317-4"><a href="glm.html#cb317-4" tabindex="-1"></a><span class="co"># grab variance-covariance matrix from the model</span></span>
<span id="cb317-5"><a href="glm.html#cb317-5" tabindex="-1"></a>vcov <span class="ot">&lt;-</span> <span class="fu">summary</span>(ships_fit1)<span class="sc">$</span>cov.unscaled</span>
<span id="cb317-6"><a href="glm.html#cb317-6" tabindex="-1"></a></span>
<span id="cb317-7"><a href="glm.html#cb317-7" tabindex="-1"></a>esterror <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">t</span>(L) <span class="sc">%*%</span> vcov <span class="sc">%*%</span> L) <span class="co">#%*% represents matrix multiplication</span></span>
<span id="cb317-8"><a href="glm.html#cb317-8" tabindex="-1"></a>esterror</span></code></pre></div>
<pre><code>##           [,1]
## [1,] 0.3394497</code></pre>
<p>Then, we can use this in our confidence interval for the log relative rate:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="glm.html#cb319-1" tabindex="-1"></a><span class="co"># calculate -beta2 + beta4</span></span>
<span id="cb319-2"><a href="glm.html#cb319-2" tabindex="-1"></a>estimate <span class="ot">&lt;-</span> <span class="fu">coef</span>(ships_fit1)<span class="sc">%*%</span>L</span>
<span id="cb319-3"><a href="glm.html#cb319-3" tabindex="-1"></a></span>
<span id="cb319-4"><a href="glm.html#cb319-4" tabindex="-1"></a><span class="co"># calculate lower CI bound</span></span>
<span id="cb319-5"><a href="glm.html#cb319-5" tabindex="-1"></a>CI_lower <span class="ot">&lt;-</span> estimate <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>esterror</span>
<span id="cb319-6"><a href="glm.html#cb319-6" tabindex="-1"></a></span>
<span id="cb319-7"><a href="glm.html#cb319-7" tabindex="-1"></a><span class="co"># calculate upper CI bound</span></span>
<span id="cb319-8"><a href="glm.html#cb319-8" tabindex="-1"></a>CI_upper <span class="ot">&lt;-</span> estimate <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>esterror</span>
<span id="cb319-9"><a href="glm.html#cb319-9" tabindex="-1"></a></span>
<span id="cb319-10"><a href="glm.html#cb319-10" tabindex="-1"></a><span class="co"># print it out nicely</span></span>
<span id="cb319-11"><a href="glm.html#cb319-11" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">round</span>(CI_lower,<span class="dv">3</span>), <span class="st">&quot;,&quot;</span>, <span class="fu">round</span>(CI_upper,<span class="dv">3</span>), <span class="st">&quot;)&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;( 0.348 , 1.678 )&quot;</code></pre>
<p>Then to get the estimated CI for the relative rate (not log relative rate), we exponentiate both ends of the interval:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="glm.html#cb321-1" tabindex="-1"></a><span class="co"># calculate lower CI bound for RR</span></span>
<span id="cb321-2"><a href="glm.html#cb321-2" tabindex="-1"></a>CI_RR_lower <span class="ot">&lt;-</span> <span class="fu">exp</span>(CI_lower)</span>
<span id="cb321-3"><a href="glm.html#cb321-3" tabindex="-1"></a></span>
<span id="cb321-4"><a href="glm.html#cb321-4" tabindex="-1"></a><span class="co"># calculate upper CI bound for RR</span></span>
<span id="cb321-5"><a href="glm.html#cb321-5" tabindex="-1"></a>CI_RR_upper <span class="ot">&lt;-</span> <span class="fu">exp</span>(CI_upper)</span>
<span id="cb321-6"><a href="glm.html#cb321-6" tabindex="-1"></a></span>
<span id="cb321-7"><a href="glm.html#cb321-7" tabindex="-1"></a><span class="co"># print it out nicely</span></span>
<span id="cb321-8"><a href="glm.html#cb321-8" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">round</span>(CI_RR_lower,<span class="dv">3</span>), <span class="st">&quot;, &quot;</span>, <span class="fu">round</span>(CI_RR_upper,<span class="dv">3</span>), <span class="st">&quot;)&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;(1.416, 5.356)&quot;</code></pre>
<p>As the resultant confidence interval for the relative rate does not contain an estimate of RR = 1, we conclude that the relative rate of incidents for ships of type E (<span class="math inline">\(x_4 = 1\)</span>) versus C (<span class="math inline">\(x_2 = 1\)</span>) significantly differs and is estimated to be 1.013 (95% CI: ), controlling for construction year and period of operation.</p>
<p>For non-categorical variables, the interpretation of the regression coefficient is the log relative rate associated with a one-unit increase in that variable.</p>
<p>For more information on Poisson models, readers are directed to <span class="citation">(<a href="#ref-hilbe2013">Hilbe, Zuur, and Ieno 2013</a>)</span>, <span class="citation">(<a href="#ref-mccullagh2019">McCullagh and Nelder 2019</a>)</span>.</p>
</div>
</div>
</div>
<div id="glm-gamma" class="section level2 hasAnchor" number="4.9">
<h2><span class="header-section-number">4.9</span> Gamma Distributed (Skewed) Outcomes<a href="glm.html#glm-gamma" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For continuous data that is not normally distributed, a GLM using the Gamma distribution can be used to model skewed, positive outcomes.</p>
<p>Below are a few examples of Gamma distributions with varying parameters (referred to as the shape and scale parameters).</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="glm.html#cb323-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb323-2"><a href="glm.html#cb323-2" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dgamma</span>(x, <span class="at">shape =</span> <span class="fl">1.5</span>, <span class="at">scale =</span> <span class="dv">1</span>), <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb323-3"><a href="glm.html#cb323-3" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Shape = 1.5, Scale = 1&quot;</span>,</span>
<span id="cb323-4"><a href="glm.html#cb323-4" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb323-5"><a href="glm.html#cb323-5" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Density&quot;</span>,</span>
<span id="cb323-6"><a href="glm.html#cb323-6" tabindex="-1"></a>      <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb323-7"><a href="glm.html#cb323-7" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dgamma</span>(x, <span class="at">shape =</span> <span class="fl">2.5</span>, <span class="at">scale =</span> <span class="dv">1</span>), <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">col =</span> <span class="st">&quot;steelblue&quot;</span>,</span>
<span id="cb323-8"><a href="glm.html#cb323-8" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Shape = 2.5, Scale = 1&quot;</span>,</span>
<span id="cb323-9"><a href="glm.html#cb323-9" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb323-10"><a href="glm.html#cb323-10" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Density&quot;</span>,</span>
<span id="cb323-11"><a href="glm.html#cb323-11" tabindex="-1"></a>      <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb323-12"><a href="glm.html#cb323-12" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dgamma</span>(x, <span class="at">shape =</span> <span class="fl">1.5</span>, <span class="at">scale =</span> <span class="fl">0.5</span>), <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">col =</span> <span class="st">&quot;darkgreen&quot;</span>,</span>
<span id="cb323-13"><a href="glm.html#cb323-13" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Shape = 1.5, Scale = 0.5&quot;</span>,</span>
<span id="cb323-14"><a href="glm.html#cb323-14" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb323-15"><a href="glm.html#cb323-15" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Density&quot;</span>,</span>
<span id="cb323-16"><a href="glm.html#cb323-16" tabindex="-1"></a>      <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb323-17"><a href="glm.html#cb323-17" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dgamma</span>(x, <span class="at">shape =</span> <span class="fl">2.5</span>, <span class="at">scale =</span> <span class="fl">0.5</span>), <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">col =</span> <span class="st">&quot;purple&quot;</span>,</span>
<span id="cb323-18"><a href="glm.html#cb323-18" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Shape = 2.5, Scale = 0.5&quot;</span>,</span>
<span id="cb323-19"><a href="glm.html#cb323-19" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb323-20"><a href="glm.html#cb323-20" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Density&quot;</span>,</span>
<span id="cb323-21"><a href="glm.html#cb323-21" tabindex="-1"></a>      <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-gamma-plots"></span>
<img src="topics_in_consulting_files/figure-html/glm-gamma-plots-1.png" alt="Examples of the Gamma distribution. Shape changes across rows while scale changes across columns." width="672" />
<p class="caption">
Figure 4.15: Examples of the Gamma distribution. Shape changes across rows while scale changes across columns.
</p>
</div>
<p>We can see from these four examples that the Gamma distribution is very flexible for modelling continuous outcomes that are skewed and positive. We however note that under the Gamma distribution, the variance is equal to the mean squared, meaning that the ratio of the mean and standard deviation is constant. Using a log link can stabilize the variance, as discussed in <span class="citation">(<a href="#ref-myers1997">Myers and Montgomery 1997</a>)</span>. Although the canonical link for a Gamma family GLM is the inverse link, we commonly see the log link applied in practice because of its interpretations and variance stabilization. Using the log link does not require further constraints on the model when fit.</p>
<p>Under the log link, we model
<span class="math display">\[
\log(y_{i}) = \boldsymbol{x}_i^T\boldsymbol{\beta}
\]</span>
which can also be written as
<span class="math display">\[
\begin{aligned}
y_i &amp;= \exp(\boldsymbol{x}_i^T\boldsymbol{\beta})\\
&amp;= \exp(\beta_0 + \beta_1x_{i1} + \beta_2x_{i2} + ... + \beta_{ip}x_{ip})\\
&amp;= \exp(\beta_0)\exp(\beta_1x_{i1}) \exp(\beta_2x_{i2})\dots \exp(\beta_{ip}x_{ip}) \\
&amp;= \exp(\beta_0)\exp(\beta_1)^{x_{i1}} \exp(\beta_2)^{x_{i2}}...\exp(\beta_{ip})^{x_{ip}}.
\end{aligned}.\
\]</span>
Under the log link, we have a multiplicative model. We interpret <span class="math inline">\(\exp(\beta_0)\)</span> as the expected value of <span class="math inline">\(y\)</span> when all covariates are equal to zero. We interpret <span class="math inline">\(\exp(\beta_j\)</span>) as the expected multiplicative increase of <span class="math inline">\(y\)</span> for a one unit increase in <span class="math inline">\(x_j\)</span>, when the other covariates are equal to zero. We note that covariates can either be continuous or categorical.</p>
<div id="glm-gamma-example" class="section level3 hasAnchor" number="4.9.1">
<h3><span class="header-section-number">4.9.1</span> Example<a href="glm.html#glm-gamma-example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will re-use the data presented in Section <a href="glm.html#glm-normal-ex">4.5.1</a> on rent prices in Munich in 2003. Instead of looking at the clear rent per square meter (<code>rentm</code>) as we did in Section <a href="glm.html#glm-normal-ex">4.5.1</a>, we will be using the clear rent (without adjustment for apartment area) as the outcome, (<code>rent</code>).</p>
<p>If the data has not already been loaded in from the <a href="https://CRAN.R-project.org/package=catdata"><strong>catdata</strong></a> package, we can load it in and look at first 6 observations using the following code:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="glm.html#cb324-1" tabindex="-1"></a><span class="fu">data</span>(rent) <span class="co"># load in the data set</span></span>
<span id="cb324-2"><a href="glm.html#cb324-2" tabindex="-1"></a><span class="fu">head</span>(rent)</span></code></pre></div>
<pre><code>##     rent rentm size rooms year area good best warm central tiles
## 1 741.39 10.90   68     2 1918    2    1    0    0       0     0
## 2 715.82 11.01   65     2 1995    2    1    0    0       0     0
## 3 528.25  8.38   63     3 1918    2    1    0    0       0     0
## 4 553.99  8.52   65     3 1983   16    0    0    0       0     0
## 5 698.21  6.98  100     4 1995   16    1    0    0       0     0
## 6 935.65 11.55   81     4 1980   16    0    0    0       0     0
##   bathextra kitchen
## 1         0       0
## 2         0       0
## 3         0       0
## 4         1       0
## 5         1       1
## 6         0       0</code></pre>
<p>Next, we can plot the outcome to see if it is skewed.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="glm.html#cb326-1" tabindex="-1"></a><span class="fu">hist</span>(rent<span class="sc">$</span>rent, <span class="at">main =</span> <span class="st">&quot;Plot of Rent&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Rent&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-gamma-example-hist"></span>
<img src="topics_in_consulting_files/figure-html/glm-gamma-example-hist-1.png" alt="Plot used to see if there is any evidence of non-normality in the outcome." width="672" />
<p class="caption">
Figure 4.16: Plot used to see if there is any evidence of non-normality in the outcome.
</p>
</div>
<p>We see that there is some skewness present in the outcome variable. We can confirm this using the <a href="https://en.wikipedia.org/wiki/Shapiro%E2%80%93Wilk_test">Shaprio-Wilk test</a> of normality. Rejecting this test indicates that the normality assumption is not appropriate to use. We can perform this test in R by:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="glm.html#cb327-1" tabindex="-1"></a><span class="fu">shapiro.test</span>(rent<span class="sc">$</span>rent)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  rent$rent
## W = 0.94478, p-value &lt; 2.2e-16</code></pre>
<p>Our <span class="math inline">\(p\)</span>-value is very small (&lt;0.001) and indicates that we cannot assume the outcome is normal for this data set. As such, we can turn to the Gamma GLM to model this outcome and see if the rent is related to any other covariates in the data set.</p>
<div id="glm-gamma-example-mf" class="section level4 hasAnchor" number="4.9.1.1">
<h4><span class="header-section-number">4.9.1.1</span> Model Fitting<a href="glm.html#glm-gamma-example-mf" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We fit a Gamma GLM to the data set with a log link, as described in the previous section. We start by building a main-effects only model containing all possible covariates (aside from <code>rentm</code>). To do so in R, we perform the following:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="glm.html#cb329-1" tabindex="-1"></a>rent_fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rent <span class="sc">~</span> size <span class="sc">+</span> <span class="fu">factor</span>(rooms) <span class="sc">+</span> year <span class="sc">+</span> <span class="fu">factor</span>(area) <span class="sc">+</span> </span>
<span id="cb329-2"><a href="glm.html#cb329-2" tabindex="-1"></a>    <span class="fu">factor</span>(good) <span class="sc">+</span> <span class="fu">factor</span>(best) <span class="sc">+</span> <span class="fu">factor</span>(warm) <span class="sc">+</span> <span class="fu">factor</span>(central) <span class="sc">+</span> </span>
<span id="cb329-3"><a href="glm.html#cb329-3" tabindex="-1"></a>    <span class="fu">factor</span>(tiles) <span class="sc">+</span> <span class="fu">factor</span>(bathextra) <span class="sc">+</span> <span class="fu">factor</span>(kitchen), <span class="at">data =</span> rent,</span>
<span id="cb329-4"><a href="glm.html#cb329-4" tabindex="-1"></a>                  <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb329-5"><a href="glm.html#cb329-5" tabindex="-1"></a><span class="fu">summary</span>(rent_fit1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = rent ~ size + factor(rooms) + year + factor(area) + 
##     factor(good) + factor(best) + factor(warm) + factor(central) + 
##     factor(tiles) + factor(bathextra) + factor(kitchen), family = Gamma(link = &quot;log&quot;), 
##     data = rent)
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         0.3241388  0.5371582   0.603 0.546289    
## size                0.0118012  0.0004383  26.924  &lt; 2e-16 ***
## factor(rooms)2      0.1004951  0.0208322   4.824 1.51e-06 ***
## factor(rooms)3      0.1101095  0.0260531   4.226 2.48e-05 ***
## factor(rooms)4      0.0383899  0.0353086   1.087 0.277049    
## factor(rooms)5     -0.0453271  0.0549179  -0.825 0.409264    
## factor(rooms)6     -0.1669296  0.0841069  -1.985 0.047310 *  
## year                0.0026328  0.0002727   9.656  &lt; 2e-16 ***
## factor(area)2      -0.0180143  0.0438585  -0.411 0.681310    
## factor(area)3      -0.0243536  0.0451711  -0.539 0.589849    
## factor(area)4      -0.0580303  0.0446632  -1.299 0.193995    
## factor(area)5      -0.0297452  0.0444352  -0.669 0.503313    
## factor(area)6      -0.0699323  0.0509111  -1.374 0.169714    
## factor(area)7      -0.1591505  0.0507257  -3.137 0.001729 ** 
## factor(area)8      -0.0717792  0.0517041  -1.388 0.165209    
## factor(area)9      -0.0706994  0.0435020  -1.625 0.104277    
## factor(area)10     -0.1131664  0.0525807  -2.152 0.031497 *  
## factor(area)11     -0.1898598  0.0510428  -3.720 0.000205 ***
## factor(area)12     -0.0526759  0.0484641  -1.087 0.277208    
## factor(area)13     -0.0752803  0.0476511  -1.580 0.114304    
## factor(area)14     -0.2092354  0.0520687  -4.018 6.07e-05 ***
## factor(area)15     -0.0959255  0.0559367  -1.715 0.086519 .  
## factor(area)16     -0.1839807  0.0468027  -3.931 8.75e-05 ***
## factor(area)17     -0.1185536  0.0508523  -2.331 0.019834 *  
## factor(area)18     -0.0572051  0.0490754  -1.166 0.243891    
## factor(area)19     -0.1330388  0.0470426  -2.828 0.004730 ** 
## factor(area)20     -0.1082865  0.0534291  -2.027 0.042821 *  
## factor(area)21     -0.1364462  0.0521111  -2.618 0.008901 ** 
## factor(area)22     -0.1961539  0.0659919  -2.972 0.002990 ** 
## factor(area)23     -0.1694169  0.0791074  -2.142 0.032345 *  
## factor(area)24     -0.1685041  0.0623742  -2.702 0.006961 ** 
## factor(area)25     -0.1635299  0.0464301  -3.522 0.000438 ***
## factor(good)1       0.0600476  0.0143014   4.199 2.80e-05 ***
## factor(best)1       0.1628041  0.0399385   4.076 4.75e-05 ***
## factor(warm)1      -0.3523173  0.0359115  -9.811  &lt; 2e-16 ***
## factor(central)1   -0.1738442  0.0245576  -7.079 2.00e-12 ***
## factor(tiles)1     -0.0816743  0.0146699  -5.567 2.93e-08 ***
## factor(bathextra)1  0.0713144  0.0204249   3.492 0.000491 ***
## factor(kitchen)1    0.1552424  0.0222566   6.975 4.13e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Gamma family taken to be 0.06367392)
## 
##     Null deviance: 378.02  on 2052  degrees of freedom
## Residual deviance: 143.27  on 2014  degrees of freedom
## AIC: 26142
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>We see many covariates (or levels of a categorical covariate) are statistically significant. We should still, however, see if we can remove some of these covariates to simplify the model. The covariates <code>area</code> has a large number of categories, and some that are not statistically significant. We can investigate whether or not we should include this covariate in the model by fitting a new GLM without <code>area</code> and performing a LRT. We do so with the following code:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="glm.html#cb331-1" tabindex="-1"></a><span class="co"># fit the model without factor(area)</span></span>
<span id="cb331-2"><a href="glm.html#cb331-2" tabindex="-1"></a>rent_fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rent <span class="sc">~</span> size <span class="sc">+</span> <span class="fu">factor</span>(rooms) <span class="sc">+</span> year <span class="sc">+</span> </span>
<span id="cb331-3"><a href="glm.html#cb331-3" tabindex="-1"></a>    <span class="fu">factor</span>(good) <span class="sc">+</span> <span class="fu">factor</span>(best) <span class="sc">+</span> <span class="fu">factor</span>(warm) <span class="sc">+</span> <span class="fu">factor</span>(central) <span class="sc">+</span> </span>
<span id="cb331-4"><a href="glm.html#cb331-4" tabindex="-1"></a>    <span class="fu">factor</span>(tiles) <span class="sc">+</span> <span class="fu">factor</span>(bathextra) <span class="sc">+</span> <span class="fu">factor</span>(kitchen), <span class="at">data =</span> rent,</span>
<span id="cb331-5"><a href="glm.html#cb331-5" tabindex="-1"></a>                  <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb331-6"><a href="glm.html#cb331-6" tabindex="-1"></a></span>
<span id="cb331-7"><a href="glm.html#cb331-7" tabindex="-1"></a><span class="co"># perform the LRT</span></span>
<span id="cb331-8"><a href="glm.html#cb331-8" tabindex="-1"></a><span class="fu">anova</span>(rent_fit2, rent_fit1, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: rent ~ size + factor(rooms) + year + factor(good) + factor(best) + 
##     factor(warm) + factor(central) + factor(tiles) + factor(bathextra) + 
##     factor(kitchen)
## Model 2: rent ~ size + factor(rooms) + year + factor(area) + factor(good) + 
##     factor(best) + factor(warm) + factor(central) + factor(tiles) + 
##     factor(bathextra) + factor(kitchen)
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1      2038     148.46                          
## 2      2014     143.27 24   5.1891 3.509e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The results of this test give us a very small <span class="math inline">\(p\)</span>-value (&lt;0.001) indicating that we reject the null hypothesis that the simpler model fit is adequate. That is, we should not remove <code>area</code> from the model.</p>
<p>We can further see if other covariates should be removed from the model. Some levels of <code>rooms</code> are insignificant, and so we can fit a model without it and again perform a LRT:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="glm.html#cb333-1" tabindex="-1"></a><span class="co"># fit the model without factor(area)</span></span>
<span id="cb333-2"><a href="glm.html#cb333-2" tabindex="-1"></a>rent_fit3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rent <span class="sc">~</span> size <span class="sc">+</span>  year <span class="sc">+</span> <span class="fu">factor</span>(area) <span class="sc">+</span></span>
<span id="cb333-3"><a href="glm.html#cb333-3" tabindex="-1"></a>    <span class="fu">factor</span>(good) <span class="sc">+</span> <span class="fu">factor</span>(best) <span class="sc">+</span> <span class="fu">factor</span>(warm) <span class="sc">+</span> <span class="fu">factor</span>(central) <span class="sc">+</span> </span>
<span id="cb333-4"><a href="glm.html#cb333-4" tabindex="-1"></a>    <span class="fu">factor</span>(tiles) <span class="sc">+</span> <span class="fu">factor</span>(bathextra) <span class="sc">+</span> <span class="fu">factor</span>(kitchen), <span class="at">data =</span> rent,</span>
<span id="cb333-5"><a href="glm.html#cb333-5" tabindex="-1"></a>                  <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb333-6"><a href="glm.html#cb333-6" tabindex="-1"></a></span>
<span id="cb333-7"><a href="glm.html#cb333-7" tabindex="-1"></a><span class="co"># perform the LRT, comparing to fit1 as fit2 was not adequate</span></span>
<span id="cb333-8"><a href="glm.html#cb333-8" tabindex="-1"></a><span class="fu">anova</span>(rent_fit3, rent_fit1, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: rent ~ size + year + factor(area) + factor(good) + factor(best) + 
##     factor(warm) + factor(central) + factor(tiles) + factor(bathextra) + 
##     factor(kitchen)
## Model 2: rent ~ size + factor(rooms) + year + factor(area) + factor(good) + 
##     factor(best) + factor(warm) + factor(central) + factor(tiles) + 
##     factor(bathextra) + factor(kitchen)
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1      2019     147.65                          
## 2      2014     143.27  5   4.3775 1.867e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The results of this test also give us a very small <span class="math inline">\(p\)</span>-value (&lt;0.001) indicating that we reject the null hypothesis that the simpler model fit is adequate. That is, we should not remove <code>rooms</code> from the model.</p>
<p>It does not appear that we should reduce the model further, and we can check this by using the <code>step()</code> function to compare different models by the AIC values:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="glm.html#cb335-1" tabindex="-1"></a><span class="co"># perform backward selection based on AIC</span></span>
<span id="cb335-2"><a href="glm.html#cb335-2" tabindex="-1"></a><span class="fu">step</span>(rent_fit1, <span class="at">direction =</span> <span class="st">&quot;backward&quot;</span>) </span></code></pre></div>
<pre><code>## Start:  AIC=26142.16
## rent ~ size + factor(rooms) + year + factor(area) + factor(good) + 
##     factor(best) + factor(warm) + factor(central) + factor(tiles) + 
##     factor(bathextra) + factor(kitchen)
## 
##                     Df Deviance   AIC
## &lt;none&gt;                   143.27 26142
## - factor(bathextra)  1   144.07 26153
## - factor(best)       1   144.38 26158
## - factor(good)       1   144.41 26158
## - factor(tiles)      1   145.21 26171
## - factor(area)      24   148.46 26176
## - factor(central)    1   146.33 26188
## - factor(kitchen)    1   146.51 26191
## - factor(rooms)      5   147.65 26201
## - factor(warm)       1   149.06 26231
## - year               1   149.44 26237
## - size               1   189.89 26872</code></pre>
<pre><code>## 
## Call:  glm(formula = rent ~ size + factor(rooms) + year + factor(area) + 
##     factor(good) + factor(best) + factor(warm) + factor(central) + 
##     factor(tiles) + factor(bathextra) + factor(kitchen), family = Gamma(link = &quot;log&quot;), 
##     data = rent)
## 
## Coefficients:
##        (Intercept)                size      factor(rooms)2  
##           0.324139            0.011801            0.100495  
##     factor(rooms)3      factor(rooms)4      factor(rooms)5  
##           0.110109            0.038390           -0.045327  
##     factor(rooms)6                year       factor(area)2  
##          -0.166930            0.002633           -0.018014  
##      factor(area)3       factor(area)4       factor(area)5  
##          -0.024354           -0.058030           -0.029745  
##      factor(area)6       factor(area)7       factor(area)8  
##          -0.069932           -0.159150           -0.071779  
##      factor(area)9      factor(area)10      factor(area)11  
##          -0.070699           -0.113166           -0.189860  
##     factor(area)12      factor(area)13      factor(area)14  
##          -0.052676           -0.075280           -0.209235  
##     factor(area)15      factor(area)16      factor(area)17  
##          -0.095925           -0.183981           -0.118554  
##     factor(area)18      factor(area)19      factor(area)20  
##          -0.057205           -0.133039           -0.108286  
##     factor(area)21      factor(area)22      factor(area)23  
##          -0.136446           -0.196154           -0.169417  
##     factor(area)24      factor(area)25       factor(good)1  
##          -0.168504           -0.163530            0.060048  
##      factor(best)1       factor(warm)1    factor(central)1  
##           0.162804           -0.352317           -0.173844  
##     factor(tiles)1  factor(bathextra)1    factor(kitchen)1  
##          -0.081674            0.071314            0.155242  
## 
## Degrees of Freedom: 2052 Total (i.e. Null);  2014 Residual
## Null Deviance:       378 
## Residual Deviance: 143.3     AIC: 26140</code></pre>
<p>The final model selected by a backwards-selection process also kept all of the main effects in the final model.</p>
<p>We can also consider adding interaction terms. <code>year</code> and <code>size</code> are both statistically significant, and perhaps there is an added increase in rent for units of the same size build in newer years. To see if this is true, we can build a model including the interaction term and again perform an LRT against <code>rent_fit1</code>:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="glm.html#cb338-1" tabindex="-1"></a><span class="co"># include interaction between year and size</span></span>
<span id="cb338-2"><a href="glm.html#cb338-2" tabindex="-1"></a>rent_fit4 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rent <span class="sc">~</span> size <span class="sc">+</span> <span class="fu">factor</span>(rooms) <span class="sc">+</span> year <span class="sc">+</span> <span class="fu">factor</span>(area) <span class="sc">+</span> </span>
<span id="cb338-3"><a href="glm.html#cb338-3" tabindex="-1"></a>    <span class="fu">factor</span>(good) <span class="sc">+</span> <span class="fu">factor</span>(best) <span class="sc">+</span> <span class="fu">factor</span>(warm) <span class="sc">+</span> <span class="fu">factor</span>(central) <span class="sc">+</span> </span>
<span id="cb338-4"><a href="glm.html#cb338-4" tabindex="-1"></a>    <span class="fu">factor</span>(tiles) <span class="sc">+</span> <span class="fu">factor</span>(bathextra) <span class="sc">+</span> <span class="fu">factor</span>(kitchen) <span class="sc">+</span> year<span class="sc">*</span>size, <span class="at">data =</span> rent,</span>
<span id="cb338-5"><a href="glm.html#cb338-5" tabindex="-1"></a>                  <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb338-6"><a href="glm.html#cb338-6" tabindex="-1"></a><span class="co"># show the output</span></span>
<span id="cb338-7"><a href="glm.html#cb338-7" tabindex="-1"></a><span class="fu">summary</span>(rent_fit4)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = rent ~ size + factor(rooms) + year + factor(area) + 
##     factor(good) + factor(best) + factor(warm) + factor(central) + 
##     factor(tiles) + factor(bathextra) + factor(kitchen) + year * 
##     size, family = Gamma(link = &quot;log&quot;), data = rent)
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         2.920e+00  1.441e+00   2.027 0.042819 *  
## size               -2.215e-02  1.742e-02  -1.271 0.203717    
## factor(rooms)2      9.283e-02  2.122e-02   4.375 1.28e-05 ***
## factor(rooms)3      9.764e-02  2.687e-02   3.634 0.000286 ***
## factor(rooms)4      2.470e-02  3.602e-02   0.686 0.492987    
## factor(rooms)5     -5.413e-02  5.507e-02  -0.983 0.325738    
## factor(rooms)6     -1.799e-01  8.415e-02  -2.138 0.032649 *  
## year                1.306e-03  7.353e-04   1.777 0.075755 .  
## factor(area)2      -2.065e-02  4.384e-02  -0.471 0.637705    
## factor(area)3      -2.636e-02  4.514e-02  -0.584 0.559262    
## factor(area)4      -5.953e-02  4.463e-02  -1.334 0.182404    
## factor(area)5      -3.256e-02  4.442e-02  -0.733 0.463664    
## factor(area)6      -7.244e-02  5.089e-02  -1.424 0.154732    
## factor(area)7      -1.609e-01  5.069e-02  -3.174 0.001524 ** 
## factor(area)8      -7.575e-02  5.171e-02  -1.465 0.143099    
## factor(area)9      -7.440e-02  4.350e-02  -1.711 0.087325 .  
## factor(area)10     -1.142e-01  5.253e-02  -2.173 0.029865 *  
## factor(area)11     -1.902e-01  5.099e-02  -3.730 0.000197 ***
## factor(area)12     -5.657e-02  4.846e-02  -1.167 0.243241    
## factor(area)13     -7.876e-02  4.765e-02  -1.653 0.098486 .  
## factor(area)14     -2.109e-01  5.203e-02  -4.054 5.23e-05 ***
## factor(area)15     -9.675e-02  5.588e-02  -1.731 0.083549 .  
## factor(area)16     -1.864e-01  4.679e-02  -3.983 7.04e-05 ***
## factor(area)17     -1.251e-01  5.089e-02  -2.458 0.014048 *  
## factor(area)18     -6.091e-02  4.907e-02  -1.241 0.214655    
## factor(area)19     -1.376e-01  4.708e-02  -2.922 0.003517 ** 
## factor(area)20     -1.119e-01  5.342e-02  -2.094 0.036356 *  
## factor(area)21     -1.399e-01  5.209e-02  -2.685 0.007310 ** 
## factor(area)22     -2.030e-01  6.602e-02  -3.074 0.002138 ** 
## factor(area)23     -1.740e-01  7.906e-02  -2.201 0.027874 *  
## factor(area)24     -1.730e-01  6.235e-02  -2.774 0.005586 ** 
## factor(area)25     -1.679e-01  4.645e-02  -3.614 0.000309 ***
## factor(good)1       5.901e-02  1.430e-02   4.128 3.80e-05 ***
## factor(best)1       1.615e-01  3.990e-02   4.048 5.35e-05 ***
## factor(warm)1      -3.484e-01  3.595e-02  -9.691  &lt; 2e-16 ***
## factor(central)1   -1.771e-01  2.459e-02  -7.200 8.46e-13 ***
## factor(tiles)1     -8.190e-02  1.466e-02  -5.588 2.61e-08 ***
## factor(bathextra)1  7.039e-02  2.041e-02   3.448 0.000576 ***
## factor(kitchen)1    1.551e-01  2.223e-02   6.977 4.07e-12 ***
## size:year           1.746e-05  8.956e-06   1.949 0.051421 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Gamma family taken to be 0.06354123)
## 
##     Null deviance: 378.02  on 2052  degrees of freedom
## Residual deviance: 143.03  on 2013  degrees of freedom
## AIC: 26141
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="glm.html#cb340-1" tabindex="-1"></a><span class="co"># perform the LRT</span></span>
<span id="cb340-2"><a href="glm.html#cb340-2" tabindex="-1"></a><span class="fu">anova</span>(rent_fit1, rent_fit4, <span class="at">test =</span> <span class="st">&quot;LRT&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: rent ~ size + factor(rooms) + year + factor(area) + factor(good) + 
##     factor(best) + factor(warm) + factor(central) + factor(tiles) + 
##     factor(bathextra) + factor(kitchen)
## Model 2: rent ~ size + factor(rooms) + year + factor(area) + factor(good) + 
##     factor(best) + factor(warm) + factor(central) + factor(tiles) + 
##     factor(bathextra) + factor(kitchen) + year * size
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)  
## 1      2014     143.27                       
## 2      2013     143.03  1  0.23906  0.05242 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We see that the <span class="math inline">\(p\)</span>-value of this test is 0.0542. While it is common to only reject null hypotheses when <span class="math inline">\(p\)</span> &lt; 0.05, many statisticians argue that such cut-offs are arbitrary and should not be used. However, although borderline “statistically significant” according to the common threshold of 0.05, the coefficient on the <code>size:year</code> is very close to zero, indicating no practical significance. As such, we leave it out of the model and continue analysis with <code>rent_fit1</code>.</p>
<p>We note that while other interaction terms can be included, interactions between categorical covariates with a large number of levels may cause issues with the model fitting when sample sizes are small.</p>
</div>
</div>
<div id="glm-gamma-example-md" class="section level3 hasAnchor" number="4.9.2">
<h3><span class="header-section-number">4.9.2</span> Model Diagnostics<a href="glm.html#glm-gamma-example-md" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We need to evaluate the model fit prior to interpreting the coefficients and determining associations. We begin by looking at the residuals for any outliers, extreme values, or overall poor model fit:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="glm.html#cb342-1" tabindex="-1"></a>resid_rent <span class="ot">&lt;-</span> <span class="fu">residuals.glm</span>(rent_fit1)</span>
<span id="cb342-2"><a href="glm.html#cb342-2" tabindex="-1"></a>fitted_rent <span class="ot">&lt;-</span> rent_fit1<span class="sc">$</span>fitted.values</span>
<span id="cb342-3"><a href="glm.html#cb342-3" tabindex="-1"></a><span class="fu">plot</span>(fitted_rent, resid_rent, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">ylab =</span> <span class="st">&quot;Deviance Residuals&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Fitted Values&quot;</span>)</span>
<span id="cb342-4"><a href="glm.html#cb342-4" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb342-5"><a href="glm.html#cb342-5" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:glm-gamma-example-resid"></span>
<img src="topics_in_consulting_files/figure-html/glm-gamma-example-resid-1.png" alt="Diagnostic plot for Gamma GLM fit" width="672" />
<p class="caption">
Figure 4.17: Diagnostic plot for Gamma GLM fit
</p>
</div>
<p>We see that all of the residuals fall between <span class="math inline">\((-2,2)\)</span>, which does not provide any evidence of poor model fit.</p>
<p>We should also check for multicollinearity using the <code>vif()</code> function from the <a href="https://CRAN.R-project.org/package=car"><strong>car</strong></a> package:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="glm.html#cb343-1" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(rent_fit1)</span></code></pre></div>
<pre><code>##                       GVIF Df GVIF^(1/(2*Df))
## size              3.920003  1        1.979900
## factor(rooms)     3.991510  5        1.148454
## year              1.482946  1        1.217763
## factor(area)      2.528454 24        1.019513
## factor(good)      1.570486  1        1.253190
## factor(best)      1.102579  1        1.050038
## factor(warm)      1.407129  1        1.186225
## factor(central)   1.516196  1        1.231339
## factor(tiles)     1.046607  1        1.023038
## factor(bathextra) 1.134967  1        1.065348
## factor(kitchen)   1.081678  1        1.040037</code></pre>
<p>All VIF values are below 10, and as such we do not have reason to be concerned about multicollinearity in this model.</p>
<div id="glm-gamma-example-interpretation" class="section level4 hasAnchor" number="4.9.2.1">
<h4><span class="header-section-number">4.9.2.1</span> Model Interpretation<a href="glm.html#glm-gamma-example-interpretation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Recall the final model chosen by the model selection procedure above:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="glm.html#cb345-1" tabindex="-1"></a><span class="fu">summary</span>(rent_fit1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = rent ~ size + factor(rooms) + year + factor(area) + 
##     factor(good) + factor(best) + factor(warm) + factor(central) + 
##     factor(tiles) + factor(bathextra) + factor(kitchen), family = Gamma(link = &quot;log&quot;), 
##     data = rent)
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         0.3241388  0.5371582   0.603 0.546289    
## size                0.0118012  0.0004383  26.924  &lt; 2e-16 ***
## factor(rooms)2      0.1004951  0.0208322   4.824 1.51e-06 ***
## factor(rooms)3      0.1101095  0.0260531   4.226 2.48e-05 ***
## factor(rooms)4      0.0383899  0.0353086   1.087 0.277049    
## factor(rooms)5     -0.0453271  0.0549179  -0.825 0.409264    
## factor(rooms)6     -0.1669296  0.0841069  -1.985 0.047310 *  
## year                0.0026328  0.0002727   9.656  &lt; 2e-16 ***
## factor(area)2      -0.0180143  0.0438585  -0.411 0.681310    
## factor(area)3      -0.0243536  0.0451711  -0.539 0.589849    
## factor(area)4      -0.0580303  0.0446632  -1.299 0.193995    
## factor(area)5      -0.0297452  0.0444352  -0.669 0.503313    
## factor(area)6      -0.0699323  0.0509111  -1.374 0.169714    
## factor(area)7      -0.1591505  0.0507257  -3.137 0.001729 ** 
## factor(area)8      -0.0717792  0.0517041  -1.388 0.165209    
## factor(area)9      -0.0706994  0.0435020  -1.625 0.104277    
## factor(area)10     -0.1131664  0.0525807  -2.152 0.031497 *  
## factor(area)11     -0.1898598  0.0510428  -3.720 0.000205 ***
## factor(area)12     -0.0526759  0.0484641  -1.087 0.277208    
## factor(area)13     -0.0752803  0.0476511  -1.580 0.114304    
## factor(area)14     -0.2092354  0.0520687  -4.018 6.07e-05 ***
## factor(area)15     -0.0959255  0.0559367  -1.715 0.086519 .  
## factor(area)16     -0.1839807  0.0468027  -3.931 8.75e-05 ***
## factor(area)17     -0.1185536  0.0508523  -2.331 0.019834 *  
## factor(area)18     -0.0572051  0.0490754  -1.166 0.243891    
## factor(area)19     -0.1330388  0.0470426  -2.828 0.004730 ** 
## factor(area)20     -0.1082865  0.0534291  -2.027 0.042821 *  
## factor(area)21     -0.1364462  0.0521111  -2.618 0.008901 ** 
## factor(area)22     -0.1961539  0.0659919  -2.972 0.002990 ** 
## factor(area)23     -0.1694169  0.0791074  -2.142 0.032345 *  
## factor(area)24     -0.1685041  0.0623742  -2.702 0.006961 ** 
## factor(area)25     -0.1635299  0.0464301  -3.522 0.000438 ***
## factor(good)1       0.0600476  0.0143014   4.199 2.80e-05 ***
## factor(best)1       0.1628041  0.0399385   4.076 4.75e-05 ***
## factor(warm)1      -0.3523173  0.0359115  -9.811  &lt; 2e-16 ***
## factor(central)1   -0.1738442  0.0245576  -7.079 2.00e-12 ***
## factor(tiles)1     -0.0816743  0.0146699  -5.567 2.93e-08 ***
## factor(bathextra)1  0.0713144  0.0204249   3.492 0.000491 ***
## factor(kitchen)1    0.1552424  0.0222566   6.975 4.13e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Gamma family taken to be 0.06367392)
## 
##     Null deviance: 378.02  on 2052  degrees of freedom
## Residual deviance: 143.27  on 2014  degrees of freedom
## AIC: 26142
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>We can write the chosen model (<code>rent_fit1)</code>) as</p>
<p><span class="math display">\[
\log(y_i) = \beta_0 + \beta_1x_1 + \beta_2x_2 + \beta_3x_3 + \dots  + \beta_{38}x_{38}
\]</span>
or equivalently
<span class="math display">\[
\begin{aligned}
y_i &amp;= \exp( \beta_0 + \beta_1x_1 + \beta_2x_2 + \beta_3x_3 + \dots  + \beta_{38}x_{38})\\
&amp;=\exp(\beta_0)\exp(\beta_1)^{x_1}\exp(\beta_2)^{x_2}\exp(\beta_3)^{x_3}\dots\exp(\beta_{38})^{x_{38}}
\end{aligned}
\]</span>
where <span class="math inline">\(x_{1}, x_{2}, \dots, x_{38}\)</span> represent each covariate (or level or each covariates) as in the summary of <code>rent_fit1</code>.</p>
<p>From this model, we interpret <span class="math inline">\(\exp(\beta_0) = \exp(0.324) = 1.383\)</span> as the expected clear rent when all other covariates are 0. For the other covariates, we interpret <span class="math inline">\(\exp(\beta_j)\)</span> as the expected multiplicative increase of the clear rent for a one unit increase in <span class="math inline">\(x_j\)</span> when all other covariates are 0.
For example, we would interpret <span class="math inline">\(\exp(\beta_1) = \exp(0.012) = 1.012\)</span> as the expected multiplicative increase of the clear rent for a one unit increase in the living space per squared meter when all other covariates are 0. This result is statistically significant.</p>
<p>We can also use these models to predict. Fore example, if we wanted to predict the clear rent for a 100 square meter home with 2 rooms built in 1995 in municipality 3 with a “good” address, warm water, central heating, no bathroom tiles, no special furniture in the bathroom, and an upmarket kitchen. We can create a new observation as if it is in the data frame and use the <code>predict()</code> function to obtain a prediction. We do this in R by:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="glm.html#cb347-1" tabindex="-1"></a><span class="co"># create a data frame using info we want to use to predict</span></span>
<span id="cb347-2"><a href="glm.html#cb347-2" tabindex="-1"></a>newdata <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">size =</span> <span class="dv">100</span>, <span class="at">rooms =</span> <span class="dv">2</span>, <span class="at">year =</span> <span class="dv">1995</span>, </span>
<span id="cb347-3"><a href="glm.html#cb347-3" tabindex="-1"></a>                     <span class="at">area =</span> <span class="dv">3</span>, <span class="at">good =</span> <span class="dv">1</span>, <span class="at">best =</span> <span class="dv">0</span>, <span class="at">warm =</span> <span class="dv">1</span>, </span>
<span id="cb347-4"><a href="glm.html#cb347-4" tabindex="-1"></a>                     <span class="at">central =</span> <span class="dv">1</span>, <span class="at">tiles =</span> <span class="dv">0</span>, <span class="at">bathextra =</span> <span class="dv">0</span>, <span class="at">kitchen =</span> <span class="dv">1</span>)</span>
<span id="cb347-5"><a href="glm.html#cb347-5" tabindex="-1"></a></span>
<span id="cb347-6"><a href="glm.html#cb347-6" tabindex="-1"></a><span class="co">#use model to predict value of am</span></span>
<span id="cb347-7"><a href="glm.html#cb347-7" tabindex="-1"></a><span class="fu">predict</span>(rent_fit1, newdata, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<pre><code>##        1 
## 679.8872</code></pre>
<p>We estimate the clear rent for the above unit to be 679.89 Euros based on the Gamma GLM.</p>
</div>
</div>
</div>
<div id="further-reading" class="section level2 hasAnchor" number="4.10">
<h2><span class="header-section-number">4.10</span> Further Reading<a href="glm.html#further-reading" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For a more detailed, theoretical introduction to generalized linear models, readers are directed to <span class="citation">(<a href="#ref-mccullagh2019">McCullagh and Nelder 2019</a>)</span>.</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-hilbe2013" class="csl-entry">
Hilbe, Joseph, Alain Zuur, and Elena Ieno. 2013. <em>Zuur, Alain.f, Joseph m. Hilbe, and Elena n Ieno, a Beginner’s Guide to GLM and GLMM with r: A Frequentist and Bayesian Perspective for Ecologists, HIghland Statistics</em>.
</div>
<div id="ref-karunarathne2022" class="csl-entry">
Karunarathne, Piyal, Nicolas Pocquet, Pierrick Labbé, and Pascal Milesi. 2022. <span>“BioRssay: An r Package for Analyses of Bioassays and Probit Graphs.”</span> <em>Parasites &amp; Vectors</em> 15 (1): 1–6.
</div>
<div id="ref-kerr1996" class="csl-entry">
Kerr, David, and James Meador. 1996. <span>“Modeling Dose Response Using Generalized Linear Models.”</span> <em>Environmental Toxicology and Chemistry</em> 15 (March): 395–401. <a href="https://doi.org/10.1002/etc.5620150325">https://doi.org/10.1002/etc.5620150325</a>.
</div>
<div id="ref-mccullagh2019" class="csl-entry">
McCullagh, Peter, and John A Nelder. 2019. <em>Generalized Linear Models</em>. Routledge.
</div>
<div id="ref-milesi2013" class="csl-entry">
Milesi, P, N Pocquet, and P Labbé. 2013. <span>“BioRssay: A r Script for Bioassay Analyses.”</span> <em>BioRssay: A R Script for Bioassay Analyses</em>.
</div>
<div id="ref-myers1997" class="csl-entry">
Myers, Raymond H, and Douglas C Montgomery. 1997. <span>“A Tutorial on Generalized Linear Models.”</span> <em>Journal of Quality Technology</em> 29 (3): 274–91.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-to-linear-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="introduction-to-nonparametric-statistics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
